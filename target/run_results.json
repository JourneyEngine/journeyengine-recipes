{"results": [{"node": {"raw_sql": "SELECT\nsite,\naccount,\nplatform,\nbigquery_name\nFROM (\n  SELECT\n  site,\n  account,\n  platform,\n  bigquery_name,\n  time_of_entry,\n  first_value(time_of_entry) over (order by time_of_entry desc) lv\n  FROM `{{ target.project }}.agency_data_pipeline.accounts`\n  )\n  WHERE time_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "admin", "accounts_proc"], "unique_id": "model.journeyengine_recipes.accounts_proc", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "admin/accounts_proc.sql", "original_file_path": "models/admin/accounts_proc.sql", "name": "accounts_proc", "resource_type": "model", "alias": "accounts_proc", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/admin/accounts_proc.sql", "compiled": true, "compiled_sql": "SELECT\nsite,\naccount,\nplatform,\nbigquery_name\nFROM (\n  SELECT\n  site,\n  account,\n  platform,\n  bigquery_name,\n  time_of_entry,\n  first_value(time_of_entry) over (order by time_of_entry desc) lv\n  FROM `journeyengine-recipes.agency_data_pipeline.accounts`\n  )\n  WHERE time_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\nsite,\naccount,\nplatform,\nbigquery_name\nFROM (\n  SELECT\n  site,\n  account,\n  platform,\n  bigquery_name,\n  time_of_entry,\n  first_value(time_of_entry) over (order by time_of_entry desc) lv\n  FROM `journeyengine-recipes.agency_data_pipeline.accounts`\n  )\n  WHERE time_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (14)", "execution_time": 3.85851788520813, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:31:57.115011Z", "completed_at": "2020-03-02T23:31:57.159506Z"}, {"name": "execute", "started_at": "2020-03-02T23:31:57.176878Z", "completed_at": "2020-03-02T23:32:00.970377Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\nmax(goal_type) goal_type,\naccount,\nmax(time_of_entry) time_of_entry\nFROM  ( \n\n\tSELECT  \n\tsite,\n\tbigquery_name,\n\tplatform,\n\ttrim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,\n\tgoal_type,\n\taccount,\n\ttime_of_entry,\n\tfirst_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv\n\tFROM `{{ target.project }}.agency_data_pipeline.conversion_goals` \n\n) \n\nWHERE lv = time_of_entry\ngroup by site, bigquery_name, platform, account, goal_name", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "admin", "conversion_goals_proc"], "unique_id": "model.journeyengine_recipes.conversion_goals_proc", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "admin/conversion_goals_proc.sql", "original_file_path": "models/admin/conversion_goals_proc.sql", "name": "conversion_goals_proc", "resource_type": "model", "alias": "conversion_goals_proc", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/admin/conversion_goals_proc.sql", "compiled": true, "compiled_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\nmax(goal_type) goal_type,\naccount,\nmax(time_of_entry) time_of_entry\nFROM  ( \n\n\tSELECT  \n\tsite,\n\tbigquery_name,\n\tplatform,\n\ttrim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,\n\tgoal_type,\n\taccount,\n\ttime_of_entry,\n\tfirst_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv\n\tFROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` \n\n) \n\nWHERE lv = time_of_entry\ngroup by site, bigquery_name, platform, account, goal_name", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\nmax(goal_type) goal_type,\naccount,\nmax(time_of_entry) time_of_entry\nFROM  ( \n\n\tSELECT  \n\tsite,\n\tbigquery_name,\n\tplatform,\n\ttrim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,\n\tgoal_type,\n\taccount,\n\ttime_of_entry,\n\tfirst_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv\n\tFROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` \n\n) \n\nWHERE lv = time_of_entry\ngroup by site, bigquery_name, platform, account, goal_name", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (7)", "execution_time": 4.094051122665405, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:31:57.115281Z", "completed_at": "2020-03-02T23:31:57.159009Z"}, {"name": "execute", "started_at": "2020-03-02T23:31:57.159858Z", "completed_at": "2020-03-02T23:32:01.206707Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\ndate, \naccount, \nchannel,\nplatform,\nurl,\nkeyword,\n0 as cost,\nsum(impressions) as impressions,\nsum(clicks) as clicks,\n0 as conversions\nFROM \n  ( \n\tSELECT  \n\tdate, \n\tsite as account,\n\t'Organic' as channel,\n\t'Organic' as platform,\n\tlower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url,\n\tkeyword,\n\tmax(impressions) as impressions, \n\tmax(clicks) as clicks,\n\tFROM `{{ target.project }}.agency_data_pipeline.gsc`\n\tGROUP BY date, account, channel, platform, url, keyword\n  ) \nGROUP BY date, account, channel, platform, url, keyword\nORDER BY account asc, date asc, url asc", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "search-console", "gsc_stats"], "unique_id": "model.journeyengine_recipes.gsc_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/search-console/gsc_stats.sql", "original_file_path": "models/base/search-console/gsc_stats.sql", "name": "gsc_stats", "resource_type": "model", "alias": "gsc_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/search-console/gsc_stats.sql", "compiled": true, "compiled_sql": "SELECT\ndate, \naccount, \nchannel,\nplatform,\nurl,\nkeyword,\n0 as cost,\nsum(impressions) as impressions,\nsum(clicks) as clicks,\n0 as conversions\nFROM \n  ( \n\tSELECT  \n\tdate, \n\tsite as account,\n\t'Organic' as channel,\n\t'Organic' as platform,\n\tlower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url,\n\tkeyword,\n\tmax(impressions) as impressions, \n\tmax(clicks) as clicks,\n\tFROM `journeyengine-recipes.agency_data_pipeline.gsc`\n\tGROUP BY date, account, channel, platform, url, keyword\n  ) \nGROUP BY date, account, channel, platform, url, keyword\nORDER BY account asc, date asc, url asc", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\ndate, \naccount, \nchannel,\nplatform,\nurl,\nkeyword,\n0 as cost,\nsum(impressions) as impressions,\nsum(clicks) as clicks,\n0 as conversions\nFROM \n  ( \n\tSELECT  \n\tdate, \n\tsite as account,\n\t'Organic' as channel,\n\t'Organic' as platform,\n\tlower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url,\n\tkeyword,\n\tmax(impressions) as impressions, \n\tmax(clicks) as clicks,\n\tFROM `journeyengine-recipes.agency_data_pipeline.gsc`\n\tGROUP BY date, account, channel, platform, url, keyword\n  ) \nGROUP BY date, account, channel, platform, url, keyword\nORDER BY account asc, date asc, url asc", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (46026)", "execution_time": 4.360942125320435, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:31:57.132528Z", "completed_at": "2020-03-02T23:31:57.183022Z"}, {"name": "execute", "started_at": "2020-03-02T23:31:57.245979Z", "completed_at": "2020-03-02T23:32:01.474651Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom(\n    select\n    account,\n    'LinkedIn Ads' as platform,\n    date,\n    campaign,\n    group_set,\n    ad,\n    null as objective,\n    campaign_type placement,\n    cost spend,\n    impressions,\n    clicks,\n    link_clicks,\n    conversions,\n    time_of_entry,\n    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv\n    from `{{ target.project }}.agency_data_pipeline.linkedin_ads`\n  )\n  where time_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "linkedin-ads", "linkedin_adplatforms"], "unique_id": "model.journeyengine_recipes.linkedin_adplatforms", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/linkedin-ads/linkedin_adplatforms.sql", "original_file_path": "models/base/linkedin-ads/linkedin_adplatforms.sql", "name": "linkedin_adplatforms", "resource_type": "model", "alias": "linkedin_adplatforms", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/linkedin-ads/linkedin_adplatforms.sql", "compiled": true, "compiled_sql": "select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom(\n    select\n    account,\n    'LinkedIn Ads' as platform,\n    date,\n    campaign,\n    group_set,\n    ad,\n    null as objective,\n    campaign_type placement,\n    cost spend,\n    impressions,\n    clicks,\n    link_clicks,\n    conversions,\n    time_of_entry,\n    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv\n    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`\n  )\n  where time_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom(\n    select\n    account,\n    'LinkedIn Ads' as platform,\n    date,\n    campaign,\n    group_set,\n    ad,\n    null as objective,\n    campaign_type placement,\n    cost spend,\n    impressions,\n    clicks,\n    link_clicks,\n    conversions,\n    time_of_entry,\n    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv\n    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`\n  )\n  where time_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (76082)", "execution_time": 4.369240999221802, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:31:57.115418Z", "completed_at": "2020-03-02T23:31:57.170548Z"}, {"name": "execute", "started_at": "2020-03-02T23:31:57.217944Z", "completed_at": "2020-03-02T23:32:01.482296Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\nsite,\naccount,\nbigquery_name,\nsource,\nmedium,\nmax(platform_n) platform,\nmax(channel_n) channel,\ntime_of_entry\nFROM  ( \n\n\tSELECT  \n\tsite,\n\taccount,\n\tbigquery_name,\n\tsource,\n\tmedium,\n\tplatform as platform_n,\n\tchannel as channel_n,\n\ttime_of_entry,\n\tfirst_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv\n\tFROM `{{ target.project }}.agency_data_pipeline.mappings_ga` \n\n) \n\nWHERE lv = time_of_entry\ngroup by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "admin", "mappings_ga_proc"], "unique_id": "model.journeyengine_recipes.mappings_ga_proc", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "admin/mappings_ga_proc.sql", "original_file_path": "models/admin/mappings_ga_proc.sql", "name": "mappings_ga_proc", "resource_type": "model", "alias": "mappings_ga_proc", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/admin/mappings_ga_proc.sql", "compiled": true, "compiled_sql": "SELECT\nsite,\naccount,\nbigquery_name,\nsource,\nmedium,\nmax(platform_n) platform,\nmax(channel_n) channel,\ntime_of_entry\nFROM  ( \n\n\tSELECT  \n\tsite,\n\taccount,\n\tbigquery_name,\n\tsource,\n\tmedium,\n\tplatform as platform_n,\n\tchannel as channel_n,\n\ttime_of_entry,\n\tfirst_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv\n\tFROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` \n\n) \n\nWHERE lv = time_of_entry\ngroup by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\nsite,\naccount,\nbigquery_name,\nsource,\nmedium,\nmax(platform_n) platform,\nmax(channel_n) channel,\ntime_of_entry\nFROM  ( \n\n\tSELECT  \n\tsite,\n\taccount,\n\tbigquery_name,\n\tsource,\n\tmedium,\n\tplatform as platform_n,\n\tchannel as channel_n,\n\ttime_of_entry,\n\tfirst_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv\n\tFROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` \n\n) \n\nWHERE lv = time_of_entry\ngroup by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (252)", "execution_time": 2.6256351470947266, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:01.337362Z", "completed_at": "2020-03-02T23:32:01.349665Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:01.350057Z", "completed_at": "2020-03-02T23:32:03.961523Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'Facebook' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv\n  from `{{ target.project }}.agency_data_pipeline.facebook_insights` \n)\nwhere time_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "facebook-insights", "facebook_insights_stats"], "unique_id": "model.journeyengine_recipes.facebook_insights_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/facebook-insights/facebook_insights_stats.sql", "original_file_path": "models/base/facebook-insights/facebook_insights_stats.sql", "name": "facebook_insights_stats", "resource_type": "model", "alias": "facebook_insights_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/facebook-insights/facebook_insights_stats.sql", "compiled": true, "compiled_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'Facebook' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` \n)\nwhere time_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'Facebook' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` \n)\nwhere time_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (800)", "execution_time": 2.2465410232543945, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:01.729076Z", "completed_at": "2020-03-02T23:32:01.739038Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:01.739406Z", "completed_at": "2020-03-02T23:32:03.974110Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \n0 as shares,\n0 as link_clicks\nfrom (\n  select\n  'Instagram' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  0 as shares,\n  0 as link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (order by time_of_entry desc) lv\n  from `{{ target.project }}.agency_data_pipeline.instagram_insights` \n)\nwhere time_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "instagram-insights", "instagram_insights_stats"], "unique_id": "model.journeyengine_recipes.instagram_insights_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/instagram-insights/instagram_insights_stats.sql", "original_file_path": "models/base/instagram-insights/instagram_insights_stats.sql", "name": "instagram_insights_stats", "resource_type": "model", "alias": "instagram_insights_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/instagram-insights/instagram_insights_stats.sql", "compiled": true, "compiled_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \n0 as shares,\n0 as link_clicks\nfrom (\n  select\n  'Instagram' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  0 as shares,\n  0 as link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` \n)\nwhere time_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \n0 as shares,\n0 as link_clicks\nfrom (\n  select\n  'Instagram' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  0 as shares,\n  0 as link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` \n)\nwhere time_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (24)", "execution_time": 2.228350877761841, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:02.109317Z", "completed_at": "2020-03-02T23:32:02.121252Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:02.121753Z", "completed_at": "2020-03-02T23:32:04.335655Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'LinkedIn' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks,\n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `{{ target.project }}.agency_data_pipeline.linkedin_company_pages`\n)\nwhere time_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "linkedin-company-pages", "linkedin_company_pages_stats"], "unique_id": "model.journeyengine_recipes.linkedin_company_pages_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/linkedin-company-pages/linkedin_company_pages_stats.sql", "original_file_path": "models/base/linkedin-company-pages/linkedin_company_pages_stats.sql", "name": "linkedin_company_pages_stats", "resource_type": "model", "alias": "linkedin_company_pages_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/linkedin-company-pages/linkedin_company_pages_stats.sql", "compiled": true, "compiled_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'LinkedIn' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks,\n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`\n)\nwhere time_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'LinkedIn' as platform,\n  account, \n  date, \n  post_url,\n  post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks,\n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`\n)\nwhere time_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (0)", "execution_time": 1.9167959690093994, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:02.471158Z", "completed_at": "2020-03-02T23:32:02.481063Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:02.481408Z", "completed_at": "2020-03-02T23:32:04.386613Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\nplatform,\naccount, \ndate, \nnull as post_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\n0 as link_clicks\nfrom (\n  select\n  'Twitter' as platform,\n  account, \n  date, \n  post_url,\n  null as post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  0 as link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `{{ target.project }}.agency_data_pipeline.twitter_premium` \n)\nwhere \naccount is not null and\ntime_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "twitter-premium", "twitter_premium_stats"], "unique_id": "model.journeyengine_recipes.twitter_premium_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/twitter-premium/twitter_premium_stats.sql", "original_file_path": "models/base/twitter-premium/twitter_premium_stats.sql", "name": "twitter_premium_stats", "resource_type": "model", "alias": "twitter_premium_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/twitter-premium/twitter_premium_stats.sql", "compiled": true, "compiled_sql": "select\nplatform,\naccount, \ndate, \nnull as post_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\n0 as link_clicks\nfrom (\n  select\n  'Twitter' as platform,\n  account, \n  date, \n  post_url,\n  null as post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  0 as link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` \n)\nwhere \naccount is not null and\ntime_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\nplatform,\naccount, \ndate, \nnull as post_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\n0 as link_clicks\nfrom (\n  select\n  'Twitter' as platform,\n  account, \n  date, \n  post_url,\n  null as post_image_url,\n  post_text, \n  impressions, \n  reactions, \n  comments, \n  shares,\n  0 as link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` \n)\nwhere \naccount is not null and\ntime_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (0)", "execution_time": 2.430148124694824, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:04.347179Z", "completed_at": "2020-03-02T23:32:04.356966Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:04.357347Z", "completed_at": "2020-03-02T23:32:06.775442Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\nplatform,\naccount, \ndate, \nnull as post_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'YouTube' as platform,\n  account, \n  date, \n  post_url,\n  null as post_image_url,\n  post_text, \n  views as impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `{{ target.project }}.agency_data_pipeline.youtube_insights`\n)\nwhere time_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "youtube_insights", "youtube_insights_stats"], "unique_id": "model.journeyengine_recipes.youtube_insights_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/youtube_insights/youtube_insights_stats.sql", "original_file_path": "models/base/youtube_insights/youtube_insights_stats.sql", "name": "youtube_insights_stats", "resource_type": "model", "alias": "youtube_insights_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/youtube_insights/youtube_insights_stats.sql", "compiled": true, "compiled_sql": "select\nplatform,\naccount, \ndate, \nnull as post_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'YouTube' as platform,\n  account, \n  date, \n  post_url,\n  null as post_image_url,\n  post_text, \n  views as impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`\n)\nwhere time_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\nplatform,\naccount, \ndate, \nnull as post_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom (\n  select\n  'YouTube' as platform,\n  account, \n  date, \n  post_url,\n  null as post_image_url,\n  post_text, \n  views as impressions, \n  reactions, \n  comments, \n  shares,\n  link_clicks, \n  time_of_entry,\n  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv\n  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`\n)\nwhere time_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (0)", "execution_time": 2.1610119342803955, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:04.728803Z", "completed_at": "2020-03-02T23:32:04.740149Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:04.740512Z", "completed_at": "2020-03-02T23:32:06.888233Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom(\n    select\n    account,\n    'Twitter Ads' as platform,\n    date,\n    campaign,\n    group_set,\n    ad,\n    campaign_type as objective,\n    placement,\n    cost spend,\n    impressions,\n    clicks,\n    link_clicks,\n    conversions,\n    time_of_entry,\n    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv\n    from `{{ target.project }}.agency_data_pipeline.twitter_ads` \n    )\nwhere time_of_entry = lv", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "twitter-ads", "twitter_adplatforms"], "unique_id": "model.journeyengine_recipes.twitter_adplatforms", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/twitter-ads/twitter_adplatforms.sql", "original_file_path": "models/base/twitter-ads/twitter_adplatforms.sql", "name": "twitter_adplatforms", "resource_type": "model", "alias": "twitter_adplatforms", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [], "sources": [], "depends_on": {"nodes": [], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/twitter-ads/twitter_adplatforms.sql", "compiled": true, "compiled_sql": "select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom(\n    select\n    account,\n    'Twitter Ads' as platform,\n    date,\n    campaign,\n    group_set,\n    ad,\n    campaign_type as objective,\n    placement,\n    cost spend,\n    impressions,\n    clicks,\n    link_clicks,\n    conversions,\n    time_of_entry,\n    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv\n    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` \n    )\nwhere time_of_entry = lv", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom(\n    select\n    account,\n    'Twitter Ads' as platform,\n    date,\n    campaign,\n    group_set,\n    ad,\n    campaign_type as objective,\n    placement,\n    cost spend,\n    impressions,\n    clicks,\n    link_clicks,\n    conversions,\n    time_of_entry,\n    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv\n    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` \n    )\nwhere time_of_entry = lv", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (0)", "execution_time": 2.2303807735443115, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:05.126034Z", "completed_at": "2020-03-02T23:32:05.136104Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:05.136456Z", "completed_at": "2020-03-02T23:32:07.354438Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Google Ads') %}\n\n{% if accounts != [] %}\n\nwith adwords_campaigns as (\n      {% for account in accounts %}\n \n\tSELECT  \n\t'Paid' as channel,\n\t'Google Ads' as platform,\n\tday,\n\tcampaignid,\n\tcampaign,\n\taccount as account,\n\tcost/1000000 cost, \n\timpressions as impressions, \n\tclicks, \n\tconversions,\n\t_sdc_sequence,\n\tfirst_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv\n\tFROM `{{ target.project }}.google_ads_{{account}}.CAMPAIGN_PERFORMANCE_REPORT`\n\t    \t{% if not loop.last %} UNION ALL {% endif %}\n            {% endfor %}\n)\n\nSELECT\nday,\ncampaignid,\ncampaign,\naccount, \nchannel,\nplatform,\nsum(cost) cost,\nsum(impressions) impressions,\nsum(clicks) clicks,\nsum(conversions) conversions\nFROM adwords_campaigns\n\nWHERE lv = _sdc_sequence\nGROUP BY day, campaignid, account, channel, platform, campaign\n\n {% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "adwords", "adwords_campaigns"], "unique_id": "model.journeyengine_recipes.adwords_campaigns", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/adwords/adwords_campaigns.sql", "original_file_path": "models/base/adwords/adwords_campaigns.sql", "name": "adwords_campaigns", "resource_type": "model", "alias": "adwords_campaigns", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/adwords/adwords_campaigns.sql", "compiled": true, "compiled_sql": "\n\n\n\nwith adwords_campaigns as (\n      \n \n\tSELECT  \n\t'Paid' as channel,\n\t'Google Ads' as platform,\n\tday,\n\tcampaignid,\n\tcampaign,\n\taccount as account,\n\tcost/1000000 cost, \n\timpressions as impressions, \n\tclicks, \n\tconversions,\n\t_sdc_sequence,\n\tfirst_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv\n\tFROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`\n\t    \t\n            \n)\n\nSELECT\nday,\ncampaignid,\ncampaign,\naccount, \nchannel,\nplatform,\nsum(cost) cost,\nsum(impressions) impressions,\nsum(clicks) clicks,\nsum(conversions) conversions\nFROM adwords_campaigns\n\nWHERE lv = _sdc_sequence\nGROUP BY day, campaignid, account, channel, platform, campaign\n\n ", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nwith adwords_campaigns as (\n      \n \n\tSELECT  \n\t'Paid' as channel,\n\t'Google Ads' as platform,\n\tday,\n\tcampaignid,\n\tcampaign,\n\taccount as account,\n\tcost/1000000 cost, \n\timpressions as impressions, \n\tclicks, \n\tconversions,\n\t_sdc_sequence,\n\tfirst_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv\n\tFROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`\n\t    \t\n            \n)\n\nSELECT\nday,\ncampaignid,\ncampaign,\naccount, \nchannel,\nplatform,\nsum(cost) cost,\nsum(impressions) impressions,\nsum(clicks) clicks,\nsum(conversions) conversions\nFROM adwords_campaigns\n\nWHERE lv = _sdc_sequence\nGROUP BY day, campaignid, account, channel, platform, campaign\n\n ", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1555)", "execution_time": 3.940720796585083, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:05.536016Z", "completed_at": "2020-03-02T23:32:06.812918Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:06.813270Z", "completed_at": "2020-03-02T23:32:09.475515Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Google Ads') %}\n\n{% if accounts != [] %}\n\nwith adwords_urls as (\n      {% for account in accounts %}\n\n\tSELECT  \n\tcampaignid,\n\tmax(finalurl) finalurl\n\tFROM `{{ target.project }}.google_ads_{{account}}.FINAL_URL_REPORT`\n\tGROUP BY campaignid\n\t\t    {% if not loop.last %} UNION ALL {% endif %}\n            {% endfor %}\n)\n\nSELECT\ncampaignid,\nlower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url\nFROM adwords_urls\n\n {% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "adwords", "adwords_urls"], "unique_id": "model.journeyengine_recipes.adwords_urls", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/adwords/adwords_urls.sql", "original_file_path": "models/base/adwords/adwords_urls.sql", "name": "adwords_urls", "resource_type": "model", "alias": "adwords_urls", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/adwords/adwords_urls.sql", "compiled": true, "compiled_sql": "\n\n\n\nwith adwords_urls as (\n      \n\n\tSELECT  \n\tcampaignid,\n\tmax(finalurl) finalurl\n\tFROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`\n\tGROUP BY campaignid\n\t\t    \n            \n)\n\nSELECT\ncampaignid,\nlower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url\nFROM adwords_urls\n\n ", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nwith adwords_urls as (\n      \n\n\tSELECT  \n\tcampaignid,\n\tmax(finalurl) finalurl\n\tFROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`\n\tGROUP BY campaignid\n\t\t    \n            \n)\n\nSELECT\ncampaignid,\nlower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url\nFROM adwords_urls\n\n ", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (28)", "execution_time": 3.775434970855713, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:07.157257Z", "completed_at": "2020-03-02T23:32:08.309457Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:08.309870Z", "completed_at": "2020-03-02T23:32:10.930751Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Facebook Ads') %}\n\n{% if accounts != [] %}\n\nwith fb_adcreative as (\n\n\n      {% for account in accounts %}\n        SELECT \n        {{ fill('fb_ads', 'adcreative', account,\n        ['id',\n        'object_url',\n      'url_tags',\n      '_sdc_sequence']) }}\n            FROM  {{ most_recent_record(\n                        relation='`' ~ target.project ~ '.fb_ads_' ~ account ~ '.adcreative`',\n                        pk_fields=['id']\n                  )}}\n        {% if not loop.last %} UNION ALL {% endif %}\n     {% endfor %}\n)\n\nselect creative_id, max(url) url\nfrom (\n  select\n    id creative_id,\n    lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url\n  from fb_adcreative\n  )\ngroup by creative_id\n\n{% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "fb-ads", "fb_adcreative"], "unique_id": "model.journeyengine_recipes.fb_adcreative", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/fb-ads/fb_adcreative.sql", "original_file_path": "models/base/fb-ads/fb_adcreative.sql", "name": "fb_adcreative", "resource_type": "model", "alias": "fb_adcreative", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql", "compiled": true, "compiled_sql": "\n\n\n\nwith fb_adcreative as (\n\n\n      \n        SELECT \n        \n  id\n, object_url\n, url_tags\n, _sdc_sequence\n            FROM  \n\n\n\n(\n\tselect * from (\n\n\t\tselect \n\t\t\t*,\n\t\t\tmax(_sdc_sequence) over (partition by id) as most_recent_sequence,\n\t\t\tmax(_sdc_batched_at) over (partition by id) as most_recent_batch\n\t\tfrom `journeyengine-recipes.fb_ads_quantic.adcreative` \n\n\t) \n\twhere _sdc_sequence = most_recent_sequence\n\tand _sdc_batched_at = most_recent_batch\n\n)\n\n\n        \n     \n)\n\nselect creative_id, max(url) url\nfrom (\n  select\n    id creative_id,\n    lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url\n  from fb_adcreative\n  )\ngroup by creative_id\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nwith fb_adcreative as (\n\n\n      \n        SELECT \n        \n  id\n, object_url\n, url_tags\n, _sdc_sequence\n            FROM  \n\n\n\n(\n\tselect * from (\n\n\t\tselect \n\t\t\t*,\n\t\t\tmax(_sdc_sequence) over (partition by id) as most_recent_sequence,\n\t\t\tmax(_sdc_batched_at) over (partition by id) as most_recent_batch\n\t\tfrom `journeyengine-recipes.fb_ads_quantic.adcreative` \n\n\t) \n\twhere _sdc_sequence = most_recent_sequence\n\tand _sdc_batched_at = most_recent_batch\n\n)\n\n\n        \n     \n)\n\nselect creative_id, max(url) url\nfrom (\n  select\n    id creative_id,\n    lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url\n  from fb_adcreative\n  )\ngroup by creative_id\n\n", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (32895)", "execution_time": 3.885197877883911, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:07.529187Z", "completed_at": "2020-03-02T23:32:08.928659Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:08.929068Z", "completed_at": "2020-03-02T23:32:11.412739Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Facebook Ads') %}\n\n{% if accounts != [] %}\n\nwith fb_ads_insights as (\n\n\t    {% for account in accounts %}\n\t    \n\t\t   \tSELECT \n\t\t\tdate_start,\n\t\t\tcampaign_id,\n\t\t\tcampaign_name,\n\t\t\tad_id,\n\t\t\taccount_name,\n\t\t\tspend,\n\t\t\treach,\n\t\t\tinline_link_clicks,\n\t\t\t_sdc_sequence,\n\t\t\tfirst_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv\n\n\t\t\tfrom (\n\t\t\t\tselect\n\t\t\t\t{{ fill('fb_ads', 'ads_insights_platform_and_device', account,\n                ['date_start',\n                'campaign_id',\n                'campaign_name',\n                'ad_id',\n                'account_name',\n                'spend',\n                'reach',\n                'inline_link_clicks',\n                '_sdc_sequence']) }},\n\t\t\tFROM `{{ target.project }}.fb_ads_{{account}}.ads_insights`\n\n\t\t\t)\n\n\t\t    {% if not loop.last %} UNION ALL {% endif %}\n\t   {% endfor %}\n\n)\n\nselect\ndate_start date,\ncampaign_id,\ncampaign_name campaign,\nad_id,\naccount_name account,\nmax(spend) cost,\nmax(reach) impressions,\nmax(inline_link_clicks) clicks\nfrom fb_ads_insights\nwhere lv = _sdc_sequence\ngroup by date, campaign_id, ad_id, account, campaign\n\n{% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "fb-ads", "fb_ads_insights"], "unique_id": "model.journeyengine_recipes.fb_ads_insights", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/fb-ads/fb_ads_insights.sql", "original_file_path": "models/base/fb-ads/fb_ads_insights.sql", "name": "fb_ads_insights", "resource_type": "model", "alias": "fb_ads_insights", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql", "compiled": true, "compiled_sql": "\n\n\n\nwith fb_ads_insights as (\n\n\t    \n\t    \n\t\t   \tSELECT \n\t\t\tdate_start,\n\t\t\tcampaign_id,\n\t\t\tcampaign_name,\n\t\t\tad_id,\n\t\t\taccount_name,\n\t\t\tspend,\n\t\t\treach,\n\t\t\tinline_link_clicks,\n\t\t\t_sdc_sequence,\n\t\t\tfirst_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv\n\n\t\t\tfrom (\n\t\t\t\tselect\n\t\t\t\t\n  date_start\n, campaign_id\n, campaign_name\n, ad_id\n, account_name\n, spend\n, null as reach\n, inline_link_clicks\n, _sdc_sequence,\n\t\t\tFROM `journeyengine-recipes.fb_ads_quantic.ads_insights`\n\n\t\t\t)\n\n\t\t    \n\t   \n\n)\n\nselect\ndate_start date,\ncampaign_id,\ncampaign_name campaign,\nad_id,\naccount_name account,\nmax(spend) cost,\nmax(reach) impressions,\nmax(inline_link_clicks) clicks\nfrom fb_ads_insights\nwhere lv = _sdc_sequence\ngroup by date, campaign_id, ad_id, account, campaign\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nwith fb_ads_insights as (\n\n\t    \n\t    \n\t\t   \tSELECT \n\t\t\tdate_start,\n\t\t\tcampaign_id,\n\t\t\tcampaign_name,\n\t\t\tad_id,\n\t\t\taccount_name,\n\t\t\tspend,\n\t\t\treach,\n\t\t\tinline_link_clicks,\n\t\t\t_sdc_sequence,\n\t\t\tfirst_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv\n\n\t\t\tfrom (\n\t\t\t\tselect\n\t\t\t\t\n  date_start\n, campaign_id\n, campaign_name\n, ad_id\n, account_name\n, spend\n, null as reach\n, inline_link_clicks\n, _sdc_sequence,\n\t\t\tFROM `journeyengine-recipes.fb_ads_quantic.ads_insights`\n\n\t\t\t)\n\n\t\t    \n\t   \n\n)\n\nselect\ndate_start date,\ncampaign_id,\ncampaign_name campaign,\nad_id,\naccount_name account,\nmax(spend) cost,\nmax(reach) impressions,\nmax(inline_link_clicks) clicks\nfrom fb_ads_insights\nwhere lv = _sdc_sequence\ngroup by date, campaign_id, ad_id, account, campaign\n\n", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (61042)", "execution_time": 5.001208066940308, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:08.027394Z", "completed_at": "2020-03-02T23:32:09.715372Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:09.716004Z", "completed_at": "2020-03-02T23:32:13.027304Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Google Ads') %}\n\n{% if accounts != [] %}\n\nwith adwords_adplatforms as (\n\n      {% for account in accounts %}\n          select\n          account,\n          'Google Ads' as platform,\n          day date,\n          campaign,\n          adgroup group_set,\n          concat( headline1, \" | \", headline2, \" - \", description) as ad,\n          null as objective,\n          adtype placement,\n          cost / 1000000 as spend,\n          impressions,\n          clicks,\n          clicks link_clicks,\n          conversions,\n          _sdc_report_datetime,\n          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv\n         from `{{ target.project }}.google_ads_{{account}}.AD_PERFORMANCE_REPORT`\n                {% if not loop.last %} UNION ALL {% endif %}\n             {% endfor %}\n\n)\n\n select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom adwords_adplatforms\n where _sdc_report_datetime = lv\n\n {% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "adwords", "adwords_adplatforms"], "unique_id": "model.journeyengine_recipes.adwords_adplatforms", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/adwords/adwords_adplatforms.sql", "original_file_path": "models/base/adwords/adwords_adplatforms.sql", "name": "adwords_adplatforms", "resource_type": "model", "alias": "adwords_adplatforms", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql", "compiled": true, "compiled_sql": "\n\n\n\nwith adwords_adplatforms as (\n\n      \n          select\n          account,\n          'Google Ads' as platform,\n          day date,\n          campaign,\n          adgroup group_set,\n          concat( headline1, \" | \", headline2, \" - \", description) as ad,\n          null as objective,\n          adtype placement,\n          cost / 1000000 as spend,\n          impressions,\n          clicks,\n          clicks link_clicks,\n          conversions,\n          _sdc_report_datetime,\n          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv\n         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`\n                \n             \n\n)\n\n select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom adwords_adplatforms\n where _sdc_report_datetime = lv\n\n ", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nwith adwords_adplatforms as (\n\n      \n          select\n          account,\n          'Google Ads' as platform,\n          day date,\n          campaign,\n          adgroup group_set,\n          concat( headline1, \" | \", headline2, \" - \", description) as ad,\n          null as objective,\n          adtype placement,\n          cost / 1000000 as spend,\n          impressions,\n          clicks,\n          clicks link_clicks,\n          conversions,\n          _sdc_report_datetime,\n          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv\n         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`\n                \n             \n\n)\n\n select\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nfrom adwords_adplatforms\n where _sdc_report_datetime = lv\n\n ", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (10720)", "execution_time": 3.742587089538574, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:09.902963Z", "completed_at": "2020-03-02T23:32:11.090796Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:11.091173Z", "completed_at": "2020-03-02T23:32:13.644257Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\ngoal_type,\naccount,\ntime_of_entry\nFROM {{ ref('conversion_goals_proc') }}\nWHERE platform = 'Facebook Ads'", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "fb-ads", "fb_conversions"], "unique_id": "model.journeyengine_recipes.fb_conversions", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/fb-ads/fb_conversions.sql", "original_file_path": "models/base/fb-ads/fb_conversions.sql", "name": "fb_conversions", "resource_type": "model", "alias": "fb_conversions", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["conversion_goals_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.conversion_goals_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/fb-ads/fb_conversions.sql", "compiled": true, "compiled_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\ngoal_type,\naccount,\ntime_of_entry\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`\nWHERE platform = 'Facebook Ads'", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\ngoal_type,\naccount,\ntime_of_entry\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`\nWHERE platform = 'Facebook Ads'", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (0)", "execution_time": 2.2062668800354004, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:11.907716Z", "completed_at": "2020-03-02T23:32:11.918873Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:11.919199Z", "completed_at": "2020-03-02T23:32:14.112639Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\ngoal_type,\naccount,\ntime_of_entry\nFROM {{ ref('conversion_goals_proc') }}\nWHERE platform = 'Google Analytics'", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "ga", "ga_conversions"], "unique_id": "model.journeyengine_recipes.ga_conversions", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/ga/ga_conversions.sql", "original_file_path": "models/base/ga/ga_conversions.sql", "name": "ga_conversions", "resource_type": "model", "alias": "ga_conversions", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["conversion_goals_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.conversion_goals_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/ga/ga_conversions.sql", "compiled": true, "compiled_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\ngoal_type,\naccount,\ntime_of_entry\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`\nWHERE platform = 'Google Analytics'", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \nsite,\nbigquery_name,\nplatform,\ngoal_name,\ngoal_type,\naccount,\ntime_of_entry\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`\nWHERE platform = 'Google Analytics'", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (7)", "execution_time": 2.5181760787963867, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:13.416677Z", "completed_at": "2020-03-02T23:32:13.432945Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:13.433334Z", "completed_at": "2020-03-02T23:32:15.933536Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n{{ ref('facebook_insights_stats') }} \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n{{ ref('instagram_insights_stats') }} \n\nUNION ALL\n\nselect\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n{{ ref('linkedin_company_pages_stats') }} \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \ncast (post_image_url as string), \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n{{ ref('twitter_premium_stats') }} \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \ncast (post_image_url as string), \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n{{ ref('youtube_insights_stats') }}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "join", "agg_social_platforms_union"], "unique_id": "model.journeyengine_recipes.agg_social_platforms_union", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "join/agg_social_platforms_union.sql", "original_file_path": "models/join/agg_social_platforms_union.sql", "name": "agg_social_platforms_union", "resource_type": "model", "alias": "agg_social_platforms_union", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["facebook_insights_stats"], ["instagram_insights_stats"], ["linkedin_company_pages_stats"], ["twitter_premium_stats"], ["youtube_insights_stats"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.facebook_insights_stats", "model.journeyengine_recipes.instagram_insights_stats", "model.journeyengine_recipes.linkedin_company_pages_stats", "model.journeyengine_recipes.twitter_premium_stats", "model.journeyengine_recipes.youtube_insights_stats"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/join/agg_social_platforms_union.sql", "compiled": true, "compiled_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` \n\nUNION ALL\n\nselect\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \ncast (post_image_url as string), \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \ncast (post_image_url as string), \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` \n\nUNION ALL\n\nselect\nplatform,\naccount, \ndate, \npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \ncast (post_image_url as string), \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` \n\nUNION ALL\nselect\nplatform,\naccount, \ndate, \ncast (post_image_url as string), \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nfrom \n`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (824)", "execution_time": 3.177000045776367, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:14.052009Z", "completed_at": "2020-03-02T23:32:14.069882Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:14.070363Z", "completed_at": "2020-03-02T23:32:17.227701Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\nday,\na.campaign,\na.campaignid, \naccount, \nchannel,\nplatform,\nb.url,\ncost,\nimpressions,\nclicks,\nconversions\nFROM {{ref('adwords_campaigns')}} a\nLEFT JOIN {{ref('adwords_urls')}} b\nON a.campaignid = b.campaignid", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "adwords", "adwords_join"], "unique_id": "model.journeyengine_recipes.adwords_join", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/adwords/adwords_join.sql", "original_file_path": "models/base/adwords/adwords_join.sql", "name": "adwords_join", "resource_type": "model", "alias": "adwords_join", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["adwords_campaigns"], ["adwords_urls"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.adwords_campaigns", "model.journeyengine_recipes.adwords_urls"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/adwords/adwords_join.sql", "compiled": true, "compiled_sql": "SELECT\nday,\na.campaign,\na.campaignid, \naccount, \nchannel,\nplatform,\nb.url,\ncost,\nimpressions,\nclicks,\nconversions\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b\nON a.campaignid = b.campaignid", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\nday,\na.campaign,\na.campaignid, \naccount, \nchannel,\nplatform,\nb.url,\ncost,\nimpressions,\nclicks,\nconversions\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b\nON a.campaignid = b.campaignid", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1555)", "execution_time": 2.7427539825439453, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:14.492568Z", "completed_at": "2020-03-02T23:32:14.507791Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:14.508393Z", "completed_at": "2020-03-02T23:32:17.233957Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- depends_on: {{ ref('fb_adcreative') }}\n\n{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Facebook Ads') %}\n\n{% if accounts != [] %}\n\nwith fb_ads as (\n\n\t    {% for account in accounts %}\n\t\t   \tSELECT \n\t\t\tid ad_id,\n\t\t\tcreative.id creative_id\n\t\t\tFROM  {{ most_recent_record(\n                        relation='`' ~ target.project ~ '.fb_ads_' ~ account ~ '.ads`',\n                        pk_fields=['id']\n                  )}}\n\t\t     {% if not loop.last %} UNION ALL {% endif %}\n\t   {% endfor %}\n\n)\n\nSELECT\na.ad_id,\nb.creative_id,\nb.url\nFROM (\n    SELECT\n    ad_id,\n    creative_id,\n    FROM fb_ads\n    ) a\nLEFT JOIN {{ref('fb_adcreative')}} b\nON (\n\ta.creative_id = b.creative_id \n)\n\n{% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "fb-ads", "fb_ads"], "unique_id": "model.journeyengine_recipes.fb_ads", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/fb-ads/fb_ads.sql", "original_file_path": "models/base/fb-ads/fb_ads.sql", "name": "fb_ads", "resource_type": "model", "alias": "fb_ads", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["fb_adcreative"], ["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.fb_adcreative", "model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/fb-ads/fb_ads.sql", "compiled": true, "compiled_sql": "-- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`\n\n\n\n\n\nwith fb_ads as (\n\n\t    \n\t\t   \tSELECT \n\t\t\tid ad_id,\n\t\t\tcreative.id creative_id\n\t\t\tFROM  \n\n\n\n(\n\tselect * from (\n\n\t\tselect \n\t\t\t*,\n\t\t\tmax(_sdc_sequence) over (partition by id) as most_recent_sequence,\n\t\t\tmax(_sdc_batched_at) over (partition by id) as most_recent_batch\n\t\tfrom `journeyengine-recipes.fb_ads_quantic.ads` \n\n\t) \n\twhere _sdc_sequence = most_recent_sequence\n\tand _sdc_batched_at = most_recent_batch\n\n)\n\n\n\t\t     \n\t   \n\n)\n\nSELECT\na.ad_id,\nb.creative_id,\nb.url\nFROM (\n    SELECT\n    ad_id,\n    creative_id,\n    FROM fb_ads\n    ) a\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b\nON (\n\ta.creative_id = b.creative_id \n)\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`\n\n\n\n\n\nwith fb_ads as (\n\n\t    \n\t\t   \tSELECT \n\t\t\tid ad_id,\n\t\t\tcreative.id creative_id\n\t\t\tFROM  \n\n\n\n(\n\tselect * from (\n\n\t\tselect \n\t\t\t*,\n\t\t\tmax(_sdc_sequence) over (partition by id) as most_recent_sequence,\n\t\t\tmax(_sdc_batched_at) over (partition by id) as most_recent_batch\n\t\tfrom `journeyengine-recipes.fb_ads_quantic.ads` \n\n\t) \n\twhere _sdc_sequence = most_recent_sequence\n\tand _sdc_batched_at = most_recent_batch\n\n)\n\n\n\t\t     \n\t   \n\n)\n\nSELECT\na.ad_id,\nb.creative_id,\nb.url\nFROM (\n    SELECT\n    ad_id,\n    creative_id,\n    FROM fb_ads\n    ) a\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b\nON (\n\ta.creative_id = b.creative_id \n)\n\n", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (7894)", "execution_time": 4.945093870162964, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:16.304099Z", "completed_at": "2020-03-02T23:32:17.842133Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:17.842726Z", "completed_at": "2020-03-02T23:32:21.247865Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nFROM \n  {{ref('agg_social_platforms_union')}} a\nLEFT JOIN \n  {{ref('accounts_proc')}} b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "join", "agg_social_platforms_site"], "unique_id": "model.journeyengine_recipes.agg_social_platforms_site", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "join/agg_social_platforms_site.sql", "original_file_path": "models/join/agg_social_platforms_site.sql", "name": "agg_social_platforms_site", "resource_type": "model", "alias": "agg_social_platforms_site", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_social_platforms_union"], ["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_social_platforms_union", "model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/join/agg_social_platforms_site.sql", "compiled": true, "compiled_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nFROM \n  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a\nLEFT JOIN \n  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\npost_image_url, \npost_url, \npost_text,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks\nFROM \n  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a\nLEFT JOIN \n  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (824)", "execution_time": 2.18254017829895, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:21.664657Z", "completed_at": "2020-03-02T23:32:21.678596Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:21.678932Z", "completed_at": "2020-03-02T23:32:23.845742Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- depends_on: {{ ref('fb_conversions') }}\n\n{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Facebook Ads') %}\n\n{% if accounts != [] %}\n\nwith fb_ads_insights_conversions as (\n\n\t    {% for account in accounts %}\n\n\t    \t{% set goals = get_column_values(table=ref('fb_conversions'), column='goal_name', max_records=50, filter_column='goal_type', filter_value='Lead', filter_column_2='bigquery_name', filter_value_2=account ) %}\n\n\t\t   \tSELECT\n\t\t   \t{{ fill('fb_ads', 'ads_insights', account,\n\t\t\t['date_start',\n\t\t\t'campaign_id',\n\t\t\t'campaign_name',\n\t\t\t'ad_id',\n\t\t\t'account_name',\n\t\t\t'_sdc_sequence',]) }},\n\t\t\tvalue.action_type,\n\t\t\tvalue._28d_click conversions,\n\t\t\tnull as revenue\n\t\t\tFROM `{{ target.project }}.fb_ads_{{account}}.ads_insights`\n\t\t\tcross join unnest(actions)\n\n\t\t\t## goal completion columns\n\t\t\t{% if goals != [] %}\n\t\t\t\twhere action_type in (\n\t\t\t\t{% for goal in goals %}\n\t\t\t\t\t'{{goal}}'\n\t\t\t\t\t{% if not loop.last %} , {% endif %} \n\t\t\t\t{% endfor %}\n\t\t\t\t)\n\t\t\t{% endif %}\n\t\t\t\n\t\t\tUNION ALL\n\n\t\t   \tSELECT \n\t\t\t{{ fill('fb_ads', 'ads_insights', account,\n\t\t\t['date_start',\n\t\t\t'campaign_id',\n\t\t\t'campaign_name',\n\t\t\t'ad_id',\n\t\t\t'account_name',\n\t\t\t'_sdc_sequence']) }},\n\t\t\tvalue.action_type,\n\t\t\tnull as conversions,\n\t\t\tvalue._28d_click as revenue\n\t\t\tFROM `{{ target.project }}.fb_ads_{{account}}.ads_insights`\n\t\t\tcross join unnest(actions)\n\t\t\t\n\t\t\t## goal completion columns\n\t\t\t{% if goals != [] %}\n\t\t\t\twhere action_type in (\n\t\t\t\t{% for goal in goals %}\n\t\t\t\t\t'{{goal}}'\n\t\t\t\t\t{% if not loop.last %} , {% endif %} \n\t\t\t\t{% endfor %}\n\t\t\t\t)\n\t\t\t{% endif %}\n\n\t\t    {% if not loop.last %} UNION ALL {% endif %}\n\t   {% endfor %}\n\n)\n\nSELECT \ndate,\ncampaign_id,\ncampaign,\nad_id,\naccount,\nsum(conversions) conversions,\nsum(revenue) revenue\nFROM \n\t\t(\n\t    SELECT\n\t    date_start date,\n\t    campaign_id,\n\t    campaign_name campaign,\n\t    ad_id,\n\t    account_name account,\n\t    action_type,\n\t    conversions,\n\t    revenue,\n\t    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,\n\t    _sdc_sequence\n\t    FROM fb_ads_insights_conversions\n\t   \t)\nwhere lv = _sdc_sequence\ngroup by date, campaign_id, campaign, ad_id, account\n\n\n{% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "fb-ads", "fb_ads_insights_conversions"], "unique_id": "model.journeyengine_recipes.fb_ads_insights_conversions", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/fb-ads/fb_ads_insights_conversions.sql", "original_file_path": "models/base/fb-ads/fb_ads_insights_conversions.sql", "name": "fb_ads_insights_conversions", "resource_type": "model", "alias": "fb_ads_insights_conversions", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["fb_conversions"], ["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.fb_conversions", "model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql", "compiled": true, "compiled_sql": "-- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`\n\n\n\n\n\nwith fb_ads_insights_conversions as (\n\n\t    \n\n\t    \t\n\n\t\t   \tSELECT\n\t\t   \t\n  date_start\n, campaign_id\n, campaign_name\n, ad_id\n, account_name\n, _sdc_sequence,\n\t\t\tvalue.action_type,\n\t\t\tvalue._28d_click conversions,\n\t\t\tnull as revenue\n\t\t\tFROM `journeyengine-recipes.fb_ads_quantic.ads_insights`\n\t\t\tcross join unnest(actions)\n\n\t\t\t## goal completion columns\n\t\t\t\n\t\t\t\n\t\t\tUNION ALL\n\n\t\t   \tSELECT \n\t\t\t\n  date_start\n, campaign_id\n, campaign_name\n, ad_id\n, account_name\n, _sdc_sequence,\n\t\t\tvalue.action_type,\n\t\t\tnull as conversions,\n\t\t\tvalue._28d_click as revenue\n\t\t\tFROM `journeyengine-recipes.fb_ads_quantic.ads_insights`\n\t\t\tcross join unnest(actions)\n\t\t\t\n\t\t\t## goal completion columns\n\t\t\t\n\n\t\t    \n\t   \n\n)\n\nSELECT \ndate,\ncampaign_id,\ncampaign,\nad_id,\naccount,\nsum(conversions) conversions,\nsum(revenue) revenue\nFROM \n\t\t(\n\t    SELECT\n\t    date_start date,\n\t    campaign_id,\n\t    campaign_name campaign,\n\t    ad_id,\n\t    account_name account,\n\t    action_type,\n\t    conversions,\n\t    revenue,\n\t    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,\n\t    _sdc_sequence\n\t    FROM fb_ads_insights_conversions\n\t   \t)\nwhere lv = _sdc_sequence\ngroup by date, campaign_id, campaign, ad_id, account\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`\n\n\n\n\n\nwith fb_ads_insights_conversions as (\n\n\t    \n\n\t    \t\n\n\t\t   \tSELECT\n\t\t   \t\n  date_start\n, campaign_id\n, campaign_name\n, ad_id\n, account_name\n, _sdc_sequence,\n\t\t\tvalue.action_type,\n\t\t\tvalue._28d_click conversions,\n\t\t\tnull as revenue\n\t\t\tFROM `journeyengine-recipes.fb_ads_quantic.ads_insights`\n\t\t\tcross join unnest(actions)\n\n\t\t\t## goal completion columns\n\t\t\t\n\t\t\t\n\t\t\tUNION ALL\n\n\t\t   \tSELECT \n\t\t\t\n  date_start\n, campaign_id\n, campaign_name\n, ad_id\n, account_name\n, _sdc_sequence,\n\t\t\tvalue.action_type,\n\t\t\tnull as conversions,\n\t\t\tvalue._28d_click as revenue\n\t\t\tFROM `journeyengine-recipes.fb_ads_quantic.ads_insights`\n\t\t\tcross join unnest(actions)\n\t\t\t\n\t\t\t## goal completion columns\n\t\t\t\n\n\t\t    \n\t   \n\n)\n\nSELECT \ndate,\ncampaign_id,\ncampaign,\nad_id,\naccount,\nsum(conversions) conversions,\nsum(revenue) revenue\nFROM \n\t\t(\n\t    SELECT\n\t    date_start date,\n\t    campaign_id,\n\t    campaign_name campaign,\n\t    ad_id,\n\t    account_name account,\n\t    action_type,\n\t    conversions,\n\t    revenue,\n\t    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,\n\t    _sdc_sequence\n\t    FROM fb_ads_insights_conversions\n\t   \t)\nwhere lv = _sdc_sequence\ngroup by date, campaign_id, campaign, ad_id, account\n\n\n", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (57774)", "execution_time": 7.448126792907715, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:18.326696Z", "completed_at": "2020-03-02T23:32:21.520168Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:21.520578Z", "completed_at": "2020-03-02T23:32:25.773314Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ncast(day as date) date, \naccount, \nplatform,\nchannel,\nurl,\ncampaign,\nsum(cost) cost,\nsum(impressions) impressions,\nsum(clicks) clicks,\nsum(conversions) conversions\nFROM {{ref('adwords_join')}}\nGROUP BY date, account, platform, channel, url, campaign", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "adwords", "adwords_stats"], "unique_id": "model.journeyengine_recipes.adwords_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/adwords/adwords_stats.sql", "original_file_path": "models/base/adwords/adwords_stats.sql", "name": "adwords_stats", "resource_type": "model", "alias": "adwords_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["adwords_join"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.adwords_join"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/adwords/adwords_stats.sql", "compiled": true, "compiled_sql": "SELECT \ncast(day as date) date, \naccount, \nplatform,\nchannel,\nurl,\ncampaign,\nsum(cost) cost,\nsum(impressions) impressions,\nsum(clicks) clicks,\nsum(conversions) conversions\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`\nGROUP BY date, account, platform, channel, url, campaign", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ncast(day as date) date, \naccount, \nplatform,\nchannel,\nurl,\ncampaign,\nsum(cost) cost,\nsum(impressions) impressions,\nsum(clicks) clicks,\nsum(conversions) conversions\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`\nGROUP BY date, account, platform, channel, url, campaign", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1555)", "execution_time": 2.304291009902954, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:24.232537Z", "completed_at": "2020-03-02T23:32:24.243066Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:24.243357Z", "completed_at": "2020-03-02T23:32:26.535525Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\nyyyymm, \nsite,\nplatform,\nposts,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks,\nsum(impressions/posts) OVER w1 impressions_per_post,\nsum(reactions/posts) OVER w1 applause_rate,\nsum(comments/posts) OVER w1 conversation_rate,\nsum(comments/posts) OVER w1 amplification_rate,\nsum(link_clicks/posts) OVER w1 clicks_per_post\n\nFROM (\n    SELECT \n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform, \n    sum(impressions) impressions,\n    sum(reactions) reactions,\n    sum(comments) comments,\n    sum(shares) shares,\n    sum(link_clicks) link_clicks,\n    count(post_url) as posts\n\tFROM {{ ref('agg_social_platforms_site') }}\n    GROUP BY yyyymm, site, platform\n    )\n WINDOW w1 as (PARTITION BY yyyymm, site)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "math", "social_platform_by_month"], "unique_id": "model.journeyengine_recipes.social_platform_by_month", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "math/social_platform_by_month.sql", "original_file_path": "models/math/social_platform_by_month.sql", "name": "social_platform_by_month", "resource_type": "model", "alias": "social_platform_by_month", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_social_platforms_site"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_social_platforms_site"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/math/social_platform_by_month.sql", "compiled": true, "compiled_sql": "SELECT\nyyyymm, \nsite,\nplatform,\nposts,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks,\nsum(impressions/posts) OVER w1 impressions_per_post,\nsum(reactions/posts) OVER w1 applause_rate,\nsum(comments/posts) OVER w1 conversation_rate,\nsum(comments/posts) OVER w1 amplification_rate,\nsum(link_clicks/posts) OVER w1 clicks_per_post\n\nFROM (\n    SELECT \n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform, \n    sum(impressions) impressions,\n    sum(reactions) reactions,\n    sum(comments) comments,\n    sum(shares) shares,\n    sum(link_clicks) link_clicks,\n    count(post_url) as posts\n\tFROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`\n    GROUP BY yyyymm, site, platform\n    )\n WINDOW w1 as (PARTITION BY yyyymm, site)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\nyyyymm, \nsite,\nplatform,\nposts,\nimpressions, \nreactions, \ncomments, \nshares,\nlink_clicks,\nsum(impressions/posts) OVER w1 impressions_per_post,\nsum(reactions/posts) OVER w1 applause_rate,\nsum(comments/posts) OVER w1 conversation_rate,\nsum(comments/posts) OVER w1 amplification_rate,\nsum(link_clicks/posts) OVER w1 clicks_per_post\n\nFROM (\n    SELECT \n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform, \n    sum(impressions) impressions,\n    sum(reactions) reactions,\n    sum(comments) comments,\n    sum(shares) shares,\n    sum(link_clicks) link_clicks,\n    count(post_url) as posts\n\tFROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`\n    GROUP BY yyyymm, site, platform\n    )\n WINDOW w1 as (PARTITION BY yyyymm, site)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (50)", "execution_time": 2.4681708812713623, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:26.130724Z", "completed_at": "2020-03-02T23:32:26.141502Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:26.141794Z", "completed_at": "2020-03-02T23:32:28.597589Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate,\nsite,\nplatform,\nifnull(post_image_url,'') ImageURL, \nifnull(post_url,'') PostURL,\nifnull(post_text,'') PostText,\nifnull(impressions, 0) Impressions,\nifnull(reactions, 0) Reactions, \nifnull(comments, 0) Comments, \nifnull(shares, 0) Shares,\nifnull(link_clicks, 0) LinkClicks\nFROM {{ ref('agg_social_platforms_site') }}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "visualization", "social_post_viz"], "unique_id": "model.journeyengine_recipes.social_post_viz", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "visualization/social_post_viz.sql", "original_file_path": "models/visualization/social_post_viz.sql", "name": "social_post_viz", "resource_type": "model", "alias": "social_post_viz", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_social_platforms_site"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_social_platforms_site"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/visualization/social_post_viz.sql", "compiled": true, "compiled_sql": "SELECT \ndate,\nsite,\nplatform,\nifnull(post_image_url,'') ImageURL, \nifnull(post_url,'') PostURL,\nifnull(post_text,'') PostText,\nifnull(impressions, 0) Impressions,\nifnull(reactions, 0) Reactions, \nifnull(comments, 0) Comments, \nifnull(shares, 0) Shares,\nifnull(link_clicks, 0) LinkClicks\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate,\nsite,\nplatform,\nifnull(post_image_url,'') ImageURL, \nifnull(post_url,'') PostURL,\nifnull(post_text,'') PostText,\nifnull(impressions, 0) Impressions,\nifnull(reactions, 0) Reactions, \nifnull(comments, 0) Comments, \nifnull(shares, 0) Shares,\nifnull(link_clicks, 0) LinkClicks\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (824)", "execution_time": 2.2877578735351562, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:26.898633Z", "completed_at": "2020-03-02T23:32:26.909516Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:26.909828Z", "completed_at": "2020-03-02T23:32:29.185061Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "with cost as (\n\n    select \n        date, account, ad_id, campaign,\n        cost, impressions, clicks, null as conversions\n    from {{ref('fb_ads_insights')}}\n),\n\nconversions as (\n\n    select \n        date, account, ad_id, campaign,\n        null as cost, null as impressions, null as clicks, conversions\n    from {{ref('fb_ads_insights_conversions')}}\n),\n\nurls as (\n\n    select ad_id, url\n    from {{ref('fb_ads')}}\n)\n\n\nSELECT\n    cast(date as date) date,\n    'Facebook Ads' platform,\n    'Paid' channel,\n    account, \n    b.url url,\n    campaign,\n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions\nFROM\n(\n    SELECT *\n    FROM \n      cost\n    UNION ALL\n    SELECT *\n    FROM \n      conversions\n) a\nLEFT JOIN urls b\nON ( a.ad_id = b.ad_id )\ngroup by date, platform, channel, account, url, campaign", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "fb-ads", "fb_ads_stats"], "unique_id": "model.journeyengine_recipes.fb_ads_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/fb-ads/fb_ads_stats.sql", "original_file_path": "models/base/fb-ads/fb_ads_stats.sql", "name": "fb_ads_stats", "resource_type": "model", "alias": "fb_ads_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["fb_ads_insights"], ["fb_ads_insights_conversions"], ["fb_ads"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.fb_ads_insights", "model.journeyengine_recipes.fb_ads_insights_conversions", "model.journeyengine_recipes.fb_ads"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/fb-ads/fb_ads_stats.sql", "compiled": true, "compiled_sql": "with cost as (\n\n    select \n        date, account, ad_id, campaign,\n        cost, impressions, clicks, null as conversions\n    from `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`\n),\n\nconversions as (\n\n    select \n        date, account, ad_id, campaign,\n        null as cost, null as impressions, null as clicks, conversions\n    from `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`\n),\n\nurls as (\n\n    select ad_id, url\n    from `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`\n)\n\n\nSELECT\n    cast(date as date) date,\n    'Facebook Ads' platform,\n    'Paid' channel,\n    account, \n    b.url url,\n    campaign,\n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions\nFROM\n(\n    SELECT *\n    FROM \n      cost\n    UNION ALL\n    SELECT *\n    FROM \n      conversions\n) a\nLEFT JOIN urls b\nON ( a.ad_id = b.ad_id )\ngroup by date, platform, channel, account, url, campaign", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "with cost as (\n\n    select \n        date, account, ad_id, campaign,\n        cost, impressions, clicks, null as conversions\n    from `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`\n),\n\nconversions as (\n\n    select \n        date, account, ad_id, campaign,\n        null as cost, null as impressions, null as clicks, conversions\n    from `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`\n),\n\nurls as (\n\n    select ad_id, url\n    from `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`\n)\n\n\nSELECT\n    cast(date as date) date,\n    'Facebook Ads' platform,\n    'Paid' channel,\n    account, \n    b.url url,\n    campaign,\n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions\nFROM\n(\n    SELECT *\n    FROM \n      cost\n    UNION ALL\n    SELECT *\n    FROM \n      conversions\n) a\nLEFT JOIN urls b\nON ( a.ad_id = b.ad_id )\ngroup by date, platform, channel, account, url, campaign", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (3078)", "execution_time": 2.654210090637207, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:28.983677Z", "completed_at": "2020-03-02T23:32:29.002285Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:29.002655Z", "completed_at": "2020-03-02T23:32:31.636524Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\nyyyymm Month, \nsite Site,\nplatform Platform,\nifnull(posts, 0) Posts,\nifnull(impressions, 0) Impressions,\nifnull(reactions, 0) Reactions,\nifnull(comments, 0) Comments,\nifnull(shares, 0) Shares,\nifnull(link_clicks, 0) LinkClicks,\nround(ifnull(impressions_per_post,0),0) ImpressionsPerPost,\nround(ifnull(applause_rate, 0),0) ApplauseRate,\nround(ifnull(conversation_rate, 0),0) ConversationRate,\nround(ifnull(amplification_rate, 0),0) AmplificationRate,\nround(ifnull(clicks_per_post, 0),0) ClicksPerPost\nFROM {{ ref('social_platform_by_month') }}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "visualization", "social_platform_viz"], "unique_id": "model.journeyengine_recipes.social_platform_viz", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "visualization/social_platform_viz.sql", "original_file_path": "models/visualization/social_platform_viz.sql", "name": "social_platform_viz", "resource_type": "model", "alias": "social_platform_viz", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["social_platform_by_month"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.social_platform_by_month"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/visualization/social_platform_viz.sql", "compiled": true, "compiled_sql": "SELECT\nyyyymm Month, \nsite Site,\nplatform Platform,\nifnull(posts, 0) Posts,\nifnull(impressions, 0) Impressions,\nifnull(reactions, 0) Reactions,\nifnull(comments, 0) Comments,\nifnull(shares, 0) Shares,\nifnull(link_clicks, 0) LinkClicks,\nround(ifnull(impressions_per_post,0),0) ImpressionsPerPost,\nround(ifnull(applause_rate, 0),0) ApplauseRate,\nround(ifnull(conversation_rate, 0),0) ConversationRate,\nround(ifnull(amplification_rate, 0),0) AmplificationRate,\nround(ifnull(clicks_per_post, 0),0) ClicksPerPost\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\nyyyymm Month, \nsite Site,\nplatform Platform,\nifnull(posts, 0) Posts,\nifnull(impressions, 0) Impressions,\nifnull(reactions, 0) Reactions,\nifnull(comments, 0) Comments,\nifnull(shares, 0) Shares,\nifnull(link_clicks, 0) LinkClicks,\nround(ifnull(impressions_per_post,0),0) ImpressionsPerPost,\nround(ifnull(applause_rate, 0),0) ApplauseRate,\nround(ifnull(conversation_rate, 0),0) ConversationRate,\nround(ifnull(amplification_rate, 0),0) AmplificationRate,\nround(ifnull(clicks_per_post, 0),0) ClicksPerPost\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (50)", "execution_time": 2.3014140129089355, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:29.548726Z", "completed_at": "2020-03-02T23:32:29.559853Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:29.560145Z", "completed_at": "2020-03-02T23:32:31.848745Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n{{ ref('adwords_stats') }}\n\nUNION ALL  \n\nSELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n{{ref('fb_ads_stats')}}\n\nUNION ALL\n\nSELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n{{ref('gsc_stats')}}\n\nUNION ALL\n\nSELECT \ndate, \naccount, \n'Paid' as channel,\nplatform,\nnull as url,\nspend cost,\nimpressions,\nclicks,\nconversions\nFROM \n{{ref('linkedin_adplatforms')}}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "join", "agg_platforms_union"], "unique_id": "model.journeyengine_recipes.agg_platforms_union", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "join/agg_platforms_union.sql", "original_file_path": "models/join/agg_platforms_union.sql", "name": "agg_platforms_union", "resource_type": "model", "alias": "agg_platforms_union", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["adwords_stats"], ["fb_ads_stats"], ["gsc_stats"], ["linkedin_adplatforms"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.adwords_stats", "model.journeyengine_recipes.fb_ads_stats", "model.journeyengine_recipes.gsc_stats", "model.journeyengine_recipes.linkedin_adplatforms"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/join/agg_platforms_union.sql", "compiled": true, "compiled_sql": "SELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`\n\nUNION ALL  \n\nSELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_stats`\n\nUNION ALL\n\nSELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`\n\nUNION ALL\n\nSELECT \ndate, \naccount, \n'Paid' as channel,\nplatform,\nnull as url,\nspend cost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`\n\nUNION ALL  \n\nSELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_stats`\n\nUNION ALL\n\nSELECT \ndate, \naccount, \nchannel,\nplatform,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`\n\nUNION ALL\n\nSELECT \ndate, \naccount, \n'Paid' as channel,\nplatform,\nnull as url,\nspend cost,\nimpressions,\nclicks,\nconversions\nFROM \n`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (126741)", "execution_time": 4.064466953277588, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:32.034416Z", "completed_at": "2020-03-02T23:32:32.051484Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:32.051829Z", "completed_at": "2020-03-02T23:32:36.097029Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "-- depends_on: {{ ref('ga_conversions') }}\n{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Google Analytics') %}\n\n{% if accounts != '' %}\n\nwith ga_report as (\n\n\t    {% for account in accounts %}\n\n\t    \t{% set leads = get_column_values(table=ref('ga_conversions'), column='goal_name', max_records=50, filter_column='goal_type', filter_value='MQL', filter_column_2='bigquery_name', filter_value_2=account ) %}\n\t    \t{% set sqls = get_column_values(table=ref('ga_conversions'), column='goal_name', max_records=50, filter_column='goal_type', filter_value='SQL', filter_column_2='bigquery_name', filter_value_2=account ) %}\n\t    \t{% set excluded = get_column_values(table=ref('ga_conversions'), column='goal_name', max_records=50, filter_column='goal_type', filter_value='Exclude', filter_column_2='bigquery_name', filter_value_2=account ) %}\n\t    \t{% set other = get_column_values(table=ref('ga_conversions'), column='goal_name', max_records=50, filter_column='goal_type', filter_value='Other', filter_column_2='bigquery_name', filter_value_2=account ) %}\n\n\t\t   \tSELECT\n\t\t   \t'{{account}}' as bigquery_name,\n\t\t   \t'Google Analytics' as lookup_platform,\n\t\t\tlower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url,\n\t\t\tdate,\n\t\t\tlower(source) source,\n\t\t\tlower(medium) medium,\n\t\t\tsessions,\n\t\t\tgoalcompletionsall goal_completions,\n\t\t\t## goal completion columns\n\t\t\t{% if leads != [] %}\n\t\t\t\t{% for goal in leads %}\n\t\t\t\t\tcast(goal{{goal}}completions as int64) \n\t\t\t\t\t{% if not loop.last %} + {% endif %} \n\t\t\t\t\t{% if loop.last %} as mqls, {% endif %} \n\t\t\t\t{% endfor %}\n\t\t\t{% else %}\t\t\t\t\n\t\t\t\tnull as mqls,\t\t\n\t\t\t{% endif %}\n\t\t\t{% if sqls != [] %}\n\t\t\t\t{% for goal in sqls %}\n\t\t\t\t\tcast(goal{{goal}}completions as int64) \n\t\t\t\t\t{% if not loop.last %} + {% endif %} \n\t\t\t\t\t{% if loop.last %} as sqls, {% endif %} \n\t\t\t\t{% endfor %}\n\t\t\t{% else %}\t\t\t\t\n\t\t\t\tnull as sqls,\t\t\n\t\t\t{% endif %}\t\t\t\n\t\t\t{% if excluded != [] %}\n\t\t\t\t{% for goal in excluded %}\n\t\t\t\t\tcast(goal{{goal}}completions as int64) \n\t\t\t\t\t{% if not loop.last %} + {% endif %} \n\t\t\t\t\t{% if loop.last %} as excluded, {% endif %} \n\t\t\t\t{% endfor %}\n\t\t\t{% else %}\t\t\t\t\n\t\t\t\tnull as excluded,\t\t\n\t\t\t{% endif %}\t\t\n\t\t\t{% if other != [] %}\n\t\t\t\t{% for goal in other %}\n\t\t\t\t\tcast(goal{{goal}}completions as int64) \n\t\t\t\t\t{% if not loop.last %} + {% endif %} \n\t\t\t\t\t{% if loop.last %} as other, {% endif %} \n\t\t\t\t{% endfor %}\n\t\t\t{% else %}\t\t\t\t\n\t\t\t\tnull as other,\t\t\n\t\t\t{% endif %}\t\t\t\n\t\t\t_sdc_sequence,\n\t\t\tfirst_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv\n\t\t\tFROM `{{ target.project }}.ga_{{account}}.report` \n\n\t\t    {% if not loop.last %} UNION ALL {% endif %}\n\t   {% endfor %}\n\n)\n\n\nSELECT \nbigquery_name,\nlookup_platform,\ndate,\nurl,\nsource,\nmedium,\nsum(sessions) sessions,\nsum(goal_completions) goal_completions,\nsum(mqls) mqls,\nsum(sqls) sqls,\nsum(excluded) excluded,\nsum(other) other\nFROM ga_report\nwhere lv = _sdc_sequence\ngroup by bigquery_name, lookup_platform, date, url, source, medium\n\n{% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "ga", "ga_proc"], "unique_id": "model.journeyengine_recipes.ga_proc", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/ga/ga_proc.sql", "original_file_path": "models/base/ga/ga_proc.sql", "name": "ga_proc", "resource_type": "model", "alias": "ga_proc", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["ga_conversions"], ["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.ga_conversions", "model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/ga/ga_proc.sql", "compiled": true, "compiled_sql": "-- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`\n\n\n\n\nwith ga_report as (\n\n\t    \n\n\t    \t\n\t    \t\n\t    \t\n\t    \t\n\n\t\t   \tSELECT\n\t\t   \t'quantic' as bigquery_name,\n\t\t   \t'Google Analytics' as lookup_platform,\n\t\t\tlower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url,\n\t\t\tdate,\n\t\t\tlower(source) source,\n\t\t\tlower(medium) medium,\n\t\t\tsessions,\n\t\t\tgoalcompletionsall goal_completions,\n\t\t\t## goal completion columns\n\t\t\t\n\t\t\t\t\n\t\t\t\t\tcast(goal19completions as int64) \n\t\t\t\t\t \n\t\t\t\t\t as mqls,  \n\t\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\tcast(goal8completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal9completions as int64) \n\t\t\t\t\t \n\t\t\t\t\t as sqls,  \n\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\tnull as excluded,\t\t\n\t\t\t\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\tcast(goal17completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal16completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal18completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal13completions as int64) \n\t\t\t\t\t \n\t\t\t\t\t as other,  \n\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t_sdc_sequence,\n\t\t\tfirst_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv\n\t\t\tFROM `journeyengine-recipes.ga_quantic.report` \n\n\t\t    \n\t   \n\n)\n\n\nSELECT \nbigquery_name,\nlookup_platform,\ndate,\nurl,\nsource,\nmedium,\nsum(sessions) sessions,\nsum(goal_completions) goal_completions,\nsum(mqls) mqls,\nsum(sqls) sqls,\nsum(excluded) excluded,\nsum(other) other\nFROM ga_report\nwhere lv = _sdc_sequence\ngroup by bigquery_name, lookup_platform, date, url, source, medium\n\n", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "-- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`\n\n\n\n\nwith ga_report as (\n\n\t    \n\n\t    \t\n\t    \t\n\t    \t\n\t    \t\n\n\t\t   \tSELECT\n\t\t   \t'quantic' as bigquery_name,\n\t\t   \t'Google Analytics' as lookup_platform,\n\t\t\tlower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\\?.*$',''),'/')) as url,\n\t\t\tdate,\n\t\t\tlower(source) source,\n\t\t\tlower(medium) medium,\n\t\t\tsessions,\n\t\t\tgoalcompletionsall goal_completions,\n\t\t\t## goal completion columns\n\t\t\t\n\t\t\t\t\n\t\t\t\t\tcast(goal19completions as int64) \n\t\t\t\t\t \n\t\t\t\t\t as mqls,  \n\t\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\tcast(goal8completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal9completions as int64) \n\t\t\t\t\t \n\t\t\t\t\t as sqls,  \n\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\tnull as excluded,\t\t\n\t\t\t\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\tcast(goal17completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal16completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal18completions as int64) \n\t\t\t\t\t +  \n\t\t\t\t\t \n\t\t\t\t\n\t\t\t\t\tcast(goal13completions as int64) \n\t\t\t\t\t \n\t\t\t\t\t as other,  \n\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t_sdc_sequence,\n\t\t\tfirst_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv\n\t\t\tFROM `journeyengine-recipes.ga_quantic.report` \n\n\t\t    \n\t   \n\n)\n\n\nSELECT \nbigquery_name,\nlookup_platform,\ndate,\nurl,\nsource,\nmedium,\nsum(sessions) sessions,\nsum(goal_completions) goal_completions,\nsum(mqls) mqls,\nsum(sqls) sqls,\nsum(excluded) excluded,\nsum(other) other\nFROM ga_report\nwhere lv = _sdc_sequence\ngroup by bigquery_name, lookup_platform, date, url, source, medium\n\n", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (702431)", "execution_time": 18.51975679397583, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:18.737035Z", "completed_at": "2020-03-02T23:32:25.434600Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:25.435032Z", "completed_at": "2020-03-02T23:32:37.255308Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{% set accounts = get_column_values(table=ref('accounts_proc'), column='bigquery_name', max_records=50, filter_column='platform', filter_value='Facebook Ads') %}\n\n{% if accounts != [] %}\n\nwith fb_adplatforms as (\n\n      {% for account in accounts %}\n          \n          select\n          account_name account,\n          'Facebook Ads' as platform,\n          date_start date,\n          campaign_name campaign,\n          adset_name group_set,\n          ad_name ad,\n          objective,\n          Concat(publisher_platform,\"-\",platform_position) as placement,\n          spend,\n          impressions,\n          clicks,\n          inline_link_clicks link_clicks,\n          sum(_28d_click) as conversions\n\n          from (\n\n                select\n                {{ fill('fb_ads', 'ads_insights_platform_and_device', account,\n                ['account_name',\n                'date_start',\n                'campaign_name',\n                'adset_name',\n                'ad_name',\n                'objective',\n                'publisher_platform',\n                'platform_position',\n                'spend',\n                'impressions',\n                'clicks',\n                'inline_link_clicks',\n                '_sdc_sequence',\n                '_sdc_batched_at']) }},\n                value._28d_click,\n               from {{ most_recent_record(\n                        relation='`' ~ target.project ~ '.fb_ads_' ~ account ~ '.ads_insights_platform_and_device`',\n                        pk_fields=['ad_id', 'adset_id', 'campaign_id', 'date_start', 'publisher_platform', 'platform_position', 'impression_device']\n                  )}}\n               left join unnest(actions)\n\n               )\n\n            {{ dbt_utils.group_by(12) }}\n\n                      {% if not loop.last %} UNION ALL {% endif %}\n                   {% endfor %}\n\n)\n\nselect distinct\n  account,\n  platform,\n  date,\n  campaign,\n  group_set,\n  ad,\n  objective,\n  placement,\n  spend,\n  impressions,\n  clicks,\n  link_clicks,\n  conversions\nfrom fb_adplatforms\n\n {% endif %}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "fb-ads", "fb_adplatforms"], "unique_id": "model.journeyengine_recipes.fb_adplatforms", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/fb-ads/fb_adplatforms.sql", "original_file_path": "models/base/fb-ads/fb_adplatforms.sql", "name": "fb_adplatforms", "resource_type": "model", "alias": "fb_adplatforms", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql", "compiled": true, "compiled_sql": "\n\n\n\nwith fb_adplatforms as (\n\n      \n          \n          select\n          account_name account,\n          'Facebook Ads' as platform,\n          date_start date,\n          campaign_name campaign,\n          adset_name group_set,\n          ad_name ad,\n          objective,\n          Concat(publisher_platform,\"-\",platform_position) as placement,\n          spend,\n          impressions,\n          clicks,\n          inline_link_clicks link_clicks,\n          sum(_28d_click) as conversions\n\n          from (\n\n                select\n                \n  account_name\n, date_start\n, campaign_name\n, adset_name\n, ad_name\n, objective\n, publisher_platform\n, platform_position\n, spend\n, impressions\n, clicks\n, inline_link_clicks\n, _sdc_sequence\n, _sdc_batched_at,\n                value._28d_click,\n               from \n\n\n\n(\n\tselect * from (\n\n\t\tselect \n\t\t\t*,\n\t\t\tmax(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,\n\t\t\tmax(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch\n\t\tfrom `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` \n\n\t) \n\twhere _sdc_sequence = most_recent_sequence\n\tand _sdc_batched_at = most_recent_batch\n\n)\n\n\n               left join unnest(actions)\n\n               )\n\n            group by 1,2,3,4,5,6,7,8,9,10,11,12\n\n                      \n                   \n\n)\n\nselect distinct\n  account,\n  platform,\n  date,\n  campaign,\n  group_set,\n  ad,\n  objective,\n  placement,\n  spend,\n  impressions,\n  clicks,\n  link_clicks,\n  conversions\nfrom fb_adplatforms\n\n ", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "\n\n\n\nwith fb_adplatforms as (\n\n      \n          \n          select\n          account_name account,\n          'Facebook Ads' as platform,\n          date_start date,\n          campaign_name campaign,\n          adset_name group_set,\n          ad_name ad,\n          objective,\n          Concat(publisher_platform,\"-\",platform_position) as placement,\n          spend,\n          impressions,\n          clicks,\n          inline_link_clicks link_clicks,\n          sum(_28d_click) as conversions\n\n          from (\n\n                select\n                \n  account_name\n, date_start\n, campaign_name\n, adset_name\n, ad_name\n, objective\n, publisher_platform\n, platform_position\n, spend\n, impressions\n, clicks\n, inline_link_clicks\n, _sdc_sequence\n, _sdc_batched_at,\n                value._28d_click,\n               from \n\n\n\n(\n\tselect * from (\n\n\t\tselect \n\t\t\t*,\n\t\t\tmax(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,\n\t\t\tmax(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch\n\t\tfrom `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` \n\n\t) \n\twhere _sdc_sequence = most_recent_sequence\n\tand _sdc_batched_at = most_recent_batch\n\n)\n\n\n               left join unnest(actions)\n\n               )\n\n            group by 1,2,3,4,5,6,7,8,9,10,11,12\n\n                      \n                   \n\n)\n\nselect distinct\n  account,\n  platform,\n  date,\n  campaign,\n  group_set,\n  ad,\n  objective,\n  placement,\n  spend,\n  impressions,\n  clicks,\n  link_clicks,\n  conversions\nfrom fb_adplatforms\n\n ", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1086940)", "execution_time": 28.081246852874756, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:11.306055Z", "completed_at": "2020-03-02T23:32:13.094076Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:13.094494Z", "completed_at": "2020-03-02T23:32:39.386001Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\na.channel channel,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n  {{ref('agg_platforms_union')}} a\nLEFT JOIN \n  {{ref('accounts_proc')}} b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "join", "agg_platforms_site"], "unique_id": "model.journeyengine_recipes.agg_platforms_site", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "join/agg_platforms_site.sql", "original_file_path": "models/join/agg_platforms_site.sql", "name": "agg_platforms_site", "resource_type": "model", "alias": "agg_platforms_site", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_platforms_union"], ["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_platforms_union", "model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/join/agg_platforms_site.sql", "compiled": true, "compiled_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\na.channel channel,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n  `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_union` a\nLEFT JOIN \n  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\na.channel channel,\nurl,\ncost,\nimpressions,\nclicks,\nconversions\nFROM \n  `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_union` a\nLEFT JOIN \n  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (126741)", "execution_time": 4.14182186126709, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:36.458242Z", "completed_at": "2020-03-02T23:32:36.470840Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:36.471161Z", "completed_at": "2020-03-02T23:32:40.598758Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT  \ncast(date as date) date,\nb.account,\nb.site site,\nc.source source,\nc.medium medium,\nconcat(a.source, ' / ', a.medium) source_medium,  \ncase when c.platform is null then \"Unmapped\" else c.platform end as platform,\ncase when c.channel is null then \"Unmapped\" else c.channel end as channel,\nurl,\nsum(sessions) sessions,\nsum(goal_completions) goal_completions,\nsum(mqls) mqls,\nsum(sqls) sqls,\nsum(other) other,\nsum(excluded) excluded\nFROM {{ ref('ga_proc') }} a\nLEFT JOIN {{ref('accounts_proc')}} b \nON ( a.bigquery_name = b.bigquery_name \n\tAND a.lookup_platform = b.platform )\nLEFT JOIN {{ref('mappings_ga_proc')}} c\nON ( a.source = c.source\n  AND a.medium = c.medium \n  AND a.bigquery_name = c.bigquery_name )\nGROUP BY date, account, site, source, medium, source_medium, platform, channel, url", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "base", "ga", "ga_stats"], "unique_id": "model.journeyengine_recipes.ga_stats", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "base/ga/ga_stats.sql", "original_file_path": "models/base/ga/ga_stats.sql", "name": "ga_stats", "resource_type": "model", "alias": "ga_stats", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["ga_proc"], ["accounts_proc"], ["mappings_ga_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.ga_proc", "model.journeyengine_recipes.accounts_proc", "model.journeyengine_recipes.mappings_ga_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/base/ga/ga_stats.sql", "compiled": true, "compiled_sql": "SELECT  \ncast(date as date) date,\nb.account,\nb.site site,\nc.source source,\nc.medium medium,\nconcat(a.source, ' / ', a.medium) source_medium,  \ncase when c.platform is null then \"Unmapped\" else c.platform end as platform,\ncase when c.channel is null then \"Unmapped\" else c.channel end as channel,\nurl,\nsum(sessions) sessions,\nsum(goal_completions) goal_completions,\nsum(mqls) mqls,\nsum(sqls) sqls,\nsum(other) other,\nsum(excluded) excluded\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc` a\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b \nON ( a.bigquery_name = b.bigquery_name \n\tAND a.lookup_platform = b.platform )\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc` c\nON ( a.source = c.source\n  AND a.medium = c.medium \n  AND a.bigquery_name = c.bigquery_name )\nGROUP BY date, account, site, source, medium, source_medium, platform, channel, url", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT  \ncast(date as date) date,\nb.account,\nb.site site,\nc.source source,\nc.medium medium,\nconcat(a.source, ' / ', a.medium) source_medium,  \ncase when c.platform is null then \"Unmapped\" else c.platform end as platform,\ncase when c.channel is null then \"Unmapped\" else c.channel end as channel,\nurl,\nsum(sessions) sessions,\nsum(goal_completions) goal_completions,\nsum(mqls) mqls,\nsum(sqls) sqls,\nsum(other) other,\nsum(excluded) excluded\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc` a\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b \nON ( a.bigquery_name = b.bigquery_name \n\tAND a.lookup_platform = b.platform )\nLEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc` c\nON ( a.source = c.source\n  AND a.medium = c.medium \n  AND a.bigquery_name = c.bigquery_name )\nGROUP BY date, account, site, source, medium, source_medium, platform, channel, url", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (702431)", "execution_time": 14.523082971572876, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:37.630606Z", "completed_at": "2020-03-02T23:32:37.646537Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:37.647070Z", "completed_at": "2020-03-02T23:32:52.152258Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n{{ ref('fb_adplatforms') }}\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\ncast(objective as string),\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n{{ ref('adwords_adplatforms') }}\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\nCAST(date AS TIMESTAMP),\ncampaign,\ngroup_set,\nad,\nCAST(objective AS STRING),\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n{{ ref('linkedin_adplatforms') }}\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\ncast(date as timestamp),\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM \n\n{{ ref('twitter_adplatforms') }}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "join", "agg_adplatforms_union"], "unique_id": "model.journeyengine_recipes.agg_adplatforms_union", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "join/agg_adplatforms_union.sql", "original_file_path": "models/join/agg_adplatforms_union.sql", "name": "agg_adplatforms_union", "resource_type": "model", "alias": "agg_adplatforms_union", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["fb_adplatforms"], ["adwords_adplatforms"], ["linkedin_adplatforms"], ["twitter_adplatforms"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.fb_adplatforms", "model.journeyengine_recipes.adwords_adplatforms", "model.journeyengine_recipes.linkedin_adplatforms", "model.journeyengine_recipes.twitter_adplatforms"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/join/agg_adplatforms_union.sql", "compiled": true, "compiled_sql": "SELECT\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n`journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\ncast(objective as string),\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n`journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\nCAST(date AS TIMESTAMP),\ncampaign,\ngroup_set,\nad,\nCAST(objective AS STRING),\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\ncast(date as timestamp),\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM \n\n`journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n`journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\ndate,\ncampaign,\ngroup_set,\nad,\ncast(objective as string),\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n`journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\nCAST(date AS TIMESTAMP),\ncampaign,\ngroup_set,\nad,\nCAST(objective AS STRING),\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM\n\n`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`\n\nUNION ALL\n\nSELECT\naccount,\nplatform,\ncast(date as timestamp),\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions\nFROM \n\n`journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1173742)", "execution_time": 14.886761903762817, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:39.758226Z", "completed_at": "2020-03-02T23:32:39.774659Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:39.775058Z", "completed_at": "2020-03-02T23:32:54.643580Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "with ga as (\n\n\tselect \n\t\tdate, account, site, channel, platform, url,\n\t\tsessions, goal_completions, mqls, sqls, other, excluded,\n\t\tnull as cost, null as impressions, null as clicks, null as conversions\n\tfrom {{ref('ga_stats')}}\n\n),\n\nplatforms as (\n\n\tselect \n\t\tdate, account, site, channel, platform, url,\n\t\tnull as sessions, null as goal_completions, null as mqls, null as sqls, null as other, null as excluded,\n\t\tcost, impressions, clicks, conversions\n\tfrom {{ref('agg_platforms_site')}}\n\n)\n\n\nSELECT\n    date, \n    site,\n    platform,\n    channel, \n    url,\n    sum(cost) cost,\n\tsum(impressions) impressions,\n\tsum(clicks) clicks,\n\tsum(conversions) conversions,\n\tsum(sessions) sessions,\n\tsum(goal_completions) goal_completions,\n\tsum(mqls) mqls,\n\tsum(sqls) sqls,\n\tsum(other) other,\n\tsum(excluded) excluded\nFROM\n(\n    SELECT *\n    FROM \n      ga\n    UNION ALL\n    SELECT *\n    FROM \n      platforms \n) \nGROUP BY\n    date, site, platform, channel, url", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "join", "agg_platforms_ga"], "unique_id": "model.journeyengine_recipes.agg_platforms_ga", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "join/agg_platforms_ga.sql", "original_file_path": "models/join/agg_platforms_ga.sql", "name": "agg_platforms_ga", "resource_type": "model", "alias": "agg_platforms_ga", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["ga_stats"], ["agg_platforms_site"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.ga_stats", "model.journeyengine_recipes.agg_platforms_site"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/join/agg_platforms_ga.sql", "compiled": true, "compiled_sql": "with ga as (\n\n\tselect \n\t\tdate, account, site, channel, platform, url,\n\t\tsessions, goal_completions, mqls, sqls, other, excluded,\n\t\tnull as cost, null as impressions, null as clicks, null as conversions\n\tfrom `journeyengine-recipes`.`agency_data_pipeline`.`ga_stats`\n\n),\n\nplatforms as (\n\n\tselect \n\t\tdate, account, site, channel, platform, url,\n\t\tnull as sessions, null as goal_completions, null as mqls, null as sqls, null as other, null as excluded,\n\t\tcost, impressions, clicks, conversions\n\tfrom `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_site`\n\n)\n\n\nSELECT\n    date, \n    site,\n    platform,\n    channel, \n    url,\n    sum(cost) cost,\n\tsum(impressions) impressions,\n\tsum(clicks) clicks,\n\tsum(conversions) conversions,\n\tsum(sessions) sessions,\n\tsum(goal_completions) goal_completions,\n\tsum(mqls) mqls,\n\tsum(sqls) sqls,\n\tsum(other) other,\n\tsum(excluded) excluded\nFROM\n(\n    SELECT *\n    FROM \n      ga\n    UNION ALL\n    SELECT *\n    FROM \n      platforms \n) \nGROUP BY\n    date, site, platform, channel, url", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "with ga as (\n\n\tselect \n\t\tdate, account, site, channel, platform, url,\n\t\tsessions, goal_completions, mqls, sqls, other, excluded,\n\t\tnull as cost, null as impressions, null as clicks, null as conversions\n\tfrom `journeyengine-recipes`.`agency_data_pipeline`.`ga_stats`\n\n),\n\nplatforms as (\n\n\tselect \n\t\tdate, account, site, channel, platform, url,\n\t\tnull as sessions, null as goal_completions, null as mqls, null as sqls, null as other, null as excluded,\n\t\tcost, impressions, clicks, conversions\n\tfrom `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_site`\n\n)\n\n\nSELECT\n    date, \n    site,\n    platform,\n    channel, \n    url,\n    sum(cost) cost,\n\tsum(impressions) impressions,\n\tsum(clicks) clicks,\n\tsum(conversions) conversions,\n\tsum(sessions) sessions,\n\tsum(goal_completions) goal_completions,\n\tsum(mqls) mqls,\n\tsum(sqls) sqls,\n\tsum(other) other,\n\tsum(excluded) excluded\nFROM\n(\n    SELECT *\n    FROM \n      ga\n    UNION ALL\n    SELECT *\n    FROM \n      platforms \n) \nGROUP BY\n    date, site, platform, channel, url", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (655454)", "execution_time": 12.458833932876587, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:52.511329Z", "completed_at": "2020-03-02T23:32:52.526820Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:52.527412Z", "completed_at": "2020-03-02T23:33:04.968740Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\ncampaign, \ngroup_set, \nad,\nobjective,\nplacement, \nspend,\nimpressions, \nclicks,\nlink_clicks,\nconversions\nFROM \n  {{ref('agg_adplatforms_union')}} a\nLEFT JOIN \n  {{ref('accounts_proc')}} b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "join", "agg_adplatforms_site"], "unique_id": "model.journeyengine_recipes.agg_adplatforms_site", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "join/agg_adplatforms_site.sql", "original_file_path": "models/join/agg_adplatforms_site.sql", "name": "agg_adplatforms_site", "resource_type": "model", "alias": "agg_adplatforms_site", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_adplatforms_union"], ["accounts_proc"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_adplatforms_union", "model.journeyengine_recipes.accounts_proc"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/join/agg_adplatforms_site.sql", "compiled": true, "compiled_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\ncampaign, \ngroup_set, \nad,\nobjective,\nplacement, \nspend,\nimpressions, \nclicks,\nlink_clicks,\nconversions\nFROM \n  `journeyengine-recipes`.`agency_data_pipeline`.`agg_adplatforms_union` a\nLEFT JOIN \n  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate, \na.account account, \nb.site site,\na.platform platform,\ncampaign, \ngroup_set, \nad,\nobjective,\nplacement, \nspend,\nimpressions, \nclicks,\nlink_clicks,\nconversions\nFROM \n  `journeyengine-recipes`.`agency_data_pipeline`.`agg_adplatforms_union` a\nLEFT JOIN \n  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b\nON ( \n  a.account = b.account AND\n  a.platform = b.platform\n)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1173742)", "execution_time": 14.24877381324768, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:32:55.037638Z", "completed_at": "2020-03-02T23:32:55.050866Z"}, {"name": "execute", "started_at": "2020-03-02T23:32:55.051175Z", "completed_at": "2020-03-02T23:33:09.284992Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\nsum(sessions) OVER w1 total_sessions,\ngoal_completions,\nsum(goal_completions) OVER w1 total_goal_completions,\nmqls,\nsum(mqls) OVER w1 total_mqls,\nsqls,\nsum(sqls) OVER w1 total_sqls,\nother,\nsum(other) OVER w1 total_other,\nexcluded,\nsum(excluded) OVER w1 total_excluded,\nFROM (\n    SELECT \n    date,\n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform,\n    channel, \n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions,\n    sum(sessions) sessions,\n    sum(goal_completions) goal_completions,\n    sum(mqls) mqls,\n    sum(sqls) sqls,\n    sum(other) other,\n    sum(excluded) excluded\n    FROM {{ ref('agg_platforms_ga') }}\n    GROUP BY date, yyyymm, site, channel, platform\n)\nWINDOW w1 as (PARTITION BY yyyymm, site)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "math", "platform_by_month"], "unique_id": "model.journeyengine_recipes.platform_by_month", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "math/platform_by_month.sql", "original_file_path": "models/math/platform_by_month.sql", "name": "platform_by_month", "resource_type": "model", "alias": "platform_by_month", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_platforms_ga"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_platforms_ga"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/math/platform_by_month.sql", "compiled": true, "compiled_sql": "SELECT\ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\nsum(sessions) OVER w1 total_sessions,\ngoal_completions,\nsum(goal_completions) OVER w1 total_goal_completions,\nmqls,\nsum(mqls) OVER w1 total_mqls,\nsqls,\nsum(sqls) OVER w1 total_sqls,\nother,\nsum(other) OVER w1 total_other,\nexcluded,\nsum(excluded) OVER w1 total_excluded,\nFROM (\n    SELECT \n    date,\n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform,\n    channel, \n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions,\n    sum(sessions) sessions,\n    sum(goal_completions) goal_completions,\n    sum(mqls) mqls,\n    sum(sqls) sqls,\n    sum(other) other,\n    sum(excluded) excluded\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_ga`\n    GROUP BY date, yyyymm, site, channel, platform\n)\nWINDOW w1 as (PARTITION BY yyyymm, site)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\nsum(sessions) OVER w1 total_sessions,\ngoal_completions,\nsum(goal_completions) OVER w1 total_goal_completions,\nmqls,\nsum(mqls) OVER w1 total_mqls,\nsqls,\nsum(sqls) OVER w1 total_sqls,\nother,\nsum(other) OVER w1 total_other,\nexcluded,\nsum(excluded) OVER w1 total_excluded,\nFROM (\n    SELECT \n    date,\n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform,\n    channel, \n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions,\n    sum(sessions) sessions,\n    sum(goal_completions) goal_completions,\n    sum(mqls) mqls,\n    sum(sqls) sqls,\n    sum(other) other,\n    sum(excluded) excluded\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_ga`\n    GROUP BY date, yyyymm, site, channel, platform\n)\nWINDOW w1 as (PARTITION BY yyyymm, site)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (11614)", "execution_time": 4.611835956573486, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:05.335770Z", "completed_at": "2020-03-02T23:33:05.345950Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:05.354469Z", "completed_at": "2020-03-02T23:33:09.936492Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\ngoal_completions,\nmqls,\nsqls,\nother,\nexcluded,\nFROM (\n    SELECT\n    date,\n    yyyymm, \n    site,\n    platform,\n    channel, \n    cost,\n    impressions,\n    clicks,\n    conversions,\n    sessions,\n    goal_completions,\n    mqls,\n    sqls,\n    other,\n    excluded,\n    FROM {{ ref('platform_by_month')}}\n)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "math", "platform_index"], "unique_id": "model.journeyengine_recipes.platform_index", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "math/platform_index.sql", "original_file_path": "models/math/platform_index.sql", "name": "platform_index", "resource_type": "model", "alias": "platform_index", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["platform_by_month"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.platform_by_month"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/math/platform_index.sql", "compiled": true, "compiled_sql": "SELECT \ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\ngoal_completions,\nmqls,\nsqls,\nother,\nexcluded,\nFROM (\n    SELECT\n    date,\n    yyyymm, \n    site,\n    platform,\n    channel, \n    cost,\n    impressions,\n    clicks,\n    conversions,\n    sessions,\n    goal_completions,\n    mqls,\n    sqls,\n    other,\n    excluded,\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`platform_by_month`\n)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\ngoal_completions,\nmqls,\nsqls,\nother,\nexcluded,\nFROM (\n    SELECT\n    date,\n    yyyymm, \n    site,\n    platform,\n    channel, \n    cost,\n    impressions,\n    clicks,\n    conversions,\n    sessions,\n    goal_completions,\n    mqls,\n    sqls,\n    other,\n    excluded,\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`platform_by_month`\n)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (11614)", "execution_time": 2.172830104827881, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:10.446089Z", "completed_at": "2020-03-02T23:33:10.456637Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:10.456991Z", "completed_at": "2020-03-02T23:33:12.617649Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate,\nyyyymm Month, \nsite Site,\nplatform Platform,\nchannel Channel, \nifnull(cost, 0) Cost,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) Clicks,\nifnull(conversions, 0) Conversions,\nifnull(sessions, 0) Sessions,\nifnull(goal_completions, 0) GoalCompletions,\nifnull(mqls, 0) MQLs,\nifnull(sqls, 0) SQLs,\nifnull(other, 0) OtherConversions,\nifnull(excluded, 0) ExcludedConversions,\nFROM {{ ref('platform_index') }}\nWHERE yyyymm >= '2017-06'", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "visualization", "platform_viz"], "unique_id": "model.journeyengine_recipes.platform_viz", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "visualization/platform_viz.sql", "original_file_path": "models/visualization/platform_viz.sql", "name": "platform_viz", "resource_type": "model", "alias": "platform_viz", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["platform_index"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.platform_index"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/visualization/platform_viz.sql", "compiled": true, "compiled_sql": "SELECT \ndate,\nyyyymm Month, \nsite Site,\nplatform Platform,\nchannel Channel, \nifnull(cost, 0) Cost,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) Clicks,\nifnull(conversions, 0) Conversions,\nifnull(sessions, 0) Sessions,\nifnull(goal_completions, 0) GoalCompletions,\nifnull(mqls, 0) MQLs,\nifnull(sqls, 0) SQLs,\nifnull(other, 0) OtherConversions,\nifnull(excluded, 0) ExcludedConversions,\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`platform_index`\nWHERE yyyymm >= '2017-06'", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate,\nyyyymm Month, \nsite Site,\nplatform Platform,\nchannel Channel, \nifnull(cost, 0) Cost,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) Clicks,\nifnull(conversions, 0) Conversions,\nifnull(sessions, 0) Sessions,\nifnull(goal_completions, 0) GoalCompletions,\nifnull(mqls, 0) MQLs,\nifnull(sqls, 0) SQLs,\nifnull(other, 0) OtherConversions,\nifnull(excluded, 0) ExcludedConversions,\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`platform_index`\nWHERE yyyymm >= '2017-06'", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (11613)", "execution_time": 2.49766206741333, "thread_id": "Thread-4", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:13.037161Z", "completed_at": "2020-03-02T23:33:13.048167Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:13.048475Z", "completed_at": "2020-03-02T23:33:15.533412Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \nurl,\ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\nsum(sessions) OVER w1 total_sessions,\ngoal_completions,\nsum(goal_completions) OVER w1 total_goal_completions,\nmqls,\nsum(mqls) OVER w1 total_mqls,\nsqls,\nsum(sqls) OVER w1 total_sqls,\nother,\nsum(other) OVER w1 total_other,\nexcluded,\nsum(other) OVER w1 total_excluded,\n\nFROM (\n    SELECT \n    date,\n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform,\n    channel, \n    url,\n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions,\n    sum(sessions) sessions,\n    sum(goal_completions) goal_completions,\n    sum(mqls) mqls,\n    sum(sqls) sqls,\n    sum(other) other,\n    sum(excluded) excluded\n    FROM {{ ref('agg_platforms_ga') }}\n    GROUP BY date, yyyymm, site, platform, channel, url\n)\nWINDOW w1 as (PARTITION BY yyyymm, site)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "math", "landing_page_by_month"], "unique_id": "model.journeyengine_recipes.landing_page_by_month", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "math/landing_page_by_month.sql", "original_file_path": "models/math/landing_page_by_month.sql", "name": "landing_page_by_month", "resource_type": "model", "alias": "landing_page_by_month", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_platforms_ga"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_platforms_ga"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/math/landing_page_by_month.sql", "compiled": true, "compiled_sql": "SELECT\ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \nurl,\ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\nsum(sessions) OVER w1 total_sessions,\ngoal_completions,\nsum(goal_completions) OVER w1 total_goal_completions,\nmqls,\nsum(mqls) OVER w1 total_mqls,\nsqls,\nsum(sqls) OVER w1 total_sqls,\nother,\nsum(other) OVER w1 total_other,\nexcluded,\nsum(other) OVER w1 total_excluded,\n\nFROM (\n    SELECT \n    date,\n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform,\n    channel, \n    url,\n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions,\n    sum(sessions) sessions,\n    sum(goal_completions) goal_completions,\n    sum(mqls) mqls,\n    sum(sqls) sqls,\n    sum(other) other,\n    sum(excluded) excluded\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_ga`\n    GROUP BY date, yyyymm, site, platform, channel, url\n)\nWINDOW w1 as (PARTITION BY yyyymm, site)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \nurl,\ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\nsum(sessions) OVER w1 total_sessions,\ngoal_completions,\nsum(goal_completions) OVER w1 total_goal_completions,\nmqls,\nsum(mqls) OVER w1 total_mqls,\nsqls,\nsum(sqls) OVER w1 total_sqls,\nother,\nsum(other) OVER w1 total_other,\nexcluded,\nsum(other) OVER w1 total_excluded,\n\nFROM (\n    SELECT \n    date,\n    FORMAT_DATE(\"%Y-%m\", date) AS yyyymm,\n    site,\n    platform,\n    channel, \n    url,\n    sum(cost) cost,\n    sum(impressions) impressions,\n    sum(clicks) clicks,\n    sum(conversions) conversions,\n    sum(sessions) sessions,\n    sum(goal_completions) goal_completions,\n    sum(mqls) mqls,\n    sum(sqls) sqls,\n    sum(other) other,\n    sum(excluded) excluded\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_platforms_ga`\n    GROUP BY date, yyyymm, site, platform, channel, url\n)\nWINDOW w1 as (PARTITION BY yyyymm, site)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (655454)", "execution_time": 13.243023872375488, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:05.325696Z", "completed_at": "2020-03-02T23:33:05.345627Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:05.346259Z", "completed_at": "2020-03-02T23:33:18.564792Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT\ndate,\naccount,\nsite,\nplatform,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions,\ncpm,\ncpc,\ncpc_link,\ncpconversion\nFROM(\n\t\tSELECT\n\t\tdate,\n\t\taccount,\n\t\tsite,\n\t\tplatform,\n\t\tcampaign,\n\t\tgroup_set,\n\t\tad,\n\t\tobjective,\n\t\tplacement,\n\t\tspend,\n\t\timpressions,\n\t\tclicks,\n\t\tlink_clicks,\n\t\tconversions,\n\t\tcase when spend > 0 and impressions > 0 then spend / (impressions/1000) else null end as cpm,\n\t\tcase when spend > 0 and clicks > 0 then spend / clicks else null end as cpc,\n\t\tcase when spend > 0 and link_clicks > 0 then spend / link_clicks else null end as cpc_link,\n\t\tcase when spend > 0 and conversions > 0 then spend / conversions else null end as cpconversion\n\t\tFROM {{ref('agg_adplatforms_site')}}\n\t)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "math", "adplatform_cost_calculations"], "unique_id": "model.journeyengine_recipes.adplatform_cost_calculations", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "math/adplatform_cost_calculations.sql", "original_file_path": "models/math/adplatform_cost_calculations.sql", "name": "adplatform_cost_calculations", "resource_type": "model", "alias": "adplatform_cost_calculations", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["agg_adplatforms_site"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.agg_adplatforms_site"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/math/adplatform_cost_calculations.sql", "compiled": true, "compiled_sql": "SELECT\ndate,\naccount,\nsite,\nplatform,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions,\ncpm,\ncpc,\ncpc_link,\ncpconversion\nFROM(\n\t\tSELECT\n\t\tdate,\n\t\taccount,\n\t\tsite,\n\t\tplatform,\n\t\tcampaign,\n\t\tgroup_set,\n\t\tad,\n\t\tobjective,\n\t\tplacement,\n\t\tspend,\n\t\timpressions,\n\t\tclicks,\n\t\tlink_clicks,\n\t\tconversions,\n\t\tcase when spend > 0 and impressions > 0 then spend / (impressions/1000) else null end as cpm,\n\t\tcase when spend > 0 and clicks > 0 then spend / clicks else null end as cpc,\n\t\tcase when spend > 0 and link_clicks > 0 then spend / link_clicks else null end as cpc_link,\n\t\tcase when spend > 0 and conversions > 0 then spend / conversions else null end as cpconversion\n\t\tFROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_adplatforms_site`\n\t)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT\ndate,\naccount,\nsite,\nplatform,\ncampaign,\ngroup_set,\nad,\nobjective,\nplacement,\nspend,\nimpressions,\nclicks,\nlink_clicks,\nconversions,\ncpm,\ncpc,\ncpc_link,\ncpconversion\nFROM(\n\t\tSELECT\n\t\tdate,\n\t\taccount,\n\t\tsite,\n\t\tplatform,\n\t\tcampaign,\n\t\tgroup_set,\n\t\tad,\n\t\tobjective,\n\t\tplacement,\n\t\tspend,\n\t\timpressions,\n\t\tclicks,\n\t\tlink_clicks,\n\t\tconversions,\n\t\tcase when spend > 0 and impressions > 0 then spend / (impressions/1000) else null end as cpm,\n\t\tcase when spend > 0 and clicks > 0 then spend / clicks else null end as cpc,\n\t\tcase when spend > 0 and link_clicks > 0 then spend / link_clicks else null end as cpc_link,\n\t\tcase when spend > 0 and conversions > 0 then spend / conversions else null end as cpconversion\n\t\tFROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_adplatforms_site`\n\t)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1173742)", "execution_time": 12.698207139968872, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:09.644984Z", "completed_at": "2020-03-02T23:33:09.657156Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:09.657528Z", "completed_at": "2020-03-02T23:33:22.341764Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \nurl,\ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\npct_sessions,\ngoal_completions,\npct_goal_completions,\nmqls,\npct_mqls,\nsqls,\npct_sqls,\nother,\nexcluded,\ncase when pct_sessions > 0 then pct_goal_completions / pct_sessions else null end as conversion_index\nFROM (\n    SELECT\n    date,\n    yyyymm, \n    site,\n    platform,\n    channel, \n    url,\n    cost,\n    impressions,\n    clicks,\n    conversions,\n    sessions,\n    case when total_sessions > 0 then sessions / total_sessions else null end as pct_sessions,\n    goal_completions,\n    case when total_goal_completions > 0 then goal_completions / total_goal_completions else null end as pct_goal_completions,\n    mqls,\n    case when total_mqls > 0 then mqls / total_mqls else null end as pct_mqls,\n    sqls,\n    case when total_sqls > 0 then sqls / total_sqls else null end as pct_sqls,\n    other,\n    excluded\n    FROM {{ ref('landing_page_by_month')}}\n)", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "math", "landing_page_index"], "unique_id": "model.journeyengine_recipes.landing_page_index", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "math/landing_page_index.sql", "original_file_path": "models/math/landing_page_index.sql", "name": "landing_page_index", "resource_type": "model", "alias": "landing_page_index", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["landing_page_by_month"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.landing_page_by_month"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/math/landing_page_index.sql", "compiled": true, "compiled_sql": "SELECT \ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \nurl,\ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\npct_sessions,\ngoal_completions,\npct_goal_completions,\nmqls,\npct_mqls,\nsqls,\npct_sqls,\nother,\nexcluded,\ncase when pct_sessions > 0 then pct_goal_completions / pct_sessions else null end as conversion_index\nFROM (\n    SELECT\n    date,\n    yyyymm, \n    site,\n    platform,\n    channel, \n    url,\n    cost,\n    impressions,\n    clicks,\n    conversions,\n    sessions,\n    case when total_sessions > 0 then sessions / total_sessions else null end as pct_sessions,\n    goal_completions,\n    case when total_goal_completions > 0 then goal_completions / total_goal_completions else null end as pct_goal_completions,\n    mqls,\n    case when total_mqls > 0 then mqls / total_mqls else null end as pct_mqls,\n    sqls,\n    case when total_sqls > 0 then sqls / total_sqls else null end as pct_sqls,\n    other,\n    excluded\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`landing_page_by_month`\n)", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate,\nyyyymm, \nsite,\nplatform,\nchannel, \nurl,\ncost,\nimpressions,\nclicks,\nconversions,\nsessions,\npct_sessions,\ngoal_completions,\npct_goal_completions,\nmqls,\npct_mqls,\nsqls,\npct_sqls,\nother,\nexcluded,\ncase when pct_sessions > 0 then pct_goal_completions / pct_sessions else null end as conversion_index\nFROM (\n    SELECT\n    date,\n    yyyymm, \n    site,\n    platform,\n    channel, \n    url,\n    cost,\n    impressions,\n    clicks,\n    conversions,\n    sessions,\n    case when total_sessions > 0 then sessions / total_sessions else null end as pct_sessions,\n    goal_completions,\n    case when total_goal_completions > 0 then goal_completions / total_goal_completions else null end as pct_goal_completions,\n    mqls,\n    case when total_mqls > 0 then mqls / total_mqls else null end as pct_mqls,\n    sqls,\n    case when total_sqls > 0 then sqls / total_sqls else null end as pct_sqls,\n    other,\n    excluded\n    FROM `journeyengine-recipes`.`agency_data_pipeline`.`landing_page_by_month`\n)", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (655454)", "execution_time": 12.337701797485352, "thread_id": "Thread-3", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:18.948212Z", "completed_at": "2020-03-02T23:33:18.960165Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:18.960473Z", "completed_at": "2020-03-02T23:33:31.284491Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "SELECT \ndate,\nyyyymm Month, \nsite Site,\nplatform Platform,\nchannel Channel, \nurl URL,\nifnull(cost, 0) Cost,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) Clicks,\nifnull(conversions, 0) Conversions,\nifnull(sessions, 0) Sessions,\nifnull(goal_completions, 0) GoalCompletions,\nifnull(conversion_index, 0) ConversionIndex,\nifnull(mqls, 0) MQLs,\nifnull(sqls, 0) SQLs,\nifnull(other, 0) OtherConversions,\nifnull(excluded, 0) ExcludedConversions,\nFROM {{ ref('landing_page_index') }}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "visualization", "landing_page_viz"], "unique_id": "model.journeyengine_recipes.landing_page_viz", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "visualization/landing_page_viz.sql", "original_file_path": "models/visualization/landing_page_viz.sql", "name": "landing_page_viz", "resource_type": "model", "alias": "landing_page_viz", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["landing_page_index"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.landing_page_index"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/visualization/landing_page_viz.sql", "compiled": true, "compiled_sql": "SELECT \ndate,\nyyyymm Month, \nsite Site,\nplatform Platform,\nchannel Channel, \nurl URL,\nifnull(cost, 0) Cost,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) Clicks,\nifnull(conversions, 0) Conversions,\nifnull(sessions, 0) Sessions,\nifnull(goal_completions, 0) GoalCompletions,\nifnull(conversion_index, 0) ConversionIndex,\nifnull(mqls, 0) MQLs,\nifnull(sqls, 0) SQLs,\nifnull(other, 0) OtherConversions,\nifnull(excluded, 0) ExcludedConversions,\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`landing_page_index`", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "SELECT \ndate,\nyyyymm Month, \nsite Site,\nplatform Platform,\nchannel Channel, \nurl URL,\nifnull(cost, 0) Cost,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) Clicks,\nifnull(conversions, 0) Conversions,\nifnull(sessions, 0) Sessions,\nifnull(goal_completions, 0) GoalCompletions,\nifnull(conversion_index, 0) ConversionIndex,\nifnull(mqls, 0) MQLs,\nifnull(sqls, 0) SQLs,\nifnull(other, 0) OtherConversions,\nifnull(excluded, 0) ExcludedConversions,\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`landing_page_index`", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (655454)", "execution_time": 7.025909185409546, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:31.642872Z", "completed_at": "2020-03-02T23:33:31.653600Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:31.653891Z", "completed_at": "2020-03-02T23:33:38.667463Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "select\ndate,\nsite,\nplatform,\nifnull(campaign,'') Campaign,\nifnull(group_set,'') ADGroup,\nifnull(ad, '') AdName,\nifnull(objective, '') Objective,\nifnull(placement, '') Placement,\nifnull(spend, 0) Spend,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) TotalClicks,\nifnull(link_clicks, 0) LinkClicks,\nifnull(conversions, 0) Conversions,\nround(cpm,2) CPM,\nround(cpc,2) CPC,\nround(cpc_link,2) CPC_Link,\nround(cpconversion,2) CPResult\n\nFROM {{ ref('adplatform_cost_calculations') }}", "database": "journeyengine-recipes", "schema": "agency_data_pipeline", "fqn": ["journeyengine_recipes", "visualization", "ad_platform_viz"], "unique_id": "model.journeyengine_recipes.ad_platform_viz", "package_name": "journeyengine_recipes", "root_path": "/Users/justinthomas/journeyengine-recipes", "path": "visualization/ad_platform_viz.sql", "original_file_path": "models/visualization/ad_platform_viz.sql", "name": "ad_platform_viz", "resource_type": "model", "alias": "ad_platform_viz", "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "tags": []}, "tags": [], "refs": [["adplatform_cost_calculations"]], "sources": [], "depends_on": {"nodes": ["model.journeyengine_recipes.adplatform_cost_calculations"], "macros": []}, "docrefs": [], "description": "", "columns": {}, "patch_path": null, "build_path": "target/run/journeyengine_recipes/visualization/ad_platform_viz.sql", "compiled": true, "compiled_sql": "select\ndate,\nsite,\nplatform,\nifnull(campaign,'') Campaign,\nifnull(group_set,'') ADGroup,\nifnull(ad, '') AdName,\nifnull(objective, '') Objective,\nifnull(placement, '') Placement,\nifnull(spend, 0) Spend,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) TotalClicks,\nifnull(link_clicks, 0) LinkClicks,\nifnull(conversions, 0) Conversions,\nround(cpm,2) CPM,\nround(cpc,2) CPC,\nround(cpc_link,2) CPC_Link,\nround(cpconversion,2) CPResult\n\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`adplatform_cost_calculations`", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "select\ndate,\nsite,\nplatform,\nifnull(campaign,'') Campaign,\nifnull(group_set,'') ADGroup,\nifnull(ad, '') AdName,\nifnull(objective, '') Objective,\nifnull(placement, '') Placement,\nifnull(spend, 0) Spend,\nifnull(impressions, 0) Impressions,\nifnull(clicks, 0) TotalClicks,\nifnull(link_clicks, 0) LinkClicks,\nifnull(conversions, 0) Conversions,\nround(cpm,2) CPM,\nround(cpc,2) CPC,\nround(cpc_link,2) CPC_Link,\nround(cpconversion,2) CPResult\n\nFROM `journeyengine-recipes`.`agency_data_pipeline`.`adplatform_cost_calculations`", "wrapped_sql": "None"}, "error": null, "status": "CREATE TABLE (1173742)", "execution_time": 16.305904865264893, "thread_id": "Thread-2", "timing": [{"name": "compile", "started_at": "2020-03-02T23:33:22.698832Z", "completed_at": "2020-03-02T23:33:22.711213Z"}, {"name": "execute", "started_at": "2020-03-02T23:33:22.711561Z", "completed_at": "2020-03-02T23:33:39.003329Z"}], "fail": null, "warn": null, "skip": false}], "generated_at": "2020-03-02T23:33:39.453156Z", "elapsed_time": 103.47217774391174}