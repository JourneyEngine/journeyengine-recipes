2020-02-27 16:38:19,578472 (MainThread): Running with dbt=0.15.2
2020-02-27 16:38:19,880076 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 16:38:19,880959 (MainThread): Tracking: tracking
2020-02-27 16:38:19,894174 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112893950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112893550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112893a50>]}
2020-02-27 16:38:20,380751 (MainThread): Partial parsing not enabled
2020-02-27 16:38:20,384844 (MainThread): Parsing macros/core.sql
2020-02-27 16:38:20,390470 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 16:38:20,399376 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 16:38:20,403561 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 16:38:20,431093 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 16:38:20,456002 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 16:38:20,480362 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 16:38:20,485099 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 16:38:20,495990 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 16:38:20,506200 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 16:38:20,518092 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 16:38:20,529008 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 16:38:20,536123 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 16:38:20,537681 (MainThread): Parsing macros/etc/query.sql
2020-02-27 16:38:20,539306 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 16:38:20,541795 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 16:38:20,544667 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 16:38:20,555991 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 16:38:20,560133 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 16:38:20,595777 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 16:38:20,597391 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 16:38:20,598933 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 16:38:20,600531 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 16:38:20,603786 (MainThread): Parsing macros/etc.sql
2020-02-27 16:38:20,605394 (MainThread): Parsing macros/catalog.sql
2020-02-27 16:38:20,609927 (MainThread): Parsing macros/adapters.sql
2020-02-27 16:38:20,632202 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 16:38:20,634833 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 16:38:20,638197 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 16:38:20,640522 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 16:38:20,652168 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 16:38:20,659410 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 16:38:20,685730 (MainThread): Partial parsing not enabled
2020-02-27 16:38:20,686752 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 16:38:20,691611 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 16:38:20,716683 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 16:38:20,716854 (MainThread): Opening a new connection, currently in state init
2020-02-27 16:38:20,744755 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 16:38:20,744907 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,753028 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 16:38:20,753192 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,760997 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 16:38:20,761115 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,768968 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 16:38:20,769091 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,777255 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 16:38:20,777393 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,789254 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 16:38:20,789411 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,798518 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 16:38:20,798688 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,807868 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 16:38:20,808004 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,818403 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 16:38:20,818637 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,835796 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 16:38:20,835993 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,845278 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 16:38:20,845400 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,855870 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 16:38:20,856000 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,863078 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 16:38:20,863209 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,870835 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 16:38:20,871007 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,877743 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 16:38:20,877870 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,885940 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 16:38:20,886121 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,894270 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 16:38:20,894457 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,902465 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 16:38:20,902592 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,910292 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 16:38:20,910433 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,918240 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 16:38:20,918414 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,926837 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 16:38:20,927010 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,984527 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 16:38:20,984699 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:20,995858 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 16:38:20,996033 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,4999 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 16:38:21,5167 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,11850 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 16:38:21,11969 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,18318 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 16:38:21,18443 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,24914 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 16:38:21,25041 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,31799 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 16:38:21,31944 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,38764 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 16:38:21,38906 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,46216 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 16:38:21,46353 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,60279 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 16:38:21,60497 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,73336 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 16:38:21,73501 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,81612 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 16:38:21,81805 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,95089 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 16:38:21,95218 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,117622 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 16:38:21,117779 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,131057 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 16:38:21,131250 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,148662 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 16:38:21,148789 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,156837 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 16:38:21,157060 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,165044 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 16:38:21,165298 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,176990 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 16:38:21,177131 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,185172 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 16:38:21,185302 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,197410 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 16:38:21,197636 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,206269 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 16:38:21,206451 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:21,478522 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 140 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 16:38:21,502765 (MainThread): 
2020-02-27 16:38:21,503232 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 16:38:21,503350 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:38:22,567172 (MainThread): 08:38:22 | Concurrency: 4 threads (target='dev')
2020-02-27 16:38:22,567408 (MainThread): 08:38:22 | 
2020-02-27 16:38:22,572038 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 16:38:22,572264 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 16:38:22,572448 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 16:38:22,572598 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 16:38:22,572791 (Thread-1): 08:38:22 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 16:38:22,572975 (Thread-2): 08:38:22 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 16:38:22,573169 (Thread-3): 08:38:22 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 16:38:22,573361 (Thread-4): 08:38:22 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 16:38:22,573835 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 16:38:22,574291 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 16:38:22,574677 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 16:38:22,575033 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 16:38:22,575151 (Thread-1): Opening a new connection, currently in state init
2020-02-27 16:38:22,575286 (Thread-2): Opening a new connection, currently in state init
2020-02-27 16:38:22,575418 (Thread-3): Opening a new connection, currently in state init
2020-02-27 16:38:22,575544 (Thread-4): Opening a new connection, currently in state init
2020-02-27 16:38:22,575696 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 16:38:22,575831 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 16:38:22,575965 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 16:38:22,576103 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 16:38:22,603458 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 16:38:22,604740 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 16:38:22,612449 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 16:38:22,621675 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 16:38:22,622887 (Thread-1): finished collecting timing info
2020-02-27 16:38:22,634340 (Thread-2): finished collecting timing info
2020-02-27 16:38:22,634709 (Thread-4): finished collecting timing info
2020-02-27 16:38:22,678695 (Thread-3): finished collecting timing info
2020-02-27 16:38:23,363724 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 16:38:23,365335 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 16:38:23,376324 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 16:38:23,377080 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 16:38:23,380018 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 16:38:23,380289 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 16:38:23,382611 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_sculpt.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 16:38:23,383581 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_sculpt.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 16:38:25,211725 (Thread-4): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US')
2020-02-27 16:38:25,211993 (Thread-4): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_sculpt.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 16:38:25,212142 (Thread-4): 404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US

(job ID: d5544788-16ae-4f12-9c73-4103e2c9bdad)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_sculpt.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:25,212383 (Thread-4): finished collecting timing info
2020-02-27 16:38:25,213098 (Thread-4): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US
  
  (job ID: d5544788-16ae-4f12-9c73-4103e2c9bdad)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_sculpt.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US

(job ID: d5544788-16ae-4f12-9c73-4103e2c9bdad)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_sculpt.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US
  
  (job ID: d5544788-16ae-4f12-9c73-4103e2c9bdad)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_sculpt.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:25,225810 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d83790>]}
2020-02-27 16:38:25,376910 (Thread-3): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US')
2020-02-27 16:38:25,378795 (Thread-3): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_sculpt.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 16:38:25,379377 (Thread-3): 404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US

(job ID: 5bf2fc97-5c55-450b-9b18-52fc5dc09f5e)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_sculpt.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:25,379746 (Thread-3): finished collecting timing info
2020-02-27 16:38:25,380713 (Thread-3): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US
  
  (job ID: 5bf2fc97-5c55-450b-9b18-52fc5dc09f5e)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_sculpt.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US

(job ID: 5bf2fc97-5c55-450b-9b18-52fc5dc09f5e)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_sculpt.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US
  
  (job ID: 5bf2fc97-5c55-450b-9b18-52fc5dc09f5e)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_sculpt.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:25,382298 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129e2ad0>]}
2020-02-27 16:38:25,746700 (Thread-4): 08:38:25 | 4 of 44 ERROR creating table model agency_data_pipeline.adwords_urls. [ERROR in 2.65s]
2020-02-27 16:38:25,748183 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 16:38:25,748612 (Thread-4): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 16:38:25,749173 (Thread-4): 08:38:25 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 16:38:25,749916 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 16:38:25,750393 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 16:38:25,750566 (Thread-4): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 16:38:25,759959 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 16:38:25,760589 (Thread-4): finished collecting timing info
2020-02-27 16:38:25,766126 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 16:38:25,766613 (Thread-4): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 16:38:26,267578 (Thread-3): 08:38:26 | 3 of 44 ERROR creating table model agency_data_pipeline.adwords_campaigns [ERROR in 2.81s]
2020-02-27 16:38:26,267898 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 16:38:26,268127 (Thread-3): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 16:38:26,268358 (Thread-3): 08:38:26 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 16:38:26,269173 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 16:38:26,269486 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 16:38:26,269688 (Thread-3): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 16:38:26,278653 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 16:38:26,279163 (Thread-3): finished collecting timing info
2020-02-27 16:38:26,285608 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 16:38:26,286070 (Thread-3): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 16:38:27,455664 (Thread-1): finished collecting timing info
2020-02-27 16:38:27,456727 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a793d0>]}
2020-02-27 16:38:27,745379 (Thread-2): finished collecting timing info
2020-02-27 16:38:27,746429 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a79610>]}
2020-02-27 16:38:27,810484 (Thread-1): 08:38:27 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (4) in 4.88s]
2020-02-27 16:38:27,811980 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 16:38:27,812328 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 16:38:27,812778 (Thread-1): 08:38:27 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 16:38:27,813801 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 16:38:27,814262 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 16:38:27,814437 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 16:38:27,823187 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 16:38:27,823971 (Thread-1): finished collecting timing info
2020-02-27 16:38:27,829685 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 16:38:27,830796 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 16:38:28,191038 (Thread-2): 08:38:28 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 5.17s]
2020-02-27 16:38:28,191329 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 16:38:28,191556 (Thread-2): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 16:38:28,191982 (Thread-2): 08:38:28 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 16:38:28,192645 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 16:38:28,192803 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 16:38:28,192972 (Thread-2): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 16:38:28,202065 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 16:38:28,202683 (Thread-2): finished collecting timing info
2020-02-27 16:38:28,208234 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 16:38:28,208712 (Thread-2): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 16:38:28,263486 (Thread-4): finished collecting timing info
2020-02-27 16:38:28,264536 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dec790>]}
2020-02-27 16:38:28,959608 (Thread-4): 08:38:28 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 2.51s]
2020-02-27 16:38:28,959959 (Thread-4): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 16:38:28,960200 (Thread-4): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 16:38:28,960597 (Thread-4): 08:38:28 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 16:38:28,961075 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 16:38:28,961222 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 16:38:28,961379 (Thread-4): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 16:38:28,971992 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 16:38:28,972705 (Thread-4): finished collecting timing info
2020-02-27 16:38:28,979078 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 16:38:28,980178 (Thread-4): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 16:38:29,131100 (Thread-3): finished collecting timing info
2020-02-27 16:38:29,132158 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f9efd0>]}
2020-02-27 16:38:29,515170 (Thread-3): 08:38:29 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.86s]
2020-02-27 16:38:29,515513 (Thread-3): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 16:38:29,515773 (Thread-3): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 16:38:29,516153 (Thread-3): 08:38:29 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 16:38:29,516710 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 16:38:29,516857 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 16:38:29,517016 (Thread-3): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 16:38:29,527300 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 16:38:29,527902 (Thread-3): finished collecting timing info
2020-02-27 16:38:29,535367 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 16:38:29,536029 (Thread-3): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 16:38:29,968830 (Thread-1): finished collecting timing info
2020-02-27 16:38:29,970774 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dc7e90>]}
2020-02-27 16:38:30,342813 (Thread-1): 08:38:30 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.16s]
2020-02-27 16:38:30,343105 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 16:38:30,343343 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 16:38:30,343734 (Thread-1): 08:38:30 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 16:38:30,344221 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 16:38:30,344408 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 16:38:30,344567 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 16:38:30,354316 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 16:38:30,354928 (Thread-1): finished collecting timing info
2020-02-27 16:38:30,360729 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 16:38:30,361218 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 16:38:30,676498 (Thread-2): finished collecting timing info
2020-02-27 16:38:30,677564 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a66750>]}
2020-02-27 16:38:31,64806 (Thread-2): 08:38:31 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.48s]
2020-02-27 16:38:31,65094 (Thread-2): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 16:38:31,65320 (Thread-2): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 16:38:31,65553 (Thread-2): 08:38:31 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 16:38:31,66183 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 16:38:31,66345 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 16:38:31,66504 (Thread-2): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 16:38:31,75361 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 16:38:31,75982 (Thread-2): finished collecting timing info
2020-02-27 16:38:31,81444 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 16:38:31,81966 (Thread-2): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 16:38:31,834954 (Thread-3): finished collecting timing info
2020-02-27 16:38:31,836096 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dd2550>]}
2020-02-27 16:38:32,203723 (Thread-1): finished collecting timing info
2020-02-27 16:38:32,204796 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fc3610>]}
2020-02-27 16:38:32,232609 (Thread-3): 08:38:32 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.32s]
2020-02-27 16:38:32,233223 (Thread-3): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 16:38:32,234289 (Thread-3): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 16:38:32,234959 (Thread-3): 08:38:32 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 16:38:32,235552 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 16:38:32,235968 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 16:38:32,236479 (Thread-3): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 16:38:32,245641 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 16:38:32,246311 (Thread-3): finished collecting timing info
2020-02-27 16:38:32,252167 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 16:38:32,254487 (Thread-3): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 16:38:32,584115 (Thread-4): finished collecting timing info
2020-02-27 16:38:32,585175 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e86710>]}
2020-02-27 16:38:33,742907 (Thread-1): 08:38:33 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 1.86s]
2020-02-27 16:38:33,743609 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 16:38:33,744945 (Thread-1): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 16:38:33,745594 (Thread-1): 08:38:33 | 14 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 16:38:33,745814 (Thread-1): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 16:38:33,746024 (Thread-1): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 16:38:33,746373 (Thread-1): 08:38:33 | 15 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 16:38:33,747401 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 16:38:33,747645 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 16:38:33,748191 (Thread-1): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 16:38:33,763187 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:38:34,150425 (Thread-4): 08:38:34 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 3.62s]
2020-02-27 16:38:34,150729 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 16:38:34,150956 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 16:38:34,151185 (Thread-4): 08:38:34 | 16 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 16:38:34,151831 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 16:38:34,152120 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 16:38:34,152312 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 16:38:34,165959 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:38:34,336959 (Thread-2): finished collecting timing info
2020-02-27 16:38:34,338061 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dec810>]}
2020-02-27 16:38:34,365452 (Thread-3): finished collecting timing info
2020-02-27 16:38:34,366296 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fc3150>]}
2020-02-27 16:38:35,308156 (Thread-2): 08:38:35 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46345) in 3.27s]
2020-02-27 16:38:35,309963 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 16:38:35,310306 (Thread-2): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 16:38:35,310701 (Thread-2): 08:38:35 | 17 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 16:38:35,311226 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 16:38:35,311765 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 16:38:35,312351 (Thread-2): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 16:38:35,325978 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:38:35,507188 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 16:38:35,507955 (Thread-4): finished collecting timing info
2020-02-27 16:38:35,515108 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 16:38:35,515641 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:35,563754 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 16:38:35,564401 (Thread-1): finished collecting timing info
2020-02-27 16:38:35,572105 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 16:38:35,572743 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:35,688380 (Thread-3): 08:38:35 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.13s]
2020-02-27 16:38:35,688697 (Thread-3): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 16:38:35,688962 (Thread-3): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 16:38:35,689379 (Thread-3): 08:38:35 | 18 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 16:38:35,689889 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 16:38:35,690045 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 16:38:35,690206 (Thread-3): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 16:38:35,706198 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:38:35,792909 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:38:35,793148 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:35,793301 (Thread-1): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 5d566186-a261-41a8-8926-5db7686019d1)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:35,793541 (Thread-1): finished collecting timing info
2020-02-27 16:38:35,794249 (Thread-1): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 5d566186-a261-41a8-8926-5db7686019d1)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 16:38:35,795136 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d9b890>]}
2020-02-27 16:38:35,851427 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:38:35,851710 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:35,851907 (Thread-4): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: b7f9050a-4e14-47a9-bb26-d34cce7464bc)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:35,852164 (Thread-4): finished collecting timing info
2020-02-27 16:38:35,852965 (Thread-4): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: b7f9050a-4e14-47a9-bb26-d34cce7464bc)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 16:38:35,853967 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11404d090>]}
2020-02-27 16:38:36,175299 (Thread-1): 08:38:36 | 15 of 44 ERROR creating table model agency_data_pipeline.fb_adcreative [ERROR in 2.05s]
2020-02-27 16:38:36,176932 (Thread-1): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 16:38:36,177405 (Thread-1): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 16:38:36,178418 (Thread-1): 08:38:36 | 19 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 16:38:36,179457 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 16:38:36,179623 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 16:38:36,179785 (Thread-1): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 16:38:36,191275 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 16:38:36,191812 (Thread-1): finished collecting timing info
2020-02-27 16:38:36,197617 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 16:38:36,198070 (Thread-1): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 16:38:36,471124 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 16:38:36,471781 (Thread-2): finished collecting timing info
2020-02-27 16:38:36,480419 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 16:38:36,480862 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:36,725359 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:38:36,725606 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:36,725761 (Thread-2): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 0d205243-583d-460d-af94-c134f2f90866)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:36,725979 (Thread-2): finished collecting timing info
2020-02-27 16:38:36,726654 (Thread-2): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 0d205243-583d-460d-af94-c134f2f90866)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 16:38:36,727543 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fc7f90>]}
2020-02-27 16:38:36,881094 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 16:38:36,881775 (Thread-3): finished collecting timing info
2020-02-27 16:38:36,888932 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 16:38:36,889377 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:36,975245 (Thread-4): 08:38:36 | 16 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights [ERROR in 1.70s]
2020-02-27 16:38:36,976555 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 16:38:36,976988 (Thread-4): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 16:38:36,977487 (Thread-4): 08:38:36 | 20 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 16:38:36,978222 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 16:38:36,978695 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 16:38:36,978866 (Thread-4): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 16:38:36,990324 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 16:38:36,991005 (Thread-4): finished collecting timing info
2020-02-27 16:38:36,996831 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 16:38:36,997321 (Thread-4): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 16:38:37,90196 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:38:37,90428 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:38:37,90585 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: ad731523-e4be-4800-8532-df595f999270)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:37,90799 (Thread-3): finished collecting timing info
2020-02-27 16:38:37,91469 (Thread-3): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: ad731523-e4be-4800-8532-df595f999270)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 16:38:37,92319 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114067b50>]}
2020-02-27 16:38:37,630982 (Thread-2): 08:38:37 | 17 of 44 ERROR creating table model agency_data_pipeline.adwords_adplatforms [ERROR in 1.42s]
2020-02-27 16:38:37,632539 (Thread-2): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 16:38:37,632960 (Thread-2): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 16:38:37,633486 (Thread-2): 08:38:37 | 21 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 16:38:37,634005 (Thread-2): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 16:38:37,634503 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 16:38:37,634840 (Thread-2): 08:38:37 | 22 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 16:38:37,635461 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 16:38:37,635603 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 16:38:37,635742 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 16:38:37,651958 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 16:38:37,652526 (Thread-2): finished collecting timing info
2020-02-27 16:38:37,658354 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 16:38:37,658884 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 16:38:38,38870 (Thread-3): 08:38:38 | 18 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.40s]
2020-02-27 16:38:38,39159 (Thread-3): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 16:38:38,39395 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 16:38:38,39858 (Thread-3): 08:38:38 | 23 of 44 SKIP relation agency_data_pipeline.fb_ads................... [SKIP]
2020-02-27 16:38:38,40220 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 16:38:38,40573 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 16:38:38,40811 (Thread-3): 08:38:38 | 24 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 16:38:38,41011 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 16:38:38,41424 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 16:38:38,41631 (Thread-3): 08:38:38 | 25 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 16:38:38,41823 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 16:38:38,42235 (Thread-3): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 16:38:38,42469 (Thread-3): 08:38:38 | 26 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 16:38:38,42668 (Thread-3): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 16:38:38,43096 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 16:38:38,43328 (Thread-3): 08:38:38 | 27 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 16:38:38,43526 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 16:38:38,975268 (Thread-1): finished collecting timing info
2020-02-27 16:38:38,976321 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ecf290>]}
2020-02-27 16:38:39,267898 (Thread-4): finished collecting timing info
2020-02-27 16:38:39,269060 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fc7f50>]}
2020-02-27 16:38:39,360323 (Thread-1): 08:38:39 | 19 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.80s]
2020-02-27 16:38:39,361769 (Thread-1): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 16:38:39,362420 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 16:38:39,362678 (Thread-3): 08:38:39 | 28 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 16:38:39,363144 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 16:38:39,363574 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 16:38:39,364074 (Thread-3): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 16:38:39,388195 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:38:40,122194 (Thread-4): 08:38:40 | 20 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.29s]
2020-02-27 16:38:40,122530 (Thread-4): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 16:38:40,123157 (Thread-1): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 16:38:40,123477 (Thread-1): 08:38:40 | 29 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 16:38:40,124026 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 16:38:40,124204 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 16:38:40,124391 (Thread-1): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 16:38:40,159145 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:38:40,549734 (Thread-2): finished collecting timing info
2020-02-27 16:38:40,552226 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11408fa50>]}
2020-02-27 16:38:41,72987 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 16:38:41,74753 (Thread-3): finished collecting timing info
2020-02-27 16:38:41,82624 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 16:38:41,83701 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 16:38:41,177752 (Thread-2): 08:38:41 | 22 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.92s]
2020-02-27 16:38:41,178043 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 16:38:41,178530 (Thread-4): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 16:38:41,178762 (Thread-4): 08:38:41 | 30 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 16:38:41,179217 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 16:38:41,179363 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 16:38:41,179517 (Thread-4): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 16:38:41,190448 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 16:38:41,190908 (Thread-4): finished collecting timing info
2020-02-27 16:38:41,196611 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 16:38:41,197034 (Thread-4): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 16:38:41,317861 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]')
2020-02-27 16:38:41,318079 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 16:38:41,318236 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 978706b8-f1d7-4e32-86d8-525a0de84cbe)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:41,318429 (Thread-3): finished collecting timing info
2020-02-27 16:38:41,319011 (Thread-3): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 978706b8-f1d7-4e32-86d8-525a0de84cbe)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 16:38:41,319774 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fc0610>]}
2020-02-27 16:38:41,588993 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 16:38:41,589643 (Thread-1): finished collecting timing info
2020-02-27 16:38:41,596704 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 16:38:41,597117 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 16:38:41,738393 (Thread-3): 08:38:41 | 28 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 1.96s]
2020-02-27 16:38:41,738682 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 16:38:41,739315 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 16:38:41,739590 (Thread-2): 08:38:41 | 31 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 16:38:41,739844 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 16:38:41,740267 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 16:38:41,740522 (Thread-3): 08:38:41 | 32 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 16:38:41,740719 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 16:38:41,741105 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 16:38:41,741319 (Thread-2): 08:38:41 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 16:38:41,741515 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 16:38:42,30693 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]')
2020-02-27 16:38:42,30986 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 16:38:42,31380 (Thread-1): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: 0d7ebc61-3cf9-42e5-ad64-6c08ba340943)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:42,31833 (Thread-1): finished collecting timing info
2020-02-27 16:38:42,32792 (Thread-1): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: 0d7ebc61-3cf9-42e5-ad64-6c08ba340943)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 16:38:42,33696 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11403bd90>]}
2020-02-27 16:38:43,218122 (Thread-1): 08:38:43 | 29 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 1.91s]
2020-02-27 16:38:43,218409 (Thread-1): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 16:38:43,219041 (Thread-3): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 16:38:43,219286 (Thread-3): 08:38:43 | 34 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 16:38:43,219488 (Thread-3): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 16:38:43,219933 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 16:38:43,220212 (Thread-1): 08:38:43 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 16:38:43,220426 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 16:38:43,220881 (Thread-3): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 16:38:43,221072 (Thread-2): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 16:38:43,221260 (Thread-3): 08:38:43 | 36 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 16:38:43,221473 (Thread-2): 08:38:43 | 37 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 16:38:43,221825 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 16:38:43,222142 (Thread-2): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 16:38:43,222708 (Thread-1): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 16:38:43,223009 (Thread-1): 08:38:43 | 38 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 16:38:43,223227 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 16:38:43,223410 (Thread-2): Began running node model.journeyengine_recipes.platform_index
2020-02-27 16:38:43,223852 (Thread-2): 08:38:43 | 39 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 16:38:43,224033 (Thread-1): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 16:38:43,224299 (Thread-2): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 16:38:43,224491 (Thread-1): 08:38:43 | 40 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 16:38:43,224956 (Thread-3): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 16:38:43,225152 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 16:38:43,225337 (Thread-3): 08:38:43 | 41 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 16:38:43,225713 (Thread-3): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 16:38:43,672896 (Thread-4): finished collecting timing info
2020-02-27 16:38:43,673946 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114031590>]}
2020-02-27 16:38:44,63463 (Thread-4): 08:38:44 | 30 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.49s]
2020-02-27 16:38:44,63754 (Thread-4): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 16:38:44,64348 (Thread-2): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 16:38:44,64587 (Thread-1): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 16:38:44,64823 (Thread-2): 08:38:44 | 42 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 16:38:44,65062 (Thread-1): 08:38:44 | 43 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 16:38:44,65691 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 16:38:44,66150 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 16:38:44,66278 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 16:38:44,66447 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_proc).
2020-02-27 16:38:44,66630 (Thread-2): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 16:38:44,66802 (Thread-1): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 16:38:44,81816 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 16:38:44,86156 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 16:38:44,86700 (Thread-1): finished collecting timing info
2020-02-27 16:38:44,92939 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 16:38:44,93234 (Thread-2): finished collecting timing info
2020-02-27 16:38:44,101867 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 16:38:44,102539 (Thread-1): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 16:38:44,102851 (Thread-2): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 16:38:46,52775 (Thread-2): finished collecting timing info
2020-02-27 16:38:46,53822 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140f8390>]}
2020-02-27 16:38:46,434955 (Thread-2): 08:38:46 | 42 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 1.99s]
2020-02-27 16:38:46,435244 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 16:38:46,435765 (Thread-4): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 16:38:46,436014 (Thread-4): 08:38:46 | 44 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 16:38:46,436477 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 16:38:46,436621 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 16:38:46,436775 (Thread-4): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 16:38:46,446490 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 16:38:46,446948 (Thread-4): finished collecting timing info
2020-02-27 16:38:46,452636 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 16:38:46,453033 (Thread-4): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 16:38:46,533380 (Thread-1): finished collecting timing info
2020-02-27 16:38:46,534706 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140cea50>]}
2020-02-27 16:38:46,987826 (Thread-1): 08:38:46 | 43 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.47s]
2020-02-27 16:38:46,988118 (Thread-1): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 16:38:49,64455 (Thread-4): finished collecting timing info
2020-02-27 16:38:49,65597 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6546aa46-84e5-4fef-bc89-798cd34a425e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140e3090>]}
2020-02-27 16:38:49,449980 (Thread-4): 08:38:49 | 44 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.63s]
2020-02-27 16:38:49,450275 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 16:38:49,474847 (MainThread): 08:38:49 | 
2020-02-27 16:38:49,475180 (MainThread): 08:38:49 | Finished running 44 table models in 27.97s.
2020-02-27 16:38:49,475408 (MainThread): Connection 'master' was left open.
2020-02-27 16:38:49,475580 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 16:38:49,475747 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 16:38:49,475908 (MainThread): Connection 'model.journeyengine_recipes.fb_ads_insights_conversions' was left open.
2020-02-27 16:38:49,476067 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 16:38:49,616413 (MainThread): 
2020-02-27 16:38:49,616650 (MainThread): Completed with 8 errors and 0 warnings:
2020-02-27 16:38:49,616836 (MainThread): 
2020-02-27 16:38:49,617008 (MainThread): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 16:38:49,617156 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US
2020-02-27 16:38:49,617293 (MainThread):   
2020-02-27 16:38:49,617442 (MainThread):   (job ID: d5544788-16ae-4f12-9c73-4103e2c9bdad)
2020-02-27 16:38:49,617574 (MainThread):   
2020-02-27 16:38:49,617702 (MainThread):                                                                       -----Query Job SQL Follows-----                                                                     
2020-02-27 16:38:49,617829 (MainThread):   
2020-02-27 16:38:49,617972 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:49,618099 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
2020-02-27 16:38:49,618224 (MainThread):      2:
2020-02-27 16:38:49,618347 (MainThread):      3:
2020-02-27 16:38:49,618469 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
2020-02-27 16:38:49,618591 (MainThread):      5:  
2020-02-27 16:38:49,618712 (MainThread):      6:  
2020-02-27 16:38:49,618833 (MainThread):      7:  OPTIONS()
2020-02-27 16:38:49,618954 (MainThread):      8:  as (
2020-02-27 16:38:49,619074 (MainThread):      9:    SELECT
2020-02-27 16:38:49,619194 (MainThread):     10:campaignid,
2020-02-27 16:38:49,619314 (MainThread):     11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
2020-02-27 16:38:49,619434 (MainThread):     12:FROM 
2020-02-27 16:38:49,619554 (MainThread):     13:(
2020-02-27 16:38:49,619673 (MainThread):     14:	SELECT  
2020-02-27 16:38:49,619792 (MainThread):     15:	campaignid,
2020-02-27 16:38:49,619912 (MainThread):     16:	max(finalurl) finalurl
2020-02-27 16:38:49,620031 (MainThread):     17:	FROM `journeyengine-recipes.google_ads_sculpt.FINAL_URL_REPORT`
2020-02-27 16:38:49,620151 (MainThread):     18:	GROUP BY campaignid
2020-02-27 16:38:49,620270 (MainThread):     19:)
2020-02-27 16:38:49,620389 (MainThread):     20:  );
2020-02-27 16:38:49,620508 (MainThread):     21:    
2020-02-27 16:38:49,620627 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:49,620759 (MainThread): 
2020-02-27 16:38:49,620902 (MainThread): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
2020-02-27 16:38:49,621030 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_sculpt was not found in location US
2020-02-27 16:38:49,621150 (MainThread):   
2020-02-27 16:38:49,621269 (MainThread):   (job ID: 5bf2fc97-5c55-450b-9b18-52fc5dc09f5e)
2020-02-27 16:38:49,621389 (MainThread):   
2020-02-27 16:38:49,621507 (MainThread):                                                                          -----Query Job SQL Follows-----                                                                       
2020-02-27 16:38:49,621628 (MainThread):   
2020-02-27 16:38:49,621747 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:49,621867 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
2020-02-27 16:38:49,621987 (MainThread):      2:
2020-02-27 16:38:49,622106 (MainThread):      3:
2020-02-27 16:38:49,622313 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
2020-02-27 16:38:49,622460 (MainThread):      5:  
2020-02-27 16:38:49,622599 (MainThread):      6:  
2020-02-27 16:38:49,622736 (MainThread):      7:  OPTIONS()
2020-02-27 16:38:49,622871 (MainThread):      8:  as (
2020-02-27 16:38:49,623004 (MainThread):      9:    SELECT
2020-02-27 16:38:49,623135 (MainThread):     10:day,
2020-02-27 16:38:49,623266 (MainThread):     11:campaignid,
2020-02-27 16:38:49,623397 (MainThread):     12:campaign,
2020-02-27 16:38:49,623524 (MainThread):     13:account, 
2020-02-27 16:38:49,623650 (MainThread):     14:channel,
2020-02-27 16:38:49,623774 (MainThread):     15:platform,
2020-02-27 16:38:49,623898 (MainThread):     16:sum(cost) cost,
2020-02-27 16:38:49,624022 (MainThread):     17:sum(impressions) impressions,
2020-02-27 16:38:49,624144 (MainThread):     18:sum(clicks) clicks,
2020-02-27 16:38:49,624267 (MainThread):     19:sum(conversions) conversions
2020-02-27 16:38:49,624389 (MainThread):     20:FROM
2020-02-27 16:38:49,624511 (MainThread):     21:( 
2020-02-27 16:38:49,624632 (MainThread):     22:	SELECT  
2020-02-27 16:38:49,624755 (MainThread):     23:	'Paid' as channel,
2020-02-27 16:38:49,624877 (MainThread):     24:	'Google Ads' as platform,
2020-02-27 16:38:49,624998 (MainThread):     25:	day,
2020-02-27 16:38:49,625118 (MainThread):     26:	campaignid,
2020-02-27 16:38:49,625239 (MainThread):     27:	campaign,
2020-02-27 16:38:49,625361 (MainThread):     28:	account as account,
2020-02-27 16:38:49,625482 (MainThread):     29:	cost/1000000 cost, 
2020-02-27 16:38:49,625602 (MainThread):     30:	impressions as impressions, 
2020-02-27 16:38:49,625723 (MainThread):     31:	clicks, 
2020-02-27 16:38:49,625844 (MainThread):     32:	conversions,
2020-02-27 16:38:49,625965 (MainThread):     33:	_sdc_sequence,
2020-02-27 16:38:49,626197 (MainThread):     34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
2020-02-27 16:38:49,626341 (MainThread):     35:	FROM `journeyengine-recipes.google_ads_sculpt.CAMPAIGN_PERFORMANCE_REPORT`
2020-02-27 16:38:49,626473 (MainThread):     36:)
2020-02-27 16:38:49,626601 (MainThread):     37:WHERE lv = _sdc_sequence
2020-02-27 16:38:49,626727 (MainThread):     38:GROUP BY day, campaignid, account, channel, platform, campaign
2020-02-27 16:38:49,626852 (MainThread):     39:  );
2020-02-27 16:38:49,626997 (MainThread):     40:    
2020-02-27 16:38:49,627120 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:38:49,627257 (MainThread): 
2020-02-27 16:38:49,627399 (MainThread): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
2020-02-27 16:38:49,627531 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:38:49,627654 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 16:38:49,627783 (MainThread): 
2020-02-27 16:38:49,627920 (MainThread): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
2020-02-27 16:38:49,628049 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:38:49,628170 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 16:38:49,628296 (MainThread): 
2020-02-27 16:38:49,628431 (MainThread): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
2020-02-27 16:38:49,628557 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:38:49,628677 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 16:38:49,628804 (MainThread): 
2020-02-27 16:38:49,628938 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 16:38:49,629064 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:38:49,629184 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 16:38:49,629310 (MainThread): 
2020-02-27 16:38:49,629443 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 16:38:49,629569 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
2020-02-27 16:38:49,629689 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 16:38:49,629814 (MainThread): 
2020-02-27 16:38:49,629947 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 16:38:49,630072 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
2020-02-27 16:38:49,630192 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 16:38:49,630353 (MainThread): 
Done. PASS=36 WARN=0 ERROR=8 SKIP=0 TOTAL=44
2020-02-27 16:38:49,630586 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a8aa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129a9b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a22510>]}
2020-02-27 16:38:49,998098 (MainThread): Flushing usage events
2020-02-27 16:56:05,488525 (MainThread): Running with dbt=0.15.2
2020-02-27 16:56:05,774015 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 16:56:05,776011 (MainThread): Tracking: tracking
2020-02-27 16:56:05,791672 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aab88d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aab8f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aab8b50>]}
2020-02-27 16:56:06,254183 (MainThread): Partial parsing not enabled
2020-02-27 16:56:06,257864 (MainThread): Parsing macros/core.sql
2020-02-27 16:56:06,263676 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 16:56:06,273086 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 16:56:06,275866 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 16:56:06,298474 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 16:56:06,323784 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 16:56:06,350979 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 16:56:06,354253 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 16:56:06,363477 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 16:56:06,373698 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 16:56:06,382290 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 16:56:06,390693 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 16:56:06,397605 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 16:56:06,399057 (MainThread): Parsing macros/etc/query.sql
2020-02-27 16:56:06,400698 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 16:56:06,403201 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 16:56:06,406117 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 16:56:06,417225 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 16:56:06,420127 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 16:56:06,461288 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 16:56:06,463160 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 16:56:06,464737 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 16:56:06,466454 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 16:56:06,469945 (MainThread): Parsing macros/etc.sql
2020-02-27 16:56:06,471350 (MainThread): Parsing macros/catalog.sql
2020-02-27 16:56:06,476256 (MainThread): Parsing macros/adapters.sql
2020-02-27 16:56:06,498727 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 16:56:06,500692 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 16:56:06,504269 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 16:56:06,506690 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 16:56:06,518945 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 16:56:06,526610 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 16:56:06,553962 (MainThread): Partial parsing not enabled
2020-02-27 16:56:06,554776 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 16:56:06,562172 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 16:56:06,589666 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 16:56:06,589828 (MainThread): Opening a new connection, currently in state init
2020-02-27 16:56:06,614189 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 16:56:06,614348 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,622258 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 16:56:06,622428 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,630767 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 16:56:06,630906 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,638653 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 16:56:06,638790 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,646650 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 16:56:06,646801 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,659721 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 16:56:06,659878 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,670012 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 16:56:06,670281 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,682940 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 16:56:06,683131 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,692371 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 16:56:06,692492 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,705372 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 16:56:06,705505 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,715488 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 16:56:06,715771 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,728591 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 16:56:06,728781 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,736197 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 16:56:06,736389 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,744053 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 16:56:06,744199 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,751330 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 16:56:06,751520 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,760696 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 16:56:06,760847 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,768967 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 16:56:06,769199 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,777002 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 16:56:06,777125 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,784625 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 16:56:06,784750 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,792809 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 16:56:06,792991 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,802054 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 16:56:06,802197 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,861043 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 16:56:06,861288 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,874173 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 16:56:06,874355 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,882095 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 16:56:06,882226 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,890023 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 16:56:06,890165 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,896907 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 16:56:06,897038 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,903301 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 16:56:06,903421 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,910947 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 16:56:06,911162 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,920353 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 16:56:06,920519 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,929386 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 16:56:06,929602 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,946075 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 16:56:06,946327 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,958407 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 16:56:06,958537 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,966281 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 16:56:06,966443 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:06,979684 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 16:56:06,979819 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,1010 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 16:56:07,1136 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,13693 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 16:56:07,13861 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,29834 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 16:56:07,30046 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,38732 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 16:56:07,38900 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,46275 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 16:56:07,46411 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,55188 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 16:56:07,55333 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,62633 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 16:56:07,62751 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,73269 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 16:56:07,73392 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,80846 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 16:56:07,81058 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:07,354853 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 140 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 16:56:07,381981 (MainThread): 
2020-02-27 16:56:07,382417 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 16:56:07,382533 (MainThread): Opening a new connection, currently in state closed
2020-02-27 16:56:08,371396 (MainThread): 08:56:08 | Concurrency: 4 threads (target='dev')
2020-02-27 16:56:08,371684 (MainThread): 08:56:08 | 
2020-02-27 16:56:08,377109 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 16:56:08,377349 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 16:56:08,377573 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 16:56:08,377788 (Thread-1): 08:56:08 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 16:56:08,377923 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 16:56:08,378132 (Thread-2): 08:56:08 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 16:56:08,378325 (Thread-3): 08:56:08 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 16:56:08,378582 (Thread-4): 08:56:08 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 16:56:08,378920 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 16:56:08,379296 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 16:56:08,379626 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 16:56:08,379944 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 16:56:08,380051 (Thread-1): Opening a new connection, currently in state init
2020-02-27 16:56:08,380185 (Thread-2): Opening a new connection, currently in state init
2020-02-27 16:56:08,380317 (Thread-3): Opening a new connection, currently in state init
2020-02-27 16:56:08,380447 (Thread-4): Opening a new connection, currently in state init
2020-02-27 16:56:08,380599 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 16:56:08,380737 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 16:56:08,380879 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 16:56:08,381015 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 16:56:08,406294 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 16:56:08,410464 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 16:56:08,418617 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 16:56:08,426359 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 16:56:08,427239 (Thread-2): finished collecting timing info
2020-02-27 16:56:08,443936 (Thread-3): finished collecting timing info
2020-02-27 16:56:08,461941 (Thread-4): finished collecting timing info
2020-02-27 16:56:08,493760 (Thread-1): finished collecting timing info
2020-02-27 16:56:09,149923 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 16:56:09,157164 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 16:56:09,190519 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 16:56:09,196638 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 16:56:09,197828 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 16:56:09,199672 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 16:56:09,199874 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 16:56:09,200641 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 16:56:10,210939 (Thread-3): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 16:56:10,211456 (Thread-3): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 16:56:10,211780 (Thread-3): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 9d51631e-2eac-446b-b1d0-47e3fd66d815)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:10,212411 (Thread-3): finished collecting timing info
2020-02-27 16:56:10,214179 (Thread-4): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 16:56:10,214335 (Thread-4): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 16:56:10,214570 (Thread-4): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: a86bc511-bde3-41b8-8d68-f1283f8261ff)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:10,214778 (Thread-4): finished collecting timing info
2020-02-27 16:56:10,213025 (Thread-3): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 9d51631e-2eac-446b-b1d0-47e3fd66d815)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 9d51631e-2eac-446b-b1d0-47e3fd66d815)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 9d51631e-2eac-446b-b1d0-47e3fd66d815)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:10,215315 (Thread-4): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: a86bc511-bde3-41b8-8d68-f1283f8261ff)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: a86bc511-bde3-41b8-8d68-f1283f8261ff)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: a86bc511-bde3-41b8-8d68-f1283f8261ff)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:10,228911 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0b95d0>]}
2020-02-27 16:56:10,229184 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc4ced0>]}
2020-02-27 16:56:10,588015 (Thread-3): 08:56:10 | 3 of 44 ERROR creating table model agency_data_pipeline.adwords_campaigns [ERROR in 1.85s]
2020-02-27 16:56:10,589908 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 16:56:10,590307 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 16:56:10,590852 (Thread-3): 08:56:10 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 16:56:10,591645 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 16:56:10,592116 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 16:56:10,592289 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 16:56:10,604322 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 16:56:10,605084 (Thread-3): finished collecting timing info
2020-02-27 16:56:10,612185 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 16:56:10,612882 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 16:56:11,277018 (Thread-4): 08:56:11 | 4 of 44 ERROR creating table model agency_data_pipeline.adwords_urls. [ERROR in 1.85s]
2020-02-27 16:56:11,277300 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 16:56:11,277531 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 16:56:11,277760 (Thread-4): 08:56:11 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 16:56:11,278755 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 16:56:11,279048 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 16:56:11,279261 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 16:56:11,288143 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 16:56:11,288655 (Thread-4): finished collecting timing info
2020-02-27 16:56:11,296470 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 16:56:11,297067 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 16:56:11,905530 (Thread-2): finished collecting timing info
2020-02-27 16:56:11,906589 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bca3890>]}
2020-02-27 16:56:12,150624 (Thread-1): finished collecting timing info
2020-02-27 16:56:12,151762 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abc13d0>]}
2020-02-27 16:56:12,266054 (Thread-2): 08:56:12 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 3.53s]
2020-02-27 16:56:12,267414 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 16:56:12,267840 (Thread-2): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 16:56:12,268285 (Thread-2): 08:56:12 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 16:56:12,269252 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 16:56:12,269716 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 16:56:12,269886 (Thread-2): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 16:56:12,278825 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 16:56:12,279507 (Thread-2): finished collecting timing info
2020-02-27 16:56:12,285278 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 16:56:12,286251 (Thread-2): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 16:56:12,637031 (Thread-1): 08:56:12 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (4) in 3.77s]
2020-02-27 16:56:12,637271 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 16:56:12,637453 (Thread-1): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 16:56:12,637635 (Thread-1): 08:56:12 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 16:56:12,638190 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 16:56:12,638519 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 16:56:12,638670 (Thread-1): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 16:56:12,648112 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 16:56:12,648825 (Thread-1): finished collecting timing info
2020-02-27 16:56:12,655752 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 16:56:12,656386 (Thread-1): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 16:56:12,783410 (Thread-3): finished collecting timing info
2020-02-27 16:56:12,784475 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd7fa90>]}
2020-02-27 16:56:13,473009 (Thread-4): finished collecting timing info
2020-02-27 16:56:13,474064 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc20410>]}
2020-02-27 16:56:13,655898 (Thread-3): 08:56:13 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 2.19s]
2020-02-27 16:56:13,657862 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 16:56:13,658300 (Thread-3): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 16:56:13,658774 (Thread-3): 08:56:13 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 16:56:13,659289 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 16:56:13,659453 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 16:56:13,659993 (Thread-3): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 16:56:13,669698 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 16:56:13,670389 (Thread-3): finished collecting timing info
2020-02-27 16:56:13,676220 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 16:56:13,676942 (Thread-3): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 16:56:14,32522 (Thread-4): 08:56:14 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.20s]
2020-02-27 16:56:14,32851 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 16:56:14,33084 (Thread-4): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 16:56:14,33316 (Thread-4): 08:56:14 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 16:56:14,33946 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 16:56:14,34110 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 16:56:14,34272 (Thread-4): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 16:56:14,43275 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 16:56:14,43803 (Thread-4): finished collecting timing info
2020-02-27 16:56:14,50771 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 16:56:14,51204 (Thread-4): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 16:56:14,717576 (Thread-2): finished collecting timing info
2020-02-27 16:56:14,718646 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf6ddd0>]}
2020-02-27 16:56:15,177902 (Thread-2): 08:56:15 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.45s]
2020-02-27 16:56:15,178251 (Thread-2): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 16:56:15,178487 (Thread-2): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 16:56:15,178878 (Thread-2): 08:56:15 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 16:56:15,179366 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 16:56:15,179514 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 16:56:15,179671 (Thread-2): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 16:56:15,188694 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 16:56:15,189224 (Thread-2): finished collecting timing info
2020-02-27 16:56:15,194633 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 16:56:15,195038 (Thread-2): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 16:56:15,410021 (Thread-1): finished collecting timing info
2020-02-27 16:56:15,411073 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c039a90>]}
2020-02-27 16:56:15,766639 (Thread-1): 08:56:15 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.77s]
2020-02-27 16:56:15,766950 (Thread-1): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 16:56:15,767209 (Thread-1): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 16:56:15,767625 (Thread-1): 08:56:15 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 16:56:15,768132 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 16:56:15,768285 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 16:56:15,768444 (Thread-1): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 16:56:15,779094 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 16:56:15,779713 (Thread-1): finished collecting timing info
2020-02-27 16:56:15,785856 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 16:56:15,786297 (Thread-1): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 16:56:15,831889 (Thread-3): finished collecting timing info
2020-02-27 16:56:15,832936 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bcaa890>]}
2020-02-27 16:56:19,516880 (Thread-4): finished collecting timing info
2020-02-27 16:56:19,519176 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0daf50>]}
2020-02-27 16:56:20,439583 (Thread-1): finished collecting timing info
2020-02-27 16:56:20,440631 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48451d4e-25fe-4639-aa40-bbb3f42a47a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc59890>]}
2020-02-27 16:56:21,125982 (Thread-3): The 'warn' method is deprecated, use 'warning' instead
2020-02-27 16:56:21,126342 (Thread-3): Error sending message, disabling tracking
2020-02-27 16:56:21,126751 (Thread-3): 08:56:21 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.17s]
2020-02-27 16:56:21,128654 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 16:56:21,129119 (Thread-3): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 16:56:21,129617 (Thread-3): 08:56:21 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 16:56:21,130207 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 16:56:21,130718 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 16:56:21,131301 (Thread-3): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 16:56:21,142692 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 16:56:21,143195 (Thread-3): finished collecting timing info
2020-02-27 16:56:21,148702 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 16:56:21,149146 (Thread-3): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 16:56:21,437402 (Thread-2): finished collecting timing info
2020-02-27 16:56:21,438547 (Thread-2): 08:56:21 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 6.26s]
2020-02-27 16:56:21,438805 (Thread-2): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 16:56:21,439047 (Thread-2): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 16:56:21,439451 (Thread-2): 08:56:21 | 14 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 16:56:21,439679 (Thread-2): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 16:56:21,439895 (Thread-2): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 16:56:21,440267 (Thread-2): 08:56:21 | 15 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 16:56:21,440840 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 16:56:21,441030 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 16:56:21,441196 (Thread-2): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 16:56:21,451123 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 16:56:21,451604 (Thread-2): finished collecting timing info
2020-02-27 16:56:21,458681 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 16:56:21,459122 (Thread-2): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 16:56:23,21152 (Thread-4): 08:56:23 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 5.49s]
2020-02-27 16:56:23,22906 (Thread-4): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 16:56:23,23347 (Thread-4): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 16:56:23,23921 (Thread-4): 08:56:23 | 16 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 16:56:23,24740 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 16:56:23,25255 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 16:56:23,25441 (Thread-4): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 16:56:23,36000 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 16:56:23,36583 (Thread-4): finished collecting timing info
2020-02-27 16:56:23,42405 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 16:56:23,42834 (Thread-4): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 16:56:23,466422 (Thread-1): 08:56:23 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46345) in 4.67s]
2020-02-27 16:56:23,466718 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 16:56:23,466948 (Thread-1): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 16:56:23,467178 (Thread-1): 08:56:23 | 17 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 16:56:23,467801 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 16:56:23,467964 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 16:56:23,468125 (Thread-1): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 16:56:23,481714 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:56:23,803460 (Thread-2): finished collecting timing info
2020-02-27 16:56:23,806632 (Thread-3): finished collecting timing info
2020-02-27 16:56:23,807633 (Thread-2): 08:56:23 | 15 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.37s]
2020-02-27 16:56:23,808458 (Thread-3): 08:56:23 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.68s]
2020-02-27 16:56:23,808837 (Thread-2): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 16:56:23,809095 (Thread-3): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 16:56:23,809384 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 16:56:23,809907 (Thread-3): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 16:56:23,810464 (Thread-2): 08:56:23 | 18 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 16:56:23,810767 (Thread-3): 08:56:23 | 19 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 16:56:23,811313 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 16:56:23,811786 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 16:56:23,811896 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 16:56:23,812037 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 16:56:23,812189 (Thread-2): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 16:56:23,812336 (Thread-3): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 16:56:23,831303 (Thread-2): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:56:23,841347 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:56:25,138781 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 16:56:25,144056 (Thread-4): finished collecting timing info
2020-02-27 16:56:25,145292 (Thread-4): 08:56:25 | 16 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.12s]
2020-02-27 16:56:25,145921 (Thread-4): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 16:56:25,146208 (Thread-4): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 16:56:25,146409 (Thread-1): finished collecting timing info
2020-02-27 16:56:25,147128 (Thread-4): 08:56:25 | 20 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 16:56:25,154983 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 16:56:25,155384 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 16:56:25,155662 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 16:56:25,155827 (Thread-4): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 16:56:25,168695 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:25,172563 (Thread-4): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:56:25,464890 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 16:56:25,467352 (Thread-2): finished collecting timing info
2020-02-27 16:56:25,478648 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 16:56:25,479813 (Thread-2): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:25,587915 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:56:25,588220 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:25,588393 (Thread-1): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 06b9f326-66c0-4d9f-99f7-7731e1537726)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:25,588616 (Thread-1): finished collecting timing info
2020-02-27 16:56:25,589308 (Thread-1): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 06b9f326-66c0-4d9f-99f7-7731e1537726)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 16:56:25,590240 (Thread-1): 08:56:25 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adcreative [ERROR in 2.12s]
2020-02-27 16:56:25,590451 (Thread-1): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 16:56:25,590672 (Thread-1): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 16:56:25,590893 (Thread-1): 08:56:25 | 21 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 16:56:25,591518 (Thread-1): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 16:56:25,591754 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 16:56:25,592075 (Thread-1): 08:56:25 | 22 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 16:56:25,592467 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 16:56:25,592612 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 16:56:25,592766 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 16:56:25,608975 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 16:56:25,609432 (Thread-1): finished collecting timing info
2020-02-27 16:56:25,615125 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 16:56:25,615690 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 16:56:25,665093 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 16:56:25,665765 (Thread-3): finished collecting timing info
2020-02-27 16:56:25,672862 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 16:56:25,673308 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:25,710585 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:56:25,710804 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:25,710953 (Thread-2): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 3a439a3c-4e80-41f3-a58b-6b7fb0da2a66)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:25,711145 (Thread-2): finished collecting timing info
2020-02-27 16:56:25,712063 (Thread-2): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 3a439a3c-4e80-41f3-a58b-6b7fb0da2a66)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 16:56:25,712892 (Thread-2): 08:56:25 | 18 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights [ERROR in 1.90s]
2020-02-27 16:56:25,713084 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 16:56:25,713276 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 16:56:25,713473 (Thread-2): 08:56:25 | 23 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 16:56:25,714050 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 16:56:25,714177 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 16:56:25,714303 (Thread-2): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 16:56:25,737422 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:56:26,307619 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:56:26,307985 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:26,309067 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 38c4e85d-f7b5-4381-9b86-18196b1760e0)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:26,310624 (Thread-3): finished collecting timing info
2020-02-27 16:56:26,312006 (Thread-3): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 38c4e85d-f7b5-4381-9b86-18196b1760e0)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 16:56:26,314824 (Thread-3): 08:56:26 | 19 of 44 ERROR creating table model agency_data_pipeline.adwords_adplatforms [ERROR in 2.50s]
2020-02-27 16:56:26,315042 (Thread-3): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 16:56:26,315267 (Thread-3): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 16:56:26,315695 (Thread-3): 08:56:26 | 24 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 16:56:26,316128 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 16:56:26,316280 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 16:56:26,316440 (Thread-3): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 16:56:26,348304 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 16:56:27,544644 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 16:56:27,546525 (Thread-4): finished collecting timing info
2020-02-27 16:56:27,553769 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 16:56:27,554693 (Thread-4): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:27,774097 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 16:56:27,774386 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 16:56:27,774574 (Thread-4): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 85e48406-f632-4ae2-9f26-a7ba7b2ca6a2)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:27,774831 (Thread-4): finished collecting timing info
2020-02-27 16:56:27,775651 (Thread-4): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 85e48406-f632-4ae2-9f26-a7ba7b2ca6a2)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 16:56:27,776576 (Thread-4): 08:56:27 | 20 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.62s]
2020-02-27 16:56:27,776789 (Thread-4): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 16:56:27,777013 (Thread-4): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 16:56:27,777465 (Thread-4): 08:56:27 | 25 of 44 SKIP relation agency_data_pipeline.fb_ads................... [SKIP]
2020-02-27 16:56:27,777865 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 16:56:27,778095 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 16:56:27,778404 (Thread-4): 08:56:27 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 16:56:27,778607 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 16:56:27,779008 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 16:56:27,779217 (Thread-4): 08:56:27 | 27 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 16:56:27,779412 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 16:56:27,779799 (Thread-4): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 16:56:27,780006 (Thread-4): 08:56:27 | 28 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 16:56:27,780200 (Thread-4): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 16:56:27,780584 (Thread-4): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 16:56:27,780788 (Thread-4): 08:56:27 | 29 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 16:56:27,780980 (Thread-4): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 16:56:27,890570 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 16:56:27,891270 (Thread-2): finished collecting timing info
2020-02-27 16:56:27,899915 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 16:56:27,900380 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 16:56:28,432404 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]')
2020-02-27 16:56:28,433596 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 16:56:28,433928 (Thread-2): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 40655303-4d60-492d-8fd7-51edbf4a0931)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:28,437450 (Thread-1): finished collecting timing info
2020-02-27 16:56:28,437824 (Thread-2): finished collecting timing info
2020-02-27 16:56:28,439200 (Thread-1): 08:56:28 | 22 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.85s]
2020-02-27 16:56:28,440957 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 16:56:28,439891 (Thread-2): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 40655303-4d60-492d-8fd7-51edbf4a0931)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 16:56:28,442003 (Thread-4): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 16:56:28,442235 (Thread-2): 08:56:28 | 23 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 2.73s]
2020-02-27 16:56:28,442417 (Thread-4): 08:56:28 | 30 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 16:56:28,442715 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 16:56:28,443170 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 16:56:28,443677 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 16:56:28,443854 (Thread-4): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 16:56:28,444020 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 16:56:28,455500 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 16:56:28,455683 (Thread-1): 08:56:28 | 31 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 16:56:28,455983 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 16:56:28,456438 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 16:56:28,456621 (Thread-2): 08:56:28 | 32 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 16:56:28,456791 (Thread-4): finished collecting timing info
2020-02-27 16:56:28,457101 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 16:56:28,462568 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 16:56:28,463117 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 16:56:28,463413 (Thread-1): 08:56:28 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 16:56:28,463721 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 16:56:28,463909 (Thread-4): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 16:56:28,960856 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 16:56:28,962653 (Thread-3): finished collecting timing info
2020-02-27 16:56:28,969308 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 16:56:28,970384 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 16:56:30,424302 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]')
2020-02-27 16:56:30,424653 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 16:56:30,424867 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: 98aeea60-866c-4ce9-bf71-ca11b511c897)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:30,425143 (Thread-3): finished collecting timing info
2020-02-27 16:56:30,425974 (Thread-3): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: 98aeea60-866c-4ce9-bf71-ca11b511c897)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 16:56:30,427133 (Thread-3): 08:56:30 | 24 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 4.11s]
2020-02-27 16:56:30,427354 (Thread-3): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 16:56:30,428119 (Thread-2): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 16:56:30,428470 (Thread-2): 08:56:30 | 34 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 16:56:30,428691 (Thread-2): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 16:56:30,429255 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 16:56:30,429571 (Thread-3): 08:56:30 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 16:56:30,429832 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 16:56:30,430431 (Thread-2): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 16:56:30,430677 (Thread-1): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 16:56:30,431013 (Thread-2): 08:56:30 | 36 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 16:56:30,431283 (Thread-1): 08:56:30 | 37 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 16:56:30,431589 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 16:56:30,431841 (Thread-1): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 16:56:30,432396 (Thread-3): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 16:56:30,432699 (Thread-3): 08:56:30 | 38 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 16:56:30,432907 (Thread-1): Began running node model.journeyengine_recipes.platform_index
2020-02-27 16:56:30,433123 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 16:56:30,433384 (Thread-1): 08:56:30 | 39 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 16:56:30,433901 (Thread-1): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 16:56:30,434089 (Thread-2): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 16:56:30,434522 (Thread-2): 08:56:30 | 40 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 16:56:30,434726 (Thread-3): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 16:56:30,434973 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 16:56:30,435198 (Thread-3): 08:56:30 | 41 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 16:56:30,435575 (Thread-3): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 16:56:30,785690 (Thread-4): finished collecting timing info
2020-02-27 16:56:30,786791 (Thread-4): 08:56:30 | 30 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.34s]
2020-02-27 16:56:30,787020 (Thread-4): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 16:56:30,787560 (Thread-1): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 16:56:30,787794 (Thread-2): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 16:56:30,788016 (Thread-1): 08:56:30 | 42 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 16:56:30,788265 (Thread-2): 08:56:30 | 43 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 16:56:30,788790 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 16:56:30,789191 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 16:56:30,789357 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 16:56:30,789528 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 16:56:30,789716 (Thread-1): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 16:56:30,789893 (Thread-2): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 16:56:30,800325 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 16:56:30,808436 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 16:56:30,809146 (Thread-1): finished collecting timing info
2020-02-27 16:56:30,814880 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 16:56:30,815146 (Thread-2): finished collecting timing info
2020-02-27 16:56:30,822064 (Thread-1): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 16:56:30,830393 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 16:56:30,831883 (Thread-2): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 16:56:33,867047 (Thread-2): finished collecting timing info
2020-02-27 16:56:33,868174 (Thread-2): 08:56:33 | 43 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 3.08s]
2020-02-27 16:56:33,868408 (Thread-2): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 16:56:34,275967 (Thread-1): finished collecting timing info
2020-02-27 16:56:34,277073 (Thread-1): 08:56:34 | 42 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 3.49s]
2020-02-27 16:56:34,277305 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 16:56:34,277872 (Thread-4): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 16:56:34,278238 (Thread-4): 08:56:34 | 44 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 16:56:34,278723 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 16:56:34,278908 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 16:56:34,279100 (Thread-4): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 16:56:34,291858 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 16:56:34,292417 (Thread-4): finished collecting timing info
2020-02-27 16:56:34,297795 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 16:56:34,298203 (Thread-4): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 16:56:36,74493 (Thread-4): finished collecting timing info
2020-02-27 16:56:36,75617 (Thread-4): 08:56:36 | 44 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 1.80s]
2020-02-27 16:56:36,75855 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 16:56:36,98969 (MainThread): 08:56:36 | 
2020-02-27 16:56:36,99326 (MainThread): 08:56:36 | Finished running 44 table models in 28.72s.
2020-02-27 16:56:36,99559 (MainThread): Connection 'master' was left open.
2020-02-27 16:56:36,99737 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 16:56:36,99909 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 16:56:36,100079 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 16:56:36,100246 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 16:56:36,245279 (MainThread): 
2020-02-27 16:56:36,245535 (MainThread): Completed with 8 errors and 0 warnings:
2020-02-27 16:56:36,245736 (MainThread): 
2020-02-27 16:56:36,245927 (MainThread): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
2020-02-27 16:56:36,246095 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 16:56:36,246254 (MainThread):   
2020-02-27 16:56:36,246391 (MainThread):   (job ID: 9d51631e-2eac-446b-b1d0-47e3fd66d815)
2020-02-27 16:56:36,246525 (MainThread):   
2020-02-27 16:56:36,246708 (MainThread):                                                                          -----Query Job SQL Follows-----                                                                       
2020-02-27 16:56:36,246888 (MainThread):   
2020-02-27 16:56:36,247051 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:36,247204 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
2020-02-27 16:56:36,247344 (MainThread):      2:
2020-02-27 16:56:36,247481 (MainThread):      3:
2020-02-27 16:56:36,247616 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
2020-02-27 16:56:36,247749 (MainThread):      5:  
2020-02-27 16:56:36,247881 (MainThread):      6:  
2020-02-27 16:56:36,248013 (MainThread):      7:  OPTIONS()
2020-02-27 16:56:36,248144 (MainThread):      8:  as (
2020-02-27 16:56:36,248272 (MainThread):      9:    SELECT
2020-02-27 16:56:36,248399 (MainThread):     10:day,
2020-02-27 16:56:36,248526 (MainThread):     11:campaignid,
2020-02-27 16:56:36,248652 (MainThread):     12:campaign,
2020-02-27 16:56:36,248778 (MainThread):     13:account, 
2020-02-27 16:56:36,248903 (MainThread):     14:channel,
2020-02-27 16:56:36,249028 (MainThread):     15:platform,
2020-02-27 16:56:36,249152 (MainThread):     16:sum(cost) cost,
2020-02-27 16:56:36,249277 (MainThread):     17:sum(impressions) impressions,
2020-02-27 16:56:36,249402 (MainThread):     18:sum(clicks) clicks,
2020-02-27 16:56:36,249527 (MainThread):     19:sum(conversions) conversions
2020-02-27 16:56:36,249651 (MainThread):     20:FROM
2020-02-27 16:56:36,249775 (MainThread):     21:( 
2020-02-27 16:56:36,249899 (MainThread):     22:	SELECT  
2020-02-27 16:56:36,250023 (MainThread):     23:	'Paid' as channel,
2020-02-27 16:56:36,250147 (MainThread):     24:	'Google Ads' as platform,
2020-02-27 16:56:36,250271 (MainThread):     25:	day,
2020-02-27 16:56:36,250394 (MainThread):     26:	campaignid,
2020-02-27 16:56:36,250517 (MainThread):     27:	campaign,
2020-02-27 16:56:36,250641 (MainThread):     28:	account as account,
2020-02-27 16:56:36,250764 (MainThread):     29:	cost/1000000 cost, 
2020-02-27 16:56:36,250888 (MainThread):     30:	impressions as impressions, 
2020-02-27 16:56:36,251011 (MainThread):     31:	clicks, 
2020-02-27 16:56:36,251136 (MainThread):     32:	conversions,
2020-02-27 16:56:36,251272 (MainThread):     33:	_sdc_sequence,
2020-02-27 16:56:36,251411 (MainThread):     34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
2020-02-27 16:56:36,251534 (MainThread):     35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
2020-02-27 16:56:36,251655 (MainThread):     36:)
2020-02-27 16:56:36,251775 (MainThread):     37:WHERE lv = _sdc_sequence
2020-02-27 16:56:36,251895 (MainThread):     38:GROUP BY day, campaignid, account, channel, platform, campaign
2020-02-27 16:56:36,252016 (MainThread):     39:  );
2020-02-27 16:56:36,252135 (MainThread):     40:    
2020-02-27 16:56:36,252255 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:36,252386 (MainThread): 
2020-02-27 16:56:36,252527 (MainThread): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 16:56:36,252655 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 16:56:36,252777 (MainThread):   
2020-02-27 16:56:36,252898 (MainThread):   (job ID: a86bc511-bde3-41b8-8d68-f1283f8261ff)
2020-02-27 16:56:36,253018 (MainThread):   
2020-02-27 16:56:36,253138 (MainThread):                                                                       -----Query Job SQL Follows-----                                                                     
2020-02-27 16:56:36,253260 (MainThread):   
2020-02-27 16:56:36,253379 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:36,253500 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
2020-02-27 16:56:36,253621 (MainThread):      2:
2020-02-27 16:56:36,253741 (MainThread):      3:
2020-02-27 16:56:36,253861 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
2020-02-27 16:56:36,253981 (MainThread):      5:  
2020-02-27 16:56:36,254101 (MainThread):      6:  
2020-02-27 16:56:36,254221 (MainThread):      7:  OPTIONS()
2020-02-27 16:56:36,254340 (MainThread):      8:  as (
2020-02-27 16:56:36,254460 (MainThread):      9:    SELECT
2020-02-27 16:56:36,254579 (MainThread):     10:campaignid,
2020-02-27 16:56:36,254699 (MainThread):     11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
2020-02-27 16:56:36,254819 (MainThread):     12:FROM 
2020-02-27 16:56:36,254939 (MainThread):     13:(
2020-02-27 16:56:36,255164 (MainThread):     14:	SELECT  
2020-02-27 16:56:36,255315 (MainThread):     15:	campaignid,
2020-02-27 16:56:36,255449 (MainThread):     16:	max(finalurl) finalurl
2020-02-27 16:56:36,255581 (MainThread):     17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
2020-02-27 16:56:36,255711 (MainThread):     18:	GROUP BY campaignid
2020-02-27 16:56:36,255839 (MainThread):     19:)
2020-02-27 16:56:36,255964 (MainThread):     20:  );
2020-02-27 16:56:36,256089 (MainThread):     21:    
2020-02-27 16:56:36,256212 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 16:56:36,256346 (MainThread): 
2020-02-27 16:56:36,256488 (MainThread): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
2020-02-27 16:56:36,256620 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:56:36,256748 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 16:56:36,256879 (MainThread): 
2020-02-27 16:56:36,257017 (MainThread): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
2020-02-27 16:56:36,257149 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:56:36,257273 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 16:56:36,257402 (MainThread): 
2020-02-27 16:56:36,257538 (MainThread): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
2020-02-27 16:56:36,257666 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:56:36,257789 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 16:56:36,257917 (MainThread): 
2020-02-27 16:56:36,258053 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 16:56:36,258181 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 16:56:36,258303 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 16:56:36,258431 (MainThread): 
2020-02-27 16:56:36,258567 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 16:56:36,258695 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
2020-02-27 16:56:36,258817 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 16:56:36,258946 (MainThread): 
2020-02-27 16:56:36,259082 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 16:56:36,259210 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
2020-02-27 16:56:36,259332 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 16:56:36,259491 (MainThread): 
Done. PASS=36 WARN=0 ERROR=8 SKIP=0 TOTAL=44
2020-02-27 16:56:36,259716 (MainThread): Flushing usage events
2020-02-27 17:07:51,408020 (MainThread): Running with dbt=0.15.2
2020-02-27 17:07:51,671265 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 17:07:51,672214 (MainThread): Tracking: tracking
2020-02-27 17:07:51,680917 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce28610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce28f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce28250>]}
2020-02-27 17:07:53,746127 (MainThread): Partial parsing not enabled
2020-02-27 17:07:53,748986 (MainThread): Parsing macros/core.sql
2020-02-27 17:07:53,757186 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 17:07:53,768422 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 17:07:53,771168 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 17:07:53,794187 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 17:07:53,818596 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 17:07:53,847907 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 17:07:53,851059 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 17:07:53,860183 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 17:07:53,870020 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 17:07:53,879025 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 17:07:53,887171 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 17:07:53,894090 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 17:07:53,895508 (MainThread): Parsing macros/etc/query.sql
2020-02-27 17:07:53,897148 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 17:07:53,899608 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 17:07:53,902535 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 17:07:53,913567 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 17:07:53,916423 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 17:07:53,956897 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 17:07:53,958770 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 17:07:53,960265 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 17:07:53,962003 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 17:07:53,965416 (MainThread): Parsing macros/etc.sql
2020-02-27 17:07:53,967095 (MainThread): Parsing macros/catalog.sql
2020-02-27 17:07:53,972053 (MainThread): Parsing macros/adapters.sql
2020-02-27 17:07:53,994412 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 17:07:53,996621 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 17:07:54,073 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 17:07:54,2304 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 17:07:54,14025 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 17:07:54,21083 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 17:07:54,47151 (MainThread): Partial parsing not enabled
2020-02-27 17:07:54,48019 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 17:07:54,52798 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 17:07:54,78244 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 17:07:54,78425 (MainThread): Opening a new connection, currently in state init
2020-02-27 17:07:54,106310 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 17:07:54,106474 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,114392 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 17:07:54,114567 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,122258 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 17:07:54,122381 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,130286 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 17:07:54,130452 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,138122 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 17:07:54,138270 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,152500 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 17:07:54,152687 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,161937 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 17:07:54,162079 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,172110 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 17:07:54,172263 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,183685 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 17:07:54,183863 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,197265 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 17:07:54,197444 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,207006 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 17:07:54,207193 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,218871 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 17:07:54,219083 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,227763 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 17:07:54,227960 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,235169 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 17:07:54,235326 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,242049 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 17:07:54,242174 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,251537 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 17:07:54,251771 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,262604 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 17:07:54,262817 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,270949 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 17:07:54,271073 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,279630 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 17:07:54,279851 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,291053 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 17:07:54,291329 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,302736 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 17:07:54,303027 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,360298 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 17:07:54,360459 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,371036 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 17:07:54,371246 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,379460 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 17:07:54,379601 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,386917 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 17:07:54,387042 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,393980 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 17:07:54,394168 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,400601 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 17:07:54,400724 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,407146 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 17:07:54,407291 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,414084 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 17:07:54,414268 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,421074 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 17:07:54,421232 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,434218 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 17:07:54,434356 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,448348 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 17:07:54,448582 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,459076 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 17:07:54,459303 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,472624 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 17:07:54,472767 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,496331 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 17:07:54,496506 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,509735 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 17:07:54,509911 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,525886 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 17:07:54,526050 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,532693 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 17:07:54,532814 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,539477 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 17:07:54,539665 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,548726 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 17:07:54,548849 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,556468 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 17:07:54,556636 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,568838 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 17:07:54,569051 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,578175 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 17:07:54,578379 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:54,851764 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 140 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 17:07:54,875624 (MainThread): 
2020-02-27 17:07:54,876025 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 17:07:54,876148 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:07:56,188638 (MainThread): 09:07:56 | Concurrency: 4 threads (target='dev')
2020-02-27 17:07:56,188900 (MainThread): 09:07:56 | 
2020-02-27 17:07:56,194910 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 17:07:56,195236 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 17:07:56,195583 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 17:07:56,195795 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 17:07:56,196062 (Thread-1): 09:07:56 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 17:07:56,196328 (Thread-2): 09:07:56 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 17:07:56,196577 (Thread-3): 09:07:56 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 17:07:56,196805 (Thread-4): 09:07:56 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 17:07:56,197371 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 17:07:56,197820 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 17:07:56,198300 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 17:07:56,198707 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 17:07:56,198880 (Thread-1): Opening a new connection, currently in state init
2020-02-27 17:07:56,199053 (Thread-2): Opening a new connection, currently in state init
2020-02-27 17:07:56,199222 (Thread-3): Opening a new connection, currently in state init
2020-02-27 17:07:56,199388 (Thread-4): Opening a new connection, currently in state init
2020-02-27 17:07:56,199583 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 17:07:56,199757 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 17:07:56,199931 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 17:07:56,200103 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 17:07:56,218192 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 17:07:56,225807 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 17:07:56,234781 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 17:07:56,243450 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 17:07:56,244338 (Thread-1): finished collecting timing info
2020-02-27 17:07:56,250203 (Thread-3): finished collecting timing info
2020-02-27 17:07:56,256178 (Thread-2): finished collecting timing info
2020-02-27 17:07:56,262501 (Thread-4): finished collecting timing info
2020-02-27 17:07:57,30428 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 17:07:57,62169 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 17:07:57,97709 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 17:07:57,105166 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 17:07:57,106370 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 17:07:57,106849 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 17:07:57,107009 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 17:07:57,109109 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 17:07:58,234961 (Thread-3): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 17:07:58,235489 (Thread-4): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 17:07:58,235670 (Thread-3): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 17:07:58,235854 (Thread-4): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 17:07:58,236057 (Thread-3): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 537333c4-d8a3-4c30-b128-749c723f22a5)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:07:58,236263 (Thread-4): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 043f599e-c4e2-4c71-89f0-b43601f91fbd)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:07:58,236525 (Thread-3): finished collecting timing info
2020-02-27 17:07:58,236986 (Thread-4): finished collecting timing info
2020-02-27 17:07:58,238487 (Thread-4): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 043f599e-c4e2-4c71-89f0-b43601f91fbd)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 043f599e-c4e2-4c71-89f0-b43601f91fbd)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 043f599e-c4e2-4c71-89f0-b43601f91fbd)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:07:58,237679 (Thread-3): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 537333c4-d8a3-4c30-b128-749c723f22a5)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 537333c4-d8a3-4c30-b128-749c723f22a5)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 537333c4-d8a3-4c30-b128-749c723f22a5)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:07:58,255056 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3a3c10>]}
2020-02-27 17:07:58,255392 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3a3f10>]}
2020-02-27 17:07:58,752193 (Thread-4): 09:07:58 | 4 of 44 ERROR creating table model agency_data_pipeline.adwords_urls. [ERROR in 2.06s]
2020-02-27 17:07:58,753641 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 17:07:58,754002 (Thread-4): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 17:07:58,754566 (Thread-4): 09:07:58 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 17:07:58,755333 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 17:07:58,755818 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 17:07:58,755996 (Thread-4): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 17:07:58,765753 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 17:07:58,766275 (Thread-4): finished collecting timing info
2020-02-27 17:07:58,772223 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 17:07:58,772714 (Thread-4): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 17:07:59,202730 (Thread-3): 09:07:59 | 3 of 44 ERROR creating table model agency_data_pipeline.adwords_campaigns [ERROR in 2.06s]
2020-02-27 17:07:59,203090 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 17:07:59,203362 (Thread-3): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 17:07:59,204115 (Thread-3): 09:07:59 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 17:07:59,204706 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 17:07:59,204900 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 17:07:59,205100 (Thread-3): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 17:07:59,215882 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 17:07:59,216400 (Thread-3): finished collecting timing info
2020-02-27 17:07:59,222014 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 17:07:59,222442 (Thread-3): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 17:08:01,268054 (Thread-1): finished collecting timing info
2020-02-27 17:08:01,269133 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf19810>]}
2020-02-27 17:08:01,465393 (Thread-2): finished collecting timing info
2020-02-27 17:08:01,467206 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3987d0>]}
2020-02-27 17:08:01,691242 (Thread-3): finished collecting timing info
2020-02-27 17:08:01,692435 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e395410>]}
2020-02-27 17:08:01,860225 (Thread-4): finished collecting timing info
2020-02-27 17:08:01,861298 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e094850>]}
2020-02-27 17:08:01,875929 (Thread-1): 09:08:01 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (4) in 5.07s]
2020-02-27 17:08:01,877688 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 17:08:01,878145 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 17:08:01,878700 (Thread-1): 09:08:01 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 17:08:01,879917 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 17:08:01,880477 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 17:08:01,880819 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 17:08:01,890137 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 17:08:01,890799 (Thread-1): finished collecting timing info
2020-02-27 17:08:01,896623 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 17:08:01,897048 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 17:08:02,363415 (Thread-2): 09:08:02 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 5.27s]
2020-02-27 17:08:02,365039 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 17:08:02,365428 (Thread-2): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 17:08:02,365901 (Thread-2): 09:08:02 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 17:08:02,366876 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 17:08:02,367351 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 17:08:02,367535 (Thread-2): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 17:08:02,377474 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 17:08:02,378338 (Thread-2): finished collecting timing info
2020-02-27 17:08:02,384556 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 17:08:02,384985 (Thread-2): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 17:08:03,815100 (Thread-3): 09:08:03 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.49s]
2020-02-27 17:08:03,816794 (Thread-3): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 17:08:03,817126 (Thread-3): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 17:08:03,817381 (Thread-3): 09:08:03 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 17:08:03,817977 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 17:08:03,818348 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 17:08:03,818790 (Thread-3): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 17:08:03,826640 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 17:08:03,827280 (Thread-3): finished collecting timing info
2020-02-27 17:08:03,834047 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 17:08:03,834747 (Thread-3): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 17:08:04,214743 (Thread-1): finished collecting timing info
2020-02-27 17:08:04,215812 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cfae450>]}
2020-02-27 17:08:04,386250 (Thread-4): 09:08:04 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.11s]
2020-02-27 17:08:04,387834 (Thread-4): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 17:08:04,388253 (Thread-4): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 17:08:04,388748 (Thread-4): 09:08:04 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 17:08:04,389561 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 17:08:04,390045 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 17:08:04,390402 (Thread-4): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 17:08:04,400817 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 17:08:04,401414 (Thread-4): finished collecting timing info
2020-02-27 17:08:04,406970 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 17:08:04,407386 (Thread-4): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 17:08:04,455199 (Thread-2): finished collecting timing info
2020-02-27 17:08:04,456265 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4ea210>]}
2020-02-27 17:08:05,380865 (Thread-1): 09:08:05 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.34s]
2020-02-27 17:08:05,381223 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 17:08:05,381830 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 17:08:05,383141 (Thread-1): 09:08:05 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 17:08:05,383820 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 17:08:05,384096 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 17:08:05,384254 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 17:08:05,394325 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 17:08:05,395452 (Thread-1): finished collecting timing info
2020-02-27 17:08:05,401488 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 17:08:05,402009 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 17:08:06,386798 (Thread-3): finished collecting timing info
2020-02-27 17:08:06,387863 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e317cd0>]}
2020-02-27 17:08:06,859942 (Thread-4): finished collecting timing info
2020-02-27 17:08:06,861061 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e348e10>]}
2020-02-27 17:08:07,109810 (Thread-2): 09:08:07 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.09s]
2020-02-27 17:08:07,111363 (Thread-2): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 17:08:07,111762 (Thread-2): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 17:08:07,112189 (Thread-2): 09:08:07 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 17:08:07,112674 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 17:08:07,113096 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 17:08:07,113570 (Thread-2): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 17:08:07,122625 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 17:08:07,123785 (Thread-2): finished collecting timing info
2020-02-27 17:08:07,129541 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 17:08:07,130011 (Thread-2): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 17:08:08,57956 (Thread-3): 09:08:08 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.57s]
2020-02-27 17:08:08,59765 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 17:08:08,60223 (Thread-3): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 17:08:08,60725 (Thread-3): 09:08:08 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 17:08:08,61668 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 17:08:08,62255 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 17:08:08,62472 (Thread-3): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 17:08:08,72738 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 17:08:08,73402 (Thread-3): finished collecting timing info
2020-02-27 17:08:08,80148 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 17:08:08,80575 (Thread-3): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 17:08:08,544416 (Thread-1): finished collecting timing info
2020-02-27 17:08:08,545535 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e50f4d0>]}
2020-02-27 17:08:09,77235 (Thread-4): 09:08:09 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.47s]
2020-02-27 17:08:09,78923 (Thread-4): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 17:08:09,79295 (Thread-4): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 17:08:09,79697 (Thread-4): 09:08:09 | 14 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 17:08:09,79936 (Thread-4): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 17:08:09,80173 (Thread-4): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 17:08:09,80880 (Thread-4): 09:08:09 | 15 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 17:08:09,82029 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 17:08:09,82187 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 17:08:09,82352 (Thread-4): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 17:08:09,97699 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:08:09,491862 (Thread-1): 09:08:09 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 3.16s]
2020-02-27 17:08:09,492158 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 17:08:09,492387 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 17:08:09,492804 (Thread-1): 09:08:09 | 16 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 17:08:09,493437 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 17:08:09,493598 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 17:08:09,493760 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 17:08:09,507662 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:08:10,2453 (Thread-2): finished collecting timing info
2020-02-27 17:08:10,3526 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e081910>]}
2020-02-27 17:08:10,269028 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 17:08:10,269719 (Thread-4): finished collecting timing info
2020-02-27 17:08:10,277110 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 17:08:10,277534 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:10,401985 (Thread-3): finished collecting timing info
2020-02-27 17:08:10,403035 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e55ca50>]}
2020-02-27 17:08:10,417376 (Thread-2): 09:08:10 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46345) in 2.89s]
2020-02-27 17:08:10,417971 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 17:08:10,418278 (Thread-2): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 17:08:10,419467 (Thread-2): 09:08:10 | 17 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 17:08:10,420084 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 17:08:10,420243 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 17:08:10,420406 (Thread-2): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 17:08:10,433465 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:08:10,506939 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:08:10,507191 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:10,507349 (Thread-4): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: cf7c21f1-9cd7-4eff-842a-60b17b40c386)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:10,507574 (Thread-4): finished collecting timing info
2020-02-27 17:08:10,508258 (Thread-4): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: cf7c21f1-9cd7-4eff-842a-60b17b40c386)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 17:08:10,509151 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e53b310>]}
2020-02-27 17:08:10,797543 (Thread-3): 09:08:10 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.34s]
2020-02-27 17:08:10,798930 (Thread-3): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 17:08:10,799272 (Thread-3): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 17:08:10,799686 (Thread-3): 09:08:10 | 18 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 17:08:10,800176 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 17:08:10,800333 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 17:08:10,800752 (Thread-3): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 17:08:10,817191 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:08:10,861312 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 17:08:10,861983 (Thread-1): finished collecting timing info
2020-02-27 17:08:10,868718 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 17:08:10,869150 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:11,84710 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:08:11,85012 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:11,85204 (Thread-1): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 7960b14f-b0db-498b-a32a-3fc9ac3e7cde)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:11,85468 (Thread-1): finished collecting timing info
2020-02-27 17:08:11,86292 (Thread-1): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 7960b14f-b0db-498b-a32a-3fc9ac3e7cde)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 17:08:11,87322 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e589d50>]}
2020-02-27 17:08:11,251096 (Thread-4): 09:08:11 | 15 of 44 ERROR creating table model agency_data_pipeline.fb_adcreative [ERROR in 1.43s]
2020-02-27 17:08:11,252487 (Thread-4): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 17:08:11,252930 (Thread-4): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 17:08:11,253482 (Thread-4): 09:08:11 | 19 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 17:08:11,254416 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 17:08:11,254903 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 17:08:11,255765 (Thread-4): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 17:08:11,266831 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 17:08:11,268984 (Thread-4): finished collecting timing info
2020-02-27 17:08:11,277627 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 17:08:11,278948 (Thread-4): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 17:08:12,253653 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 17:08:12,254309 (Thread-2): finished collecting timing info
2020-02-27 17:08:12,262993 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 17:08:12,263433 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:12,531619 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 17:08:12,532314 (Thread-3): finished collecting timing info
2020-02-27 17:08:12,539805 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 17:08:12,540355 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:12,977368 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:08:12,977701 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:12,978304 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:08:12,978505 (Thread-2): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 0fcd1998-41cb-46c6-b010-52ffbca63dcf)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:12,978743 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:08:12,979039 (Thread-2): finished collecting timing info
2020-02-27 17:08:12,979529 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 912590a6-472c-45e8-9c09-85f6b7176dba)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:12,980786 (Thread-3): finished collecting timing info
2020-02-27 17:08:12,980114 (Thread-2): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 0fcd1998-41cb-46c6-b010-52ffbca63dcf)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 17:08:12,982110 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5af750>]}
2020-02-27 17:08:12,981694 (Thread-3): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 912590a6-472c-45e8-9c09-85f6b7176dba)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 17:08:12,983016 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0fba10>]}
2020-02-27 17:08:14,604412 (Thread-4): finished collecting timing info
2020-02-27 17:08:14,605587 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e540390>]}
2020-02-27 17:08:17,446331 (Thread-1): 09:08:17 | 16 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights [ERROR in 1.59s]
2020-02-27 17:08:17,446936 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 17:08:17,447245 (Thread-1): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 17:08:17,448520 (Thread-1): 09:08:17 | 20 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 17:08:17,449092 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 17:08:17,449243 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 17:08:17,449404 (Thread-1): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 17:08:17,460430 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 17:08:17,461167 (Thread-1): finished collecting timing info
2020-02-27 17:08:17,466935 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 17:08:17,467801 (Thread-1): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 17:08:18,441260 (Thread-2): 09:08:18 | 17 of 44 ERROR creating table model agency_data_pipeline.adwords_adplatforms [ERROR in 2.56s]
2020-02-27 17:08:18,443030 (Thread-2): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 17:08:18,443416 (Thread-2): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 17:08:18,443671 (Thread-2): 09:08:18 | 21 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 17:08:18,444411 (Thread-2): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 17:08:18,444974 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 17:08:18,445339 (Thread-2): 09:08:18 | 22 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 17:08:18,445979 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 17:08:18,446134 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 17:08:18,446293 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 17:08:18,463028 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 17:08:18,463578 (Thread-2): finished collecting timing info
2020-02-27 17:08:18,469228 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 17:08:18,469683 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 17:08:19,183976 (Thread-3): 09:08:19 | 18 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.18s]
2020-02-27 17:08:19,185582 (Thread-3): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 17:08:19,185849 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 17:08:19,186434 (Thread-3): 09:08:19 | 23 of 44 SKIP relation agency_data_pipeline.fb_ads................... [SKIP]
2020-02-27 17:08:19,186788 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 17:08:19,187280 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 17:08:19,187924 (Thread-3): 09:08:19 | 24 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 17:08:19,188223 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 17:08:19,188814 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 17:08:19,189038 (Thread-3): 09:08:19 | 25 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 17:08:19,189242 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 17:08:19,189713 (Thread-3): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 17:08:19,189935 (Thread-3): 09:08:19 | 26 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 17:08:19,190129 (Thread-3): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 17:08:19,190514 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 17:08:19,190720 (Thread-3): 09:08:19 | 27 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 17:08:19,190909 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 17:08:19,601923 (Thread-4): 09:08:19 | 19 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 3.35s]
2020-02-27 17:08:19,602274 (Thread-4): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 17:08:19,602825 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 17:08:19,603138 (Thread-3): 09:08:19 | 28 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 17:08:19,603727 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 17:08:19,603906 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 17:08:19,604094 (Thread-3): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 17:08:19,628150 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:08:20,53461 (Thread-1): finished collecting timing info
2020-02-27 17:08:20,55129 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5bce90>]}
2020-02-27 17:08:20,751129 (Thread-1): 09:08:20 | 20 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.61s]
2020-02-27 17:08:20,751390 (Thread-1): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 17:08:20,751879 (Thread-4): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 17:08:20,752135 (Thread-4): 09:08:20 | 29 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 17:08:20,752542 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 17:08:20,752661 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 17:08:20,752786 (Thread-4): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 17:08:20,789821 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:08:21,268030 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 17:08:21,270775 (Thread-3): finished collecting timing info
2020-02-27 17:08:21,277320 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 17:08:21,278268 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 17:08:21,547372 (Thread-2): finished collecting timing info
2020-02-27 17:08:21,548283 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e55c3d0>]}
2020-02-27 17:08:21,631704 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]')
2020-02-27 17:08:21,631977 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 17:08:21,632152 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 5a919ca4-80ad-4757-9e90-13482f92bce4)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:21,632355 (Thread-3): finished collecting timing info
2020-02-27 17:08:21,632925 (Thread-3): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 5a919ca4-80ad-4757-9e90-13482f92bce4)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 17:08:21,633630 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e4e6a90>]}
2020-02-27 17:08:21,940972 (Thread-2): 09:08:21 | 22 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 3.10s]
2020-02-27 17:08:21,941530 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 17:08:21,942698 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 17:08:21,943039 (Thread-1): 09:08:21 | 30 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 17:08:21,943463 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 17:08:21,943592 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 17:08:21,943935 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 17:08:21,955216 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 17:08:21,956017 (Thread-1): finished collecting timing info
2020-02-27 17:08:21,962961 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 17:08:21,963644 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 17:08:22,250899 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 17:08:22,251752 (Thread-4): finished collecting timing info
2020-02-27 17:08:22,258541 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 17:08:22,259400 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 17:08:22,373355 (Thread-3): 09:08:22 | 28 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 2.03s]
2020-02-27 17:08:22,373621 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 17:08:22,374236 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 17:08:22,374494 (Thread-2): 09:08:22 | 31 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 17:08:22,374736 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 17:08:22,375076 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 17:08:22,375271 (Thread-3): 09:08:22 | 32 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 17:08:22,375432 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 17:08:22,375803 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 17:08:22,376016 (Thread-2): 09:08:22 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 17:08:22,376241 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 17:08:22,996202 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]')
2020-02-27 17:08:22,996424 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 17:08:22,996559 (Thread-4): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: 0fa54041-b9e2-48e6-a136-584b24f8bfcf)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:22,996753 (Thread-4): finished collecting timing info
2020-02-27 17:08:22,997509 (Thread-4): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: 0fa54041-b9e2-48e6-a136-584b24f8bfcf)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 17:08:22,998536 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e421350>]}
2020-02-27 17:08:23,597174 (Thread-4): 09:08:23 | 29 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 2.25s]
2020-02-27 17:08:23,597483 (Thread-4): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 17:08:23,598189 (Thread-3): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 17:08:23,598483 (Thread-3): 09:08:23 | 34 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 17:08:23,598722 (Thread-3): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 17:08:23,599179 (Thread-4): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 17:08:23,599375 (Thread-4): 09:08:23 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 17:08:23,599555 (Thread-4): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 17:08:23,599965 (Thread-3): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 17:08:23,600132 (Thread-2): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 17:08:23,600300 (Thread-3): 09:08:23 | 36 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 17:08:23,600470 (Thread-2): 09:08:23 | 37 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 17:08:23,600710 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 17:08:23,600899 (Thread-2): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 17:08:23,601332 (Thread-4): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 17:08:23,601563 (Thread-4): 09:08:23 | 38 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 17:08:23,601706 (Thread-2): Began running node model.journeyengine_recipes.platform_index
2020-02-27 17:08:23,601881 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 17:08:23,602135 (Thread-2): 09:08:23 | 39 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 17:08:23,602673 (Thread-2): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 17:08:23,602866 (Thread-3): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 17:08:23,603255 (Thread-3): 09:08:23 | 40 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 17:08:23,603405 (Thread-4): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 17:08:23,603569 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 17:08:23,603846 (Thread-4): 09:08:23 | 41 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 17:08:23,604269 (Thread-4): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 17:08:24,864827 (Thread-1): finished collecting timing info
2020-02-27 17:08:24,865794 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5a2850>]}
2020-02-27 17:08:25,694412 (Thread-1): 09:08:25 | 30 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.92s]
2020-02-27 17:08:25,694779 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 17:08:25,701826 (Thread-2): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 17:08:25,702173 (Thread-2): 09:08:25 | 42 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 17:08:25,702587 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 17:08:25,702706 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 17:08:25,702833 (Thread-2): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 17:08:25,710206 (Thread-3): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 17:08:25,717230 (Thread-3): 09:08:25 | 43 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 17:08:25,717845 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 17:08:25,718015 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 17:08:25,716884 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 17:08:25,718194 (Thread-3): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 17:08:25,735767 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 17:08:25,736637 (Thread-2): finished collecting timing info
2020-02-27 17:08:25,747050 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 17:08:25,747622 (Thread-3): finished collecting timing info
2020-02-27 17:08:25,748329 (Thread-2): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 17:08:25,766544 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 17:08:25,768369 (Thread-3): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 17:08:28,604958 (Thread-3): finished collecting timing info
2020-02-27 17:08:28,606821 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e610f10>]}
2020-02-27 17:08:29,78691 (Thread-2): finished collecting timing info
2020-02-27 17:08:29,79666 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e591e90>]}
2020-02-27 17:08:29,333545 (Thread-3): 09:08:29 | 43 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.89s]
2020-02-27 17:08:29,335368 (Thread-3): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 17:08:30,733941 (Thread-2): 09:08:30 | 42 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 3.38s]
2020-02-27 17:08:30,739669 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 17:08:30,740439 (Thread-1): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 17:08:30,740761 (Thread-1): 09:08:30 | 44 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 17:08:30,741555 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 17:08:30,741792 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 17:08:30,742075 (Thread-1): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 17:08:30,764617 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 17:08:30,768668 (Thread-1): finished collecting timing info
2020-02-27 17:08:30,777934 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 17:08:30,780153 (Thread-1): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 17:08:33,860455 (Thread-1): finished collecting timing info
2020-02-27 17:08:33,862301 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f2deaf4-d810-455b-b4c3-af15fe22b9cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e395a50>]}
2020-02-27 17:08:34,373331 (Thread-1): 09:08:34 | 44 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 3.12s]
2020-02-27 17:08:34,374408 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 17:08:34,393449 (MainThread): 09:08:34 | 
2020-02-27 17:08:34,393804 (MainThread): 09:08:34 | Finished running 44 table models in 39.52s.
2020-02-27 17:08:34,394113 (MainThread): Connection 'master' was left open.
2020-02-27 17:08:34,394311 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 17:08:34,394516 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 17:08:34,394700 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 17:08:34,394876 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 17:08:34,736673 (MainThread): 
2020-02-27 17:08:34,736947 (MainThread): Completed with 8 errors and 0 warnings:
2020-02-27 17:08:34,737197 (MainThread): 
2020-02-27 17:08:34,737471 (MainThread): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 17:08:34,737706 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 17:08:34,737871 (MainThread):   
2020-02-27 17:08:34,738033 (MainThread):   (job ID: 043f599e-c4e2-4c71-89f0-b43601f91fbd)
2020-02-27 17:08:34,738190 (MainThread):   
2020-02-27 17:08:34,738346 (MainThread):                                                                       -----Query Job SQL Follows-----                                                                     
2020-02-27 17:08:34,738506 (MainThread):   
2020-02-27 17:08:34,738666 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:34,738820 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
2020-02-27 17:08:34,739009 (MainThread):      2:
2020-02-27 17:08:34,739242 (MainThread):      3:
2020-02-27 17:08:34,739475 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
2020-02-27 17:08:34,739669 (MainThread):      5:  
2020-02-27 17:08:34,739861 (MainThread):      6:  
2020-02-27 17:08:34,740051 (MainThread):      7:  OPTIONS()
2020-02-27 17:08:34,740241 (MainThread):      8:  as (
2020-02-27 17:08:34,740527 (MainThread):      9:    SELECT
2020-02-27 17:08:34,740692 (MainThread):     10:campaignid,
2020-02-27 17:08:34,740847 (MainThread):     11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
2020-02-27 17:08:34,741152 (MainThread):     12:FROM 
2020-02-27 17:08:34,741336 (MainThread):     13:(
2020-02-27 17:08:34,741501 (MainThread):     14:	SELECT  
2020-02-27 17:08:34,741661 (MainThread):     15:	campaignid,
2020-02-27 17:08:34,741816 (MainThread):     16:	max(finalurl) finalurl
2020-02-27 17:08:34,742028 (MainThread):     17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
2020-02-27 17:08:34,742206 (MainThread):     18:	GROUP BY campaignid
2020-02-27 17:08:34,742369 (MainThread):     19:)
2020-02-27 17:08:34,742527 (MainThread):     20:  );
2020-02-27 17:08:34,742682 (MainThread):     21:    
2020-02-27 17:08:34,742834 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:34,743002 (MainThread): 
2020-02-27 17:08:34,743225 (MainThread): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
2020-02-27 17:08:34,743459 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 17:08:34,743653 (MainThread):   
2020-02-27 17:08:34,743828 (MainThread):   (job ID: 537333c4-d8a3-4c30-b128-749c723f22a5)
2020-02-27 17:08:34,743992 (MainThread):   
2020-02-27 17:08:34,744153 (MainThread):                                                                          -----Query Job SQL Follows-----                                                                       
2020-02-27 17:08:34,744312 (MainThread):   
2020-02-27 17:08:34,744467 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:34,744622 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
2020-02-27 17:08:34,744777 (MainThread):      2:
2020-02-27 17:08:34,744930 (MainThread):      3:
2020-02-27 17:08:34,745082 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
2020-02-27 17:08:34,745233 (MainThread):      5:  
2020-02-27 17:08:34,745384 (MainThread):      6:  
2020-02-27 17:08:34,745592 (MainThread):      7:  OPTIONS()
2020-02-27 17:08:34,745920 (MainThread):      8:  as (
2020-02-27 17:08:34,746157 (MainThread):      9:    SELECT
2020-02-27 17:08:34,746395 (MainThread):     10:day,
2020-02-27 17:08:34,746632 (MainThread):     11:campaignid,
2020-02-27 17:08:34,746912 (MainThread):     12:campaign,
2020-02-27 17:08:34,747140 (MainThread):     13:account, 
2020-02-27 17:08:34,747376 (MainThread):     14:channel,
2020-02-27 17:08:34,747610 (MainThread):     15:platform,
2020-02-27 17:08:34,747849 (MainThread):     16:sum(cost) cost,
2020-02-27 17:08:34,748082 (MainThread):     17:sum(impressions) impressions,
2020-02-27 17:08:34,748379 (MainThread):     18:sum(clicks) clicks,
2020-02-27 17:08:34,748666 (MainThread):     19:sum(conversions) conversions
2020-02-27 17:08:34,748937 (MainThread):     20:FROM
2020-02-27 17:08:34,749177 (MainThread):     21:( 
2020-02-27 17:08:34,749435 (MainThread):     22:	SELECT  
2020-02-27 17:08:34,749676 (MainThread):     23:	'Paid' as channel,
2020-02-27 17:08:34,749919 (MainThread):     24:	'Google Ads' as platform,
2020-02-27 17:08:34,750316 (MainThread):     25:	day,
2020-02-27 17:08:34,750671 (MainThread):     26:	campaignid,
2020-02-27 17:08:34,750975 (MainThread):     27:	campaign,
2020-02-27 17:08:34,751310 (MainThread):     28:	account as account,
2020-02-27 17:08:34,751566 (MainThread):     29:	cost/1000000 cost, 
2020-02-27 17:08:34,751854 (MainThread):     30:	impressions as impressions, 
2020-02-27 17:08:34,752130 (MainThread):     31:	clicks, 
2020-02-27 17:08:34,752409 (MainThread):     32:	conversions,
2020-02-27 17:08:34,752805 (MainThread):     33:	_sdc_sequence,
2020-02-27 17:08:34,752984 (MainThread):     34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
2020-02-27 17:08:34,753150 (MainThread):     35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
2020-02-27 17:08:34,753408 (MainThread):     36:)
2020-02-27 17:08:34,753608 (MainThread):     37:WHERE lv = _sdc_sequence
2020-02-27 17:08:34,753806 (MainThread):     38:GROUP BY day, campaignid, account, channel, platform, campaign
2020-02-27 17:08:34,754003 (MainThread):     39:  );
2020-02-27 17:08:34,754197 (MainThread):     40:    
2020-02-27 17:08:34,754391 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:08:34,754649 (MainThread): 
2020-02-27 17:08:34,754994 (MainThread): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
2020-02-27 17:08:34,755222 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:08:34,755434 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 17:08:34,755609 (MainThread): 
2020-02-27 17:08:34,755789 (MainThread): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
2020-02-27 17:08:34,755955 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:08:34,756210 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 17:08:34,756415 (MainThread): 
2020-02-27 17:08:34,756619 (MainThread): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
2020-02-27 17:08:34,756795 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:08:34,756983 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 17:08:34,757190 (MainThread): 
2020-02-27 17:08:34,757391 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 17:08:34,757566 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:08:34,757750 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 17:08:34,757954 (MainThread): 
2020-02-27 17:08:34,758156 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 17:08:34,758331 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
2020-02-27 17:08:34,758516 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 17:08:34,758723 (MainThread): 
2020-02-27 17:08:34,758924 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 17:08:34,759097 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
2020-02-27 17:08:34,759280 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 17:08:34,759532 (MainThread): 
Done. PASS=36 WARN=0 ERROR=8 SKIP=0 TOTAL=44
2020-02-27 17:08:34,759841 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf45850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf198d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5bcf10>]}
2020-02-27 17:08:35,128462 (MainThread): Flushing usage events
2020-02-27 17:10:16,608551 (MainThread): Running with dbt=0.15.2
2020-02-27 17:10:16,874102 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 17:10:16,874728 (MainThread): Tracking: tracking
2020-02-27 17:10:16,883313 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10feb6810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0b4950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10feb6b10>]}
2020-02-27 17:10:18,120936 (MainThread): Partial parsing not enabled
2020-02-27 17:10:18,123687 (MainThread): Parsing macros/core.sql
2020-02-27 17:10:18,129215 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 17:10:18,139016 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 17:10:18,143048 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 17:10:18,166555 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 17:10:18,190757 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 17:10:18,213632 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 17:10:18,216746 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 17:10:18,225819 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 17:10:18,235775 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 17:10:18,244323 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 17:10:18,251923 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 17:10:18,258486 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 17:10:18,259879 (MainThread): Parsing macros/etc/query.sql
2020-02-27 17:10:18,261511 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 17:10:18,263917 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 17:10:18,279045 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 17:10:18,295024 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 17:10:18,297847 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 17:10:18,337992 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 17:10:18,339749 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 17:10:18,341240 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 17:10:18,343046 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 17:10:18,346310 (MainThread): Parsing macros/etc.sql
2020-02-27 17:10:18,347885 (MainThread): Parsing macros/catalog.sql
2020-02-27 17:10:18,352570 (MainThread): Parsing macros/adapters.sql
2020-02-27 17:10:18,374231 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 17:10:18,376292 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 17:10:18,380207 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 17:10:18,383143 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 17:10:18,396448 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 17:10:18,406804 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 17:10:18,433600 (MainThread): Partial parsing not enabled
2020-02-27 17:10:18,434477 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 17:10:18,441433 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 17:10:18,468497 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 17:10:18,468664 (MainThread): Opening a new connection, currently in state init
2020-02-27 17:10:18,494794 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 17:10:18,494969 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,502604 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 17:10:18,502724 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,510366 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 17:10:18,510538 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,519828 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 17:10:18,520024 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,530181 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 17:10:18,530338 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,542919 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 17:10:18,543047 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,553022 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 17:10:18,553204 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,562442 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 17:10:18,562566 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,571264 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 17:10:18,571387 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,585324 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 17:10:18,585587 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,597555 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 17:10:18,597754 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,608733 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 17:10:18,608867 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,615693 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 17:10:18,615825 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,623222 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 17:10:18,623418 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,630271 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 17:10:18,630395 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,638761 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 17:10:18,638887 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,646343 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 17:10:18,646466 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,654694 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 17:10:18,654861 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,663766 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 17:10:18,663993 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,674332 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 17:10:18,674542 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,682601 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 17:10:18,682782 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,738572 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 17:10:18,738798 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,754423 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 17:10:18,754685 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,765452 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 17:10:18,765682 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,775324 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 17:10:18,775519 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,782833 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 17:10:18,783006 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,789589 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 17:10:18,789742 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,796321 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 17:10:18,796445 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,803452 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 17:10:18,803641 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,810566 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 17:10:18,810709 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,824499 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 17:10:18,824682 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,835117 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 17:10:18,835239 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,843160 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 17:10:18,843339 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,856212 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 17:10:18,856341 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,877715 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 17:10:18,877853 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,891838 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 17:10:18,892068 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,909681 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 17:10:18,909819 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,916450 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 17:10:18,916576 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,922692 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 17:10:18,922809 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,930940 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 17:10:18,931057 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,939187 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 17:10:18,939390 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,952480 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 17:10:18,952600 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:18,958743 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 17:10:18,958870 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:19,220732 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 140 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 17:10:19,248150 (MainThread): 
2020-02-27 17:10:19,248652 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 17:10:19,248788 (MainThread): Opening a new connection, currently in state closed
2020-02-27 17:10:21,307188 (MainThread): 09:10:21 | Concurrency: 4 threads (target='dev')
2020-02-27 17:10:21,307446 (MainThread): 09:10:21 | 
2020-02-27 17:10:21,313151 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 17:10:21,313457 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 17:10:21,313738 (Thread-1): 09:10:21 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 17:10:21,313865 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 17:10:21,314186 (Thread-2): 09:10:21 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 17:10:21,314399 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 17:10:21,314980 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 17:10:21,315131 (Thread-3): 09:10:21 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 17:10:21,315774 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 17:10:21,315995 (Thread-4): 09:10:21 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 17:10:21,316134 (Thread-1): Opening a new connection, currently in state init
2020-02-27 17:10:21,316727 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 17:10:21,316917 (Thread-2): Opening a new connection, currently in state init
2020-02-27 17:10:21,317489 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 17:10:21,317698 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 17:10:21,317827 (Thread-3): Opening a new connection, currently in state init
2020-02-27 17:10:21,317956 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 17:10:21,318167 (Thread-4): Opening a new connection, currently in state init
2020-02-27 17:10:21,339663 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 17:10:21,339809 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 17:10:21,348780 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 17:10:21,348971 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 17:10:21,356750 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 17:10:21,364746 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 17:10:21,364880 (Thread-1): finished collecting timing info
2020-02-27 17:10:21,365243 (Thread-2): finished collecting timing info
2020-02-27 17:10:21,396068 (Thread-3): finished collecting timing info
2020-02-27 17:10:21,442734 (Thread-4): finished collecting timing info
2020-02-27 17:10:22,144064 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 17:10:22,146411 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 17:10:22,156435 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 17:10:22,167290 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 17:10:22,168793 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 17:10:22,170004 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 17:10:22,170179 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 17:10:22,171726 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 17:10:25,535503 (Thread-2): finished collecting timing info
2020-02-27 17:10:25,537464 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111037050>]}
2020-02-27 17:10:25,540396 (Thread-3): finished collecting timing info
2020-02-27 17:10:25,542540 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11107cd90>]}
2020-02-27 17:10:25,552669 (Thread-1): finished collecting timing info
2020-02-27 17:10:25,555310 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111037d50>]}
2020-02-27 17:10:25,876447 (Thread-4): finished collecting timing info
2020-02-27 17:10:25,877511 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff73d90>]}
2020-02-27 17:10:26,186085 (Thread-2): 09:10:26 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 4.22s]
2020-02-27 17:10:26,187937 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 17:10:26,188372 (Thread-2): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 17:10:26,188817 (Thread-2): 09:10:26 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 17:10:26,189805 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 17:10:26,190339 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 17:10:26,190576 (Thread-2): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 17:10:26,200243 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 17:10:26,200791 (Thread-2): finished collecting timing info
2020-02-27 17:10:26,206739 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 17:10:26,207165 (Thread-2): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 17:10:26,627756 (Thread-3): 09:10:26 | 3 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 4.23s]
2020-02-27 17:10:26,629535 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 17:10:26,629937 (Thread-3): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 17:10:26,630350 (Thread-3): 09:10:26 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 17:10:26,630824 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 17:10:26,631260 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 17:10:26,631774 (Thread-3): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 17:10:26,642467 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 17:10:26,643305 (Thread-3): finished collecting timing info
2020-02-27 17:10:26,650285 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 17:10:26,650831 (Thread-3): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 17:10:27,103433 (Thread-1): 09:10:27 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (4) in 4.24s]
2020-02-27 17:10:27,104139 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 17:10:27,105492 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 17:10:27,106066 (Thread-1): 09:10:27 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 17:10:27,106750 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 17:10:27,107601 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 17:10:27,108140 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 17:10:27,119595 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 17:10:27,120298 (Thread-1): finished collecting timing info
2020-02-27 17:10:27,126783 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 17:10:27,127223 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 17:10:27,768759 (Thread-4): 09:10:27 | 4 of 44 OK created table model agency_data_pipeline.adwords_urls..... [CREATE TABLE (28) in 4.56s]
2020-02-27 17:10:27,769140 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 17:10:27,769401 (Thread-4): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 17:10:27,769648 (Thread-4): 09:10:27 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 17:10:27,770159 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 17:10:27,770321 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 17:10:27,770545 (Thread-4): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 17:10:27,781073 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 17:10:27,781639 (Thread-4): finished collecting timing info
2020-02-27 17:10:27,787758 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 17:10:27,788212 (Thread-4): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 17:10:29,104791 (Thread-2): finished collecting timing info
2020-02-27 17:10:29,105853 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111414c50>]}
2020-02-27 17:10:29,557727 (Thread-3): finished collecting timing info
2020-02-27 17:10:29,559272 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11103e2d0>]}
2020-02-27 17:10:29,732787 (Thread-1): finished collecting timing info
2020-02-27 17:10:29,747418 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110c0ad0>]}
2020-02-27 17:10:29,955247 (Thread-2): 09:10:29 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 2.92s]
2020-02-27 17:10:29,957086 (Thread-2): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 17:10:29,957467 (Thread-2): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 17:10:29,957886 (Thread-2): 09:10:29 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 17:10:29,958364 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 17:10:29,958773 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 17:10:29,959250 (Thread-2): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 17:10:29,969243 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 17:10:29,970116 (Thread-2): finished collecting timing info
2020-02-27 17:10:29,977047 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 17:10:29,977628 (Thread-2): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 17:10:30,757042 (Thread-4): finished collecting timing info
2020-02-27 17:10:30,758334 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ffd3890>]}
2020-02-27 17:10:30,847540 (Thread-3): 09:10:30 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.93s]
2020-02-27 17:10:30,849279 (Thread-3): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 17:10:30,849656 (Thread-3): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 17:10:30,850117 (Thread-3): 09:10:30 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 17:10:30,850806 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 17:10:30,851330 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 17:10:30,851524 (Thread-3): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 17:10:30,860609 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 17:10:30,861301 (Thread-3): finished collecting timing info
2020-02-27 17:10:30,867061 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 17:10:30,867704 (Thread-3): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 17:10:31,572851 (Thread-1): 09:10:31 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.64s]
2020-02-27 17:10:31,574235 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 17:10:31,574631 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 17:10:31,575032 (Thread-1): 09:10:31 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 17:10:31,575511 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 17:10:31,575918 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 17:10:31,576400 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 17:10:31,587417 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 17:10:31,587965 (Thread-1): finished collecting timing info
2020-02-27 17:10:31,593483 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 17:10:31,593915 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 17:10:32,703744 (Thread-2): finished collecting timing info
2020-02-27 17:10:32,704822 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111447690>]}
2020-02-27 17:10:32,705941 (Thread-4): 09:10:32 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.99s]
2020-02-27 17:10:32,706494 (Thread-4): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 17:10:32,707694 (Thread-4): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 17:10:32,708193 (Thread-4): 09:10:32 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 17:10:32,708625 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 17:10:32,708776 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 17:10:32,709190 (Thread-4): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 17:10:32,718172 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 17:10:32,718751 (Thread-4): finished collecting timing info
2020-02-27 17:10:32,724543 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 17:10:32,725087 (Thread-4): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 17:10:33,172214 (Thread-2): 09:10:33 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.75s]
2020-02-27 17:10:33,173744 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 17:10:33,174169 (Thread-2): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 17:10:33,174607 (Thread-2): 09:10:33 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 17:10:33,175375 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 17:10:33,175986 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 17:10:33,176483 (Thread-2): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 17:10:33,186138 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 17:10:33,186742 (Thread-2): finished collecting timing info
2020-02-27 17:10:33,192751 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 17:10:33,193172 (Thread-2): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 17:10:33,343003 (Thread-3): finished collecting timing info
2020-02-27 17:10:33,344233 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113d2750>]}
2020-02-27 17:10:33,671644 (Thread-1): finished collecting timing info
2020-02-27 17:10:33,672720 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113f1990>]}
2020-02-27 17:10:33,865779 (Thread-3): 09:10:33 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.49s]
2020-02-27 17:10:33,866389 (Thread-3): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 17:10:33,867555 (Thread-3): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 17:10:33,868054 (Thread-3): 09:10:33 | 14 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 17:10:33,868538 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 17:10:33,868691 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 17:10:33,869120 (Thread-3): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 17:10:33,879550 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 17:10:33,880238 (Thread-3): finished collecting timing info
2020-02-27 17:10:33,886157 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 17:10:33,886731 (Thread-3): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 17:10:35,444414 (Thread-1): 09:10:35 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.10s]
2020-02-27 17:10:35,444764 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 17:10:35,444996 (Thread-1): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 17:10:35,445430 (Thread-1): 09:10:35 | 15 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 17:10:35,446028 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 17:10:35,446193 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 17:10:35,446355 (Thread-1): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 17:10:35,457687 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 17:10:35,458144 (Thread-1): finished collecting timing info
2020-02-27 17:10:35,463624 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 17:10:35,464032 (Thread-1): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 17:10:35,688840 (Thread-4): finished collecting timing info
2020-02-27 17:10:35,692405 (Thread-2): finished collecting timing info
2020-02-27 17:10:35,693450 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11148e2d0>]}
2020-02-27 17:10:35,694235 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111002390>]}
2020-02-27 17:10:36,838569 (Thread-4): 09:10:36 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46345) in 2.98s]
2020-02-27 17:10:36,840102 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 17:10:36,840487 (Thread-4): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 17:10:36,840929 (Thread-4): 09:10:36 | 16 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 17:10:36,841719 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 17:10:36,842202 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 17:10:36,842409 (Thread-4): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 17:10:36,856319 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:10:37,526790 (Thread-3): finished collecting timing info
2020-02-27 17:10:37,530429 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ffba750>]}
2020-02-27 17:10:37,619676 (Thread-2): 09:10:37 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.52s]
2020-02-27 17:10:37,621268 (Thread-2): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 17:10:37,621657 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 17:10:37,622081 (Thread-2): 09:10:37 | 17 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 17:10:37,622859 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 17:10:37,623332 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 17:10:37,623516 (Thread-2): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 17:10:37,637922 (Thread-2): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:10:37,684686 (Thread-1): finished collecting timing info
2020-02-27 17:10:37,685526 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111059290>]}
2020-02-27 17:10:38,383547 (Thread-3): 09:10:38 | 14 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 3.66s]
2020-02-27 17:10:38,384076 (Thread-3): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 17:10:38,384625 (Thread-3): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 17:10:38,386340 (Thread-3): 09:10:38 | 18 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 17:10:38,387171 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 17:10:38,387460 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 17:10:38,388073 (Thread-3): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 17:10:38,400358 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:10:38,546178 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 17:10:38,546855 (Thread-4): finished collecting timing info
2020-02-27 17:10:38,555477 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 17:10:38,556112 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:38,852116 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:10:38,854032 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:38,854395 (Thread-4): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 50facb38-4c55-4dab-86b1-18d346a12750)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:10:38,854709 (Thread-4): finished collecting timing info
2020-02-27 17:10:38,855790 (Thread-4): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 50facb38-4c55-4dab-86b1-18d346a12750)

                                                                     -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 17:10:38,870239 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111557c10>]}
2020-02-27 17:10:38,984793 (Thread-1): 09:10:38 | 15 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.24s]
2020-02-27 17:10:38,986174 (Thread-1): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 17:10:38,986558 (Thread-1): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 17:10:38,986964 (Thread-1): 09:10:38 | 19 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 17:10:38,987848 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 17:10:38,988309 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 17:10:38,988487 (Thread-1): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 17:10:39,6881 (Thread-1): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:10:39,93684 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 17:10:39,94290 (Thread-2): finished collecting timing info
2020-02-27 17:10:39,100940 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 17:10:39,101585 (Thread-2): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:39,286280 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:10:39,286579 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:39,286786 (Thread-2): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 2214286f-3f37-442a-b1a7-bf90ffe97225)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:10:39,287074 (Thread-2): finished collecting timing info
2020-02-27 17:10:39,287760 (Thread-2): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 2214286f-3f37-442a-b1a7-bf90ffe97225)

                                                                      -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 17:10:39,288637 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11162bd10>]}
2020-02-27 17:10:39,389921 (Thread-4): 09:10:39 | 16 of 44 ERROR creating table model agency_data_pipeline.fb_adcreative [ERROR in 2.03s]
2020-02-27 17:10:39,391595 (Thread-4): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 17:10:39,392052 (Thread-4): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 17:10:39,392832 (Thread-4): 09:10:39 | 20 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-27 17:10:39,393704 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 17:10:39,394305 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 17:10:39,394542 (Thread-4): Compiling model.journeyengine_recipes.adwords_join
2020-02-27 17:10:39,411758 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 17:10:39,412463 (Thread-4): finished collecting timing info
2020-02-27 17:10:39,419881 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 17:10:39,420346 (Thread-4): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-27 17:10:39,587698 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 17:10:39,589016 (Thread-3): finished collecting timing info
2020-02-27 17:10:39,596150 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 17:10:39,596645 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:39,921954 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:10:39,922965 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:39,923265 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 2b88f51d-26f7-4a93-bfef-9d17b9afaa94)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:10:39,923551 (Thread-3): finished collecting timing info
2020-02-27 17:10:39,924573 (Thread-3): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 2b88f51d-26f7-4a93-bfef-9d17b9afaa94)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 17:10:39,926447 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111643650>]}
2020-02-27 17:10:40,346660 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 17:10:40,347334 (Thread-1): finished collecting timing info
2020-02-27 17:10:40,354926 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 17:10:40,355430 (Thread-1): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:40,626272 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 17:10:40,626661 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 17:10:40,627177 (Thread-1): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 4669d43a-7ebb-4df5-adac-c46df8de8ec9)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:10:40,627605 (Thread-1): finished collecting timing info
2020-02-27 17:10:40,628496 (Thread-1): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 4669d43a-7ebb-4df5-adac-c46df8de8ec9)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 17:10:40,630496 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111452550>]}
2020-02-27 17:10:40,716474 (Thread-2): 09:10:40 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights [ERROR in 1.67s]
2020-02-27 17:10:40,718230 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 17:10:40,718675 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 17:10:40,719184 (Thread-2): 09:10:40 | 21 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 17:10:40,719937 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 17:10:40,720395 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 17:10:40,720565 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 17:10:40,736450 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 17:10:40,736963 (Thread-2): finished collecting timing info
2020-02-27 17:10:40,742826 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 17:10:40,743271 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 17:10:41,954715 (Thread-3): 09:10:41 | 18 of 44 ERROR creating table model agency_data_pipeline.adwords_adplatforms [ERROR in 1.54s]
2020-02-27 17:10:41,955584 (Thread-3): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 17:10:41,956809 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 17:10:41,957300 (Thread-3): 09:10:41 | 22 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 17:10:41,957881 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 17:10:41,958031 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 17:10:41,958191 (Thread-3): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 17:10:41,981964 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:10:43,152326 (Thread-4): finished collecting timing info
2020-02-27 17:10:43,155036 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115ac350>]}
2020-02-27 17:10:43,347786 (Thread-2): finished collecting timing info
2020-02-27 17:10:43,348878 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114b7c50>]}
2020-02-27 17:10:43,392523 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 17:10:43,393221 (Thread-3): finished collecting timing info
2020-02-27 17:10:43,401819 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 17:10:43,402301 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 17:10:43,620976 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]')
2020-02-27 17:10:43,621460 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`




  );
    
2020-02-27 17:10:43,621897 (Thread-3): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 671888a2-808d-47f2-a9c9-01b8d7c77c61)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:10:43,622362 (Thread-3): finished collecting timing info
2020-02-27 17:10:43,623309 (Thread-3): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]

(job ID: 671888a2-808d-47f2-a9c9-01b8d7c77c61)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:  );
  15:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 17:10:43,626012 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11165cc10>]}
2020-02-27 17:10:43,839809 (Thread-1): 09:10:43 | 19 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.64s]
2020-02-27 17:10:43,841487 (Thread-1): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 17:10:43,841862 (Thread-1): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 17:10:43,842334 (Thread-1): 09:10:43 | 23 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 17:10:43,843240 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 17:10:43,843715 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 17:10:43,843892 (Thread-1): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 17:10:43,878139 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 17:10:44,725454 (Thread-4): 09:10:44 | 20 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 3.76s]
2020-02-27 17:10:44,726868 (Thread-4): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 17:10:44,727232 (Thread-4): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 17:10:44,727639 (Thread-4): 09:10:44 | 24 of 44 SKIP relation agency_data_pipeline.fb_ads................... [SKIP]
2020-02-27 17:10:44,728263 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 17:10:44,728810 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 17:10:44,729152 (Thread-4): 09:10:44 | 25 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 17:10:44,729511 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 17:10:44,729715 (Thread-4): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 17:10:44,730048 (Thread-4): 09:10:44 | 26 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-27 17:10:44,730631 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 17:10:44,730819 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-27 17:10:44,731019 (Thread-4): Compiling model.journeyengine_recipes.adwords_stats
2020-02-27 17:10:44,740965 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 17:10:44,741385 (Thread-4): finished collecting timing info
2020-02-27 17:10:44,747101 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 17:10:44,747515 (Thread-4): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-27 17:10:45,314289 (Thread-2): 09:10:45 | 21 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.63s]
2020-02-27 17:10:45,315034 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 17:10:45,315394 (Thread-2): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 17:10:45,316518 (Thread-2): 09:10:45 | 27 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 17:10:45,316882 (Thread-2): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 17:10:45,317372 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 17:10:45,318017 (Thread-2): 09:10:45 | 28 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 17:10:45,318830 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 17:10:45,319011 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 17:10:45,319185 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 17:10:45,331159 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 17:10:45,331728 (Thread-2): finished collecting timing info
2020-02-27 17:10:45,337765 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 17:10:45,338242 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 17:10:45,441482 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 17:10:45,442211 (Thread-1): finished collecting timing info
2020-02-27 17:10:45,449295 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 17:10:45,449750 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 17:10:45,653222 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]')
2020-02-27 17:10:45,653509 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 17:10:45,653702 (Thread-1): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: f230e4a1-09af-4771-811a-02d2ee2f7765)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 17:10:45,653966 (Thread-1): finished collecting timing info
2020-02-27 17:10:45,654769 (Thread-1): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]

(job ID: f230e4a1-09af-4771-811a-02d2ee2f7765)

                                                                  -----Query Job SQL Follows-----                                                                  

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:)
  19:
  20:
  21:SELECT 
  22:bigquery_name,
  23:lookup_platform,
  24:date,
  25:url,
  26:source,
  27:medium,
  28:sum(sessions) sessions,
  29:sum(goal_completions) goal_completions,
  30:sum(mqls) mqls,
  31:sum(subscribers) subscribers,
  32:sum(excluded) excluded,
  33:sum(other) other
  34:FROM ga_report
  35:where lv = _sdc_sequence
  36:group by bigquery_name, lookup_platform, date, url, source, medium
  37:
  38:
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 17:10:45,655760 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113a6f50>]}
2020-02-27 17:10:45,728056 (Thread-3): 09:10:45 | 22 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 1.67s]
2020-02-27 17:10:45,729638 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 17:10:45,729999 (Thread-3): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 17:10:45,730247 (Thread-3): 09:10:45 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 17:10:45,731226 (Thread-3): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 17:10:45,731474 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 17:10:45,732090 (Thread-3): 09:10:45 | 30 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 17:10:45,732611 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 17:10:45,732828 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 17:10:45,733140 (Thread-3): 09:10:45 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 17:10:45,733363 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 17:10:46,541770 (Thread-1): 09:10:46 | 23 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 1.81s]
2020-02-27 17:10:46,542078 (Thread-1): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 17:10:46,542704 (Thread-3): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 17:10:46,542944 (Thread-3): 09:10:46 | 32 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 17:10:46,543146 (Thread-3): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 17:10:48,91165 (Thread-4): finished collecting timing info
2020-02-27 17:10:48,92350 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11145e490>]}
2020-02-27 17:10:48,906199 (Thread-2): finished collecting timing info
2020-02-27 17:10:48,907299 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114ab050>]}
2020-02-27 17:10:49,131667 (Thread-4): 09:10:49 | 26 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 3.36s]
2020-02-27 17:10:49,132369 (Thread-4): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 17:10:49,133985 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 17:10:49,134231 (Thread-1): 09:10:49 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 17:10:49,134434 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 17:10:49,135251 (Thread-4): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 17:10:49,135836 (Thread-4): 09:10:49 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 17:10:49,136248 (Thread-4): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 17:10:49,136688 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 17:10:49,136915 (Thread-1): 09:10:49 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 17:10:49,137186 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 17:10:49,137764 (Thread-4): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 17:10:49,137973 (Thread-3): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 17:10:49,138174 (Thread-4): 09:10:49 | 36 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 17:10:49,138388 (Thread-3): 09:10:49 | 37 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 17:10:49,138656 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 17:10:49,138882 (Thread-3): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 17:10:49,139452 (Thread-1): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 17:10:49,139768 (Thread-1): 09:10:49 | 38 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 17:10:49,139934 (Thread-3): Began running node model.journeyengine_recipes.platform_index
2020-02-27 17:10:49,140204 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 17:10:49,140392 (Thread-3): 09:10:49 | 39 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 17:10:49,140888 (Thread-4): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 17:10:49,141084 (Thread-3): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 17:10:49,141268 (Thread-4): 09:10:49 | 40 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 17:10:49,141742 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 17:10:49,141925 (Thread-1): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 17:10:49,142272 (Thread-1): 09:10:49 | 41 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 17:10:49,142470 (Thread-1): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 17:10:50,734511 (Thread-2): 09:10:50 | 28 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 3.59s]
2020-02-27 17:10:50,734844 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 17:10:50,735616 (Thread-4): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 17:10:50,735863 (Thread-3): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 17:10:50,736085 (Thread-4): 09:10:50 | 42 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 17:10:50,736309 (Thread-3): 09:10:50 | 43 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 17:10:50,736910 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 17:10:50,737341 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 17:10:50,737517 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-27 17:10:50,737704 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 17:10:50,737890 (Thread-4): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 17:10:50,738067 (Thread-3): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 17:10:50,753923 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 17:10:50,759139 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 17:10:50,759586 (Thread-4): finished collecting timing info
2020-02-27 17:10:50,765356 (Thread-3): finished collecting timing info
2020-02-27 17:10:50,765213 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 17:10:50,773116 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 17:10:50,773788 (Thread-4): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 17:10:50,774400 (Thread-3): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 17:10:53,795879 (Thread-4): finished collecting timing info
2020-02-27 17:10:53,799004 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111388210>]}
2020-02-27 17:10:54,50990 (Thread-3): finished collecting timing info
2020-02-27 17:10:54,51886 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11146b6d0>]}
2020-02-27 17:10:54,987965 (Thread-4): 09:10:54 | 42 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 3.06s]
2020-02-27 17:10:54,989472 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 17:10:54,990142 (Thread-2): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 17:10:54,990397 (Thread-2): 09:10:54 | 44 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 17:10:54,991150 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 17:10:54,991628 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 17:10:54,991805 (Thread-2): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 17:10:55,1746 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 17:10:55,2549 (Thread-2): finished collecting timing info
2020-02-27 17:10:55,11232 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 17:10:55,11936 (Thread-2): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 17:10:56,486377 (Thread-3): 09:10:56 | 43 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 3.31s]
2020-02-27 17:10:56,486714 (Thread-3): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 17:10:58,12925 (Thread-2): finished collecting timing info
2020-02-27 17:10:58,13985 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60d564ac-a4f4-40f3-b874-ce8e525103b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111407610>]}
2020-02-27 17:11:02,64870 (Thread-2): 09:11:02 | 44 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 3.02s]
2020-02-27 17:11:02,68142 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 17:11:02,120300 (MainThread): 09:11:02 | 
2020-02-27 17:11:02,120571 (MainThread): 09:11:02 | Finished running 44 table models in 42.87s.
2020-02-27 17:11:02,120731 (MainThread): Connection 'master' was left open.
2020-02-27 17:11:02,120853 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 17:11:02,120971 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 17:11:02,121086 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 17:11:02,121199 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 17:11:02,259995 (MainThread): 
2020-02-27 17:11:02,260253 (MainThread): Completed with 6 errors and 0 warnings:
2020-02-27 17:11:02,260558 (MainThread): 
2020-02-27 17:11:02,260851 (MainThread): Database Error in model fb_adcreative (models/base/fb-ads/fb_adcreative.sql)
2020-02-27 17:11:02,261093 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:11:02,261315 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adcreative.sql
2020-02-27 17:11:02,261542 (MainThread): 
2020-02-27 17:11:02,261773 (MainThread): Database Error in model fb_ads_insights (models/base/fb-ads/fb_ads_insights.sql)
2020-02-27 17:11:02,262003 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:11:02,262199 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights.sql
2020-02-27 17:11:02,262359 (MainThread): 
2020-02-27 17:11:02,262557 (MainThread): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
2020-02-27 17:11:02,262750 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:11:02,262940 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 17:11:02,263148 (MainThread): 
2020-02-27 17:11:02,263360 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 17:11:02,263566 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 17:11:02,263758 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 17:11:02,263963 (MainThread): 
2020-02-27 17:11:02,264183 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 17:11:02,264397 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [14:3]
2020-02-27 17:11:02,264574 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 17:11:02,264755 (MainThread): 
2020-02-27 17:11:02,264945 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 17:11:02,265124 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [18:1]
2020-02-27 17:11:02,265295 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 17:11:02,265521 (MainThread): 
Done. PASS=38 WARN=0 ERROR=6 SKIP=0 TOTAL=44
2020-02-27 17:11:02,265824 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111389f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff6a350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111542b10>]}
2020-02-27 17:11:02,900133 (MainThread): Flushing usage events
2020-02-27 19:23:09,411746 (MainThread): Running with dbt=0.15.2
2020-02-27 19:23:09,747723 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 19:23:09,749027 (MainThread): Tracking: tracking
2020-02-27 19:23:09,761042 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106143ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106143e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106143a50>]}
2020-02-27 19:23:10,216106 (MainThread): Partial parsing not enabled
2020-02-27 19:23:10,219228 (MainThread): Parsing macros/core.sql
2020-02-27 19:23:10,224946 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 19:23:10,234118 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 19:23:10,236829 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 19:23:10,260204 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 19:23:10,286237 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 19:23:10,313753 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 19:23:10,316835 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 19:23:10,325659 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 19:23:10,335486 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 19:23:10,344391 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 19:23:10,355613 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 19:23:10,362771 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 19:23:10,364496 (MainThread): Parsing macros/etc/query.sql
2020-02-27 19:23:10,366225 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 19:23:10,368790 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 19:23:10,371764 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 19:23:10,382297 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 19:23:10,385119 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 19:23:10,422074 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 19:23:10,424773 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 19:23:10,426743 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 19:23:10,429227 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 19:23:10,433968 (MainThread): Parsing macros/etc.sql
2020-02-27 19:23:10,436152 (MainThread): Parsing macros/catalog.sql
2020-02-27 19:23:10,441430 (MainThread): Parsing macros/adapters.sql
2020-02-27 19:23:10,460459 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 19:23:10,461974 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 19:23:10,464896 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 19:23:10,467213 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 19:23:10,479095 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 19:23:10,486423 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 19:23:10,513760 (MainThread): Partial parsing not enabled
2020-02-27 19:23:10,515114 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 19:23:10,521203 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 19:23:10,554359 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 19:23:10,554547 (MainThread): Opening a new connection, currently in state init
2020-02-27 19:23:10,583034 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 19:23:10,583224 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,592162 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 19:23:10,592317 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,600380 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 19:23:10,600534 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,608150 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 19:23:10,608284 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,618375 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 19:23:10,618583 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,635052 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 19:23:10,635242 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,644527 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 19:23:10,644718 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,658280 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 19:23:10,658553 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,671584 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 19:23:10,671757 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,687292 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 19:23:10,687654 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,700511 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 19:23:10,700678 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,712840 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 19:23:10,712988 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,720446 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 19:23:10,720627 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,728295 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 19:23:10,728500 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,735614 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 19:23:10,735737 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,744697 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 19:23:10,744865 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,753444 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 19:23:10,753612 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,761408 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 19:23:10,761555 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,769703 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 19:23:10,769885 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,778895 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 19:23:10,779091 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,787906 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 19:23:10,788086 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,844966 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 19:23:10,845211 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,858490 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 19:23:10,858667 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,867525 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 19:23:10,867729 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,875975 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 19:23:10,876105 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,883154 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 19:23:10,883307 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,889724 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 19:23:10,889841 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,896488 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 19:23:10,896653 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,903690 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 19:23:10,903817 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,911681 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 19:23:10,911890 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,927900 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 19:23:10,928081 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,940267 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 19:23:10,940451 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,948230 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 19:23:10,948349 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,964252 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 19:23:10,964467 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:10,986542 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 19:23:10,986677 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,3238 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 19:23:11,3421 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,18828 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 19:23:11,18975 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,25620 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 19:23:11,25807 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,33135 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 19:23:11,33306 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,42899 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 19:23:11,43025 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,51303 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 19:23:11,51482 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,63560 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 19:23:11,63757 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,72612 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 19:23:11,72774 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:11,341057 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 140 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 19:23:11,366352 (MainThread): 
2020-02-27 19:23:11,366788 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 19:23:11,366920 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:23:12,203984 (MainThread): 11:23:12 | Concurrency: 4 threads (target='dev')
2020-02-27 19:23:12,204228 (MainThread): 11:23:12 | 
2020-02-27 19:23:12,209993 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 19:23:12,210311 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:23:12,210649 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:23:12,210962 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 19:23:12,211253 (Thread-1): 11:23:12 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 19:23:12,211524 (Thread-2): 11:23:12 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 19:23:12,211834 (Thread-3): 11:23:12 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 19:23:12,212131 (Thread-4): 11:23:12 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 19:23:12,212742 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 19:23:12,213308 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 19:23:12,213743 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 19:23:12,214203 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 19:23:12,214353 (Thread-1): Opening a new connection, currently in state init
2020-02-27 19:23:12,214535 (Thread-2): Opening a new connection, currently in state init
2020-02-27 19:23:12,214736 (Thread-3): Opening a new connection, currently in state init
2020-02-27 19:23:12,214904 (Thread-4): Opening a new connection, currently in state init
2020-02-27 19:23:12,215095 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 19:23:12,215269 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:23:12,215439 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:23:12,215609 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 19:23:12,239483 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 19:23:12,244498 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 19:23:12,252589 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 19:23:12,260652 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 19:23:12,261722 (Thread-3): finished collecting timing info
2020-02-27 19:23:12,262049 (Thread-4): finished collecting timing info
2020-02-27 19:23:12,262314 (Thread-2): finished collecting timing info
2020-02-27 19:23:12,268284 (Thread-1): finished collecting timing info
2020-02-27 19:23:13,10077 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 19:23:13,18466 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 19:23:13,21339 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 19:23:13,48243 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 19:23:13,49390 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 19:23:13,51121 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 19:23:13,51290 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 19:23:13,53653 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 19:23:15,777893 (Thread-1): finished collecting timing info
2020-02-27 19:23:15,778960 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107348290>]}
2020-02-27 19:23:15,790128 (Thread-3): finished collecting timing info
2020-02-27 19:23:15,791121 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107353a90>]}
2020-02-27 19:23:16,158725 (Thread-1): 11:23:16 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (7) in 3.57s]
2020-02-27 19:23:16,160263 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 19:23:16,160690 (Thread-1): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 19:23:16,161274 (Thread-1): 11:23:16 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 19:23:16,162573 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 19:23:16,163277 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 19:23:16,163471 (Thread-1): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 19:23:16,172582 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 19:23:16,173365 (Thread-1): finished collecting timing info
2020-02-27 19:23:16,179279 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 19:23:16,179756 (Thread-1): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 19:23:16,345620 (Thread-2): finished collecting timing info
2020-02-27 19:23:16,346455 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072304d0>]}
2020-02-27 19:23:16,531403 (Thread-3): 11:23:16 | 3 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 3.58s]
2020-02-27 19:23:16,532994 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:23:16,533379 (Thread-3): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:23:16,533644 (Thread-3): 11:23:16 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 19:23:16,534301 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 19:23:16,534716 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 19:23:16,535197 (Thread-3): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:23:16,543924 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 19:23:16,544646 (Thread-3): finished collecting timing info
2020-02-27 19:23:16,551993 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 19:23:16,553036 (Thread-3): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 19:23:16,914653 (Thread-2): 11:23:16 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 4.13s]
2020-02-27 19:23:16,914949 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:23:16,915175 (Thread-2): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:23:16,915406 (Thread-2): 11:23:16 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 19:23:16,916325 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 19:23:16,916764 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 19:23:16,916962 (Thread-2): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:23:16,925957 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 19:23:16,926681 (Thread-2): finished collecting timing info
2020-02-27 19:23:16,932946 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 19:23:16,934037 (Thread-2): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 19:23:17,209653 (Thread-4): finished collecting timing info
2020-02-27 19:23:17,210683 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107708810>]}
2020-02-27 19:23:17,586784 (Thread-4): 11:23:17 | 4 of 44 OK created table model agency_data_pipeline.adwords_urls..... [CREATE TABLE (28) in 5.00s]
2020-02-27 19:23:17,587047 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 19:23:17,587263 (Thread-4): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:23:17,587486 (Thread-4): 11:23:17 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 19:23:17,588067 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 19:23:17,588206 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 19:23:17,588458 (Thread-4): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:23:17,597290 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 19:23:17,597921 (Thread-4): finished collecting timing info
2020-02-27 19:23:17,604549 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 19:23:17,605061 (Thread-4): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 19:23:18,328509 (Thread-1): finished collecting timing info
2020-02-27 19:23:18,329566 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f9f90>]}
2020-02-27 19:23:19,11746 (Thread-1): 11:23:19 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 2.17s]
2020-02-27 19:23:19,12123 (Thread-1): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 19:23:19,12387 (Thread-1): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:23:19,12819 (Thread-1): 11:23:19 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 19:23:19,13388 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 19:23:19,13573 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 19:23:19,13767 (Thread-1): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:23:19,23909 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 19:23:19,24496 (Thread-1): finished collecting timing info
2020-02-27 19:23:19,30522 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 19:23:19,30986 (Thread-1): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 19:23:19,110202 (Thread-3): finished collecting timing info
2020-02-27 19:23:19,111255 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f4490>]}
2020-02-27 19:23:19,505778 (Thread-3): 11:23:19 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.58s]
2020-02-27 19:23:19,506059 (Thread-3): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:23:19,506287 (Thread-3): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:23:19,506511 (Thread-3): 11:23:19 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 19:23:19,507073 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 19:23:19,507204 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 19:23:19,507335 (Thread-3): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:23:19,515680 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 19:23:19,517604 (Thread-3): finished collecting timing info
2020-02-27 19:23:19,525161 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 19:23:19,525852 (Thread-3): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 19:23:20,181581 (Thread-4): finished collecting timing info
2020-02-27 19:23:20,182640 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f1710>]}
2020-02-27 19:23:20,548924 (Thread-2): finished collecting timing info
2020-02-27 19:23:20,549971 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10773c1d0>]}
2020-02-27 19:23:20,584027 (Thread-4): 11:23:20 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.59s]
2020-02-27 19:23:20,585754 (Thread-4): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:23:20,586198 (Thread-4): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:23:20,586830 (Thread-4): 11:23:20 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 19:23:20,587438 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 19:23:20,587861 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 19:23:20,588558 (Thread-4): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:23:20,598666 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 19:23:20,599283 (Thread-4): finished collecting timing info
2020-02-27 19:23:20,605776 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 19:23:20,606357 (Thread-4): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 19:23:20,934241 (Thread-1): finished collecting timing info
2020-02-27 19:23:20,935303 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107754350>]}
2020-02-27 19:23:20,970352 (Thread-2): 11:23:20 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 3.63s]
2020-02-27 19:23:20,972918 (Thread-2): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:23:20,973274 (Thread-2): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:23:20,973825 (Thread-2): 11:23:20 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 19:23:20,974906 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 19:23:20,975960 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 19:23:20,976510 (Thread-2): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:23:20,985838 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 19:23:20,986897 (Thread-2): finished collecting timing info
2020-02-27 19:23:20,993054 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 19:23:20,993703 (Thread-2): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 19:23:21,368230 (Thread-1): 11:23:21 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 1.92s]
2020-02-27 19:23:21,368599 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:23:21,368852 (Thread-1): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:23:21,369271 (Thread-1): 11:23:21 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 19:23:21,369734 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 19:23:21,369881 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 19:23:21,370039 (Thread-1): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:23:21,380003 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 19:23:21,380594 (Thread-1): finished collecting timing info
2020-02-27 19:23:21,386634 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 19:23:21,387128 (Thread-1): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 19:23:21,743192 (Thread-3): finished collecting timing info
2020-02-27 19:23:21,744261 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107348290>]}
2020-02-27 19:23:22,111310 (Thread-3): 11:23:22 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.24s]
2020-02-27 19:23:22,111688 (Thread-3): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:23:22,112057 (Thread-3): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 19:23:22,112560 (Thread-3): 11:23:22 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 19:23:22,113047 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 19:23:22,113200 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 19:23:22,113362 (Thread-3): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 19:23:22,127029 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:22,842930 (Thread-4): finished collecting timing info
2020-02-27 19:23:22,844022 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10776d790>]}
2020-02-27 19:23:23,216858 (Thread-4): 11:23:23 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.26s]
2020-02-27 19:23:23,217176 (Thread-4): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:23:23,217408 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:23:23,217829 (Thread-4): 11:23:23 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 19:23:23,218490 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 19:23:23,218652 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 19:23:23,218815 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:23:23,234148 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:23,499150 (Thread-1): finished collecting timing info
2020-02-27 19:23:23,500201 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077dd4d0>]}
2020-02-27 19:23:23,843871 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-27 19:23:23,844159 (Thread-3): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 19:23:23,869996 (Thread-1): 11:23:23 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.13s]
2020-02-27 19:23:23,870355 (Thread-1): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:23:23,870589 (Thread-1): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:23:23,870824 (Thread-1): 11:23:23 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 19:23:23,871490 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 19:23:23,871654 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 19:23:23,871819 (Thread-1): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:23:23,885116 (Thread-1): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:23,994802 (Thread-3): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 19:23:23,995233 (Thread-3): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 19:23:23,997833 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 19:23:23,998382 (Thread-3): finished collecting timing info
2020-02-27 19:23:24,6012 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 19:23:24,6481 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 19:23:24,740336 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:23:24,906773 (Thread-4): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 19:23:24,907417 (Thread-4): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 19:23:24,910222 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 19:23:24,910869 (Thread-4): finished collecting timing info
2020-02-27 19:23:24,917706 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 19:23:24,918173 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 19:23:24,924861 (Thread-2): finished collecting timing info
2020-02-27 19:23:24,926032 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076bfa10>]}
2020-02-27 19:23:25,158086 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 19:23:25,158770 (Thread-1): finished collecting timing info
2020-02-27 19:23:25,166058 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 19:23:25,166499 (Thread-1): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 19:23:25,324961 (Thread-2): 11:23:25 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46649) in 3.95s]
2020-02-27 19:23:25,325263 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:23:25,325494 (Thread-2): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:23:25,325881 (Thread-2): 11:23:25 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 19:23:25,326360 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 19:23:25,326508 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 19:23:25,326667 (Thread-2): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:23:25,342700 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:25,355463 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]')
2020-02-27 19:23:25,355809 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    


  );
    
2020-02-27 19:23:25,356007 (Thread-1): 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 71ec1997-af80-443e-8c9c-31e754fc13c3)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:23:25,356274 (Thread-1): finished collecting timing info
2020-02-27 19:23:25,357087 (Thread-1): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]

(job ID: 71ec1997-af80-443e-8c9c-31e754fc13c3)

                                                                        -----Query Job SQL Follows-----                                                                        

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:  );
  13:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
  Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 19:23:25,370814 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077af110>]}
2020-02-27 19:23:25,756135 (Thread-1): 11:23:25 | 16 of 44 ERROR creating table model agency_data_pipeline.adwords_adplatforms [ERROR in 1.50s]
2020-02-27 19:23:25,756428 (Thread-1): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:23:25,756667 (Thread-1): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 19:23:25,757147 (Thread-1): 11:23:25 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 19:23:25,757641 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 19:23:25,757793 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 19:23:25,757955 (Thread-1): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 19:23:25,769094 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 19:23:25,769619 (Thread-1): finished collecting timing info
2020-02-27 19:23:25,777329 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 19:23:25,778424 (Thread-1): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 19:23:26,923587 (Thread-2): finished collecting timing info
2020-02-27 19:23:26,924339 (Thread-2): Compilation Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  'dbt_utils' is undefined
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 358, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 32, in top-level template code
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 407, in getattr
    value = getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'dbt_utils' is undefined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 155, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 322, in compile
    return compile_node(self.adapter, self.config, self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 234, in compile_node
    node = compiler.compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 136, in compile_node
    node)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 371, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 363, in render_template
    dbt.exceptions.raise_compiler_error(str(e), node)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/exceptions.py", line 363, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  'dbt_utils' is undefined
2020-02-27 19:23:26,929590 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078b5ed0>]}
2020-02-27 19:23:27,303492 (Thread-2): 11:23:27 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.60s]
2020-02-27 19:23:27,303811 (Thread-2): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:23:27,304056 (Thread-2): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 19:23:27,304550 (Thread-2): 11:23:27 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 19:23:27,305203 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 19:23:27,305369 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 19:23:27,305534 (Thread-2): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 19:23:27,315778 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 19:23:27,316288 (Thread-2): finished collecting timing info
2020-02-27 19:23:27,322071 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 19:23:27,322572 (Thread-2): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 19:23:28,7351 (Thread-1): finished collecting timing info
2020-02-27 19:23:28,8400 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107967150>]}
2020-02-27 19:23:28,244954 (Thread-3): finished collecting timing info
2020-02-27 19:23:28,246037 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077a9dd0>]}
2020-02-27 19:23:28,384897 (Thread-1): 11:23:28 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.25s]
2020-02-27 19:23:28,386447 (Thread-1): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 19:23:28,386863 (Thread-1): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 19:23:28,387301 (Thread-1): 11:23:28 | 20 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-27 19:23:28,387917 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 19:23:28,388366 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 19:23:28,388882 (Thread-1): Compiling model.journeyengine_recipes.adwords_join
2020-02-27 19:23:28,400665 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 19:23:28,402157 (Thread-1): finished collecting timing info
2020-02-27 19:23:28,408224 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 19:23:28,408701 (Thread-1): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-27 19:23:28,776842 (Thread-3): 11:23:28 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 6.13s]
2020-02-27 19:23:28,777165 (Thread-3): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 19:23:28,777455 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:23:28,777956 (Thread-3): 11:23:28 | 21 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 19:23:28,778672 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 19:23:28,778833 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 19:23:28,778997 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:23:28,797639 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 19:23:28,798283 (Thread-3): finished collecting timing info
2020-02-27 19:23:28,805280 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 19:23:28,806356 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 19:23:28,835840 (Thread-4): finished collecting timing info
2020-02-27 19:23:28,836671 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078a3750>]}
2020-02-27 19:23:29,213257 (Thread-4): 11:23:29 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 5.62s]
2020-02-27 19:23:29,213621 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:23:29,213853 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 19:23:29,214299 (Thread-4): 11:23:29 | 22 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 19:23:29,214512 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 19:23:29,214720 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:23:29,215137 (Thread-4): 11:23:29 | 23 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 19:23:29,215829 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 19:23:29,215992 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 19:23:29,216152 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:23:29,243221 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:29,593596 (Thread-2): finished collecting timing info
2020-02-27 19:23:29,594668 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107822f50>]}
2020-02-27 19:23:29,977929 (Thread-2): 11:23:29 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.29s]
2020-02-27 19:23:29,978234 (Thread-2): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 19:23:29,978492 (Thread-2): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 19:23:29,979015 (Thread-2): 11:23:29 | 24 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 19:23:29,979747 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 19:23:29,979925 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 19:23:29,980089 (Thread-2): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 19:23:29,995413 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:30,431198 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:30,852621 (Thread-1): finished collecting timing info
2020-02-27 19:23:30,853469 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077436d0>]}
2020-02-27 19:23:31,197251 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 19:23:31,197897 (Thread-2): finished collecting timing info
2020-02-27 19:23:31,205146 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 19:23:31,205601 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 19:23:31,235654 (Thread-1): 11:23:31 | 20 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 2.47s]
2020-02-27 19:23:31,235949 (Thread-1): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 19:23:31,236177 (Thread-1): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 19:23:31,236406 (Thread-1): 11:23:31 | 25 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 19:23:31,236787 (Thread-1): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 19:23:31,237138 (Thread-1): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 19:23:31,237517 (Thread-1): 11:23:31 | 26 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 19:23:31,238114 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 19:23:31,238260 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-27 19:23:31,238415 (Thread-1): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 19:23:31,271892 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:31,349173 (Thread-3): finished collecting timing info
2020-02-27 19:23:31,350250 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077a9dd0>]}
2020-02-27 19:23:31,740162 (Thread-3): 11:23:31 | 21 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.57s]
2020-02-27 19:23:31,740454 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:23:31,740686 (Thread-3): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 19:23:31,740915 (Thread-3): 11:23:31 | 27 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-27 19:23:31,741553 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 19:23:31,741840 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 19:23:31,742031 (Thread-3): Compiling model.journeyengine_recipes.adwords_stats
2020-02-27 19:23:31,752906 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 19:23:31,753419 (Thread-3): finished collecting timing info
2020-02-27 19:23:31,759415 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 19:23:31,759916 (Thread-3): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-27 19:23:31,912737 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:23:32,96382 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 19:23:32,96943 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 19:23:32,97320 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:23:32,258505 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 19:23:32,259182 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 19:23:32,262779 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 19:23:32,265890 (Thread-4): finished collecting timing info
2020-02-27 19:23:32,274326 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 19:23:32,275660 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 19:23:32,797273 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/f572b143-62b5-4c2b-8cc2-997f5adce0eb?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 19:23:32,824629 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 19:23:32,824891 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/f572b143-62b5-4c2b-8cc2-997f5adce0eb?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: f572b143-62b5-4c2b-8cc2-997f5adce0eb)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:23:32,825130 (Thread-4): finished collecting timing info
2020-02-27 19:23:32,825844 (Thread-4): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/f572b143-62b5-4c2b-8cc2-997f5adce0eb?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: f572b143-62b5-4c2b-8cc2-997f5adce0eb)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 19:23:32,830824 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10779dc50>]}
2020-02-27 19:23:32,939087 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:33,204934 (Thread-4): 11:23:33 | 23 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.62s]
2020-02-27 19:23:33,205229 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:23:33,205522 (Thread-4): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 19:23:33,206084 (Thread-4): 11:23:33 | 28 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 19:23:33,206294 (Thread-4): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 19:23:33,206499 (Thread-4): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:23:33,206853 (Thread-4): 11:23:33 | 29 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 19:23:33,207459 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 19:23:33,207631 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 19:23:33,207800 (Thread-4): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:23:33,219941 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 19:23:33,220425 (Thread-4): finished collecting timing info
2020-02-27 19:23:33,227853 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 19:23:33,228369 (Thread-4): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 19:23:33,658468 (Thread-2): finished collecting timing info
2020-02-27 19:23:33,659755 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10778d0d0>]}
2020-02-27 19:23:34,33818 (Thread-2): 11:23:34 | 24 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.68s]
2020-02-27 19:23:34,34110 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 19:23:34,34336 (Thread-2): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 19:23:34,34563 (Thread-2): 11:23:34 | 30 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 19:23:34,34942 (Thread-2): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 19:23:34,35374 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 19:23:34,35609 (Thread-2): 11:23:34 | 31 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 19:23:34,35811 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 19:23:34,503778 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:35,432797 (Thread-3): finished collecting timing info
2020-02-27 19:23:35,434642 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079e4f90>]}
2020-02-27 19:23:35,437565 (Thread-4): finished collecting timing info
2020-02-27 19:23:35,439629 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107956890>]}
2020-02-27 19:23:35,806988 (Thread-3): 11:23:35 | 27 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 3.69s]
2020-02-27 19:23:35,807809 (Thread-3): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 19:23:35,809470 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 19:23:35,809745 (Thread-2): 11:23:35 | 32 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 19:23:35,809952 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 19:23:35,810996 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 19:23:35,811240 (Thread-3): 11:23:35 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 19:23:35,811630 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 19:23:35,910673 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:36,173660 (Thread-4): 11:23:36 | 29 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.23s]
2020-02-27 19:23:36,173998 (Thread-4): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:23:36,174626 (Thread-2): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:23:36,174832 (Thread-3): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 19:23:36,175080 (Thread-2): 11:23:36 | 34 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 19:23:36,175331 (Thread-3): 11:23:36 | 35 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 19:23:36,175873 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 19:23:36,176451 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 19:23:36,176620 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-27 19:23:36,176777 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-27 19:23:36,176946 (Thread-2): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:23:36,177143 (Thread-3): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 19:23:36,187998 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 19:23:36,196394 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 19:23:36,199781 (Thread-2): finished collecting timing info
2020-02-27 19:23:36,200196 (Thread-3): finished collecting timing info
2020-02-27 19:23:36,206443 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 19:23:36,214478 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 19:23:36,216773 (Thread-3): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 19:23:36,216980 (Thread-2): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 19:23:37,340060 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:23:38,371695 (Thread-3): finished collecting timing info
2020-02-27 19:23:38,372734 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aa19d0>]}
2020-02-27 19:23:38,590795 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 19:23:38,593731 (Thread-1): finished collecting timing info
2020-02-27 19:23:38,601508 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 19:23:38,602673 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 19:23:38,619090 (Thread-2): finished collecting timing info
2020-02-27 19:23:38,619935 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ab47d0>]}
2020-02-27 19:23:38,738860 (Thread-3): 11:23:38 | 35 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.20s]
2020-02-27 19:23:38,740416 (Thread-3): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 19:23:39,86436 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/4c4f26b0-60fc-4239-a8ea-2562ffeae1d6?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 19:23:39,86680 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 19:23:39,86850 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/4c4f26b0-60fc-4239-a8ea-2562ffeae1d6?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 4c4f26b0-60fc-4239-a8ea-2562ffeae1d6)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal13completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal16completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal10completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal17completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal5completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:23:39,87080 (Thread-1): finished collecting timing info
2020-02-27 19:23:39,87768 (Thread-1): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/4c4f26b0-60fc-4239-a8ea-2562ffeae1d6?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 4c4f26b0-60fc-4239-a8ea-2562ffeae1d6)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal13completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal16completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal10completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal17completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal5completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 19:23:39,88889 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079bbb50>]}
2020-02-27 19:23:39,110480 (Thread-2): 11:23:39 | 34 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.44s]
2020-02-27 19:23:39,111068 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:23:39,112410 (Thread-4): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 19:23:39,112624 (Thread-4): 11:23:39 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 19:23:39,113028 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 19:23:39,113371 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 19:23:39,113814 (Thread-4): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 19:23:39,123177 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 19:23:39,126486 (Thread-4): finished collecting timing info
2020-02-27 19:23:39,134947 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 19:23:39,135581 (Thread-4): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 19:23:39,499261 (Thread-1): 11:23:39 | 26 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 7.85s]
2020-02-27 19:23:39,499622 (Thread-1): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 19:23:39,500398 (Thread-2): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 19:23:39,500704 (Thread-2): 11:23:39 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 19:23:39,500954 (Thread-2): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 19:23:39,501493 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 19:23:39,501777 (Thread-1): 11:23:39 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 19:23:39,501976 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 19:23:39,502445 (Thread-2): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 19:23:39,502655 (Thread-3): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 19:23:39,502855 (Thread-2): 11:23:39 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 19:23:39,503080 (Thread-3): 11:23:39 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 19:23:39,503372 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 19:23:39,503649 (Thread-3): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 19:23:39,504182 (Thread-1): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 19:23:39,504490 (Thread-1): 11:23:39 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 19:23:39,504701 (Thread-3): Began running node model.journeyengine_recipes.platform_index
2020-02-27 19:23:39,504900 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 19:23:39,505085 (Thread-3): 11:23:39 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 19:23:39,505553 (Thread-2): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 19:23:39,505750 (Thread-3): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 19:23:39,505930 (Thread-2): 11:23:39 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 19:23:39,506393 (Thread-1): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 19:23:39,506587 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 19:23:39,506773 (Thread-1): 11:23:39 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 19:23:39,507133 (Thread-1): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 19:23:41,627625 (Thread-4): finished collecting timing info
2020-02-27 19:23:41,628670 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '780cac4d-b2b8-4c10-acaa-db1f71fc2213', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107967950>]}
2020-02-27 19:23:42,1191 (Thread-4): 11:23:42 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.52s]
2020-02-27 19:23:42,1485 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 19:23:42,9455 (MainThread): 11:23:42 | 
2020-02-27 19:23:42,9745 (MainThread): 11:23:42 | Finished running 44 table models in 30.64s.
2020-02-27 19:23:42,9930 (MainThread): Connection 'master' was left open.
2020-02-27 19:23:42,10070 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 19:23:42,10205 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 19:23:42,10336 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 19:23:42,10466 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 19:23:42,123552 (MainThread): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51678), raddr=('172.217.5.202', 443)>
2020-02-27 19:23:42,124013 (MainThread): unclosed <socket.socket fd=9, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51675), raddr=('172.217.5.74', 443)>
2020-02-27 19:23:42,124473 (MainThread): unclosed <socket.socket fd=16, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51692), raddr=('172.217.5.202', 443)>
2020-02-27 19:23:42,124677 (MainThread): unclosed <socket.socket fd=17, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51693), raddr=('172.217.5.202', 443)>
2020-02-27 19:23:42,124913 (MainThread): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51687), raddr=('172.217.5.74', 443)>
2020-02-27 19:23:42,125077 (MainThread): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51688), raddr=('172.217.5.74', 443)>
2020-02-27 19:23:42,125242 (MainThread): unclosed <socket.socket fd=15, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51691), raddr=('172.217.5.202', 443)>
2020-02-27 19:23:42,125398 (MainThread): unclosed <socket.socket fd=18, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51694), raddr=('172.217.5.202', 443)>
2020-02-27 19:23:42,125612 (MainThread): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51686), raddr=('172.217.5.74', 443)>
2020-02-27 19:23:42,125765 (MainThread): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('172.20.32.147', 51689), raddr=('172.217.5.74', 443)>
2020-02-27 19:23:42,204118 (MainThread): 
2020-02-27 19:23:42,204354 (MainThread): Completed with 4 errors and 0 warnings:
2020-02-27 19:23:42,204522 (MainThread): 
2020-02-27 19:23:42,204686 (MainThread): Database Error in model adwords_adplatforms (models/base/adwords/adwords_adplatforms.sql)
2020-02-27 19:23:42,204837 (MainThread):   Syntax error: Expected "(" or keyword SELECT or keyword WITH but got ")" at [12:3]
2020-02-27 19:23:42,204980 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_adplatforms.sql
2020-02-27 19:23:42,205127 (MainThread): 
2020-02-27 19:23:42,205280 (MainThread): Compilation Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 19:23:42,205424 (MainThread):   'dbt_utils' is undefined
2020-02-27 19:23:42,205567 (MainThread): 
2020-02-27 19:23:42,205717 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 19:23:42,205858 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 19:23:42,205992 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 19:23:42,206132 (MainThread): 
2020-02-27 19:23:42,206283 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 19:23:42,206423 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 19:23:42,206556 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 19:23:42,206733 (MainThread): 
Done. PASS=40 WARN=0 ERROR=4 SKIP=0 TOTAL=44
2020-02-27 19:23:42,206963 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107af8790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107abe150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10773d990>]}
2020-02-27 19:23:42,580567 (MainThread): Flushing usage events
2020-02-27 19:28:47,416463 (MainThread): Running with dbt=0.15.2
2020-02-27 19:28:47,458055 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.deps.DepsTask'>, debug=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='deps', single_threaded=False, strict=False, target=None, test_new_parser=False, use_cache=True, vars='{}', warn_error=False, which='deps', write_json=True)
2020-02-27 19:28:47,458975 (MainThread): Tracking: tracking
2020-02-27 19:28:47,469715 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b261d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b347d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b26450>]}
2020-02-27 19:28:47,874877 (MainThread): Warning: No packages were found in packages.yml
2020-02-27 19:28:47,877383 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ba1110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ba1190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ba1810>]}
2020-02-27 19:28:48,247736 (MainThread): Flushing usage events
2020-02-27 19:33:13,334189 (MainThread): Running with dbt=0.15.2
2020-02-27 19:33:13,390615 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.deps.DepsTask'>, debug=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='deps', single_threaded=False, strict=False, target=None, test_new_parser=False, use_cache=True, vars='{}', warn_error=False, which='deps', write_json=True)
2020-02-27 19:33:13,391568 (MainThread): Tracking: tracking
2020-02-27 19:33:13,401702 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0696d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a069910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a065450>]}
2020-02-27 19:33:13,822315 (MainThread): Set downloads directory='/var/folders/_l/j_nh44291kxd9wpzkm_vpzm80000gn/T/dbt-downloads-rw835u6u'
2020-02-27 19:33:13,823683 (MainThread): Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3,and in 3.9 it will stop working
2020-02-27 19:33:13,823869 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/index.json
2020-02-27 19:33:13,986228 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/index.json 200
2020-02-27 19:33:13,986655 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2020-02-27 19:33:14,111318 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2020-02-27 19:33:14,126901 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.2.4.json
2020-02-27 19:33:14,252004 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.2.4.json 200
2020-02-27 19:33:14,259426 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2020-02-27 19:33:14,388204 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2020-02-27 19:33:14,405478 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.2.4.json
2020-02-27 19:33:14,529701 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.2.4.json 200
2020-02-27 19:33:14,530757 (MainThread): Installing fishtown-analytics/dbt_utils@0.2.4
2020-02-27 19:33:15,66337 (MainThread):   Installed from version 0.2.4

2020-02-27 19:33:15,66705 (MainThread): Sending event: {'category': 'dbt', 'action': 'package', 'label': '11e60924-b4fa-4679-a183-2664794720a5', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091d50d0>]}
2020-02-27 19:33:15,435062 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10821d710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10819a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098a3890>]}
2020-02-27 19:33:15,809826 (MainThread): Flushing usage events
2020-02-27 19:43:03,661790 (MainThread): Running with dbt=0.15.2
2020-02-27 19:43:03,974338 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 19:43:03,975304 (MainThread): Tracking: tracking
2020-02-27 19:43:03,985371 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fbcf5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fbcfb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fbcf510>]}
2020-02-27 19:43:04,426188 (MainThread): Partial parsing not enabled
2020-02-27 19:43:04,429972 (MainThread): Parsing macros/core.sql
2020-02-27 19:43:04,435840 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 19:43:04,445261 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 19:43:04,447786 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 19:43:04,472211 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 19:43:04,499434 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 19:43:04,527815 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 19:43:04,531341 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 19:43:04,540293 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 19:43:04,550015 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 19:43:04,558796 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 19:43:04,566779 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 19:43:04,576303 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 19:43:04,578024 (MainThread): Parsing macros/etc/query.sql
2020-02-27 19:43:04,579789 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 19:43:04,582328 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 19:43:04,585390 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 19:43:04,596407 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 19:43:04,599206 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 19:43:04,638185 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 19:43:04,640120 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 19:43:04,641628 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 19:43:04,643367 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 19:43:04,646796 (MainThread): Parsing macros/etc.sql
2020-02-27 19:43:04,648494 (MainThread): Parsing macros/catalog.sql
2020-02-27 19:43:04,653286 (MainThread): Parsing macros/adapters.sql
2020-02-27 19:43:04,672551 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 19:43:04,674127 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 19:43:04,677751 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 19:43:04,680071 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 19:43:04,692137 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 19:43:04,699435 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 19:43:04,744045 (MainThread): Partial parsing not enabled
2020-02-27 19:43:04,745902 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 19:43:04,752011 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 19:43:04,758751 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-27 19:43:04,760578 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-27 19:43:04,762834 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-27 19:43:04,766138 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-27 19:43:04,768171 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-27 19:43:04,775116 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-27 19:43:04,777690 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-27 19:43:04,779958 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-27 19:43:04,783688 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-27 19:43:04,785679 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-27 19:43:04,788979 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-27 19:43:04,792481 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-27 19:43:04,795715 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-27 19:43:04,798331 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-27 19:43:04,800924 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-27 19:43:04,802651 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-27 19:43:04,807018 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-27 19:43:04,813307 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-27 19:43:04,817316 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-27 19:43:04,819965 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-27 19:43:04,822446 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-27 19:43:04,847591 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-27 19:43:04,848889 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-27 19:43:04,850366 (MainThread): Parsing macros/logger/log_info.sql
2020-02-27 19:43:04,851801 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-27 19:43:04,856547 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-27 19:43:04,858870 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-27 19:43:04,862263 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-27 19:43:04,864451 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-27 19:43:04,866532 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-27 19:43:04,868591 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-27 19:43:04,871477 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-27 19:43:04,873856 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-27 19:43:04,875474 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-27 19:43:04,877220 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-27 19:43:04,879232 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-27 19:43:04,881729 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-27 19:43:04,884154 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-27 19:43:04,888562 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-27 19:43:04,893796 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-27 19:43:04,895668 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-27 19:43:04,900471 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-27 19:43:04,905908 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-27 19:43:04,909537 (MainThread): Parsing macros/sql/star.sql
2020-02-27 19:43:04,913735 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-27 19:43:04,922281 (MainThread): Parsing macros/sql/union.sql
2020-02-27 19:43:04,934852 (MainThread): Parsing macros/sql/groupby.sql
2020-02-27 19:43:04,936629 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-27 19:43:04,939451 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-27 19:43:04,941841 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-27 19:43:04,947964 (MainThread): Parsing macros/sql/pivot.sql
2020-02-27 19:43:04,952254 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-27 19:43:04,981385 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 19:43:04,981561 (MainThread): Opening a new connection, currently in state init
2020-02-27 19:43:05,12066 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 19:43:05,12262 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,21701 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 19:43:05,21892 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,30495 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 19:43:05,30621 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,38799 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 19:43:05,38929 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,48274 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 19:43:05,48421 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,61495 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 19:43:05,61727 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,72989 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 19:43:05,73198 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,86894 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 19:43:05,87105 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,97920 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 19:43:05,98119 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,112431 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 19:43:05,112565 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,123261 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 19:43:05,123446 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,136555 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 19:43:05,136721 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,144200 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 19:43:05,144391 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,152023 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 19:43:05,152182 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,159677 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 19:43:05,159801 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,168374 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 19:43:05,168509 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,177670 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 19:43:05,177847 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,186624 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 19:43:05,186752 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,196297 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 19:43:05,196474 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,205456 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 19:43:05,205652 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,214497 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 19:43:05,214627 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,269392 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 19:43:05,269583 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,280900 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 19:43:05,281030 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,291929 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 19:43:05,292159 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,300615 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 19:43:05,300756 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,347486 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 19:43:05,347694 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,355298 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 19:43:05,355424 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,362989 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 19:43:05,363171 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,370843 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 19:43:05,371003 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,378781 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 19:43:05,378934 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,393238 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 19:43:05,393381 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,408170 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 19:43:05,408390 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,417721 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 19:43:05,417901 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,432147 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 19:43:05,432320 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,457379 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 19:43:05,457595 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,471096 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 19:43:05,471232 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,487445 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 19:43:05,487635 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,495778 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 19:43:05,495914 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,502709 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 19:43:05,502828 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,515235 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 19:43:05,515379 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,523346 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 19:43:05,523477 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,534742 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 19:43:05,534875 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,541713 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 19:43:05,541839 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:05,829652 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 19:43:05,860730 (MainThread): 
2020-02-27 19:43:05,861282 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 19:43:05,861457 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:43:06,774809 (MainThread): 11:43:06 | Concurrency: 4 threads (target='dev')
2020-02-27 19:43:06,775110 (MainThread): 11:43:06 | 
2020-02-27 19:43:06,778576 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 19:43:06,778822 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:43:06,779048 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:43:06,779274 (Thread-1): 11:43:06 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 19:43:06,779434 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 19:43:06,779660 (Thread-2): 11:43:06 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 19:43:06,779867 (Thread-3): 11:43:06 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 19:43:06,780144 (Thread-4): 11:43:06 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 19:43:06,780500 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 19:43:06,780947 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 19:43:06,781406 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 19:43:06,781574 (Thread-1): Opening a new connection, currently in state init
2020-02-27 19:43:06,781868 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 19:43:06,782044 (Thread-2): Opening a new connection, currently in state init
2020-02-27 19:43:06,782196 (Thread-3): Opening a new connection, currently in state init
2020-02-27 19:43:06,782362 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 19:43:06,782503 (Thread-4): Opening a new connection, currently in state init
2020-02-27 19:43:06,782658 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:43:06,782809 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:43:06,800303 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 19:43:06,800423 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 19:43:06,809757 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 19:43:06,818601 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 19:43:06,827774 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 19:43:06,828239 (Thread-1): finished collecting timing info
2020-02-27 19:43:06,840243 (Thread-2): finished collecting timing info
2020-02-27 19:43:06,881633 (Thread-3): finished collecting timing info
2020-02-27 19:43:06,928237 (Thread-4): finished collecting timing info
2020-02-27 19:43:07,565745 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 19:43:07,566621 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 19:43:07,567782 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 19:43:07,568809 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 19:43:07,572387 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 19:43:07,572824 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 19:43:07,574360 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 19:43:07,575125 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 19:43:08,320659 (Thread-3): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 19:43:08,320914 (Thread-3): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 19:43:08,321066 (Thread-3): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: b8c6fe97-6ace-4f14-9976-bfb15b443553)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:08,321313 (Thread-3): finished collecting timing info
2020-02-27 19:43:08,332674 (Thread-4): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 19:43:08,332965 (Thread-4): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 19:43:08,333224 (Thread-4): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 5f02f2aa-ddb0-47d2-b4f4-589364b078cb)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:08,333470 (Thread-4): finished collecting timing info
2020-02-27 19:43:08,322085 (Thread-3): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: b8c6fe97-6ace-4f14-9976-bfb15b443553)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: b8c6fe97-6ace-4f14-9976-bfb15b443553)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: b8c6fe97-6ace-4f14-9976-bfb15b443553)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:08,334162 (Thread-4): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 5f02f2aa-ddb0-47d2-b4f4-589364b078cb)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 5f02f2aa-ddb0-47d2-b4f4-589364b078cb)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 5f02f2aa-ddb0-47d2-b4f4-589364b078cb)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:08,340607 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11138b650>]}
2020-02-27 19:43:08,340956 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114afa90>]}
2020-02-27 19:43:08,707965 (Thread-3): 11:43:08 | 3 of 44 ERROR creating table model agency_data_pipeline.adwords_campaigns [ERROR in 1.56s]
2020-02-27 19:43:08,709410 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:43:08,709796 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 19:43:08,710342 (Thread-3): 11:43:08 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 19:43:08,711135 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 19:43:08,711615 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 19:43:08,711810 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 19:43:08,722713 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 19:43:08,723341 (Thread-3): finished collecting timing info
2020-02-27 19:43:08,729838 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 19:43:08,730309 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 19:43:09,98334 (Thread-4): 11:43:09 | 4 of 44 ERROR creating table model agency_data_pipeline.adwords_urls. [ERROR in 1.56s]
2020-02-27 19:43:09,98628 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 19:43:09,98859 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:43:09,99526 (Thread-4): 11:43:09 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 19:43:09,100061 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 19:43:09,100236 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 19:43:09,100399 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:43:09,110426 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 19:43:09,110992 (Thread-4): finished collecting timing info
2020-02-27 19:43:09,117468 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 19:43:09,117899 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 19:43:10,269718 (Thread-1): finished collecting timing info
2020-02-27 19:43:10,271080 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdd9110>]}
2020-02-27 19:43:10,647866 (Thread-1): 11:43:10 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.49s]
2020-02-27 19:43:10,648209 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 19:43:10,648442 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:43:10,648884 (Thread-1): 11:43:10 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 19:43:10,649699 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 19:43:10,649861 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 19:43:10,650024 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:43:10,660545 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 19:43:10,661066 (Thread-1): finished collecting timing info
2020-02-27 19:43:10,667583 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 19:43:10,668124 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 19:43:10,969692 (Thread-3): finished collecting timing info
2020-02-27 19:43:10,970772 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd90550>]}
2020-02-27 19:43:11,342116 (Thread-3): 11:43:11 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 2.26s]
2020-02-27 19:43:11,342415 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 19:43:11,342718 (Thread-3): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:43:11,343129 (Thread-3): 11:43:11 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 19:43:11,343606 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 19:43:11,343753 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 19:43:11,343910 (Thread-3): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:43:11,354565 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 19:43:11,355082 (Thread-3): finished collecting timing info
2020-02-27 19:43:11,361473 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 19:43:11,362460 (Thread-3): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 19:43:11,421446 (Thread-2): finished collecting timing info
2020-02-27 19:43:11,422529 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdc40d0>]}
2020-02-27 19:43:11,664202 (Thread-4): finished collecting timing info
2020-02-27 19:43:11,665263 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111440bd0>]}
2020-02-27 19:43:11,789722 (Thread-2): 11:43:11 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 4.64s]
2020-02-27 19:43:11,791233 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:43:11,791501 (Thread-2): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:43:11,792019 (Thread-2): 11:43:11 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 19:43:11,792777 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 19:43:11,793209 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 19:43:11,793694 (Thread-2): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:43:11,803117 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 19:43:11,803879 (Thread-2): finished collecting timing info
2020-02-27 19:43:11,810339 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 19:43:11,810919 (Thread-2): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 19:43:12,175203 (Thread-4): 11:43:12 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.57s]
2020-02-27 19:43:12,175449 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:43:12,175718 (Thread-4): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:43:12,176063 (Thread-4): 11:43:12 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 19:43:12,176623 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 19:43:12,176759 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 19:43:12,176888 (Thread-4): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:43:12,185670 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 19:43:12,186136 (Thread-4): finished collecting timing info
2020-02-27 19:43:12,192469 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 19:43:12,192918 (Thread-4): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 19:43:12,893119 (Thread-1): finished collecting timing info
2020-02-27 19:43:12,894356 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11136b2d0>]}
2020-02-27 19:43:13,222785 (Thread-3): finished collecting timing info
2020-02-27 19:43:13,223858 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113b1550>]}
2020-02-27 19:43:13,273529 (Thread-1): 11:43:13 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.24s]
2020-02-27 19:43:13,275149 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:43:13,275606 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:43:13,276069 (Thread-1): 11:43:13 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 19:43:13,276900 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 19:43:13,277473 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 19:43:13,277653 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:43:13,290133 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 19:43:13,290871 (Thread-1): finished collecting timing info
2020-02-27 19:43:13,298599 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 19:43:13,299081 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 19:43:13,654361 (Thread-3): 11:43:13 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 1.88s]
2020-02-27 19:43:13,654769 (Thread-3): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:43:13,655024 (Thread-3): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:43:13,655411 (Thread-3): 11:43:13 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 19:43:13,655898 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 19:43:13,656047 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 19:43:13,656205 (Thread-3): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:43:13,665726 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 19:43:13,666220 (Thread-3): finished collecting timing info
2020-02-27 19:43:13,673088 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 19:43:13,673786 (Thread-3): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 19:43:13,925829 (Thread-2): finished collecting timing info
2020-02-27 19:43:13,927236 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdd9090>]}
2020-02-27 19:43:14,56343 (Thread-4): finished collecting timing info
2020-02-27 19:43:14,57413 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe0b650>]}
2020-02-27 19:43:14,293199 (Thread-2): 11:43:14 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.13s]
2020-02-27 19:43:14,294840 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:43:14,295238 (Thread-2): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:43:14,295498 (Thread-2): 11:43:14 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 19:43:14,296142 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 19:43:14,296567 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 19:43:14,297043 (Thread-2): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:43:14,306846 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 19:43:14,307333 (Thread-2): finished collecting timing info
2020-02-27 19:43:14,313824 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 19:43:14,314282 (Thread-2): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 19:43:14,695328 (Thread-4): 11:43:14 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 1.88s]
2020-02-27 19:43:14,695622 (Thread-4): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:43:14,695853 (Thread-4): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 19:43:14,696089 (Thread-4): 11:43:14 | 14 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 19:43:14,696449 (Thread-4): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 19:43:14,696679 (Thread-4): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 19:43:14,697034 (Thread-4): 11:43:14 | 15 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 19:43:14,697646 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 19:43:14,697833 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 19:43:14,697997 (Thread-4): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 19:43:14,712472 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:15,415218 (Thread-1): finished collecting timing info
2020-02-27 19:43:15,416303 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10edb7090>]}
2020-02-27 19:43:15,828397 (Thread-1): 11:43:15 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.14s]
2020-02-27 19:43:15,828673 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:43:15,828893 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:43:15,829115 (Thread-1): 11:43:15 | 16 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 19:43:15,829812 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 19:43:15,829955 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 19:43:15,830099 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:43:15,845067 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:16,172432 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:43:16,173535 (Thread-4): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 19:43:16,359866 (Thread-4): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 19:43:16,360366 (Thread-4): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 19:43:16,363227 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 19:43:16,367351 (Thread-3): finished collecting timing info
2020-02-27 19:43:16,368334 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114d4f50>]}
2020-02-27 19:43:16,369101 (Thread-4): finished collecting timing info
2020-02-27 19:43:16,378621 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 19:43:16,380142 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 19:43:16,516190 (Thread-2): finished collecting timing info
2020-02-27 19:43:16,517260 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111440c10>]}
2020-02-27 19:43:16,741713 (Thread-3): 11:43:16 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46649) in 2.71s]
2020-02-27 19:43:16,742996 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:43:16,743335 (Thread-3): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:43:16,743741 (Thread-3): 11:43:16 | 17 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 19:43:16,744171 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 19:43:16,744507 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 19:43:16,744646 (Thread-3): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:43:16,756793 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:17,124768 (Thread-2): 11:43:17 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.22s]
2020-02-27 19:43:17,125063 (Thread-2): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:43:17,125296 (Thread-2): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:43:17,125680 (Thread-2): 11:43:17 | 18 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 19:43:17,126165 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 19:43:17,126313 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 19:43:17,126507 (Thread-2): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:43:17,142486 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:17,302341 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-27 19:43:17,470778 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 19:43:17,471470 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 19:43:17,474695 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 19:43:17,475283 (Thread-1): finished collecting timing info
2020-02-27 19:43:17,484796 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 19:43:17,485375 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 19:43:18,225402 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 19:43:18,228823 (Thread-3): finished collecting timing info
2020-02-27 19:43:18,237007 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 19:43:18,237527 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-27 19:43:18,455536 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 19:43:18,644884 (Thread-2): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 19:43:18,645597 (Thread-2): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 19:43:18,652674 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 19:43:18,653281 (Thread-2): finished collecting timing info
2020-02-27 19:43:18,660591 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 19:43:18,661080 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 19:43:18,852077 (Thread-4): finished collecting timing info
2020-02-27 19:43:18,853320 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111587750>]}
2020-02-27 19:43:19,152842 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/e97a4a1b-3e4c-4450-b754-147d2ddc49d5?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-27 19:43:19,153148 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 19:43:19,153354 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/e97a4a1b-3e4c-4450-b754-147d2ddc49d5?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: e97a4a1b-3e4c-4450-b754-147d2ddc49d5)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:19,153646 (Thread-2): finished collecting timing info
2020-02-27 19:43:19,154328 (Thread-2): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/e97a4a1b-3e4c-4450-b754-147d2ddc49d5?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: e97a4a1b-3e4c-4450-b754-147d2ddc49d5)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 19:43:19,161193 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115df2d0>]}
2020-02-27 19:43:19,233870 (Thread-4): 11:43:19 | 15 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.16s]
2020-02-27 19:43:19,235456 (Thread-4): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 19:43:19,235832 (Thread-4): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 19:43:19,236246 (Thread-4): 11:43:19 | 19 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 19:43:19,237197 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 19:43:19,237669 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 19:43:19,237855 (Thread-4): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 19:43:19,248955 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 19:43:19,249555 (Thread-4): finished collecting timing info
2020-02-27 19:43:19,255872 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 19:43:19,256354 (Thread-4): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 19:43:19,630814 (Thread-2): 11:43:19 | 18 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.04s]
2020-02-27 19:43:19,631200 (Thread-2): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:43:19,631496 (Thread-2): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 19:43:19,631954 (Thread-2): 11:43:19 | 20 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 19:43:19,632431 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 19:43:19,632580 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 19:43:19,632738 (Thread-2): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 19:43:19,645880 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 19:43:19,646449 (Thread-2): finished collecting timing info
2020-02-27 19:43:19,654079 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 19:43:19,654535 (Thread-2): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 19:43:20,816942 (Thread-1): finished collecting timing info
2020-02-27 19:43:20,818001 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11166a190>]}
2020-02-27 19:43:20,955615 (Thread-3): finished collecting timing info
2020-02-27 19:43:20,956675 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114ac950>]}
2020-02-27 19:43:21,174684 (Thread-4): finished collecting timing info
2020-02-27 19:43:21,175759 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114fc1d0>]}
2020-02-27 19:43:21,189069 (Thread-1): 11:43:21 | 16 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.99s]
2020-02-27 19:43:21,190912 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:43:21,191386 (Thread-1): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 19:43:21,191855 (Thread-1): 11:43:21 | 21 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 19:43:21,192530 (Thread-1): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 19:43:21,193089 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:43:21,193625 (Thread-1): 11:43:21 | 22 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 19:43:21,194117 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 19:43:21,194266 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 19:43:21,194436 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:43:21,213168 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 19:43:21,213897 (Thread-1): finished collecting timing info
2020-02-27 19:43:21,222669 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 19:43:21,223162 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 19:43:21,585919 (Thread-3): 11:43:21 | 17 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 4.21s]
2020-02-27 19:43:21,587442 (Thread-3): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:43:21,587811 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 19:43:21,588079 (Thread-3): 11:43:21 | 23 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 19:43:21,588836 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 19:43:21,589268 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 19:43:21,589740 (Thread-3): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 19:43:21,605760 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:21,979108 (Thread-4): 11:43:21 | 19 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 1.94s]
2020-02-27 19:43:21,979417 (Thread-4): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 19:43:21,979653 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 19:43:21,980075 (Thread-4): 11:43:21 | 24 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 19:43:21,980459 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 19:43:21,980696 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:43:21,981012 (Thread-4): 11:43:21 | 25 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 19:43:21,981638 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 19:43:21,981796 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 19:43:21,981953 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:43:22,5271 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:22,50799 (Thread-2): finished collecting timing info
2020-02-27 19:43:22,51856 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd903d0>]}
2020-02-27 19:43:22,432750 (Thread-2): 11:43:22 | 20 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.42s]
2020-02-27 19:43:22,433139 (Thread-2): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 19:43:22,433482 (Thread-2): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 19:43:22,434136 (Thread-2): 11:43:22 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 19:43:22,434477 (Thread-2): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 19:43:22,434767 (Thread-2): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 19:43:22,435170 (Thread-2): 11:43:22 | 27 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 19:43:22,435896 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 19:43:22,436109 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 19:43:22,436310 (Thread-2): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 19:43:22,472677 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:22,727341 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 19:43:22,728065 (Thread-3): finished collecting timing info
2020-02-27 19:43:22,735212 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 19:43:22,735658 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 19:43:23,176540 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:23,661254 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:23,741532 (Thread-1): finished collecting timing info
2020-02-27 19:43:23,742610 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd43810>]}
2020-02-27 19:43:24,117374 (Thread-1): 11:43:24 | 22 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.55s]
2020-02-27 19:43:24,117713 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:43:24,117945 (Thread-1): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 19:43:24,118353 (Thread-1): 11:43:24 | 28 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 19:43:24,118797 (Thread-1): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 19:43:24,119025 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:43:24,119371 (Thread-1): 11:43:24 | 29 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 19:43:24,119989 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 19:43:24,120139 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 19:43:24,120298 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:43:24,133662 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 19:43:24,135760 (Thread-1): finished collecting timing info
2020-02-27 19:43:24,142481 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 19:43:24,142952 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 19:43:24,507918 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:43:24,673876 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 19:43:24,674553 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 19:43:24,675050 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:43:24,823591 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:24,845761 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 19:43:24,846436 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 19:43:24,849508 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 19:43:24,850109 (Thread-4): finished collecting timing info
2020-02-27 19:43:24,857734 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 19:43:24,858223 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 19:43:24,911251 (Thread-3): finished collecting timing info
2020-02-27 19:43:24,912311 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd2aad0>]}
2020-02-27 19:43:25,314072 (Thread-3): 11:43:25 | 23 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.32s]
2020-02-27 19:43:25,314372 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 19:43:25,314627 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 19:43:25,315006 (Thread-3): 11:43:25 | 30 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 19:43:25,315225 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 19:43:25,432467 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/74a403b4-c412-406c-a45b-47ecb561e283?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 19:43:25,432765 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 19:43:25,432971 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/74a403b4-c412-406c-a45b-47ecb561e283?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 74a403b4-c412-406c-a45b-47ecb561e283)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:25,433243 (Thread-4): finished collecting timing info
2020-02-27 19:43:25,434056 (Thread-4): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/74a403b4-c412-406c-a45b-47ecb561e283?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 74a403b4-c412-406c-a45b-47ecb561e283)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 19:43:25,435225 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114ba250>]}
2020-02-27 19:43:25,802723 (Thread-4): 11:43:25 | 25 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.45s]
2020-02-27 19:43:25,803014 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:43:25,803688 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 19:43:25,804054 (Thread-3): 11:43:25 | 31 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 19:43:25,804314 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 19:43:25,804807 (Thread-4): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 19:43:25,805047 (Thread-4): 11:43:25 | 32 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 19:43:25,805249 (Thread-4): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 19:43:25,805679 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 19:43:25,805953 (Thread-3): 11:43:25 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 19:43:25,806173 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 19:43:26,222156 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:26,665578 (Thread-1): finished collecting timing info
2020-02-27 19:43:26,666640 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe0ce10>]}
2020-02-27 19:43:27,34208 (Thread-1): 11:43:27 | 29 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.55s]
2020-02-27 19:43:27,34555 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:43:27,35241 (Thread-4): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:43:27,35528 (Thread-3): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 19:43:27,35792 (Thread-4): 11:43:27 | 34 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 19:43:27,36236 (Thread-3): 11:43:27 | 35 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 19:43:27,36923 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 19:43:27,37380 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 19:43:27,37548 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 19:43:27,37718 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-27 19:43:27,37902 (Thread-4): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:43:27,38075 (Thread-3): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 19:43:27,54998 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 19:43:27,59249 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 19:43:27,59680 (Thread-4): finished collecting timing info
2020-02-27 19:43:27,59997 (Thread-3): finished collecting timing info
2020-02-27 19:43:27,68177 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 19:43:27,76606 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 19:43:27,77443 (Thread-3): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 19:43:27,78880 (Thread-4): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 19:43:27,435634 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:43:29,177922 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 19:43:29,178628 (Thread-2): finished collecting timing info
2020-02-27 19:43:29,186453 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 19:43:29,186912 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 19:43:29,441577 (Thread-4): finished collecting timing info
2020-02-27 19:43:29,442679 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd96e10>]}
2020-02-27 19:43:29,727176 (Thread-3): finished collecting timing info
2020-02-27 19:43:29,728108 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd0cd90>]}
2020-02-27 19:43:29,784246 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/74313bea-99fb-45a9-8bdf-0d429757a3ee?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 19:43:29,784536 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 19:43:29,784738 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/74313bea-99fb-45a9-8bdf-0d429757a3ee?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 74313bea-99fb-45a9-8bdf-0d429757a3ee)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal10completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal5completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal13completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal16completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal17completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal18completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:29,785012 (Thread-2): finished collecting timing info
2020-02-27 19:43:29,785815 (Thread-2): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/74313bea-99fb-45a9-8bdf-0d429757a3ee?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 74313bea-99fb-45a9-8bdf-0d429757a3ee)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal10completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal5completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal13completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal16completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal17completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal18completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 19:43:29,787135 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb88110>]}
2020-02-27 19:43:29,841482 (Thread-4): 11:43:29 | 34 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.41s]
2020-02-27 19:43:29,842870 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:43:29,843498 (Thread-1): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 19:43:29,843767 (Thread-1): 11:43:29 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 19:43:29,844511 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 19:43:29,844981 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 19:43:29,845159 (Thread-1): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 19:43:29,856370 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 19:43:29,856865 (Thread-1): finished collecting timing info
2020-02-27 19:43:29,863374 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 19:43:29,863862 (Thread-1): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 19:43:30,231025 (Thread-3): 11:43:30 | 35 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.69s]
2020-02-27 19:43:30,231594 (Thread-3): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 19:43:30,611137 (Thread-2): 11:43:30 | 27 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 7.35s]
2020-02-27 19:43:30,611492 (Thread-2): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 19:43:30,612299 (Thread-4): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 19:43:30,612635 (Thread-4): 11:43:30 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 19:43:30,612903 (Thread-4): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 19:43:30,613452 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 19:43:30,613735 (Thread-2): 11:43:30 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 19:43:30,613981 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 19:43:30,614618 (Thread-4): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 19:43:30,614873 (Thread-3): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 19:43:30,615171 (Thread-4): 11:43:30 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 19:43:30,615453 (Thread-3): 11:43:30 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 19:43:30,615804 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 19:43:30,616095 (Thread-3): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 19:43:30,616811 (Thread-2): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 19:43:30,617178 (Thread-2): 11:43:30 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 19:43:30,617401 (Thread-3): Began running node model.journeyengine_recipes.platform_index
2020-02-27 19:43:30,617658 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 19:43:30,617942 (Thread-3): 11:43:30 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 19:43:30,618538 (Thread-4): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 19:43:30,618789 (Thread-3): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 19:43:30,619013 (Thread-4): 11:43:30 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 19:43:30,619568 (Thread-2): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 19:43:30,619891 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 19:43:30,620173 (Thread-2): 11:43:30 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 19:43:30,620629 (Thread-2): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 19:43:31,819525 (Thread-1): finished collecting timing info
2020-02-27 19:43:31,820730 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd102498e-2b5f-492a-82ac-203966b267c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd1bf90>]}
2020-02-27 19:43:32,197294 (Thread-1): 11:43:32 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 1.98s]
2020-02-27 19:43:32,197585 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 19:43:32,209419 (MainThread): 11:43:32 | 
2020-02-27 19:43:32,209676 (MainThread): 11:43:32 | Finished running 44 table models in 26.35s.
2020-02-27 19:43:32,209835 (MainThread): Connection 'master' was left open.
2020-02-27 19:43:32,209954 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 19:43:32,210069 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 19:43:32,210181 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 19:43:32,210292 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 19:43:32,372309 (MainThread): 
2020-02-27 19:43:32,372730 (MainThread): Completed with 5 errors and 0 warnings:
2020-02-27 19:43:32,373014 (MainThread): 
2020-02-27 19:43:32,373324 (MainThread): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
2020-02-27 19:43:32,373665 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 19:43:32,373948 (MainThread):   
2020-02-27 19:43:32,374199 (MainThread):   (job ID: b8c6fe97-6ace-4f14-9976-bfb15b443553)
2020-02-27 19:43:32,374777 (MainThread):   
2020-02-27 19:43:32,375009 (MainThread):                                                                          -----Query Job SQL Follows-----                                                                       
2020-02-27 19:43:32,375208 (MainThread):   
2020-02-27 19:43:32,375344 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:32,375480 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
2020-02-27 19:43:32,375618 (MainThread):      2:
2020-02-27 19:43:32,375774 (MainThread):      3:
2020-02-27 19:43:32,375995 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
2020-02-27 19:43:32,376226 (MainThread):      5:  
2020-02-27 19:43:32,376464 (MainThread):      6:  
2020-02-27 19:43:32,376705 (MainThread):      7:  OPTIONS()
2020-02-27 19:43:32,376950 (MainThread):      8:  as (
2020-02-27 19:43:32,377176 (MainThread):      9:    SELECT
2020-02-27 19:43:32,377505 (MainThread):     10:day,
2020-02-27 19:43:32,377778 (MainThread):     11:campaignid,
2020-02-27 19:43:32,378288 (MainThread):     12:campaign,
2020-02-27 19:43:32,378519 (MainThread):     13:account, 
2020-02-27 19:43:32,378732 (MainThread):     14:channel,
2020-02-27 19:43:32,378947 (MainThread):     15:platform,
2020-02-27 19:43:32,379164 (MainThread):     16:sum(cost) cost,
2020-02-27 19:43:32,379411 (MainThread):     17:sum(impressions) impressions,
2020-02-27 19:43:32,379618 (MainThread):     18:sum(clicks) clicks,
2020-02-27 19:43:32,379833 (MainThread):     19:sum(conversions) conversions
2020-02-27 19:43:32,380026 (MainThread):     20:FROM
2020-02-27 19:43:32,380209 (MainThread):     21:( 
2020-02-27 19:43:32,380389 (MainThread):     22:	SELECT  
2020-02-27 19:43:32,380568 (MainThread):     23:	'Paid' as channel,
2020-02-27 19:43:32,380742 (MainThread):     24:	'Google Ads' as platform,
2020-02-27 19:43:32,380927 (MainThread):     25:	day,
2020-02-27 19:43:32,381130 (MainThread):     26:	campaignid,
2020-02-27 19:43:32,381341 (MainThread):     27:	campaign,
2020-02-27 19:43:32,381675 (MainThread):     28:	account as account,
2020-02-27 19:43:32,381903 (MainThread):     29:	cost/1000000 cost, 
2020-02-27 19:43:32,382123 (MainThread):     30:	impressions as impressions, 
2020-02-27 19:43:32,382388 (MainThread):     31:	clicks, 
2020-02-27 19:43:32,382625 (MainThread):     32:	conversions,
2020-02-27 19:43:32,382870 (MainThread):     33:	_sdc_sequence,
2020-02-27 19:43:32,383123 (MainThread):     34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
2020-02-27 19:43:32,383415 (MainThread):     35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
2020-02-27 19:43:32,383601 (MainThread):     36:)
2020-02-27 19:43:32,383802 (MainThread):     37:WHERE lv = _sdc_sequence
2020-02-27 19:43:32,383960 (MainThread):     38:GROUP BY day, campaignid, account, channel, platform, campaign
2020-02-27 19:43:32,384127 (MainThread):     39:  );
2020-02-27 19:43:32,384402 (MainThread):     40:    
2020-02-27 19:43:32,384591 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:32,384776 (MainThread): 
2020-02-27 19:43:32,384967 (MainThread): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 19:43:32,385222 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 19:43:32,385456 (MainThread):   
2020-02-27 19:43:32,385649 (MainThread):   (job ID: 5f02f2aa-ddb0-47d2-b4f4-589364b078cb)
2020-02-27 19:43:32,385897 (MainThread):   
2020-02-27 19:43:32,386090 (MainThread):                                                                       -----Query Job SQL Follows-----                                                                     
2020-02-27 19:43:32,386326 (MainThread):   
2020-02-27 19:43:32,386550 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:32,386809 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
2020-02-27 19:43:32,387057 (MainThread):      2:
2020-02-27 19:43:32,387246 (MainThread):      3:
2020-02-27 19:43:32,387415 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
2020-02-27 19:43:32,387572 (MainThread):      5:  
2020-02-27 19:43:32,387730 (MainThread):      6:  
2020-02-27 19:43:32,387882 (MainThread):      7:  OPTIONS()
2020-02-27 19:43:32,388044 (MainThread):      8:  as (
2020-02-27 19:43:32,388205 (MainThread):      9:    SELECT
2020-02-27 19:43:32,388355 (MainThread):     10:campaignid,
2020-02-27 19:43:32,388504 (MainThread):     11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
2020-02-27 19:43:32,388653 (MainThread):     12:FROM 
2020-02-27 19:43:32,388803 (MainThread):     13:(
2020-02-27 19:43:32,388960 (MainThread):     14:	SELECT  
2020-02-27 19:43:32,389134 (MainThread):     15:	campaignid,
2020-02-27 19:43:32,389434 (MainThread):     16:	max(finalurl) finalurl
2020-02-27 19:43:32,389618 (MainThread):     17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
2020-02-27 19:43:32,389845 (MainThread):     18:	GROUP BY campaignid
2020-02-27 19:43:32,389998 (MainThread):     19:)
2020-02-27 19:43:32,390261 (MainThread):     20:  );
2020-02-27 19:43:32,390422 (MainThread):     21:    
2020-02-27 19:43:32,390617 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:43:32,390810 (MainThread): 
2020-02-27 19:43:32,391030 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 19:43:32,391182 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-27 19:43:32,391321 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 19:43:32,391462 (MainThread): 
2020-02-27 19:43:32,391648 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 19:43:32,391846 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 19:43:32,391983 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 19:43:32,392119 (MainThread): 
2020-02-27 19:43:32,392387 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 19:43:32,392536 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 19:43:32,392700 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 19:43:32,392877 (MainThread): 
Done. PASS=39 WARN=0 ERROR=5 SKIP=0 TOTAL=44
2020-02-27 19:43:32,393142 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115cb310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c959350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100c5d50>]}
2020-02-27 19:43:32,765673 (MainThread): Flushing usage events
2020-02-27 19:45:31,989998 (MainThread): Running with dbt=0.15.2
2020-02-27 19:45:32,290506 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 19:45:32,291437 (MainThread): Tracking: tracking
2020-02-27 19:45:32,300475 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fbbf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fbbb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fbb590>]}
2020-02-27 19:45:32,726288 (MainThread): Partial parsing not enabled
2020-02-27 19:45:32,730030 (MainThread): Parsing macros/core.sql
2020-02-27 19:45:32,736087 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 19:45:32,745427 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 19:45:32,748265 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 19:45:32,770939 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 19:45:32,801185 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 19:45:32,829991 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 19:45:32,833792 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 19:45:32,845142 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 19:45:32,855020 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 19:45:32,865375 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 19:45:32,874725 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 19:45:32,881568 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 19:45:32,883492 (MainThread): Parsing macros/etc/query.sql
2020-02-27 19:45:32,885615 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 19:45:32,888089 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 19:45:32,890968 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 19:45:32,901924 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 19:45:32,904770 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 19:45:32,943973 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 19:45:32,945771 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 19:45:32,947213 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 19:45:32,948940 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 19:45:32,952366 (MainThread): Parsing macros/etc.sql
2020-02-27 19:45:32,953934 (MainThread): Parsing macros/catalog.sql
2020-02-27 19:45:32,958839 (MainThread): Parsing macros/adapters.sql
2020-02-27 19:45:32,981066 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 19:45:32,983266 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 19:45:32,987574 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 19:45:32,990578 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 19:45:33,3498 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 19:45:33,11008 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 19:45:33,59516 (MainThread): Partial parsing not enabled
2020-02-27 19:45:33,60523 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 19:45:33,67395 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 19:45:33,73529 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-27 19:45:33,75371 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-27 19:45:33,77985 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-27 19:45:33,81454 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-27 19:45:33,83638 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-27 19:45:33,90522 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-27 19:45:33,93030 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-27 19:45:33,95171 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-27 19:45:33,98779 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-27 19:45:33,100533 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-27 19:45:33,103454 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-27 19:45:33,106842 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-27 19:45:33,111349 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-27 19:45:33,114100 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-27 19:45:33,116874 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-27 19:45:33,118836 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-27 19:45:33,122936 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-27 19:45:33,128871 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-27 19:45:33,132690 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-27 19:45:33,135697 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-27 19:45:33,138646 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-27 19:45:33,163987 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-27 19:45:33,165327 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-27 19:45:33,166758 (MainThread): Parsing macros/logger/log_info.sql
2020-02-27 19:45:33,168059 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-27 19:45:33,172480 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-27 19:45:33,174792 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-27 19:45:33,178378 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-27 19:45:33,181062 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-27 19:45:33,183299 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-27 19:45:33,185729 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-27 19:45:33,188938 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-27 19:45:33,191536 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-27 19:45:33,193408 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-27 19:45:33,195169 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-27 19:45:33,197355 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-27 19:45:33,199916 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-27 19:45:33,202512 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-27 19:45:33,207192 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-27 19:45:33,212829 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-27 19:45:33,215095 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-27 19:45:33,219649 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-27 19:45:33,225121 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-27 19:45:33,228808 (MainThread): Parsing macros/sql/star.sql
2020-02-27 19:45:33,232854 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-27 19:45:33,241264 (MainThread): Parsing macros/sql/union.sql
2020-02-27 19:45:33,255865 (MainThread): Parsing macros/sql/groupby.sql
2020-02-27 19:45:33,258771 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-27 19:45:33,262601 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-27 19:45:33,265254 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-27 19:45:33,271876 (MainThread): Parsing macros/sql/pivot.sql
2020-02-27 19:45:33,275967 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-27 19:45:33,301851 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 19:45:33,302016 (MainThread): Opening a new connection, currently in state init
2020-02-27 19:45:33,329884 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 19:45:33,330075 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,338796 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 19:45:33,338947 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,347643 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 19:45:33,347810 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,356485 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 19:45:33,356665 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,366189 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 19:45:33,366394 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,379162 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 19:45:33,379304 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,389065 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 19:45:33,389210 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,399298 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 19:45:33,399433 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,409085 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 19:45:33,409213 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,423041 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 19:45:33,423199 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,435724 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 19:45:33,435955 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,448126 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 19:45:33,448277 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,455423 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 19:45:33,455597 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,462920 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 19:45:33,463089 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,470502 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 19:45:33,470633 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,479046 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 19:45:33,479186 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,487720 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 19:45:33,487869 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,496515 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 19:45:33,496648 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,505987 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 19:45:33,506126 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,513990 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 19:45:33,514160 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,522857 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 19:45:33,523039 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,580291 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 19:45:33,580477 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,591724 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 19:45:33,591867 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,601131 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 19:45:33,601343 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,611585 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 19:45:33,611777 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,657624 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 19:45:33,657828 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,666041 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 19:45:33,666244 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,674998 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 19:45:33,675159 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,682444 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 19:45:33,682598 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,690179 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 19:45:33,690369 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,705778 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 19:45:33,706011 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,720443 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 19:45:33,720622 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,729224 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 19:45:33,729410 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,743443 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 19:45:33,743597 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,765368 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 19:45:33,765498 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,778149 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 19:45:33,778297 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,793976 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 19:45:33,794142 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,801993 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 19:45:33,802152 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,808776 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 19:45:33,808913 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,818131 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 19:45:33,818301 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,826111 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 19:45:33,826255 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,838026 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 19:45:33,838204 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:33,847172 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 19:45:33,847348 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:34,128200 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 19:45:34,153108 (MainThread): 
2020-02-27 19:45:34,153590 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 19:45:34,153710 (MainThread): Opening a new connection, currently in state closed
2020-02-27 19:45:35,29812 (MainThread): 11:45:35 | Concurrency: 4 threads (target='dev')
2020-02-27 19:45:35,30069 (MainThread): 11:45:35 | 
2020-02-27 19:45:35,33921 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 19:45:35,34206 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:45:35,34376 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:45:35,34599 (Thread-1): 11:45:35 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 19:45:35,34734 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 19:45:35,34954 (Thread-2): 11:45:35 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 19:45:35,35163 (Thread-3): 11:45:35 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 19:45:35,35592 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 19:45:35,35783 (Thread-4): 11:45:35 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 19:45:35,36222 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 19:45:35,36374 (Thread-1): Opening a new connection, currently in state init
2020-02-27 19:45:35,36645 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 19:45:35,36854 (Thread-2): Opening a new connection, currently in state init
2020-02-27 19:45:35,37133 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 19:45:35,37303 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 19:45:35,37434 (Thread-3): Opening a new connection, currently in state init
2020-02-27 19:45:35,37570 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:45:35,37700 (Thread-4): Opening a new connection, currently in state init
2020-02-27 19:45:35,50154 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:45:35,55267 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 19:45:35,64065 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 19:45:35,64248 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 19:45:35,72926 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 19:45:35,82083 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 19:45:35,82407 (Thread-1): finished collecting timing info
2020-02-27 19:45:35,82932 (Thread-2): finished collecting timing info
2020-02-27 19:45:35,95956 (Thread-3): finished collecting timing info
2020-02-27 19:45:35,108681 (Thread-4): finished collecting timing info
2020-02-27 19:45:35,760250 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 19:45:35,798263 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 19:45:35,804434 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 19:45:35,822352 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 19:45:35,824203 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 19:45:35,824399 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 19:45:35,825445 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 19:45:35,825585 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 19:45:36,585268 (Thread-4): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 19:45:36,585532 (Thread-4): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 19:45:36,585684 (Thread-4): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 45e48768-30c3-4a88-bb07-8ce584fcfbd2)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:45:36,585927 (Thread-4): finished collecting timing info
2020-02-27 19:45:36,586723 (Thread-4): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 45e48768-30c3-4a88-bb07-8ce584fcfbd2)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 45e48768-30c3-4a88-bb07-8ce584fcfbd2)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 45e48768-30c3-4a88-bb07-8ce584fcfbd2)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:45:36,596006 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10546f590>]}
2020-02-27 19:45:36,662648 (Thread-3): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 19:45:36,662957 (Thread-3): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 19:45:36,663150 (Thread-3): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 4aedc640-dd55-41e0-b68f-161b88cb62a7)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:45:36,663439 (Thread-3): finished collecting timing info
2020-02-27 19:45:36,664289 (Thread-3): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 4aedc640-dd55-41e0-b68f-161b88cb62a7)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 4aedc640-dd55-41e0-b68f-161b88cb62a7)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 4aedc640-dd55-41e0-b68f-161b88cb62a7)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:45:36,665317 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105450810>]}
2020-02-27 19:45:36,957694 (Thread-4): 11:45:36 | 4 of 44 ERROR creating table model agency_data_pipeline.adwords_urls. [ERROR in 1.56s]
2020-02-27 19:45:36,959118 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 19:45:36,959516 (Thread-4): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 19:45:36,960074 (Thread-4): 11:45:36 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 19:45:36,960823 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 19:45:36,961303 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 19:45:36,961473 (Thread-4): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 19:45:36,971533 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 19:45:36,971997 (Thread-4): finished collecting timing info
2020-02-27 19:45:36,978330 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 19:45:36,978817 (Thread-4): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 19:45:37,335099 (Thread-3): 11:45:37 | 3 of 44 ERROR creating table model agency_data_pipeline.adwords_campaigns [ERROR in 1.63s]
2020-02-27 19:45:37,335445 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 19:45:37,335693 (Thread-3): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:45:37,336479 (Thread-3): 11:45:37 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 19:45:37,337041 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 19:45:37,337190 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 19:45:37,337347 (Thread-3): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:45:37,347915 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 19:45:37,348403 (Thread-3): finished collecting timing info
2020-02-27 19:45:37,354805 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 19:45:37,355258 (Thread-3): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 19:45:38,462671 (Thread-2): finished collecting timing info
2020-02-27 19:45:38,463752 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fbbe50>]}
2020-02-27 19:45:38,843835 (Thread-2): 11:45:38 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 3.43s]
2020-02-27 19:45:38,844154 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 19:45:38,844382 (Thread-2): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:45:38,844819 (Thread-2): 11:45:38 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 19:45:38,845513 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 19:45:38,845679 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 19:45:38,845840 (Thread-2): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:45:38,855289 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 19:45:38,855796 (Thread-2): finished collecting timing info
2020-02-27 19:45:38,862427 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 19:45:38,862897 (Thread-2): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 19:45:39,407594 (Thread-4): finished collecting timing info
2020-02-27 19:45:39,408755 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105719310>]}
2020-02-27 19:45:39,523371 (Thread-3): finished collecting timing info
2020-02-27 19:45:39,524299 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057254d0>]}
2020-02-27 19:45:39,562946 (Thread-1): finished collecting timing info
2020-02-27 19:45:39,563800 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10521aa50>]}
2020-02-27 19:45:39,790170 (Thread-4): 11:45:39 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 2.45s]
2020-02-27 19:45:39,791004 (Thread-4): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 19:45:39,792684 (Thread-4): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:45:39,793312 (Thread-4): 11:45:39 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 19:45:39,793843 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 19:45:39,794010 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 19:45:39,794446 (Thread-4): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:45:39,804199 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 19:45:39,804935 (Thread-4): finished collecting timing info
2020-02-27 19:45:39,811501 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 19:45:39,811976 (Thread-4): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 19:45:40,250895 (Thread-3): 11:45:40 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.19s]
2020-02-27 19:45:40,252825 (Thread-3): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 19:45:40,253373 (Thread-3): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:45:40,254233 (Thread-3): 11:45:40 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 19:45:40,255103 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 19:45:40,255269 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 19:45:40,255556 (Thread-3): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:45:40,267178 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 19:45:40,267771 (Thread-3): finished collecting timing info
2020-02-27 19:45:40,274578 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 19:45:40,275618 (Thread-3): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 19:45:40,677970 (Thread-1): 11:45:40 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 4.53s]
2020-02-27 19:45:40,678276 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 19:45:40,678506 (Thread-1): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:45:40,678742 (Thread-1): 11:45:40 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 19:45:40,679425 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 19:45:40,679814 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 19:45:40,680007 (Thread-1): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:45:40,690083 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 19:45:40,690611 (Thread-1): finished collecting timing info
2020-02-27 19:45:40,697436 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 19:45:40,697868 (Thread-1): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 19:45:41,697254 (Thread-2): finished collecting timing info
2020-02-27 19:45:41,698379 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fbbd10>]}
2020-02-27 19:45:42,69717 (Thread-2): 11:45:42 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.85s]
2020-02-27 19:45:42,70804 (Thread-2): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 19:45:42,71169 (Thread-2): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:45:42,71610 (Thread-2): 11:45:42 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 19:45:42,72382 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 19:45:42,72725 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 19:45:42,72897 (Thread-2): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:45:42,83539 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 19:45:42,85952 (Thread-2): finished collecting timing info
2020-02-27 19:45:42,93148 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 19:45:42,94095 (Thread-2): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 19:45:42,254628 (Thread-4): finished collecting timing info
2020-02-27 19:45:42,255998 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058cb190>]}
2020-02-27 19:45:42,409878 (Thread-3): finished collecting timing info
2020-02-27 19:45:42,411006 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105743e50>]}
2020-02-27 19:45:42,627189 (Thread-4): 11:45:42 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.46s]
2020-02-27 19:45:42,628632 (Thread-4): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 19:45:42,628987 (Thread-4): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:45:42,629417 (Thread-4): 11:45:42 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 19:45:42,630144 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 19:45:42,630563 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 19:45:42,630711 (Thread-4): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:45:42,641036 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 19:45:42,641730 (Thread-4): finished collecting timing info
2020-02-27 19:45:42,649210 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 19:45:42,649863 (Thread-4): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 19:45:42,774069 (Thread-1): finished collecting timing info
2020-02-27 19:45:42,775007 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056ffd90>]}
2020-02-27 19:45:43,19778 (Thread-3): 11:45:43 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.16s]
2020-02-27 19:45:43,20331 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 19:45:43,21344 (Thread-3): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:45:43,21794 (Thread-3): 11:45:43 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 19:45:43,22199 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 19:45:43,22317 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 19:45:43,22649 (Thread-3): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:45:43,31674 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 19:45:43,32509 (Thread-3): finished collecting timing info
2020-02-27 19:45:43,40062 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 19:45:43,40675 (Thread-3): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 19:45:43,409213 (Thread-1): 11:45:43 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.10s]
2020-02-27 19:45:43,409602 (Thread-1): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 19:45:43,409919 (Thread-1): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 19:45:43,410176 (Thread-1): 11:45:43 | 14 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 19:45:43,410346 (Thread-1): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 19:45:43,411139 (Thread-1): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 19:45:43,411621 (Thread-1): 11:45:43 | 15 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 19:45:43,412427 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 19:45:43,412744 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 19:45:43,412952 (Thread-1): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 19:45:43,441265 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 19:45:43,442091 (Thread-1): finished collecting timing info
2020-02-27 19:45:43,463865 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 19:45:43,466110 (Thread-1): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 19:45:44,328856 (Thread-2): finished collecting timing info
2020-02-27 19:45:44,329980 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040dd150>]}
2020-02-27 19:45:44,719532 (Thread-2): 11:45:44 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.26s]
2020-02-27 19:45:44,719839 (Thread-2): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 19:45:44,720094 (Thread-2): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 19:45:44,720567 (Thread-2): 11:45:44 | 16 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 19:45:44,721261 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 19:45:44,721428 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 19:45:44,721591 (Thread-2): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 19:45:44,734272 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 19:45:44,734855 (Thread-2): finished collecting timing info
2020-02-27 19:45:44,788834 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 19:45:44,789412 (Thread-2): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 19:45:45,125629 (Thread-3): finished collecting timing info
2020-02-27 19:45:45,126633 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10599e510>]}
2020-02-27 19:45:45,515465 (Thread-3): 11:45:45 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.10s]
2020-02-27 19:45:45,515716 (Thread-3): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 19:45:45,515919 (Thread-3): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 19:45:45,516314 (Thread-3): 11:45:45 | 17 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 19:45:45,516825 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 19:45:45,516943 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 19:45:45,517070 (Thread-3): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 19:45:45,530570 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:45,605364 (Thread-1): finished collecting timing info
2020-02-27 19:45:45,606247 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105925150>]}
2020-02-27 19:45:45,974425 (Thread-1): 11:45:45 | 15 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.19s]
2020-02-27 19:45:45,974819 (Thread-1): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 19:45:45,975110 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:45:45,975752 (Thread-1): 11:45:45 | 18 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 19:45:45,976401 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 19:45:45,976599 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 19:45:45,976810 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:45:45,992945 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:46,952172 (Thread-2): finished collecting timing info
2020-02-27 19:45:46,953316 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105254b50>]}
2020-02-27 19:45:47,153090 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-27 19:45:47,153431 (Thread-3): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 19:45:47,295716 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-27 19:45:47,314629 (Thread-3): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 19:45:47,315046 (Thread-3): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 19:45:47,317973 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 19:45:47,318605 (Thread-3): finished collecting timing info
2020-02-27 19:45:47,326317 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 19:45:47,326884 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 19:45:47,332502 (Thread-2): 11:45:47 | 16 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.23s]
2020-02-27 19:45:47,332795 (Thread-2): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 19:45:47,333029 (Thread-2): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:45:47,333260 (Thread-2): 11:45:47 | 19 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 19:45:47,334030 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 19:45:47,334171 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 19:45:47,334305 (Thread-2): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:45:47,349031 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:47,466654 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 19:45:47,467350 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 19:45:47,470538 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 19:45:47,471090 (Thread-1): finished collecting timing info
2020-02-27 19:45:47,479579 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 19:45:47,480167 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 19:45:48,248467 (Thread-4): finished collecting timing info
2020-02-27 19:45:48,249326 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105714610>]}
2020-02-27 19:45:48,614036 (Thread-4): 11:45:48 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 5.62s]
2020-02-27 19:45:48,614340 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 19:45:48,614575 (Thread-4): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:45:48,614964 (Thread-4): 11:45:48 | 20 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 19:45:48,615454 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 19:45:48,615606 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 19:45:48,615766 (Thread-4): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:45:48,632706 (Thread-4): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:48,698802 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 19:45:48,699422 (Thread-2): finished collecting timing info
2020-02-27 19:45:48,706864 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 19:45:48,707476 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-27 19:45:49,747643 (Thread-3): finished collecting timing info
2020-02-27 19:45:49,748804 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10416c190>]}
2020-02-27 19:45:50,14301 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:45:50,136773 (Thread-3): 11:45:50 | 17 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.23s]
2020-02-27 19:45:50,137137 (Thread-3): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 19:45:50,137436 (Thread-3): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 19:45:50,138079 (Thread-3): 11:45:50 | 21 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 19:45:50,138333 (Thread-3): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 19:45:50,138555 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:45:50,138952 (Thread-3): 11:45:50 | 22 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 19:45:50,139584 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 19:45:50,139778 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 19:45:50,139979 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:45:50,158610 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 19:45:50,159211 (Thread-3): finished collecting timing info
2020-02-27 19:45:50,166857 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 19:45:50,167686 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 19:45:50,185643 (Thread-4): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 19:45:50,186205 (Thread-4): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 19:45:50,191824 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 19:45:50,192348 (Thread-4): finished collecting timing info
2020-02-27 19:45:50,199122 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 19:45:50,199635 (Thread-4): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 19:45:50,669094 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/c97e67e8-4926-45cd-ac1a-7256c3695328?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-27 19:45:50,669314 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 19:45:50,669455 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/c97e67e8-4926-45cd-ac1a-7256c3695328?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: c97e67e8-4926-45cd-ac1a-7256c3695328)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:45:50,669646 (Thread-4): finished collecting timing info
2020-02-27 19:45:50,670215 (Thread-4): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/c97e67e8-4926-45cd-ac1a-7256c3695328?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: c97e67e8-4926-45cd-ac1a-7256c3695328)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 19:45:50,673422 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040d0350>]}
2020-02-27 19:45:51,35728 (Thread-4): 11:45:51 | 20 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.06s]
2020-02-27 19:45:51,36000 (Thread-4): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 19:45:51,36297 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:45:51,36731 (Thread-4): 11:45:51 | 23 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 19:45:51,37168 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 19:45:51,37294 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 19:45:51,37422 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:45:51,61042 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:51,89878 (Thread-1): finished collecting timing info
2020-02-27 19:45:51,90735 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041ba390>]}
2020-02-27 19:45:51,129522 (Thread-2): finished collecting timing info
2020-02-27 19:45:51,130989 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057ef910>]}
2020-02-27 19:45:51,453173 (Thread-1): 11:45:51 | 18 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 5.11s]
2020-02-27 19:45:51,453479 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 19:45:51,453693 (Thread-1): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 19:45:51,454141 (Thread-1): 11:45:51 | 24 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 19:45:51,454847 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 19:45:51,455200 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 19:45:51,455632 (Thread-1): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 19:45:51,514221 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:51,881925 (Thread-2): 11:45:51 | 19 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.80s]
2020-02-27 19:45:51,882187 (Thread-2): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 19:45:51,882386 (Thread-2): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 19:45:51,882588 (Thread-2): 11:45:51 | 25 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 19:45:51,883212 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 19:45:51,883359 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 19:45:51,883493 (Thread-2): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 19:45:51,897994 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:52,479614 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:53,70839 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 19:45:53,71492 (Thread-2): finished collecting timing info
2020-02-27 19:45:53,79031 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 19:45:53,79646 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 19:45:53,496053 (Thread-3): finished collecting timing info
2020-02-27 19:45:53,496957 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10598aa10>]}
2020-02-27 19:45:53,643404 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:45:53,802879 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:53,839100 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 19:45:53,840198 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 19:45:53,840734 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 19:45:53,886840 (Thread-3): 11:45:53 | 22 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 3.36s]
2020-02-27 19:45:53,887232 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 19:45:53,887555 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 19:45:53,887895 (Thread-3): 11:45:53 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 19:45:53,888226 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 19:45:53,888407 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:45:53,888680 (Thread-3): 11:45:53 | 27 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 19:45:53,889146 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 19:45:53,889275 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 19:45:53,889406 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:45:53,901664 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 19:45:53,902249 (Thread-3): finished collecting timing info
2020-02-27 19:45:53,910567 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 19:45:53,911275 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 19:45:54,2535 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 19:45:54,4102 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 19:45:54,7167 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 19:45:54,7941 (Thread-4): finished collecting timing info
2020-02-27 19:45:54,16576 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 19:45:54,17480 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 19:45:54,454731 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a0bbc169-9c6b-44b0-9108-c9bd4ab4e65f?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 19:45:54,455054 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 19:45:54,455211 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a0bbc169-9c6b-44b0-9108-c9bd4ab4e65f?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: a0bbc169-9c6b-44b0-9108-c9bd4ab4e65f)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:45:54,455407 (Thread-4): finished collecting timing info
2020-02-27 19:45:54,456198 (Thread-4): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a0bbc169-9c6b-44b0-9108-c9bd4ab4e65f?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: a0bbc169-9c6b-44b0-9108-c9bd4ab4e65f)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 19:45:54,457257 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040b8d90>]}
2020-02-27 19:45:54,826960 (Thread-4): 11:45:54 | 23 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.42s]
2020-02-27 19:45:54,827485 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 19:45:54,827874 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 19:45:54,828521 (Thread-4): 11:45:54 | 28 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 19:45:54,828738 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 19:45:54,829147 (Thread-4): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 19:45:54,829341 (Thread-4): 11:45:54 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 19:45:54,829508 (Thread-4): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 19:45:54,829842 (Thread-4): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 19:45:54,830018 (Thread-4): 11:45:54 | 30 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 19:45:54,830174 (Thread-4): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 19:45:55,133539 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:56,281347 (Thread-3): finished collecting timing info
2020-02-27 19:45:56,282627 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041d7650>]}
2020-02-27 19:45:56,390362 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:56,646251 (Thread-3): 11:45:56 | 27 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.39s]
2020-02-27 19:45:56,646544 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 19:45:56,647191 (Thread-4): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:45:56,647444 (Thread-3): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 19:45:56,647682 (Thread-4): 11:45:56 | 31 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 19:45:56,647915 (Thread-3): 11:45:56 | 32 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 19:45:56,648401 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 19:45:56,648777 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 19:45:56,648880 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 19:45:56,649017 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 19:45:56,649168 (Thread-4): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:45:56,649308 (Thread-3): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 19:45:56,660399 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 19:45:56,670888 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 19:45:56,671593 (Thread-3): finished collecting timing info
2020-02-27 19:45:56,671961 (Thread-4): finished collecting timing info
2020-02-27 19:45:56,679753 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 19:45:56,691549 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 19:45:56,692106 (Thread-3): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 19:45:56,693150 (Thread-4): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 19:45:57,790318 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 19:45:59,100763 (Thread-3): finished collecting timing info
2020-02-27 19:45:59,101904 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056d18d0>]}
2020-02-27 19:45:59,169429 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 19:45:59,170151 (Thread-1): finished collecting timing info
2020-02-27 19:45:59,185329 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 19:45:59,186225 (Thread-1): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 19:45:59,322061 (Thread-4): finished collecting timing info
2020-02-27 19:45:59,323096 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10523cf90>]}
2020-02-27 19:45:59,490753 (Thread-3): 11:45:59 | 32 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.45s]
2020-02-27 19:45:59,492275 (Thread-3): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 19:45:59,730164 (Thread-2): finished collecting timing info
2020-02-27 19:45:59,731233 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054446d0>]}
2020-02-27 19:45:59,846654 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/161dae19-175d-40e3-968b-1049b0f229eb?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 19:45:59,846946 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 19:45:59,847161 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/161dae19-175d-40e3-968b-1049b0f229eb?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 161dae19-175d-40e3-968b-1049b0f229eb)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal5completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal17completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal10completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal16completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal13completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:45:59,847439 (Thread-1): finished collecting timing info
2020-02-27 19:45:59,848255 (Thread-1): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/161dae19-175d-40e3-968b-1049b0f229eb?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 161dae19-175d-40e3-968b-1049b0f229eb)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal5completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal17completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal10completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal16completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal13completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 19:45:59,849374 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056df850>]}
2020-02-27 19:45:59,870288 (Thread-4): 11:45:59 | 31 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.67s]
2020-02-27 19:45:59,871617 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 19:45:59,872317 (Thread-3): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 19:45:59,872571 (Thread-3): 11:45:59 | 33 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 19:45:59,873237 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 19:45:59,873677 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.social_post_viz).
2020-02-27 19:45:59,873838 (Thread-3): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 19:45:59,884041 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 19:45:59,885050 (Thread-3): finished collecting timing info
2020-02-27 19:45:59,891861 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 19:45:59,892888 (Thread-3): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 19:46:00,272963 (Thread-2): 11:46:00 | 25 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 7.85s]
2020-02-27 19:46:00,274320 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 19:46:00,274876 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 19:46:00,275186 (Thread-4): 11:46:00 | 34 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 19:46:00,275727 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 19:46:00,276864 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 19:46:00,277259 (Thread-2): 11:46:00 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 19:46:00,277514 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 19:46:00,278006 (Thread-4): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 19:46:00,278334 (Thread-4): 11:46:00 | 36 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 19:46:00,278510 (Thread-4): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 19:46:00,664647 (Thread-1): 11:46:00 | 24 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 8.39s]
2020-02-27 19:46:00,665032 (Thread-1): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 19:46:00,666230 (Thread-2): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 19:46:00,666639 (Thread-2): 11:46:00 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 19:46:00,666922 (Thread-2): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 19:46:00,667534 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 19:46:00,667811 (Thread-1): 11:46:00 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 19:46:00,668116 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 19:46:00,668774 (Thread-2): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 19:46:00,668954 (Thread-1): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 19:46:00,669182 (Thread-2): 11:46:00 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 19:46:00,669403 (Thread-1): 11:46:00 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 19:46:00,669637 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 19:46:00,669847 (Thread-1): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 19:46:00,670317 (Thread-4): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 19:46:00,670630 (Thread-4): 11:46:00 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 19:46:00,670819 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 19:46:00,670989 (Thread-4): Began running node model.journeyengine_recipes.platform_index
2020-02-27 19:46:00,671304 (Thread-4): 11:46:00 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 19:46:00,671734 (Thread-2): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 19:46:00,671932 (Thread-4): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 19:46:00,672097 (Thread-2): 11:46:00 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 19:46:00,672516 (Thread-1): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 19:46:00,672690 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 19:46:00,672833 (Thread-1): 11:46:00 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 19:46:00,673130 (Thread-1): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 19:46:02,66339 (Thread-3): finished collecting timing info
2020-02-27 19:46:02,67332 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa8137a0-e0b9-434e-89e3-28df953ecfa5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057d4d10>]}
2020-02-27 19:46:02,457133 (Thread-3): 11:46:02 | 33 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.19s]
2020-02-27 19:46:02,457438 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 19:46:02,555125 (MainThread): 11:46:02 | 
2020-02-27 19:46:02,555372 (MainThread): 11:46:02 | Finished running 44 table models in 28.40s.
2020-02-27 19:46:02,555523 (MainThread): Connection 'master' was left open.
2020-02-27 19:46:02,555636 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 19:46:02,555746 (MainThread): Connection 'model.journeyengine_recipes.fb_ads' was left open.
2020-02-27 19:46:02,555852 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 19:46:02,555958 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 19:46:02,713401 (MainThread): 
2020-02-27 19:46:02,713658 (MainThread): Completed with 5 errors and 0 warnings:
2020-02-27 19:46:02,713843 (MainThread): 
2020-02-27 19:46:02,714002 (MainThread): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 19:46:02,714147 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 19:46:02,714427 (MainThread):   
2020-02-27 19:46:02,714655 (MainThread):   (job ID: 45e48768-30c3-4a88-bb07-8ce584fcfbd2)
2020-02-27 19:46:02,714871 (MainThread):   
2020-02-27 19:46:02,715084 (MainThread):                                                                       -----Query Job SQL Follows-----                                                                     
2020-02-27 19:46:02,715296 (MainThread):   
2020-02-27 19:46:02,715504 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:46:02,715707 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
2020-02-27 19:46:02,715909 (MainThread):      2:
2020-02-27 19:46:02,716155 (MainThread):      3:
2020-02-27 19:46:02,716347 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
2020-02-27 19:46:02,716553 (MainThread):      5:  
2020-02-27 19:46:02,716797 (MainThread):      6:  
2020-02-27 19:46:02,716936 (MainThread):      7:  OPTIONS()
2020-02-27 19:46:02,717115 (MainThread):      8:  as (
2020-02-27 19:46:02,717251 (MainThread):      9:    SELECT
2020-02-27 19:46:02,717413 (MainThread):     10:campaignid,
2020-02-27 19:46:02,717547 (MainThread):     11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
2020-02-27 19:46:02,717696 (MainThread):     12:FROM 
2020-02-27 19:46:02,717828 (MainThread):     13:(
2020-02-27 19:46:02,717970 (MainThread):     14:	SELECT  
2020-02-27 19:46:02,718120 (MainThread):     15:	campaignid,
2020-02-27 19:46:02,718251 (MainThread):     16:	max(finalurl) finalurl
2020-02-27 19:46:02,718439 (MainThread):     17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
2020-02-27 19:46:02,718600 (MainThread):     18:	GROUP BY campaignid
2020-02-27 19:46:02,718757 (MainThread):     19:)
2020-02-27 19:46:02,718938 (MainThread):     20:  );
2020-02-27 19:46:02,719137 (MainThread):     21:    
2020-02-27 19:46:02,719358 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:46:02,719582 (MainThread): 
2020-02-27 19:46:02,719755 (MainThread): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
2020-02-27 19:46:02,719895 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 19:46:02,720042 (MainThread):   
2020-02-27 19:46:02,720180 (MainThread):   (job ID: 4aedc640-dd55-41e0-b68f-161b88cb62a7)
2020-02-27 19:46:02,720402 (MainThread):   
2020-02-27 19:46:02,720536 (MainThread):                                                                          -----Query Job SQL Follows-----                                                                       
2020-02-27 19:46:02,720667 (MainThread):   
2020-02-27 19:46:02,720881 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:46:02,721022 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
2020-02-27 19:46:02,721186 (MainThread):      2:
2020-02-27 19:46:02,721317 (MainThread):      3:
2020-02-27 19:46:02,721525 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
2020-02-27 19:46:02,721695 (MainThread):      5:  
2020-02-27 19:46:02,721826 (MainThread):      6:  
2020-02-27 19:46:02,721955 (MainThread):      7:  OPTIONS()
2020-02-27 19:46:02,722083 (MainThread):      8:  as (
2020-02-27 19:46:02,722220 (MainThread):      9:    SELECT
2020-02-27 19:46:02,722350 (MainThread):     10:day,
2020-02-27 19:46:02,722477 (MainThread):     11:campaignid,
2020-02-27 19:46:02,722603 (MainThread):     12:campaign,
2020-02-27 19:46:02,722729 (MainThread):     13:account, 
2020-02-27 19:46:02,722855 (MainThread):     14:channel,
2020-02-27 19:46:02,723016 (MainThread):     15:platform,
2020-02-27 19:46:02,723201 (MainThread):     16:sum(cost) cost,
2020-02-27 19:46:02,723342 (MainThread):     17:sum(impressions) impressions,
2020-02-27 19:46:02,723476 (MainThread):     18:sum(clicks) clicks,
2020-02-27 19:46:02,723608 (MainThread):     19:sum(conversions) conversions
2020-02-27 19:46:02,723737 (MainThread):     20:FROM
2020-02-27 19:46:02,723866 (MainThread):     21:( 
2020-02-27 19:46:02,723993 (MainThread):     22:	SELECT  
2020-02-27 19:46:02,724120 (MainThread):     23:	'Paid' as channel,
2020-02-27 19:46:02,724246 (MainThread):     24:	'Google Ads' as platform,
2020-02-27 19:46:02,724372 (MainThread):     25:	day,
2020-02-27 19:46:02,724498 (MainThread):     26:	campaignid,
2020-02-27 19:46:02,724622 (MainThread):     27:	campaign,
2020-02-27 19:46:02,724747 (MainThread):     28:	account as account,
2020-02-27 19:46:02,724875 (MainThread):     29:	cost/1000000 cost, 
2020-02-27 19:46:02,725000 (MainThread):     30:	impressions as impressions, 
2020-02-27 19:46:02,725124 (MainThread):     31:	clicks, 
2020-02-27 19:46:02,725248 (MainThread):     32:	conversions,
2020-02-27 19:46:02,725372 (MainThread):     33:	_sdc_sequence,
2020-02-27 19:46:02,725496 (MainThread):     34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
2020-02-27 19:46:02,725623 (MainThread):     35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
2020-02-27 19:46:02,725748 (MainThread):     36:)
2020-02-27 19:46:02,725872 (MainThread):     37:WHERE lv = _sdc_sequence
2020-02-27 19:46:02,725996 (MainThread):     38:GROUP BY day, campaignid, account, channel, platform, campaign
2020-02-27 19:46:02,726120 (MainThread):     39:  );
2020-02-27 19:46:02,726249 (MainThread):     40:    
2020-02-27 19:46:02,726374 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 19:46:02,726512 (MainThread): 
2020-02-27 19:46:02,726655 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 19:46:02,726788 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-27 19:46:02,726914 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 19:46:02,727046 (MainThread): 
2020-02-27 19:46:02,727185 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 19:46:02,727316 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 19:46:02,727442 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 19:46:02,727574 (MainThread): 
2020-02-27 19:46:02,727712 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 19:46:02,727843 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 19:46:02,727967 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 19:46:02,728141 (MainThread): 
Done. PASS=39 WARN=0 ERROR=5 SKIP=0 TOTAL=44
2020-02-27 19:46:02,728426 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105209990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040c71d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ec8810>]}
2020-02-27 19:46:03,95341 (MainThread): Flushing usage events
2020-02-27 20:03:07,728313 (MainThread): Running with dbt=0.15.2
2020-02-27 20:03:08,35996 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 20:03:08,37213 (MainThread): Tracking: tracking
2020-02-27 20:03:08,47349 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11170f790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11170fd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11170fa90>]}
2020-02-27 20:03:08,519013 (MainThread): Partial parsing not enabled
2020-02-27 20:03:08,523066 (MainThread): Parsing macros/core.sql
2020-02-27 20:03:08,529114 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 20:03:08,538391 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 20:03:08,541318 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 20:03:08,563546 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 20:03:08,588983 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 20:03:08,615587 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 20:03:08,618667 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 20:03:08,627804 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 20:03:08,637522 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 20:03:08,646042 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 20:03:08,653967 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 20:03:08,660506 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 20:03:08,662357 (MainThread): Parsing macros/etc/query.sql
2020-02-27 20:03:08,664486 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 20:03:08,667071 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 20:03:08,669879 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 20:03:08,680556 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 20:03:08,683366 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 20:03:08,725653 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 20:03:08,727360 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 20:03:08,728884 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 20:03:08,730594 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 20:03:08,734073 (MainThread): Parsing macros/etc.sql
2020-02-27 20:03:08,735665 (MainThread): Parsing macros/catalog.sql
2020-02-27 20:03:08,740690 (MainThread): Parsing macros/adapters.sql
2020-02-27 20:03:08,760667 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 20:03:08,762513 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 20:03:08,765681 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 20:03:08,767972 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 20:03:08,782568 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 20:03:08,791756 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 20:03:08,833732 (MainThread): Partial parsing not enabled
2020-02-27 20:03:08,836008 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 20:03:08,843723 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 20:03:08,854290 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-27 20:03:08,856109 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-27 20:03:08,858479 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-27 20:03:08,862001 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-27 20:03:08,864223 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-27 20:03:08,870692 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-27 20:03:08,872963 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-27 20:03:08,875351 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-27 20:03:08,879081 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-27 20:03:08,881186 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-27 20:03:08,884218 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-27 20:03:08,887556 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-27 20:03:08,890417 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-27 20:03:08,892810 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-27 20:03:08,894882 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-27 20:03:08,896297 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-27 20:03:08,900074 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-27 20:03:08,906266 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-27 20:03:08,910300 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-27 20:03:08,913341 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-27 20:03:08,916108 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-27 20:03:08,943045 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-27 20:03:08,944338 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-27 20:03:08,945831 (MainThread): Parsing macros/logger/log_info.sql
2020-02-27 20:03:08,947263 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-27 20:03:08,951853 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-27 20:03:08,954780 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-27 20:03:08,958562 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-27 20:03:08,960498 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-27 20:03:08,962176 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-27 20:03:08,964404 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-27 20:03:08,967321 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-27 20:03:08,969466 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-27 20:03:08,971033 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-27 20:03:08,972714 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-27 20:03:08,974740 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-27 20:03:08,977198 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-27 20:03:08,979119 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-27 20:03:08,983407 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-27 20:03:08,988683 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-27 20:03:08,990899 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-27 20:03:08,995627 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-27 20:03:09,1223 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-27 20:03:09,4739 (MainThread): Parsing macros/sql/star.sql
2020-02-27 20:03:09,8852 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-27 20:03:09,16916 (MainThread): Parsing macros/sql/union.sql
2020-02-27 20:03:09,30536 (MainThread): Parsing macros/sql/groupby.sql
2020-02-27 20:03:09,33198 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-27 20:03:09,35986 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-27 20:03:09,38302 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-27 20:03:09,45737 (MainThread): Parsing macros/sql/pivot.sql
2020-02-27 20:03:09,50560 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-27 20:03:09,80993 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 20:03:09,81200 (MainThread): Opening a new connection, currently in state init
2020-02-27 20:03:09,113333 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:03:09,113543 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,123624 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 20:03:09,123797 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,132415 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:03:09,132582 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,141202 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 20:03:09,141351 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,150181 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 20:03:09,150319 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,167330 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 20:03:09,167577 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,181457 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 20:03:09,181684 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,193918 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:03:09,194131 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,204902 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:03:09,205097 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,223315 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 20:03:09,223543 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,234641 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 20:03:09,234828 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,247319 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:03:09,247467 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,255345 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:03:09,255481 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,262969 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:03:09,263112 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,270867 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:03:09,271009 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,279855 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 20:03:09,280050 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,289109 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 20:03:09,289250 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,298032 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 20:03:09,298171 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,308383 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 20:03:09,308544 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,318399 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 20:03:09,318572 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,327526 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:03:09,327719 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,384036 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 20:03:09,384187 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,395237 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:03:09,395384 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,404119 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:03:09,404257 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,411892 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:03:09,412061 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,420820 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:03:09,421002 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,468239 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:03:09,468435 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,476133 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:03:09,476301 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,483787 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:03:09,483919 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,491465 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:03:09,491638 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,505391 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 20:03:09,505537 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,517552 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:03:09,517695 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,527698 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:03:09,527904 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,541699 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:03:09,541828 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,568300 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:03:09,568525 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,584615 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:03:09,584831 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,605184 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:03:09,605379 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,612949 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:03:09,613078 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,621126 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 20:03:09,621278 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,632232 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 20:03:09,632468 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,644826 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:03:09,645069 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,658094 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:03:09,658275 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,666881 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:03:09,667090 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:09,952337 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 20:03:09,979860 (MainThread): 
2020-02-27 20:03:09,980327 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 20:03:09,980464 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:03:11,77456 (MainThread): 12:03:11 | Concurrency: 4 threads (target='dev')
2020-02-27 20:03:11,77725 (MainThread): 12:03:11 | 
2020-02-27 20:03:11,81295 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:03:11,81530 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:03:11,81761 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:03:11,81987 (Thread-1): 12:03:11 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 20:03:11,82151 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:03:11,82413 (Thread-2): 12:03:11 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 20:03:11,82663 (Thread-3): 12:03:11 | 3 of 44 START table model agency_data_pipeline.adwords_campaigns..... [RUN]
2020-02-27 20:03:11,83228 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:03:11,83432 (Thread-4): 12:03:11 | 4 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 20:03:11,83927 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:03:11,84285 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:03:11,84405 (Thread-1): Opening a new connection, currently in state init
2020-02-27 20:03:11,84841 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:03:11,84965 (Thread-2): Opening a new connection, currently in state init
2020-02-27 20:03:11,85138 (Thread-3): Opening a new connection, currently in state init
2020-02-27 20:03:11,85330 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 20:03:11,85507 (Thread-4): Opening a new connection, currently in state init
2020-02-27 20:03:11,85649 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:03:11,85825 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:03:11,97205 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 20:03:11,104572 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:03:11,112381 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:03:11,122161 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:03:11,131775 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:03:11,132654 (Thread-1): finished collecting timing info
2020-02-27 20:03:11,145230 (Thread-2): finished collecting timing info
2020-02-27 20:03:11,151506 (Thread-4): finished collecting timing info
2020-02-27 20:03:11,229942 (Thread-3): finished collecting timing info
2020-02-27 20:03:11,875687 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:03:11,890705 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:03:11,891428 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:03:11,899576 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:03:11,902634 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 20:03:11,903053 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 20:03:11,905645 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 20:03:11,906604 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 20:03:12,941882 (Thread-3): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 20:03:12,942153 (Thread-3): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM
( 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
)
WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign
  );
    
2020-02-27 20:03:12,942309 (Thread-3): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: a1d893ef-1001-4fb7-ae89-d8b6ff67ef5d)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:12,942556 (Thread-3): finished collecting timing info
2020-02-27 20:03:12,943276 (Thread-3): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: a1d893ef-1001-4fb7-ae89-d8b6ff67ef5d)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: a1d893ef-1001-4fb7-ae89-d8b6ff67ef5d)

                                                                       -----Query Job SQL Follows-----                                                                       

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:day,
  11:campaignid,
  12:campaign,
  13:account, 
  14:channel,
  15:platform,
  16:sum(cost) cost,
  17:sum(impressions) impressions,
  18:sum(clicks) clicks,
  19:sum(conversions) conversions
  20:FROM
  21:( 
  22:	SELECT  
  23:	'Paid' as channel,
  24:	'Google Ads' as platform,
  25:	day,
  26:	campaignid,
  27:	campaign,
  28:	account as account,
  29:	cost/1000000 cost, 
  30:	impressions as impressions, 
  31:	clicks, 
  32:	conversions,
  33:	_sdc_sequence,
  34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
  35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
  36:)
  37:WHERE lv = _sdc_sequence
  38:GROUP BY day, campaignid, account, channel, platform, campaign
  39:  );
  40:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: a1d893ef-1001-4fb7-ae89-d8b6ff67ef5d)
  
                                                                         -----Query Job SQL Follows-----                                                                       
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:day,
    11:campaignid,
    12:campaign,
    13:account, 
    14:channel,
    15:platform,
    16:sum(cost) cost,
    17:sum(impressions) impressions,
    18:sum(clicks) clicks,
    19:sum(conversions) conversions
    20:FROM
    21:( 
    22:	SELECT  
    23:	'Paid' as channel,
    24:	'Google Ads' as platform,
    25:	day,
    26:	campaignid,
    27:	campaign,
    28:	account as account,
    29:	cost/1000000 cost, 
    30:	impressions as impressions, 
    31:	clicks, 
    32:	conversions,
    33:	_sdc_sequence,
    34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
    35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
    36:)
    37:WHERE lv = _sdc_sequence
    38:GROUP BY day, campaignid, account, channel, platform, campaign
    39:  );
    40:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:12,957012 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a66fd0>]}
2020-02-27 20:03:13,51766 (Thread-4): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 20:03:13,51991 (Thread-4): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 20:03:13,52138 (Thread-4): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 73786e94-a29a-4138-8f22-190a7ea9d871)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:13,52350 (Thread-4): finished collecting timing info
2020-02-27 20:03:13,52960 (Thread-4): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 73786e94-a29a-4138-8f22-190a7ea9d871)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: 73786e94-a29a-4138-8f22-190a7ea9d871)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: 73786e94-a29a-4138-8f22-190a7ea9d871)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:13,53727 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113053b10>]}
2020-02-27 20:03:13,333653 (Thread-3): 12:03:13 | 3 of 44 ERROR creating table model agency_data_pipeline.adwords_campaigns [ERROR in 1.87s]
2020-02-27 20:03:13,335182 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:03:13,335587 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:03:13,336158 (Thread-3): 12:03:13 | 5 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 20:03:13,336998 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:03:13,337538 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 20:03:13,337727 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 20:03:13,348153 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:03:13,348745 (Thread-3): finished collecting timing info
2020-02-27 20:03:13,355339 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:03:13,355828 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 20:03:13,728489 (Thread-4): 12:03:13 | 4 of 44 ERROR creating table model agency_data_pipeline.adwords_urls. [ERROR in 1.97s]
2020-02-27 20:03:13,728786 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:03:13,729020 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:03:13,729667 (Thread-4): 12:03:13 | 6 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 20:03:13,730179 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:03:13,730335 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 20:03:13,730503 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:03:13,740470 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:03:13,740992 (Thread-4): finished collecting timing info
2020-02-27 20:03:13,747100 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:03:13,747535 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 20:03:14,726317 (Thread-1): finished collecting timing info
2020-02-27 20:03:14,727407 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a05c90>]}
2020-02-27 20:03:14,734779 (Thread-2): finished collecting timing info
2020-02-27 20:03:14,736045 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a05950>]}
2020-02-27 20:03:15,103891 (Thread-1): 12:03:15 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.64s]
2020-02-27 20:03:15,104457 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:03:15,104783 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:03:15,106315 (Thread-1): 12:03:15 | 7 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 20:03:15,107201 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:03:15,107365 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 20:03:15,107546 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:03:15,116600 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:03:15,117560 (Thread-1): finished collecting timing info
2020-02-27 20:03:15,125121 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:03:15,125764 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:03:15,491497 (Thread-2): 12:03:15 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 3.65s]
2020-02-27 20:03:15,491860 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:03:15,492108 (Thread-2): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:03:15,492541 (Thread-2): 12:03:15 | 8 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 20:03:15,493229 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:03:15,493396 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 20:03:15,493565 (Thread-2): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:03:15,502956 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:03:15,503448 (Thread-2): finished collecting timing info
2020-02-27 20:03:15,509751 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:03:15,510176 (Thread-2): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:03:15,889150 (Thread-3): finished collecting timing info
2020-02-27 20:03:15,890234 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f59950>]}
2020-02-27 20:03:15,917596 (Thread-4): finished collecting timing info
2020-02-27 20:03:15,918696 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ff6610>]}
2020-02-27 20:03:16,261379 (Thread-3): 12:03:16 | 5 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 2.55s]
2020-02-27 20:03:16,263202 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:03:16,263653 (Thread-3): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:03:16,264146 (Thread-3): 12:03:16 | 9 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 20:03:16,265089 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:03:16,265665 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 20:03:16,265884 (Thread-3): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:03:16,279164 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:03:16,279912 (Thread-3): finished collecting timing info
2020-02-27 20:03:16,287365 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:03:16,288370 (Thread-3): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 20:03:16,659008 (Thread-4): 12:03:16 | 6 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.19s]
2020-02-27 20:03:16,659311 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:03:16,659557 (Thread-4): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:03:16,659962 (Thread-4): 12:03:16 | 10 of 44 START table model agency_data_pipeline.twitter_premium_stats [RUN]
2020-02-27 20:03:16,660459 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:03:16,660613 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 20:03:16,660778 (Thread-4): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:03:16,671968 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:03:16,672565 (Thread-4): finished collecting timing info
2020-02-27 20:03:16,680642 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:03:16,681127 (Thread-4): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 20:03:17,380554 (Thread-1): finished collecting timing info
2020-02-27 20:03:17,381629 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a22610>]}
2020-02-27 20:03:17,760386 (Thread-1): 12:03:17 | 7 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.27s]
2020-02-27 20:03:17,760698 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:03:17,760936 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:03:17,761326 (Thread-1): 12:03:17 | 11 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 20:03:17,761818 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:03:17,761971 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 20:03:17,762136 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:03:17,771755 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:03:17,772294 (Thread-1): finished collecting timing info
2020-02-27 20:03:17,778802 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:03:17,779265 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 20:03:18,70354 (Thread-2): finished collecting timing info
2020-02-27 20:03:18,71434 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fde9ed0>]}
2020-02-27 20:03:18,450303 (Thread-2): 12:03:18 | 8 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.58s]
2020-02-27 20:03:18,450672 (Thread-2): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:03:18,450909 (Thread-2): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:03:18,451312 (Thread-2): 12:03:18 | 12 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 20:03:18,451803 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:03:18,451954 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 20:03:18,452118 (Thread-2): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:03:18,462914 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:03:18,463849 (Thread-2): finished collecting timing info
2020-02-27 20:03:18,470639 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:03:18,471101 (Thread-2): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 20:03:18,499970 (Thread-3): finished collecting timing info
2020-02-27 20:03:18,501099 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f64990>]}
2020-02-27 20:03:18,880232 (Thread-3): 12:03:18 | 9 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.24s]
2020-02-27 20:03:18,880541 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:03:18,880876 (Thread-3): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:03:18,881433 (Thread-3): 12:03:18 | 13 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 20:03:18,881968 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:03:18,882137 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 20:03:18,882312 (Thread-3): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:03:18,891755 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:03:18,892245 (Thread-3): finished collecting timing info
2020-02-27 20:03:18,898573 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:03:18,899036 (Thread-3): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 20:03:19,884837 (Thread-4): finished collecting timing info
2020-02-27 20:03:19,886365 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f8f610>]}
2020-02-27 20:03:20,257531 (Thread-4): 12:03:20 | 10 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 3.23s]
2020-02-27 20:03:20,257831 (Thread-4): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:03:20,258095 (Thread-4): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 20:03:20,258512 (Thread-4): 12:03:20 | 14 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 20:03:20,258757 (Thread-4): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 20:03:20,258983 (Thread-4): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:03:20,259489 (Thread-4): 12:03:20 | 15 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 20:03:20,259999 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:03:20,260157 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 20:03:20,260325 (Thread-4): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 20:03:20,276967 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:20,285622 (Thread-1): finished collecting timing info
2020-02-27 20:03:20,286552 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117df790>]}
2020-02-27 20:03:20,661821 (Thread-1): 12:03:20 | 11 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.52s]
2020-02-27 20:03:20,662106 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:03:20,662361 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:03:20,662895 (Thread-1): 12:03:20 | 16 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 20:03:20,663366 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:03:20,663498 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 20:03:20,663635 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:03:20,678266 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:21,36509 (Thread-3): finished collecting timing info
2020-02-27 20:03:21,37369 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ff6d10>]}
2020-02-27 20:03:21,209613 (Thread-2): finished collecting timing info
2020-02-27 20:03:21,210706 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f8fb50>]}
2020-02-27 20:03:21,418050 (Thread-3): 12:03:21 | 13 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.16s]
2020-02-27 20:03:21,419657 (Thread-3): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:03:21,420042 (Thread-3): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:03:21,420447 (Thread-3): 12:03:21 | 17 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 20:03:21,420931 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:03:21,421346 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 20:03:21,421835 (Thread-3): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:03:21,437061 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:21,677445 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 20:03:21,677764 (Thread-4): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 20:03:21,828812 (Thread-4): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 20:03:21,829558 (Thread-4): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 20:03:21,832819 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:03:21,833518 (Thread-4): finished collecting timing info
2020-02-27 20:03:21,842033 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:03:21,842625 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 20:03:21,862070 (Thread-2): 12:03:21 | 12 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.76s]
2020-02-27 20:03:21,862446 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:03:21,862654 (Thread-2): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:03:21,863059 (Thread-2): 12:03:21 | 18 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 20:03:21,863540 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:03:21,864471 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 20:03:21,864712 (Thread-2): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:03:21,882810 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:21,885125 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-27 20:03:22,58902 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:03:22,59760 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:03:22,63152 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:03:22,64055 (Thread-1): finished collecting timing info
2020-02-27 20:03:22,71704 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:03:22,72291 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 20:03:23,200973 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:03:23,201921 (Thread-3): finished collecting timing info
2020-02-27 20:03:23,209170 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:03:23,209790 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-27 20:03:23,337586 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:03:23,498466 (Thread-2): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:03:23,500051 (Thread-2): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:03:23,508057 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:03:23,509240 (Thread-2): finished collecting timing info
2020-02-27 20:03:23,516802 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:03:23,517424 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:03:24,49342 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/3997aa09-38a7-4a28-bacf-27ff92189a73?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-27 20:03:24,49598 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:03:24,49770 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/3997aa09-38a7-4a28-bacf-27ff92189a73?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 3997aa09-38a7-4a28-bacf-27ff92189a73)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:24,50009 (Thread-2): finished collecting timing info
2020-02-27 20:03:24,50982 (Thread-2): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/3997aa09-38a7-4a28-bacf-27ff92189a73?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 3997aa09-38a7-4a28-bacf-27ff92189a73)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:03:24,57430 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a1c890>]}
2020-02-27 20:03:24,344141 (Thread-4): finished collecting timing info
2020-02-27 20:03:24,345252 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ff66d0>]}
2020-02-27 20:03:24,442403 (Thread-2): 12:03:24 | 18 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.19s]
2020-02-27 20:03:24,444187 (Thread-2): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:03:24,444617 (Thread-2): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:03:24,445214 (Thread-2): 12:03:24 | 19 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 20:03:24,446262 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:03:24,446934 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 20:03:24,447149 (Thread-2): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 20:03:24,459101 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:03:24,459964 (Thread-2): finished collecting timing info
2020-02-27 20:03:24,468699 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:03:24,469623 (Thread-2): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 20:03:24,847967 (Thread-4): 12:03:24 | 15 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.09s]
2020-02-27 20:03:24,848248 (Thread-4): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:03:24,848476 (Thread-4): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:03:24,849012 (Thread-4): 12:03:24 | 20 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 20:03:24,849577 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:03:24,849710 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 20:03:24,849853 (Thread-4): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 20:03:24,861785 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:03:24,862300 (Thread-4): finished collecting timing info
2020-02-27 20:03:24,869148 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:03:24,869795 (Thread-4): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 20:03:25,137359 (Thread-1): finished collecting timing info
2020-02-27 20:03:25,138444 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113128e50>]}
2020-02-27 20:03:25,520514 (Thread-1): 12:03:25 | 16 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.47s]
2020-02-27 20:03:25,520823 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:03:25,521064 (Thread-1): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:03:25,521457 (Thread-1): 12:03:25 | 21 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 20:03:25,521693 (Thread-1): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:03:25,521913 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:03:25,522239 (Thread-1): 12:03:25 | 22 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 20:03:25,522712 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:03:25,522861 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 20:03:25,523023 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:03:25,540439 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:03:25,540945 (Thread-1): finished collecting timing info
2020-02-27 20:03:25,547437 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:03:25,547917 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 20:03:25,625480 (Thread-3): finished collecting timing info
2020-02-27 20:03:25,626353 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113165390>]}
2020-02-27 20:03:26,9584 (Thread-3): 12:03:26 | 17 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 4.21s]
2020-02-27 20:03:26,9894 (Thread-3): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:03:26,10134 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 20:03:26,10543 (Thread-3): 12:03:26 | 23 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 20:03:26,11188 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:03:26,11360 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 20:03:26,11530 (Thread-3): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 20:03:26,28851 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:27,320863 (Thread-4): finished collecting timing info
2020-02-27 20:03:27,321946 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129bbe10>]}
2020-02-27 20:03:27,406697 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:03:27,408103 (Thread-3): finished collecting timing info
2020-02-27 20:03:27,417814 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:03:27,419544 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 20:03:27,422262 (Thread-2): finished collecting timing info
2020-02-27 20:03:27,424147 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129e72d0>]}
2020-02-27 20:03:27,703427 (Thread-4): 12:03:27 | 20 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.47s]
2020-02-27 20:03:27,704792 (Thread-4): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:03:27,705192 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:03:27,705595 (Thread-4): 12:03:27 | 24 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 20:03:27,706223 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:03:27,706781 (Thread-4): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 20:03:27,707028 (Thread-4): 12:03:27 | 25 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 20:03:27,707810 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:03:27,708076 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 20:03:27,708309 (Thread-4): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 20:03:27,750575 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:27,986972 (Thread-1): finished collecting timing info
2020-02-27 20:03:27,987992 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113064490>]}
2020-02-27 20:03:28,93694 (Thread-2): 12:03:28 | 19 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.98s]
2020-02-27 20:03:28,95066 (Thread-2): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:03:28,95425 (Thread-2): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:03:28,95934 (Thread-2): 12:03:28 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 20:03:28,96712 (Thread-2): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:03:28,97340 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:03:28,97740 (Thread-2): 12:03:28 | 27 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 20:03:28,98520 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:03:28,98678 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 20:03:28,98842 (Thread-2): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:03:28,123472 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:28,490329 (Thread-1): 12:03:28 | 22 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.47s]
2020-02-27 20:03:28,490604 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:03:28,490808 (Thread-1): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:03:28,491200 (Thread-1): 12:03:28 | 28 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 20:03:28,491605 (Thread-1): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:03:28,491862 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:03:28,492143 (Thread-1): 12:03:28 | 29 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 20:03:28,492668 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:03:28,492800 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 20:03:28,492941 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:03:28,505072 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:03:28,505602 (Thread-1): finished collecting timing info
2020-02-27 20:03:28,513038 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:03:28,513809 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 20:03:29,303356 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:29,488229 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:30,457116 (Thread-3): finished collecting timing info
2020-02-27 20:03:30,458198 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129a1f10>]}
2020-02-27 20:03:30,834747 (Thread-3): 12:03:30 | 23 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 4.45s]
2020-02-27 20:03:30,835086 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 20:03:30,835373 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:03:30,835597 (Thread-3): 12:03:30 | 30 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 20:03:30,835908 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:03:30,861911 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:03:30,890741 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:30,985470 (Thread-1): finished collecting timing info
2020-02-27 20:03:30,986558 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130dc190>]}
2020-02-27 20:03:31,23096 (Thread-2): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:03:31,23608 (Thread-2): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:03:31,24013 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:03:31,200163 (Thread-2): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:03:31,200644 (Thread-2): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:03:31,202910 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:03:31,204859 (Thread-2): finished collecting timing info
2020-02-27 20:03:31,213210 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:03:31,215329 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:03:31,363826 (Thread-1): 12:03:31 | 29 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.49s]
2020-02-27 20:03:31,364132 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:03:31,364727 (Thread-3): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:03:31,364943 (Thread-1): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:03:31,365154 (Thread-3): 12:03:31 | 31 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 20:03:31,365401 (Thread-1): 12:03:31 | 32 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 20:03:31,365976 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:03:31,366410 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:03:31,366537 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-27 20:03:31,366710 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 20:03:31,366899 (Thread-3): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:03:31,367078 (Thread-1): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 20:03:31,378230 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:03:31,387135 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:03:31,387672 (Thread-3): finished collecting timing info
2020-02-27 20:03:31,393964 (Thread-1): finished collecting timing info
2020-02-27 20:03:31,394931 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:03:31,402038 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:03:31,402815 (Thread-3): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 20:03:31,403446 (Thread-1): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 20:03:31,809687 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/bd20b0e6-d558-49a1-b6cd-36bc37c9d046?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 20:03:31,809972 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:03:31,810164 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/bd20b0e6-d558-49a1-b6cd-36bc37c9d046?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: bd20b0e6-d558-49a1-b6cd-36bc37c9d046)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:31,810395 (Thread-2): finished collecting timing info
2020-02-27 20:03:31,811074 (Thread-2): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/bd20b0e6-d558-49a1-b6cd-36bc37c9d046?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: bd20b0e6-d558-49a1-b6cd-36bc37c9d046)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:03:31,812125 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f9a450>]}
2020-02-27 20:03:32,43491 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:32,184830 (Thread-2): 12:03:32 | 27 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.71s]
2020-02-27 20:03:32,185321 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:03:32,186371 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:03:32,186684 (Thread-2): 12:03:32 | 33 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 20:03:32,186935 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:03:32,187498 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:03:32,187745 (Thread-2): 12:03:32 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 20:03:32,188091 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:03:32,188567 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:03:32,188793 (Thread-2): 12:03:32 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 20:03:32,189000 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:03:33,599744 (Thread-1): finished collecting timing info
2020-02-27 20:03:33,600822 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a63590>]}
2020-02-27 20:03:33,647950 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:03:33,982907 (Thread-3): finished collecting timing info
2020-02-27 20:03:33,983479 (Thread-1): 12:03:33 | 32 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.23s]
2020-02-27 20:03:33,984298 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113069650>]}
2020-02-27 20:03:33,984641 (Thread-1): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:03:34,380568 (Thread-3): 12:03:34 | 31 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.62s]
2020-02-27 20:03:34,380827 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:03:34,381259 (Thread-2): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:03:34,381535 (Thread-2): 12:03:34 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 20:03:34,382047 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:03:34,382285 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 20:03:34,382537 (Thread-2): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 20:03:34,393289 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:03:34,394299 (Thread-2): finished collecting timing info
2020-02-27 20:03:34,400962 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:03:34,402349 (Thread-2): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 20:03:34,712242 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:03:34,712982 (Thread-4): finished collecting timing info
2020-02-27 20:03:34,721934 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:03:34,723430 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:03:35,236712 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/adeca05b-45cb-4404-8933-dfecaed02b01?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 20:03:35,237032 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:03:35,237237 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/adeca05b-45cb-4404-8933-dfecaed02b01?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: adeca05b-45cb-4404-8933-dfecaed02b01)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal16completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal10completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal17completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal5completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal13completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:35,237517 (Thread-4): finished collecting timing info
2020-02-27 20:03:35,238355 (Thread-4): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/adeca05b-45cb-4404-8933-dfecaed02b01?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: adeca05b-45cb-4404-8933-dfecaed02b01)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal16completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal10completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal17completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal5completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal13completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:03:35,239493 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11179d250>]}
2020-02-27 20:03:35,617082 (Thread-4): 12:03:35 | 25 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 7.53s]
2020-02-27 20:03:35,617361 (Thread-4): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 20:03:35,618046 (Thread-3): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 20:03:35,618273 (Thread-3): 12:03:35 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 20:03:35,618443 (Thread-3): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 20:03:35,618810 (Thread-4): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:03:35,619001 (Thread-4): 12:03:35 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 20:03:35,619164 (Thread-4): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:03:35,619537 (Thread-3): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:03:35,619691 (Thread-1): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:03:35,619844 (Thread-3): 12:03:35 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 20:03:35,620024 (Thread-1): 12:03:35 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 20:03:35,620261 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:03:35,620469 (Thread-1): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:03:35,620902 (Thread-4): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:03:35,621141 (Thread-4): 12:03:35 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 20:03:35,621282 (Thread-1): Began running node model.journeyengine_recipes.platform_index
2020-02-27 20:03:35,621440 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:03:35,621622 (Thread-1): 12:03:35 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 20:03:35,622017 (Thread-3): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:03:35,622173 (Thread-1): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 20:03:35,622414 (Thread-3): 12:03:35 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 20:03:35,622868 (Thread-4): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 20:03:35,623078 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:03:35,623350 (Thread-4): 12:03:35 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 20:03:35,623762 (Thread-4): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 20:03:36,534697 (Thread-2): finished collecting timing info
2020-02-27 20:03:36,535804 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35615e46-e36b-4f4f-9d71-87000011d8c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112876410>]}
2020-02-27 20:03:36,915592 (Thread-2): 12:03:36 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.15s]
2020-02-27 20:03:36,915878 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:03:36,924873 (MainThread): 12:03:36 | 
2020-02-27 20:03:36,925141 (MainThread): 12:03:36 | Finished running 44 table models in 26.94s.
2020-02-27 20:03:36,925290 (MainThread): Connection 'master' was left open.
2020-02-27 20:03:36,925403 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 20:03:36,925512 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 20:03:36,925618 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 20:03:36,925723 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 20:03:37,76945 (MainThread): 
2020-02-27 20:03:37,77194 (MainThread): Completed with 5 errors and 0 warnings:
2020-02-27 20:03:37,77378 (MainThread): 
2020-02-27 20:03:37,77555 (MainThread): Runtime Error in model adwords_campaigns (models/base/adwords/adwords_campaigns.sql)
2020-02-27 20:03:37,77711 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 20:03:37,77856 (MainThread):   
2020-02-27 20:03:37,78020 (MainThread):   (job ID: a1d893ef-1001-4fb7-ae89-d8b6ff67ef5d)
2020-02-27 20:03:37,78159 (MainThread):   
2020-02-27 20:03:37,78296 (MainThread):                                                                          -----Query Job SQL Follows-----                                                                       
2020-02-27 20:03:37,78432 (MainThread):   
2020-02-27 20:03:37,78565 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:37,78699 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */
2020-02-27 20:03:37,78831 (MainThread):      2:
2020-02-27 20:03:37,78961 (MainThread):      3:
2020-02-27 20:03:37,79111 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
2020-02-27 20:03:37,79423 (MainThread):      5:  
2020-02-27 20:03:37,79599 (MainThread):      6:  
2020-02-27 20:03:37,79747 (MainThread):      7:  OPTIONS()
2020-02-27 20:03:37,79905 (MainThread):      8:  as (
2020-02-27 20:03:37,80048 (MainThread):      9:    SELECT
2020-02-27 20:03:37,80188 (MainThread):     10:day,
2020-02-27 20:03:37,80326 (MainThread):     11:campaignid,
2020-02-27 20:03:37,80461 (MainThread):     12:campaign,
2020-02-27 20:03:37,80595 (MainThread):     13:account, 
2020-02-27 20:03:37,80727 (MainThread):     14:channel,
2020-02-27 20:03:37,80857 (MainThread):     15:platform,
2020-02-27 20:03:37,80987 (MainThread):     16:sum(cost) cost,
2020-02-27 20:03:37,81116 (MainThread):     17:sum(impressions) impressions,
2020-02-27 20:03:37,81244 (MainThread):     18:sum(clicks) clicks,
2020-02-27 20:03:37,81384 (MainThread):     19:sum(conversions) conversions
2020-02-27 20:03:37,81511 (MainThread):     20:FROM
2020-02-27 20:03:37,81745 (MainThread):     21:( 
2020-02-27 20:03:37,81893 (MainThread):     22:	SELECT  
2020-02-27 20:03:37,82088 (MainThread):     23:	'Paid' as channel,
2020-02-27 20:03:37,82235 (MainThread):     24:	'Google Ads' as platform,
2020-02-27 20:03:37,82375 (MainThread):     25:	day,
2020-02-27 20:03:37,82511 (MainThread):     26:	campaignid,
2020-02-27 20:03:37,82645 (MainThread):     27:	campaign,
2020-02-27 20:03:37,82778 (MainThread):     28:	account as account,
2020-02-27 20:03:37,82929 (MainThread):     29:	cost/1000000 cost, 
2020-02-27 20:03:37,83101 (MainThread):     30:	impressions as impressions, 
2020-02-27 20:03:37,83249 (MainThread):     31:	clicks, 
2020-02-27 20:03:37,83392 (MainThread):     32:	conversions,
2020-02-27 20:03:37,83536 (MainThread):     33:	_sdc_sequence,
2020-02-27 20:03:37,83673 (MainThread):     34:	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
2020-02-27 20:03:37,83810 (MainThread):     35:	FROM `journeyengine-recipes.google_ads_.CAMPAIGN_PERFORMANCE_REPORT`
2020-02-27 20:03:37,83944 (MainThread):     36:)
2020-02-27 20:03:37,84077 (MainThread):     37:WHERE lv = _sdc_sequence
2020-02-27 20:03:37,84209 (MainThread):     38:GROUP BY day, campaignid, account, channel, platform, campaign
2020-02-27 20:03:37,84341 (MainThread):     39:  );
2020-02-27 20:03:37,84470 (MainThread):     40:    
2020-02-27 20:03:37,84599 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:37,84818 (MainThread): 
2020-02-27 20:03:37,84990 (MainThread): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 20:03:37,85143 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 20:03:37,85421 (MainThread):   
2020-02-27 20:03:37,85651 (MainThread):   (job ID: 73786e94-a29a-4138-8f22-190a7ea9d871)
2020-02-27 20:03:37,85831 (MainThread):   
2020-02-27 20:03:37,85980 (MainThread):                                                                       -----Query Job SQL Follows-----                                                                     
2020-02-27 20:03:37,86129 (MainThread):   
2020-02-27 20:03:37,86274 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:37,86516 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
2020-02-27 20:03:37,86701 (MainThread):      2:
2020-02-27 20:03:37,86842 (MainThread):      3:
2020-02-27 20:03:37,86981 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
2020-02-27 20:03:37,87125 (MainThread):      5:  
2020-02-27 20:03:37,87262 (MainThread):      6:  
2020-02-27 20:03:37,87395 (MainThread):      7:  OPTIONS()
2020-02-27 20:03:37,87527 (MainThread):      8:  as (
2020-02-27 20:03:37,87657 (MainThread):      9:    SELECT
2020-02-27 20:03:37,87788 (MainThread):     10:campaignid,
2020-02-27 20:03:37,87917 (MainThread):     11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
2020-02-27 20:03:37,88048 (MainThread):     12:FROM 
2020-02-27 20:03:37,88176 (MainThread):     13:(
2020-02-27 20:03:37,88304 (MainThread):     14:	SELECT  
2020-02-27 20:03:37,88433 (MainThread):     15:	campaignid,
2020-02-27 20:03:37,88560 (MainThread):     16:	max(finalurl) finalurl
2020-02-27 20:03:37,88688 (MainThread):     17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
2020-02-27 20:03:37,88816 (MainThread):     18:	GROUP BY campaignid
2020-02-27 20:03:37,88943 (MainThread):     19:)
2020-02-27 20:03:37,89070 (MainThread):     20:  );
2020-02-27 20:03:37,89196 (MainThread):     21:    
2020-02-27 20:03:37,89322 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:03:37,89460 (MainThread): 
2020-02-27 20:03:37,89607 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 20:03:37,89743 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-27 20:03:37,89870 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:03:37,90003 (MainThread): 
2020-02-27 20:03:37,90145 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 20:03:37,90347 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 20:03:37,90602 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:03:37,90834 (MainThread): 
2020-02-27 20:03:37,91016 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 20:03:37,91167 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 20:03:37,91306 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:03:37,91492 (MainThread): 
Done. PASS=39 WARN=0 ERROR=5 SKIP=0 TOTAL=44
2020-02-27 20:03:37,91744 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a35650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11118b3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116602d0>]}
2020-02-27 20:03:37,463933 (MainThread): Flushing usage events
2020-02-27 20:18:57,588720 (MainThread): Running with dbt=0.15.2
2020-02-27 20:18:57,888996 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 20:18:57,890295 (MainThread): Tracking: tracking
2020-02-27 20:18:57,898433 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a647ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a647e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6479d0>]}
2020-02-27 20:18:58,385125 (MainThread): Partial parsing not enabled
2020-02-27 20:18:58,388283 (MainThread): Parsing macros/core.sql
2020-02-27 20:18:58,394287 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 20:18:58,403276 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 20:18:58,405858 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 20:18:58,427235 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 20:18:58,451373 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 20:18:58,473766 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 20:18:58,476659 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 20:18:58,485508 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 20:18:58,498574 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 20:18:58,509911 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 20:18:58,519814 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 20:18:58,526444 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 20:18:58,527836 (MainThread): Parsing macros/etc/query.sql
2020-02-27 20:18:58,529335 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 20:18:58,531651 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 20:18:58,534622 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 20:18:58,545271 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 20:18:58,549597 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 20:18:58,590894 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 20:18:58,592700 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 20:18:58,594239 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 20:18:58,596078 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 20:18:58,599440 (MainThread): Parsing macros/etc.sql
2020-02-27 20:18:58,600978 (MainThread): Parsing macros/catalog.sql
2020-02-27 20:18:58,605869 (MainThread): Parsing macros/adapters.sql
2020-02-27 20:18:58,624251 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 20:18:58,625897 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 20:18:58,630436 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 20:18:58,633253 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 20:18:58,647065 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 20:18:58,654664 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 20:18:58,695328 (MainThread): Partial parsing not enabled
2020-02-27 20:18:58,696324 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 20:18:58,703353 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 20:18:58,711315 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-27 20:18:58,713214 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-27 20:18:58,715561 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-27 20:18:58,718947 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-27 20:18:58,721140 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-27 20:18:58,727260 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-27 20:18:58,729467 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-27 20:18:58,731765 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-27 20:18:58,735191 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-27 20:18:58,737087 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-27 20:18:58,740264 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-27 20:18:58,743554 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-27 20:18:58,747067 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-27 20:18:58,749096 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-27 20:18:58,751382 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-27 20:18:58,753140 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-27 20:18:58,756941 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-27 20:18:58,763098 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-27 20:18:58,766972 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-27 20:18:58,769796 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-27 20:18:58,772297 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-27 20:18:58,796873 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-27 20:18:58,798659 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-27 20:18:58,800172 (MainThread): Parsing macros/logger/log_info.sql
2020-02-27 20:18:58,802390 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-27 20:18:58,808554 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-27 20:18:58,811552 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-27 20:18:58,815263 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-27 20:18:58,817242 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-27 20:18:58,819074 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-27 20:18:58,821462 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-27 20:18:58,824229 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-27 20:18:58,826537 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-27 20:18:58,828532 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-27 20:18:58,830231 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-27 20:18:58,832179 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-27 20:18:58,834565 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-27 20:18:58,836864 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-27 20:18:58,841149 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-27 20:18:58,848367 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-27 20:18:58,850632 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-27 20:18:58,856101 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-27 20:18:58,861675 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-27 20:18:58,865186 (MainThread): Parsing macros/sql/star.sql
2020-02-27 20:18:58,869096 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-27 20:18:58,876906 (MainThread): Parsing macros/sql/union.sql
2020-02-27 20:18:58,888947 (MainThread): Parsing macros/sql/groupby.sql
2020-02-27 20:18:58,890713 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-27 20:18:58,893543 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-27 20:18:58,895954 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-27 20:18:58,902102 (MainThread): Parsing macros/sql/pivot.sql
2020-02-27 20:18:58,906191 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-27 20:18:58,931338 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 20:18:58,931488 (MainThread): Opening a new connection, currently in state init
2020-02-27 20:18:58,957080 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:18:58,957240 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:58,966054 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 20:18:58,966191 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:58,974366 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:18:58,974496 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:58,984562 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 20:18:58,985066 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:58,996026 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 20:18:58,996237 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,9662 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 20:18:59,9837 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,19340 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 20:18:59,19468 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,28681 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:18:59,28803 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,38252 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:18:59,38402 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,54183 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 20:18:59,54385 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,65063 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 20:18:59,65261 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,76317 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:18:59,76506 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,83547 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:18:59,83679 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,90393 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:18:59,90514 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,97586 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:18:59,97716 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,105704 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 20:18:59,105830 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,114922 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 20:18:59,115095 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,124677 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 20:18:59,124903 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,137189 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 20:18:59,137384 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,146604 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 20:18:59,146792 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,156551 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:18:59,156829 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,218140 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 20:18:59,218324 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,229453 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:18:59,229651 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,238328 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:18:59,238529 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,246349 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:18:59,246472 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,292304 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:18:59,292586 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,301704 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:18:59,301843 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,309370 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:18:59,309501 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,316463 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:18:59,316586 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,322832 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:18:59,322948 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,338563 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 20:18:59,338851 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,354125 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:18:59,354277 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,362828 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:18:59,363026 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,378689 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:18:59,378842 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,401203 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:18:59,401347 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,414644 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:18:59,414865 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,432750 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:18:59,432891 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,440488 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:18:59,440622 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,447008 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 20:18:59,447131 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,459047 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 20:18:59,459212 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,467129 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:18:59,467255 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,478272 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:18:59,478426 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,489428 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:18:59,489548 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:18:59,749809 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 20:18:59,777718 (MainThread): 
2020-02-27 20:18:59,778188 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 20:18:59,778311 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:19:00,852148 (MainThread): 12:19:00 | Concurrency: 4 threads (target='dev')
2020-02-27 20:19:00,852406 (MainThread): 12:19:00 | 
2020-02-27 20:19:00,855624 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:19:00,855835 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:19:00,856021 (Thread-1): 12:19:00 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 20:19:00,856153 (Thread-3): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:19:00,856397 (Thread-2): 12:19:00 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 20:19:00,856536 (Thread-4): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:19:00,856814 (Thread-3): 12:19:00 | 3 of 44 START table model agency_data_pipeline.adwords_urls.......... [RUN]
2020-02-27 20:19:00,857138 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:19:00,857387 (Thread-4): 12:19:00 | 4 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 20:19:00,857686 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:19:00,857897 (Thread-1): Opening a new connection, currently in state init
2020-02-27 20:19:00,858189 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:19:00,858365 (Thread-2): Opening a new connection, currently in state init
2020-02-27 20:19:00,858654 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:19:00,858787 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 20:19:00,858916 (Thread-3): Opening a new connection, currently in state init
2020-02-27 20:19:00,859050 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:19:00,859175 (Thread-4): Opening a new connection, currently in state init
2020-02-27 20:19:00,871959 (Thread-3): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 20:19:00,876431 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:19:00,883845 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:19:00,883998 (Thread-4): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 20:19:00,892695 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:19:00,901749 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:19:00,902192 (Thread-1): finished collecting timing info
2020-02-27 20:19:00,902525 (Thread-2): finished collecting timing info
2020-02-27 20:19:00,908186 (Thread-3): finished collecting timing info
2020-02-27 20:19:00,949309 (Thread-4): finished collecting timing info
2020-02-27 20:19:01,632309 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:19:01,644509 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:19:01,674689 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:19:01,675192 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:19:01,676480 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 20:19:01,676654 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 20:19:01,678971 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 20:19:01,679157 (Thread-4): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 20:19:02,658501 (Thread-3): Not Retrying after 0 previous attempts. Error: NotFound('Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US')
2020-02-27 20:19:02,658731 (Thread-3): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM 
(
	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
	GROUP BY campaignid
)
  );
    
2020-02-27 20:19:02,658882 (Thread-3): 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: b8ca6768-958e-458a-ab83-a9250ed9373a)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:19:02,659083 (Thread-3): finished collecting timing info
2020-02-27 20:19:02,659685 (Thread-3): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: b8ca6768-958e-458a-ab83-a9250ed9373a)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US

(job ID: b8ca6768-958e-458a-ab83-a9250ed9373a)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    SELECT
  10:campaignid,
  11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  12:FROM 
  13:(
  14:	SELECT  
  15:	campaignid,
  16:	max(finalurl) finalurl
  17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
  18:	GROUP BY campaignid
  19:)
  20:  );
  21:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 99, in exception_handler
    raise dbt.exceptions.RuntimeException(str(e)) from e
dbt.exceptions.RuntimeException: Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
  
  (job ID: b8ca6768-958e-458a-ab83-a9250ed9373a)
  
                                                                      -----Query Job SQL Follows-----                                                                     
  
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
     1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
     2:
     3:
     4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
     5:  
     6:  
     7:  OPTIONS()
     8:  as (
     9:    SELECT
    10:campaignid,
    11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
    12:FROM 
    13:(
    14:	SELECT  
    15:	campaignid,
    16:	max(finalurl) finalurl
    17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
    18:	GROUP BY campaignid
    19:)
    20:  );
    21:    
      |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:19:02,683575 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be06a10>]}
2020-02-27 20:19:03,58809 (Thread-3): 12:19:03 | 3 of 44 ERROR creating table model agency_data_pipeline.adwords_urls. [ERROR in 1.83s]
2020-02-27 20:19:03,59148 (Thread-3): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:19:03,59381 (Thread-3): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:19:03,59917 (Thread-3): 12:19:03 | 5 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 20:19:03,60399 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:19:03,60550 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 20:19:03,60711 (Thread-3): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:19:03,70218 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:19:03,70672 (Thread-3): finished collecting timing info
2020-02-27 20:19:03,79792 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:19:03,80430 (Thread-3): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 20:19:04,391421 (Thread-4): finished collecting timing info
2020-02-27 20:19:04,392499 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6fe590>]}
2020-02-27 20:19:04,773223 (Thread-4): 12:19:04 | 4 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.53s]
2020-02-27 20:19:04,773530 (Thread-4): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:19:04,773763 (Thread-4): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:19:04,774166 (Thread-4): 12:19:04 | 6 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 20:19:04,774658 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:19:04,774810 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 20:19:04,774973 (Thread-4): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:19:04,784419 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:19:04,784911 (Thread-4): finished collecting timing info
2020-02-27 20:19:04,791071 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:19:04,791497 (Thread-4): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:19:04,932327 (Thread-2): finished collecting timing info
2020-02-27 20:19:04,933521 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b868110>]}
2020-02-27 20:19:05,15797 (Thread-1): finished collecting timing info
2020-02-27 20:19:05,16866 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6ad710>]}
2020-02-27 20:19:05,302170 (Thread-2): 12:19:05 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 4.08s]
2020-02-27 20:19:05,303669 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:19:05,304073 (Thread-2): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:19:05,304510 (Thread-2): 12:19:05 | 7 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 20:19:05,305455 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:19:05,305926 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 20:19:05,306104 (Thread-2): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:19:05,315591 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:19:05,316195 (Thread-2): finished collecting timing info
2020-02-27 20:19:05,322592 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:19:05,323043 (Thread-2): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:19:05,663767 (Thread-3): finished collecting timing info
2020-02-27 20:19:05,664835 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bded710>]}
2020-02-27 20:19:05,674603 (Thread-1): 12:19:05 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 4.16s]
2020-02-27 20:19:05,675175 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:19:05,676217 (Thread-1): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:19:05,676802 (Thread-1): 12:19:05 | 8 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 20:19:05,677790 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:19:05,677936 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 20:19:05,678078 (Thread-1): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:19:05,688058 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:19:05,689802 (Thread-1): finished collecting timing info
2020-02-27 20:19:05,698770 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:19:05,699759 (Thread-1): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 20:19:06,54340 (Thread-3): 12:19:06 | 5 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 2.60s]
2020-02-27 20:19:06,54642 (Thread-3): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:19:06,54877 (Thread-3): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:19:06,55274 (Thread-3): 12:19:06 | 9 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-27 20:19:06,55822 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:19:06,55974 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 20:19:06,56136 (Thread-3): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:19:06,66101 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:19:06,66701 (Thread-3): finished collecting timing info
2020-02-27 20:19:06,73650 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:19:06,76068 (Thread-3): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 20:19:07,302370 (Thread-4): finished collecting timing info
2020-02-27 20:19:07,303432 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b84e390>]}
2020-02-27 20:19:07,681394 (Thread-4): 12:19:07 | 6 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.53s]
2020-02-27 20:19:07,681710 (Thread-4): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:19:07,681943 (Thread-4): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:19:07,682334 (Thread-4): 12:19:07 | 10 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 20:19:07,682822 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:19:07,682977 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 20:19:07,683146 (Thread-4): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:19:07,693889 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:19:07,696729 (Thread-1): finished collecting timing info
2020-02-27 20:19:07,697557 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a65f510>]}
2020-02-27 20:19:07,698934 (Thread-4): finished collecting timing info
2020-02-27 20:19:07,706137 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:19:07,710379 (Thread-4): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 20:19:07,904399 (Thread-2): finished collecting timing info
2020-02-27 20:19:07,905681 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b84e350>]}
2020-02-27 20:19:08,77406 (Thread-1): 12:19:08 | 8 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.02s]
2020-02-27 20:19:08,79066 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:19:08,79485 (Thread-1): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:19:08,79921 (Thread-1): 12:19:08 | 11 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 20:19:08,80625 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:19:08,81114 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 20:19:08,81270 (Thread-1): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:19:08,89879 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:19:08,90684 (Thread-1): finished collecting timing info
2020-02-27 20:19:08,98692 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:19:08,99362 (Thread-1): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 20:19:08,475075 (Thread-2): 12:19:08 | 7 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.60s]
2020-02-27 20:19:08,475395 (Thread-2): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:19:08,475697 (Thread-2): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:19:08,476111 (Thread-2): 12:19:08 | 12 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 20:19:08,476596 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:19:08,476748 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 20:19:08,476910 (Thread-2): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:19:08,486216 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:19:08,486749 (Thread-2): finished collecting timing info
2020-02-27 20:19:08,492816 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:19:08,493259 (Thread-2): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 20:19:09,358285 (Thread-3): finished collecting timing info
2020-02-27 20:19:09,359356 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be6cc10>]}
2020-02-27 20:19:09,726960 (Thread-3): 12:19:09 | 9 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 3.30s]
2020-02-27 20:19:09,727327 (Thread-3): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:19:09,727563 (Thread-3): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:19:09,727960 (Thread-3): 12:19:09 | 13 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 20:19:09,728448 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:19:09,728600 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 20:19:09,728768 (Thread-3): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 20:19:09,739337 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:19:09,739811 (Thread-3): finished collecting timing info
2020-02-27 20:19:09,745800 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:19:09,746192 (Thread-3): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 20:19:10,3759 (Thread-4): finished collecting timing info
2020-02-27 20:19:10,4831 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7a8890>]}
2020-02-27 20:19:10,384817 (Thread-4): 12:19:10 | 10 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.32s]
2020-02-27 20:19:10,385174 (Thread-4): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:19:10,385460 (Thread-4): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:19:10,385914 (Thread-4): 12:19:10 | 14 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 20:19:10,386608 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:19:10,386781 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 20:19:10,386950 (Thread-4): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 20:19:10,399030 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:19:10,399521 (Thread-4): finished collecting timing info
2020-02-27 20:19:10,446043 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:19:10,446656 (Thread-4): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 20:19:10,452350 (Thread-2): finished collecting timing info
2020-02-27 20:19:10,453697 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be62110>]}
2020-02-27 20:19:10,517066 (Thread-1): finished collecting timing info
2020-02-27 20:19:10,518121 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a112e90>]}
2020-02-27 20:19:10,820894 (Thread-2): 12:19:10 | 12 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 1.98s]
2020-02-27 20:19:10,822403 (Thread-2): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:19:10,822779 (Thread-2): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:19:10,823187 (Thread-2): 12:19:10 | 15 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-27 20:19:10,823674 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:19:10,824120 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 20:19:10,824315 (Thread-2): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:19:10,836348 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:11,648229 (Thread-1): 12:19:11 | 11 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.44s]
2020-02-27 20:19:11,648610 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:19:11,648877 (Thread-1): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:19:11,649276 (Thread-1): 12:19:11 | 16 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 20:19:11,649770 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:19:11,649924 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 20:19:11,650089 (Thread-1): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 20:19:11,663865 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:12,157947 (Thread-3): finished collecting timing info
2020-02-27 20:19:12,159012 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf9e550>]}
2020-02-27 20:19:12,298137 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:19:12,298712 (Thread-2): finished collecting timing info
2020-02-27 20:19:12,305018 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:19:12,305434 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-27 20:19:12,560918 (Thread-3): 12:19:12 | 13 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.43s]
2020-02-27 20:19:12,561224 (Thread-3): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:19:12,561458 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:19:12,561697 (Thread-3): 12:19:12 | 17 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 20:19:12,562355 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:19:12,562646 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 20:19:12,562838 (Thread-3): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:19:12,577894 (Thread-3): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:12,639113 (Thread-4): finished collecting timing info
2020-02-27 20:19:12,640179 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a767a90>]}
2020-02-27 20:19:13,10379 (Thread-4): 12:19:13 | 14 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.25s]
2020-02-27 20:19:13,10748 (Thread-4): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:19:13,11036 (Thread-4): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:19:13,11550 (Thread-4): 12:19:13 | 18 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 20:19:13,12291 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:19:13,12510 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 20:19:13,12714 (Thread-4): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:19:13,25760 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:13,113432 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-27 20:19:13,113717 (Thread-1): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 20:19:13,298937 (Thread-1): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 20:19:13,299461 (Thread-1): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 20:19:13,302133 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:19:13,302693 (Thread-1): finished collecting timing info
2020-02-27 20:19:13,310081 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:19:13,310493 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 20:19:13,971486 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-27 20:19:14,134240 (Thread-3): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:19:14,134941 (Thread-3): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:19:14,138188 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:19:14,138785 (Thread-3): finished collecting timing info
2020-02-27 20:19:14,146694 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:19:14,147157 (Thread-3): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 20:19:14,444618 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:19:14,445334 (Thread-4): finished collecting timing info
2020-02-27 20:19:14,453177 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:19:14,453702 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-27 20:19:14,541024 (Thread-2): finished collecting timing info
2020-02-27 20:19:14,542091 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b86c0d0>]}
2020-02-27 20:19:14,909860 (Thread-2): 12:19:14 | 15 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 3.72s]
2020-02-27 20:19:14,910214 (Thread-2): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:19:14,910447 (Thread-2): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:19:14,910980 (Thread-2): 12:19:14 | 19 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 20:19:14,911496 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:19:14,911650 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 20:19:14,911814 (Thread-2): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:19:14,930414 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:15,737230 (Thread-1): finished collecting timing info
2020-02-27 20:19:15,738310 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be96dd0>]}
2020-02-27 20:19:16,107754 (Thread-1): 12:19:16 | 16 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.09s]
2020-02-27 20:19:16,108072 (Thread-1): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:19:16,108311 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:19:16,108849 (Thread-1): 12:19:16 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 20:19:16,109359 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:19:16,109511 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 20:19:16,109673 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:19:16,126373 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:19:16,126860 (Thread-1): finished collecting timing info
2020-02-27 20:19:16,133719 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:19:16,134421 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 20:19:16,432796 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:19:16,585204 (Thread-2): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:19:16,585801 (Thread-2): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:19:16,592053 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:19:16,592562 (Thread-2): finished collecting timing info
2020-02-27 20:19:16,600422 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:19:16,600937 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:19:16,883445 (Thread-4): finished collecting timing info
2020-02-27 20:19:16,884512 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfb0590>]}
2020-02-27 20:19:16,901505 (Thread-3): finished collecting timing info
2020-02-27 20:19:16,902413 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf85f10>]}
2020-02-27 20:19:17,101651 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a390a7cc-aa66-4506-9c2c-27e3987f0ef1?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-27 20:19:17,101952 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:19:17,102164 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a390a7cc-aa66-4506-9c2c-27e3987f0ef1?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: a390a7cc-aa66-4506-9c2c-27e3987f0ef1)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:19:17,102444 (Thread-2): finished collecting timing info
2020-02-27 20:19:17,103252 (Thread-2): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a390a7cc-aa66-4506-9c2c-27e3987f0ef1?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: a390a7cc-aa66-4506-9c2c-27e3987f0ef1)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:19:17,108887 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4f0250>]}
2020-02-27 20:19:17,278377 (Thread-4): 12:19:17 | 18 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.87s]
2020-02-27 20:19:17,279977 (Thread-4): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:19:17,280370 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:19:17,280755 (Thread-4): 12:19:17 | 21 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 20:19:17,281243 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:19:17,281663 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 20:19:17,282160 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:19:17,309497 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:17,673775 (Thread-3): 12:19:17 | 17 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.34s]
2020-02-27 20:19:17,675366 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:19:17,675756 (Thread-3): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 20:19:17,676186 (Thread-3): 12:19:17 | 22 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 20:19:17,676930 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:19:17,677110 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 20:19:17,677591 (Thread-3): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 20:19:17,716239 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:18,79728 (Thread-2): 12:19:18 | 19 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.20s]
2020-02-27 20:19:18,80046 (Thread-2): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:19:18,80283 (Thread-2): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 20:19:18,80790 (Thread-2): 12:19:18 | 23 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 20:19:18,81142 (Thread-2): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 20:19:18,81393 (Thread-2): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 20:19:18,81709 (Thread-2): 12:19:18 | 24 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 20:19:18,82274 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:19:18,82446 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 20:19:18,82615 (Thread-2): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 20:19:18,99606 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:18,587632 (Thread-1): finished collecting timing info
2020-02-27 20:19:18,590053 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdb5150>]}
2020-02-27 20:19:18,758373 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:18,955092 (Thread-1): 12:19:18 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.48s]
2020-02-27 20:19:18,955399 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:19:18,955633 (Thread-1): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:19:18,956022 (Thread-1): 12:19:18 | 25 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 20:19:18,956410 (Thread-1): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:19:18,956642 (Thread-1): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:19:18,956967 (Thread-1): 12:19:18 | 26 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 20:19:18,957291 (Thread-1): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:19:18,957534 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:19:18,957850 (Thread-1): 12:19:18 | 27 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 20:19:18,958316 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:19:18,958467 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 20:19:18,958628 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:19:18,970559 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:19:18,971092 (Thread-1): finished collecting timing info
2020-02-27 20:19:18,978388 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:19:18,978849 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 20:19:19,104856 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:19,577816 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:19:19,578506 (Thread-2): finished collecting timing info
2020-02-27 20:19:19,585980 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:19:19,586388 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 20:19:19,882589 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 20:19:20,17381 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:19:20,17956 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:19:20,18387 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 20:19:20,214762 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:19:20,215397 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:19:20,218224 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:19:20,218793 (Thread-4): finished collecting timing info
2020-02-27 20:19:20,226267 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:19:20,226742 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:19:20,670089 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/ebee8be6-8106-42b7-9c31-a5f2908f5a93?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 20:19:20,670393 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:19:20,670597 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/ebee8be6-8106-42b7-9c31-a5f2908f5a93?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: ebee8be6-8106-42b7-9c31-a5f2908f5a93)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:19:20,670876 (Thread-4): finished collecting timing info
2020-02-27 20:19:20,671681 (Thread-4): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/ebee8be6-8106-42b7-9c31-a5f2908f5a93?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: ebee8be6-8106-42b7-9c31-a5f2908f5a93)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:19:20,672792 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b812cd0>]}
2020-02-27 20:19:20,758335 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:21,43782 (Thread-4): 12:19:21 | 21 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.39s]
2020-02-27 20:19:21,45228 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:19:21,45559 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:19:21,46149 (Thread-4): 12:19:21 | 28 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 20:19:21,46426 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:19:21,46997 (Thread-4): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:19:21,47286 (Thread-4): 12:19:21 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 20:19:21,47539 (Thread-4): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:19:21,48096 (Thread-4): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:19:21,48345 (Thread-4): 12:19:21 | 30 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 20:19:21,48552 (Thread-4): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:19:21,241400 (Thread-1): finished collecting timing info
2020-02-27 20:19:21,242471 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be9eb50>]}
2020-02-27 20:19:21,613180 (Thread-1): 12:19:21 | 27 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.28s]
2020-02-27 20:19:21,613487 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:19:21,614093 (Thread-4): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:19:21,614294 (Thread-1): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:19:21,614553 (Thread-4): 12:19:21 | 31 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 20:19:21,614782 (Thread-1): 12:19:21 | 32 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 20:19:21,615347 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:19:21,615780 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:19:21,615906 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 20:19:21,616078 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 20:19:21,616265 (Thread-4): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:19:21,616443 (Thread-1): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 20:19:21,627371 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:19:21,636137 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:19:21,636810 (Thread-4): finished collecting timing info
2020-02-27 20:19:21,643744 (Thread-1): finished collecting timing info
2020-02-27 20:19:21,644667 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:19:21,651750 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:19:21,652466 (Thread-1): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 20:19:21,652734 (Thread-4): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 20:19:22,59006 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:22,264684 (Thread-2): finished collecting timing info
2020-02-27 20:19:22,265746 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be98f10>]}
2020-02-27 20:19:22,659401 (Thread-2): 12:19:22 | 24 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 4.18s]
2020-02-27 20:19:22,659705 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 20:19:22,660245 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:19:22,660489 (Thread-2): 12:19:22 | 33 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 20:19:22,660696 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:19:22,661125 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:19:22,661370 (Thread-2): 12:19:22 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 20:19:22,661577 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:19:22,661974 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:19:22,662187 (Thread-2): 12:19:22 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 20:19:22,662385 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:19:23,823018 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:19:23,986865 (Thread-1): finished collecting timing info
2020-02-27 20:19:23,987926 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d373d0>]}
2020-02-27 20:19:24,68275 (Thread-4): finished collecting timing info
2020-02-27 20:19:24,69342 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb01650>]}
2020-02-27 20:19:24,362113 (Thread-1): 12:19:24 | 32 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.37s]
2020-02-27 20:19:24,363976 (Thread-1): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:19:24,727491 (Thread-4): 12:19:24 | 31 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.45s]
2020-02-27 20:19:24,727851 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:19:24,728411 (Thread-2): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:19:24,728667 (Thread-2): 12:19:24 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 20:19:24,729133 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:19:24,729283 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-27 20:19:24,729442 (Thread-2): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 20:19:24,739997 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:19:24,740438 (Thread-2): finished collecting timing info
2020-02-27 20:19:24,746465 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:19:24,746890 (Thread-2): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 20:19:25,170840 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:19:25,171546 (Thread-3): finished collecting timing info
2020-02-27 20:19:25,179954 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:19:25,182522 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:19:25,734253 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/299deb8d-e7d6-445e-b542-2be859860df9?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 20:19:25,734553 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:19:25,734759 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/299deb8d-e7d6-445e-b542-2be859860df9?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 299deb8d-e7d6-445e-b542-2be859860df9)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal10completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal16completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal5completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal13completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal17completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:19:25,735040 (Thread-3): finished collecting timing info
2020-02-27 20:19:25,735843 (Thread-3): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/299deb8d-e7d6-445e-b542-2be859860df9?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 299deb8d-e7d6-445e-b542-2be859860df9)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal10completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal16completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal5completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal13completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal17completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:19:25,737014 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bea0e10>]}
2020-02-27 20:19:26,97319 (Thread-3): 12:19:26 | 22 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 8.06s]
2020-02-27 20:19:26,97696 (Thread-3): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 20:19:26,98416 (Thread-4): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 20:19:26,98681 (Thread-4): 12:19:26 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 20:19:26,98901 (Thread-4): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 20:19:26,99378 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:19:26,99629 (Thread-3): 12:19:26 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 20:19:26,99840 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:19:26,100342 (Thread-4): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:19:26,100550 (Thread-1): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:19:26,100757 (Thread-4): 12:19:26 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 20:19:26,100978 (Thread-1): 12:19:26 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 20:19:26,101288 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:19:26,101556 (Thread-1): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:19:26,102248 (Thread-3): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:19:26,102482 (Thread-4): Began running node model.journeyengine_recipes.platform_index
2020-02-27 20:19:26,102677 (Thread-3): 12:19:26 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 20:19:26,102904 (Thread-4): 12:19:26 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 20:19:26,103196 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:19:26,103439 (Thread-4): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 20:19:26,103970 (Thread-1): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:19:26,104279 (Thread-1): 12:19:26 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 20:19:26,104474 (Thread-4): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 20:19:26,104679 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:19:26,104916 (Thread-4): 12:19:26 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 20:19:26,105303 (Thread-4): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 20:19:26,965286 (Thread-2): finished collecting timing info
2020-02-27 20:19:26,966355 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b5a45e5-b11b-4bf5-bbd6-21efd9727f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a78cfd0>]}
2020-02-27 20:19:27,339253 (Thread-2): 12:19:27 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.24s]
2020-02-27 20:19:27,339626 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:19:27,363426 (MainThread): 12:19:27 | 
2020-02-27 20:19:27,363787 (MainThread): 12:19:27 | Finished running 44 table models in 27.59s.
2020-02-27 20:19:27,364022 (MainThread): Connection 'master' was left open.
2020-02-27 20:19:27,364202 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 20:19:27,364376 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 20:19:27,364547 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 20:19:27,364714 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 20:19:27,508998 (MainThread): 
2020-02-27 20:19:27,509235 (MainThread): Completed with 4 errors and 0 warnings:
2020-02-27 20:19:27,509438 (MainThread): 
2020-02-27 20:19:27,509625 (MainThread): Runtime Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 20:19:27,509774 (MainThread):   404 Not found: Dataset journeyengine-recipes:google_ads_ was not found in location US
2020-02-27 20:19:27,509912 (MainThread):   
2020-02-27 20:19:27,510049 (MainThread):   (job ID: b8ca6768-958e-458a-ab83-a9250ed9373a)
2020-02-27 20:19:27,510182 (MainThread):   
2020-02-27 20:19:27,510314 (MainThread):                                                                       -----Query Job SQL Follows-----                                                                     
2020-02-27 20:19:27,510446 (MainThread):   
2020-02-27 20:19:27,510575 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:19:27,510704 (MainThread):      1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
2020-02-27 20:19:27,510833 (MainThread):      2:
2020-02-27 20:19:27,510960 (MainThread):      3:
2020-02-27 20:19:27,511086 (MainThread):      4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
2020-02-27 20:19:27,511212 (MainThread):      5:  
2020-02-27 20:19:27,511337 (MainThread):      6:  
2020-02-27 20:19:27,511463 (MainThread):      7:  OPTIONS()
2020-02-27 20:19:27,511588 (MainThread):      8:  as (
2020-02-27 20:19:27,511713 (MainThread):      9:    SELECT
2020-02-27 20:19:27,511838 (MainThread):     10:campaignid,
2020-02-27 20:19:27,511963 (MainThread):     11:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
2020-02-27 20:19:27,512088 (MainThread):     12:FROM 
2020-02-27 20:19:27,512216 (MainThread):     13:(
2020-02-27 20:19:27,512339 (MainThread):     14:	SELECT  
2020-02-27 20:19:27,512464 (MainThread):     15:	campaignid,
2020-02-27 20:19:27,512603 (MainThread):     16:	max(finalurl) finalurl
2020-02-27 20:19:27,512729 (MainThread):     17:	FROM `journeyengine-recipes.google_ads_.FINAL_URL_REPORT`
2020-02-27 20:19:27,512854 (MainThread):     18:	GROUP BY campaignid
2020-02-27 20:19:27,512979 (MainThread):     19:)
2020-02-27 20:19:27,513103 (MainThread):     20:  );
2020-02-27 20:19:27,513227 (MainThread):     21:    
2020-02-27 20:19:27,513351 (MainThread):       |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:19:27,513486 (MainThread): 
2020-02-27 20:19:27,513625 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 20:19:27,513756 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-27 20:19:27,513881 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:19:27,514013 (MainThread): 
2020-02-27 20:19:27,514151 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 20:19:27,514296 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 20:19:27,514421 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:19:27,514552 (MainThread): 
2020-02-27 20:19:27,514691 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 20:19:27,514821 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 20:19:27,514946 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:19:27,515107 (MainThread): 
Done. PASS=40 WARN=0 ERROR=4 SKIP=0 TOTAL=44
2020-02-27 20:19:27,515337 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8d3550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf49290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c21e150>]}
2020-02-27 20:19:27,937465 (MainThread): Flushing usage events
2020-02-27 20:28:35,762086 (MainThread): Running with dbt=0.15.2
2020-02-27 20:28:36,51837 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 20:28:36,53653 (MainThread): Tracking: tracking
2020-02-27 20:28:36,62672 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a24a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a24a3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a24a7d0>]}
2020-02-27 20:28:36,511040 (MainThread): Partial parsing not enabled
2020-02-27 20:28:36,513836 (MainThread): Parsing macros/core.sql
2020-02-27 20:28:36,521876 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 20:28:36,532377 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 20:28:36,534942 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 20:28:36,556442 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 20:28:36,580320 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 20:28:36,602450 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 20:28:36,605569 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 20:28:36,614528 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 20:28:36,624502 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 20:28:36,632769 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 20:28:36,640817 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 20:28:36,647283 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 20:28:36,648781 (MainThread): Parsing macros/etc/query.sql
2020-02-27 20:28:36,650418 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 20:28:36,652846 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 20:28:36,655771 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 20:28:36,666361 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 20:28:36,669013 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 20:28:36,704340 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 20:28:36,707473 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 20:28:36,709915 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 20:28:36,712366 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 20:28:36,717009 (MainThread): Parsing macros/etc.sql
2020-02-27 20:28:36,719043 (MainThread): Parsing macros/catalog.sql
2020-02-27 20:28:36,724127 (MainThread): Parsing macros/adapters.sql
2020-02-27 20:28:36,742527 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 20:28:36,744193 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 20:28:36,747329 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 20:28:36,749738 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 20:28:36,761698 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 20:28:36,769523 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 20:28:36,815320 (MainThread): Partial parsing not enabled
2020-02-27 20:28:36,816249 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 20:28:36,821198 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 20:28:36,827122 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-27 20:28:36,828651 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-27 20:28:36,830729 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-27 20:28:36,833993 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-27 20:28:36,836107 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-27 20:28:36,842537 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-27 20:28:36,844969 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-27 20:28:36,847185 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-27 20:28:36,850549 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-27 20:28:36,852329 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-27 20:28:36,855514 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-27 20:28:36,858708 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-27 20:28:36,861392 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-27 20:28:36,863617 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-27 20:28:36,865634 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-27 20:28:36,867016 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-27 20:28:36,870717 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-27 20:28:36,876627 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-27 20:28:36,880692 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-27 20:28:36,885434 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-27 20:28:36,889259 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-27 20:28:36,915421 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-27 20:28:36,916711 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-27 20:28:36,918073 (MainThread): Parsing macros/logger/log_info.sql
2020-02-27 20:28:36,919278 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-27 20:28:36,923770 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-27 20:28:36,927724 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-27 20:28:36,932587 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-27 20:28:36,935411 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-27 20:28:36,938314 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-27 20:28:36,940873 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-27 20:28:36,944040 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-27 20:28:36,946369 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-27 20:28:36,948309 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-27 20:28:36,950028 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-27 20:28:36,952020 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-27 20:28:36,954553 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-27 20:28:36,956552 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-27 20:28:36,960903 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-27 20:28:36,965767 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-27 20:28:36,967539 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-27 20:28:36,971914 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-27 20:28:36,977306 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-27 20:28:36,981019 (MainThread): Parsing macros/sql/star.sql
2020-02-27 20:28:36,985105 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-27 20:28:36,993610 (MainThread): Parsing macros/sql/union.sql
2020-02-27 20:28:37,5748 (MainThread): Parsing macros/sql/groupby.sql
2020-02-27 20:28:37,7570 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-27 20:28:37,10234 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-27 20:28:37,12397 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-27 20:28:37,20410 (MainThread): Parsing macros/sql/pivot.sql
2020-02-27 20:28:37,25494 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-27 20:28:37,56531 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 20:28:37,56783 (MainThread): Opening a new connection, currently in state init
2020-02-27 20:28:37,87350 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:28:37,87550 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,97258 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 20:28:37,97524 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,108208 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:28:37,108403 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,116873 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 20:28:37,117055 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,125817 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 20:28:37,126005 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,139605 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 20:28:37,139747 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,149111 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 20:28:37,149236 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,158672 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:28:37,158802 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,168253 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:28:37,168379 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,183042 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 20:28:37,183241 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,193229 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 20:28:37,193419 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,205413 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:28:37,205550 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,212212 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:28:37,212344 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,220037 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:28:37,220241 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,229491 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:28:37,229651 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,238122 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 20:28:37,238247 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,246339 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 20:28:37,246481 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,254874 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 20:28:37,255005 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,263855 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 20:28:37,264006 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,272778 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 20:28:37,272926 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,281042 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:28:37,281173 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,336842 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 20:28:37,337095 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,350630 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:28:37,350819 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,359153 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:28:37,359277 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,365809 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:28:37,365930 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,374182 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:28:37,374349 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,419653 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:28:37,419865 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,427209 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:28:37,427401 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,434432 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:28:37,434613 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,441871 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:28:37,442027 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,457690 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 20:28:37,457985 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,472355 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:28:37,472612 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,486960 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:28:37,487215 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,504322 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:28:37,504511 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,526618 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:28:37,526779 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,539363 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:28:37,539555 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,555993 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:28:37,556210 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,566085 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:28:37,566341 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,576397 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 20:28:37,576573 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,586534 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 20:28:37,586664 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,594199 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:28:37,594326 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,605227 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:28:37,605357 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,616063 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:28:37,616182 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:37,878508 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 20:28:37,905801 (MainThread): 
2020-02-27 20:28:37,906227 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 20:28:37,906349 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:28:38,877439 (MainThread): 12:28:38 | Concurrency: 4 threads (target='dev')
2020-02-27 20:28:38,877707 (MainThread): 12:28:38 | 
2020-02-27 20:28:38,880693 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:28:38,880903 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:28:38,881109 (Thread-1): 12:28:38 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 20:28:38,881257 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:28:38,881485 (Thread-2): 12:28:38 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 20:28:38,881670 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:28:38,881928 (Thread-3): 12:28:38 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 20:28:38,882262 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:28:38,882545 (Thread-4): 12:28:38 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 20:28:38,882862 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:28:38,883094 (Thread-1): Opening a new connection, currently in state init
2020-02-27 20:28:38,883381 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:28:38,883611 (Thread-2): Opening a new connection, currently in state init
2020-02-27 20:28:38,883902 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:28:38,884087 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 20:28:38,884235 (Thread-3): Opening a new connection, currently in state init
2020-02-27 20:28:38,884390 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:28:38,884534 (Thread-4): Opening a new connection, currently in state init
2020-02-27 20:28:38,897517 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 20:28:38,904259 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:28:38,913382 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:28:38,913702 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:28:38,921922 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:28:38,930278 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:28:38,930514 (Thread-1): finished collecting timing info
2020-02-27 20:28:38,930997 (Thread-2): finished collecting timing info
2020-02-27 20:28:38,942302 (Thread-3): finished collecting timing info
2020-02-27 20:28:38,964281 (Thread-4): finished collecting timing info
2020-02-27 20:28:39,601557 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:28:39,615264 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:28:39,634846 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:28:39,647306 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:28:39,648812 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 20:28:39,649698 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 20:28:39,650779 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 20:28:39,650965 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 20:28:42,598738 (Thread-1): finished collecting timing info
2020-02-27 20:28:42,600091 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a257c50>]}
2020-02-27 20:28:42,649947 (Thread-3): finished collecting timing info
2020-02-27 20:28:42,652085 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a1990>]}
2020-02-27 20:28:42,681946 (Thread-4): finished collecting timing info
2020-02-27 20:28:42,682993 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a1e90>]}
2020-02-27 20:28:42,841651 (Thread-2): finished collecting timing info
2020-02-27 20:28:42,842751 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a1950>]}
2020-02-27 20:28:42,969192 (Thread-1): 12:28:42 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.72s]
2020-02-27 20:28:42,971171 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:28:42,971663 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:28:42,972556 (Thread-1): 12:28:42 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 20:28:42,973344 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:28:42,973514 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 20:28:42,974005 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:28:42,984159 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:28:42,984834 (Thread-1): finished collecting timing info
2020-02-27 20:28:42,991350 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:28:42,991816 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:28:43,350227 (Thread-3): 12:28:43 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.77s]
2020-02-27 20:28:43,351023 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:28:43,351402 (Thread-3): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:28:43,352727 (Thread-3): 12:28:43 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 20:28:43,353418 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:28:43,353613 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 20:28:43,353813 (Thread-3): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:28:43,363616 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:28:43,364673 (Thread-3): finished collecting timing info
2020-02-27 20:28:43,372963 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:28:43,373629 (Thread-3): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:28:43,740105 (Thread-4): 12:28:43 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.80s]
2020-02-27 20:28:43,741451 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:28:43,741788 (Thread-4): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:28:43,742185 (Thread-4): 12:28:43 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 20:28:43,742672 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:28:43,743090 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 20:28:43,743567 (Thread-4): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:28:43,752941 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:28:43,753574 (Thread-4): finished collecting timing info
2020-02-27 20:28:43,759982 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:28:43,760684 (Thread-4): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 20:28:44,123303 (Thread-2): 12:28:44 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 3.96s]
2020-02-27 20:28:44,123610 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:28:44,123843 (Thread-2): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:28:44,124283 (Thread-2): 12:28:44 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-27 20:28:44,124972 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:28:44,125141 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 20:28:44,125305 (Thread-2): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:28:44,134657 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:28:44,135169 (Thread-2): finished collecting timing info
2020-02-27 20:28:44,141383 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:28:44,141811 (Thread-2): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 20:28:45,278103 (Thread-1): finished collecting timing info
2020-02-27 20:28:45,279164 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9bbad0>]}
2020-02-27 20:28:45,597969 (Thread-3): finished collecting timing info
2020-02-27 20:28:45,599277 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9f1390>]}
2020-02-27 20:28:45,656330 (Thread-1): 12:28:45 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.31s]
2020-02-27 20:28:45,657838 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:28:45,658119 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:28:45,658606 (Thread-1): 12:28:45 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 20:28:45,659097 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:28:45,659520 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 20:28:45,660017 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:28:45,669966 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:28:45,670555 (Thread-1): finished collecting timing info
2020-02-27 20:28:45,678049 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:28:45,678496 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 20:28:45,955254 (Thread-4): finished collecting timing info
2020-02-27 20:28:45,956382 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9c0d50>]}
2020-02-27 20:28:46,37197 (Thread-3): 12:28:46 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.25s]
2020-02-27 20:28:46,38937 (Thread-3): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:28:46,39319 (Thread-3): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:28:46,39744 (Thread-3): 12:28:46 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 20:28:46,40251 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:28:46,40748 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 20:28:46,40919 (Thread-3): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:28:46,50694 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:28:46,51498 (Thread-3): finished collecting timing info
2020-02-27 20:28:46,58123 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:28:46,58835 (Thread-3): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 20:28:46,421662 (Thread-4): 12:28:46 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.21s]
2020-02-27 20:28:46,422019 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:28:46,422303 (Thread-4): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:28:46,422595 (Thread-4): 12:28:46 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 20:28:46,423291 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:28:46,423441 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 20:28:46,423600 (Thread-4): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:28:46,433153 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:28:46,433675 (Thread-4): finished collecting timing info
2020-02-27 20:28:46,440317 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:28:46,440872 (Thread-4): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 20:28:46,518086 (Thread-2): finished collecting timing info
2020-02-27 20:28:46,519152 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b720990>]}
2020-02-27 20:28:46,879802 (Thread-2): 12:28:46 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.39s]
2020-02-27 20:28:46,880172 (Thread-2): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:28:46,880406 (Thread-2): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:28:46,880798 (Thread-2): 12:28:46 | 12 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-27 20:28:46,881278 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:28:46,881429 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 20:28:46,881589 (Thread-2): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:28:46,894145 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:47,806190 (Thread-1): finished collecting timing info
2020-02-27 20:28:47,808012 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9bb290>]}
2020-02-27 20:28:48,220921 (Thread-1): 12:28:48 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.15s]
2020-02-27 20:28:48,221281 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:28:48,221639 (Thread-1): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:28:48,222200 (Thread-1): 12:28:48 | 13 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-27 20:28:48,223075 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:28:48,223249 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 20:28:48,223438 (Thread-1): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 20:28:48,237743 (Thread-1): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:48,454731 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:28:48,455326 (Thread-2): finished collecting timing info
2020-02-27 20:28:48,461872 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:28:48,464783 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-27 20:28:48,502865 (Thread-3): finished collecting timing info
2020-02-27 20:28:48,503924 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bae9050>]}
2020-02-27 20:28:48,781961 (Thread-4): finished collecting timing info
2020-02-27 20:28:48,783117 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b44e310>]}
2020-02-27 20:28:48,872187 (Thread-3): 12:28:48 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.46s]
2020-02-27 20:28:48,873538 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:28:48,873834 (Thread-3): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:28:48,874169 (Thread-3): 12:28:48 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 20:28:48,874589 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:28:48,874917 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 20:28:48,875338 (Thread-3): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 20:28:48,889497 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:49,253913 (Thread-4): 12:28:49 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.36s]
2020-02-27 20:28:49,254220 (Thread-4): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:28:49,254452 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:28:49,254688 (Thread-4): 12:28:49 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 20:28:49,255303 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:28:49,255472 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 20:28:49,255637 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:28:49,270951 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:49,611012 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:28:49,611685 (Thread-1): finished collecting timing info
2020-02-27 20:28:49,619408 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:28:49,619867 (Thread-1): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls
GROUP BY campaignid

 
  );
    
2020-02-27 20:28:50,46502 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/4211099b-1e77-422c-941b-ba6fbe7e5d8e?maxResults=0&location=US: SELECT list expression references column campaignid which is neither grouped nor aggregated at [17:9]')
2020-02-27 20:28:50,46764 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls
GROUP BY campaignid

 
  );
    
2020-02-27 20:28:50,46942 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/4211099b-1e77-422c-941b-ba6fbe7e5d8e?maxResults=0&location=US: SELECT list expression references column campaignid which is neither grouped nor aggregated at [17:9]

(job ID: 4211099b-1e77-422c-941b-ba6fbe7e5d8e)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with adwords_urls as (
  14:      
  15:
  16:	SELECT  
  17:	campaignid,
  18:	max(finalurl) finalurl
  19:	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
  20:		    
  21:            
  22:)
  23:
  24:SELECT
  25:campaignid,
  26:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  27:FROM adwords_urls
  28:GROUP BY campaignid
  29:
  30: 
  31:  );
  32:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:28:50,47174 (Thread-1): finished collecting timing info
2020-02-27 20:28:50,47888 (Thread-1): Database Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  SELECT list expression references column campaignid which is neither grouped nor aggregated at [17:9]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_urls.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/4211099b-1e77-422c-941b-ba6fbe7e5d8e?maxResults=0&location=US: SELECT list expression references column campaignid which is neither grouped nor aggregated at [17:9]

(job ID: 4211099b-1e77-422c-941b-ba6fbe7e5d8e)

                                                                    -----Query Job SQL Follows-----                                                                     

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with adwords_urls as (
  14:      
  15:
  16:	SELECT  
  17:	campaignid,
  18:	max(finalurl) finalurl
  19:	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
  20:		    
  21:            
  22:)
  23:
  24:SELECT
  25:campaignid,
  26:lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  27:FROM adwords_urls
  28:GROUP BY campaignid
  29:
  30: 
  31:  );
  32:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
  SELECT list expression references column campaignid which is neither grouped nor aggregated at [17:9]
  compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_urls.sql
2020-02-27 20:28:50,64918 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9bb290>]}
2020-02-27 20:28:50,453824 (Thread-1): 12:28:50 | 13 of 44 ERROR creating table model agency_data_pipeline.adwords_urls [ERROR in 1.84s]
2020-02-27 20:28:50,454130 (Thread-1): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:28:50,454364 (Thread-1): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:28:50,454882 (Thread-1): 12:28:50 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 20:28:50,455365 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:28:50,455518 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 20:28:50,455680 (Thread-1): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:28:50,468728 (Thread-1): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:50,588755 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-27 20:28:50,589050 (Thread-3): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 20:28:50,608049 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 20:28:50,756338 (Thread-3): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 20:28:50,756772 (Thread-3): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 20:28:50,759443 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:28:50,760065 (Thread-3): finished collecting timing info
2020-02-27 20:28:50,769109 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:28:50,769698 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 20:28:50,824706 (Thread-4): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:28:50,825209 (Thread-4): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:28:50,827382 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:28:50,827865 (Thread-4): finished collecting timing info
2020-02-27 20:28:50,835254 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:28:50,864985 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 20:28:51,214477 (Thread-2): finished collecting timing info
2020-02-27 20:28:51,215550 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bacb050>]}
2020-02-27 20:28:51,591756 (Thread-2): 12:28:51 | 12 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 4.33s]
2020-02-27 20:28:51,592098 (Thread-2): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:28:51,592399 (Thread-2): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:28:51,593011 (Thread-2): 12:28:51 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 20:28:51,593576 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:28:51,593728 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 20:28:51,593889 (Thread-2): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:28:51,610489 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:51,838994 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:28:51,839713 (Thread-1): finished collecting timing info
2020-02-27 20:28:51,847746 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:28:51,848305 (Thread-1): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-27 20:28:52,777787 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:28:52,947812 (Thread-2): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:28:52,948496 (Thread-2): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:28:52,954883 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:28:52,955396 (Thread-2): finished collecting timing info
2020-02-27 20:28:52,961998 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:28:52,962406 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:28:53,218956 (Thread-3): finished collecting timing info
2020-02-27 20:28:53,220028 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba81e50>]}
2020-02-27 20:28:53,446715 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/65963cca-8695-4e88-a0eb-ff287965f4f7?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-27 20:28:53,447012 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:28:53,447226 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/65963cca-8695-4e88-a0eb-ff287965f4f7?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 65963cca-8695-4e88-a0eb-ff287965f4f7)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:28:53,447509 (Thread-2): finished collecting timing info
2020-02-27 20:28:53,448277 (Thread-2): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/65963cca-8695-4e88-a0eb-ff287965f4f7?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 65963cca-8695-4e88-a0eb-ff287965f4f7)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:28:53,449337 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb8ce90>]}
2020-02-27 20:28:53,586686 (Thread-3): 12:28:53 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.35s]
2020-02-27 20:28:53,588028 (Thread-3): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:28:53,588417 (Thread-3): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:28:53,588977 (Thread-3): 12:28:53 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 20:28:53,589753 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:28:53,590230 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 20:28:53,590438 (Thread-3): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 20:28:53,601055 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:28:53,601695 (Thread-3): finished collecting timing info
2020-02-27 20:28:53,608045 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:28:53,608485 (Thread-3): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 20:28:53,852798 (Thread-4): finished collecting timing info
2020-02-27 20:28:53,853919 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b989d90>]}
2020-02-27 20:28:54,8556 (Thread-2): 12:28:54 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.86s]
2020-02-27 20:28:54,10070 (Thread-2): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:28:54,10457 (Thread-2): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:28:54,10934 (Thread-2): 12:28:54 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 20:28:54,11718 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:28:54,12196 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 20:28:54,12375 (Thread-2): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 20:28:54,23516 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:28:54,24188 (Thread-2): finished collecting timing info
2020-02-27 20:28:54,31702 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:28:54,32161 (Thread-2): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 20:28:54,386275 (Thread-4): 12:28:54 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.60s]
2020-02-27 20:28:54,386574 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:28:54,386807 (Thread-4): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:28:54,387199 (Thread-4): 12:28:54 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 20:28:54,387696 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:28:54,387855 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 20:28:54,388018 (Thread-4): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:28:54,404960 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:28:54,405458 (Thread-4): finished collecting timing info
2020-02-27 20:28:54,411583 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:28:54,412041 (Thread-4): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 20:28:55,183094 (Thread-1): finished collecting timing info
2020-02-27 20:28:55,184165 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bba5b90>]}
2020-02-27 20:28:55,563820 (Thread-1): 12:28:55 | 16 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 4.73s]
2020-02-27 20:28:55,564122 (Thread-1): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:28:55,564356 (Thread-1): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 20:28:55,564759 (Thread-1): 12:28:55 | 21 of 44 SKIP relation agency_data_pipeline.adwords_join............. [SKIP]
2020-02-27 20:28:55,565112 (Thread-1): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 20:28:55,565353 (Thread-1): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 20:28:55,565687 (Thread-1): 12:28:55 | 22 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 20:28:55,566252 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:28:55,566409 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 20:28:55,566570 (Thread-1): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 20:28:55,582835 (Thread-1): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:55,788002 (Thread-3): finished collecting timing info
2020-02-27 20:28:55,789072 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9ae8d0>]}
2020-02-27 20:28:56,170409 (Thread-3): 12:28:56 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.20s]
2020-02-27 20:28:56,170717 (Thread-3): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:28:56,170950 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:28:56,171474 (Thread-3): 12:28:56 | 23 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 20:28:56,171714 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:28:56,171931 (Thread-3): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:28:56,172250 (Thread-3): 12:28:56 | 24 of 44 SKIP relation agency_data_pipeline.adwords_stats............ [SKIP]
2020-02-27 20:28:56,172563 (Thread-3): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:28:56,172795 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:28:56,173099 (Thread-3): 12:28:56 | 25 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 20:28:56,173566 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:28:56,173716 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 20:28:56,173874 (Thread-3): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:28:56,195934 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:56,419858 (Thread-2): finished collecting timing info
2020-02-27 20:28:56,421054 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b980cd0>]}
2020-02-27 20:28:56,783946 (Thread-2): 12:28:56 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.41s]
2020-02-27 20:28:56,784315 (Thread-2): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:28:56,784581 (Thread-2): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:28:56,785148 (Thread-2): 12:28:56 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 20:28:56,785381 (Thread-2): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:28:56,785597 (Thread-2): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 20:28:56,785960 (Thread-2): 12:28:56 | 27 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 20:28:56,786643 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:28:56,786815 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 20:28:56,787012 (Thread-2): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 20:28:56,822017 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:56,959735 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:28:56,960415 (Thread-1): finished collecting timing info
2020-02-27 20:28:56,968950 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:28:56,969536 (Thread-1): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 20:28:57,424404 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:57,533407 (Thread-4): finished collecting timing info
2020-02-27 20:28:57,534475 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b980650>]}
2020-02-27 20:28:57,926943 (Thread-4): 12:28:57 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 3.15s]
2020-02-27 20:28:57,927230 (Thread-4): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:28:57,927465 (Thread-4): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:28:57,927858 (Thread-4): 12:28:57 | 28 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 20:28:57,928222 (Thread-4): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:28:57,928439 (Thread-4): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:28:57,928788 (Thread-4): 12:28:57 | 29 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 20:28:57,929355 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:28:57,929506 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 20:28:57,929670 (Thread-4): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:28:57,942423 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:28:57,942959 (Thread-4): finished collecting timing info
2020-02-27 20:28:57,949648 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:28:57,950225 (Thread-4): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 20:28:58,283290 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:58,785980 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-27 20:28:58,961866 (Thread-3): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:28:58,962551 (Thread-3): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:28:58,963056 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-27 20:28:59,141258 (Thread-3): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:28:59,141817 (Thread-3): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:28:59,144571 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:28:59,145150 (Thread-3): finished collecting timing info
2020-02-27 20:28:59,153890 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:28:59,154478 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:28:59,333489 (Thread-1): finished collecting timing info
2020-02-27 20:28:59,334564 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3b7cd0>]}
2020-02-27 20:28:59,369246 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:28:59,610211 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/ab89a6b0-3184-4fbf-b335-f89fb0a6cbee?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 20:28:59,610465 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:28:59,610634 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/ab89a6b0-3184-4fbf-b335-f89fb0a6cbee?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: ab89a6b0-3184-4fbf-b335-f89fb0a6cbee)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:28:59,610868 (Thread-3): finished collecting timing info
2020-02-27 20:28:59,611550 (Thread-3): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/ab89a6b0-3184-4fbf-b335-f89fb0a6cbee?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: ab89a6b0-3184-4fbf-b335-f89fb0a6cbee)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:28:59,612613 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b744810>]}
2020-02-27 20:28:59,711444 (Thread-1): 12:28:59 | 22 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.77s]
2020-02-27 20:28:59,713126 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 20:28:59,713483 (Thread-1): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:28:59,713876 (Thread-1): 12:28:59 | 30 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 20:28:59,714109 (Thread-1): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:29:00,95406 (Thread-4): finished collecting timing info
2020-02-27 20:29:00,96461 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2ad310>]}
2020-02-27 20:29:00,138621 (Thread-3): 12:29:00 | 25 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.44s]
2020-02-27 20:29:00,140390 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:29:00,141341 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:29:00,141949 (Thread-1): 12:29:00 | 31 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 20:29:00,142502 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:29:00,143116 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:29:00,143352 (Thread-3): 12:29:00 | 32 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 20:29:00,143564 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:29:00,144074 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:29:00,144302 (Thread-1): 12:29:00 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 20:29:00,144558 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:29:00,494469 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:29:00,545981 (Thread-4): 12:29:00 | 29 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.17s]
2020-02-27 20:29:00,546297 (Thread-4): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:29:00,546845 (Thread-3): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:29:00,547047 (Thread-1): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:29:00,547227 (Thread-3): 12:29:00 | 34 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 20:29:00,547404 (Thread-1): 12:29:00 | 35 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 20:29:00,547842 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:29:00,548007 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 20:29:00,548308 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:29:00,548462 (Thread-3): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:29:00,548673 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-27 20:29:00,552388 (Thread-1): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 20:29:00,566771 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:29:00,569911 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:29:00,570441 (Thread-1): finished collecting timing info
2020-02-27 20:29:00,576805 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:29:00,577102 (Thread-3): finished collecting timing info
2020-02-27 20:29:00,585803 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:29:00,586248 (Thread-1): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 20:29:00,587700 (Thread-3): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 20:29:01,865613 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:29:02,767530 (Thread-1): finished collecting timing info
2020-02-27 20:29:02,768942 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b747a90>]}
2020-02-27 20:29:03,143532 (Thread-1): 12:29:03 | 35 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.22s]
2020-02-27 20:29:03,143903 (Thread-1): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:29:03,269528 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:29:03,270203 (Thread-2): finished collecting timing info
2020-02-27 20:29:03,278139 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:29:03,278626 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:29:03,386219 (Thread-3): finished collecting timing info
2020-02-27 20:29:03,387272 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb33410>]}
2020-02-27 20:29:03,707419 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/5a62e2e4-087f-4299-8dea-d8148347d6f2?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 20:29:03,707724 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:29:03,707953 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/5a62e2e4-087f-4299-8dea-d8148347d6f2?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 5a62e2e4-087f-4299-8dea-d8148347d6f2)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal5completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal17completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal10completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal18completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal16completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal13completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:29:03,708184 (Thread-2): finished collecting timing info
2020-02-27 20:29:03,708866 (Thread-2): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/5a62e2e4-087f-4299-8dea-d8148347d6f2?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 5a62e2e4-087f-4299-8dea-d8148347d6f2)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal5completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal17completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal10completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal18completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal16completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal13completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:29:03,709912 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb6e8d0>]}
2020-02-27 20:29:03,752496 (Thread-3): 12:29:03 | 34 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.84s]
2020-02-27 20:29:03,753925 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:29:03,754573 (Thread-4): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:29:03,754830 (Thread-4): 12:29:03 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 20:29:03,755586 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:29:03,756058 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 20:29:03,756241 (Thread-4): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 20:29:03,768565 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:29:03,769270 (Thread-4): finished collecting timing info
2020-02-27 20:29:03,775576 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:29:03,776017 (Thread-4): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 20:29:04,131943 (Thread-2): 12:29:04 | 27 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 6.92s]
2020-02-27 20:29:04,132301 (Thread-2): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 20:29:04,133056 (Thread-3): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 20:29:04,133356 (Thread-3): 12:29:04 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 20:29:04,133609 (Thread-3): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 20:29:04,134143 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:29:04,134477 (Thread-2): 12:29:04 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 20:29:04,134731 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:29:04,135360 (Thread-3): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:29:04,135607 (Thread-1): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:29:04,135829 (Thread-3): 12:29:04 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 20:29:04,136099 (Thread-1): 12:29:04 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 20:29:04,136441 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:29:04,136746 (Thread-1): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:29:04,137287 (Thread-2): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:29:04,137596 (Thread-2): 12:29:04 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 20:29:04,137783 (Thread-1): Began running node model.journeyengine_recipes.platform_index
2020-02-27 20:29:04,137988 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:29:04,138221 (Thread-1): 12:29:04 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 20:29:04,138695 (Thread-3): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:29:04,138904 (Thread-1): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 20:29:04,139102 (Thread-3): 12:29:04 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 20:29:04,139575 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:29:04,139759 (Thread-2): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 20:29:04,140127 (Thread-2): 12:29:04 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 20:29:04,140342 (Thread-2): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 20:29:05,929963 (Thread-4): finished collecting timing info
2020-02-27 20:29:05,930793 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e931e92-bf9c-4ac2-bca6-8467d2843d6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bca3c90>]}
2020-02-27 20:29:06,298431 (Thread-4): 12:29:06 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.18s]
2020-02-27 20:29:06,298685 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:29:06,372142 (MainThread): 12:29:06 | 
2020-02-27 20:29:06,372381 (MainThread): 12:29:06 | Finished running 44 table models in 28.47s.
2020-02-27 20:29:06,372528 (MainThread): Connection 'master' was left open.
2020-02-27 20:29:06,372641 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 20:29:06,372750 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 20:29:06,372858 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 20:29:06,372963 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 20:29:06,513391 (MainThread): 
2020-02-27 20:29:06,513653 (MainThread): Completed with 4 errors and 0 warnings:
2020-02-27 20:29:06,513811 (MainThread): 
2020-02-27 20:29:06,513967 (MainThread): Database Error in model adwords_urls (models/base/adwords/adwords_urls.sql)
2020-02-27 20:29:06,514117 (MainThread):   SELECT list expression references column campaignid which is neither grouped nor aggregated at [17:9]
2020-02-27 20:29:06,514264 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/adwords/adwords_urls.sql
2020-02-27 20:29:06,514405 (MainThread): 
2020-02-27 20:29:06,514550 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 20:29:06,514688 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-27 20:29:06,514819 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:29:06,514955 (MainThread): 
2020-02-27 20:29:06,515097 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 20:29:06,515232 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 20:29:06,515360 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:29:06,515494 (MainThread): 
2020-02-27 20:29:06,515634 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 20:29:06,515764 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 20:29:06,515888 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:29:06,516051 (MainThread): 
Done. PASS=40 WARN=0 ERROR=4 SKIP=0 TOTAL=44
2020-02-27 20:29:06,516286 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6f5d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2fb8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2ad110>]}
2020-02-27 20:29:06,874050 (MainThread): Flushing usage events
2020-02-27 20:31:01,583752 (MainThread): Running with dbt=0.15.2
2020-02-27 20:31:01,878608 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 20:31:01,879623 (MainThread): Tracking: tracking
2020-02-27 20:31:01,889154 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ceaee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ceae4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ceaedd0>]}
2020-02-27 20:31:02,326664 (MainThread): Partial parsing not enabled
2020-02-27 20:31:02,329465 (MainThread): Parsing macros/core.sql
2020-02-27 20:31:02,337482 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 20:31:02,347919 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 20:31:02,350584 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 20:31:02,371944 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 20:31:02,399389 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 20:31:02,421785 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 20:31:02,424857 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 20:31:02,435866 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 20:31:02,446243 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 20:31:02,455050 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 20:31:02,462952 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 20:31:02,469737 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 20:31:02,471139 (MainThread): Parsing macros/etc/query.sql
2020-02-27 20:31:02,472672 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 20:31:02,474992 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 20:31:02,477660 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 20:31:02,488447 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 20:31:02,491226 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 20:31:02,527310 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 20:31:02,530008 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 20:31:02,532057 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 20:31:02,534165 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 20:31:02,538457 (MainThread): Parsing macros/etc.sql
2020-02-27 20:31:02,540167 (MainThread): Parsing macros/catalog.sql
2020-02-27 20:31:02,545152 (MainThread): Parsing macros/adapters.sql
2020-02-27 20:31:02,563184 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 20:31:02,564741 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 20:31:02,567850 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 20:31:02,570023 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 20:31:02,583276 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 20:31:02,590656 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 20:31:02,634686 (MainThread): Partial parsing not enabled
2020-02-27 20:31:02,635746 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 20:31:02,642331 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 20:31:02,650868 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-27 20:31:02,652992 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-27 20:31:02,655357 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-27 20:31:02,659026 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-27 20:31:02,661221 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-27 20:31:02,667744 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-27 20:31:02,670159 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-27 20:31:02,672124 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-27 20:31:02,675291 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-27 20:31:02,676842 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-27 20:31:02,679633 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-27 20:31:02,682709 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-27 20:31:02,685496 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-27 20:31:02,687921 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-27 20:31:02,690534 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-27 20:31:02,692309 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-27 20:31:02,695815 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-27 20:31:02,701808 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-27 20:31:02,705609 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-27 20:31:02,708328 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-27 20:31:02,710982 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-27 20:31:02,736236 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-27 20:31:02,737464 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-27 20:31:02,738895 (MainThread): Parsing macros/logger/log_info.sql
2020-02-27 20:31:02,740278 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-27 20:31:02,744859 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-27 20:31:02,747340 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-27 20:31:02,751054 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-27 20:31:02,753212 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-27 20:31:02,755156 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-27 20:31:02,757260 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-27 20:31:02,760236 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-27 20:31:02,762691 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-27 20:31:02,764628 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-27 20:31:02,766165 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-27 20:31:02,768099 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-27 20:31:02,770631 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-27 20:31:02,772999 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-27 20:31:02,777389 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-27 20:31:02,783074 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-27 20:31:02,784985 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-27 20:31:02,789416 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-27 20:31:02,794505 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-27 20:31:02,798086 (MainThread): Parsing macros/sql/star.sql
2020-02-27 20:31:02,802212 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-27 20:31:02,810221 (MainThread): Parsing macros/sql/union.sql
2020-02-27 20:31:02,826671 (MainThread): Parsing macros/sql/groupby.sql
2020-02-27 20:31:02,828781 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-27 20:31:02,831992 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-27 20:31:02,834552 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-27 20:31:02,840668 (MainThread): Parsing macros/sql/pivot.sql
2020-02-27 20:31:02,844650 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-27 20:31:02,872032 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 20:31:02,872215 (MainThread): Opening a new connection, currently in state init
2020-02-27 20:31:02,904351 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:31:02,904486 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,912535 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 20:31:02,912726 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,921117 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:31:02,921281 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,930753 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 20:31:02,931004 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,942079 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 20:31:02,942287 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,956090 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 20:31:02,956268 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,965737 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 20:31:02,965874 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,975607 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:31:02,975743 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,984892 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:31:02,985047 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:02,999480 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 20:31:02,999733 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,14229 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 20:31:03,14503 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,28603 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:31:03,28733 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,36839 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:31:03,37053 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,46312 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:31:03,46516 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,55134 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:31:03,55328 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,65023 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 20:31:03,65279 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,76033 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 20:31:03,76237 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,84829 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 20:31:03,84951 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,94215 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 20:31:03,94354 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,103250 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 20:31:03,103461 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,114148 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:31:03,114335 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,171626 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 20:31:03,171868 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,185576 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:31:03,185713 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,193535 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:31:03,193658 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,201014 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:31:03,201171 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,210164 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:31:03,210337 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,254453 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:31:03,254733 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,264001 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:31:03,264211 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,271818 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:31:03,272022 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,279247 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:31:03,279444 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,292658 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 20:31:03,292783 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,303590 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:31:03,303719 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,312412 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:31:03,312556 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,326109 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:31:03,326245 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,348772 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:31:03,348981 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,363490 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:31:03,363707 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,384557 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:31:03,384714 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,392976 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:31:03,393104 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,402086 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 20:31:03,402275 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,412572 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 20:31:03,412749 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,421263 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:31:03,421412 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,435324 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:31:03,435495 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,447595 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:31:03,447719 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:03,721923 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 20:31:03,745654 (MainThread): 
2020-02-27 20:31:03,746140 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 20:31:03,746271 (MainThread): Opening a new connection, currently in state closed
2020-02-27 20:31:04,471356 (MainThread): 12:31:04 | Concurrency: 4 threads (target='dev')
2020-02-27 20:31:04,471610 (MainThread): 12:31:04 | 
2020-02-27 20:31:04,477850 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:31:04,478171 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:31:04,478408 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:31:04,478613 (Thread-1): 12:31:04 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 20:31:04,478777 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:31:04,479084 (Thread-2): 12:31:04 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 20:31:04,479292 (Thread-3): 12:31:04 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 20:31:04,479615 (Thread-4): 12:31:04 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 20:31:04,479979 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 20:31:04,480374 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 20:31:04,480697 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 20:31:04,481018 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 20:31:04,481123 (Thread-1): Opening a new connection, currently in state init
2020-02-27 20:31:04,481257 (Thread-2): Opening a new connection, currently in state init
2020-02-27 20:31:04,481389 (Thread-3): Opening a new connection, currently in state init
2020-02-27 20:31:04,481518 (Thread-4): Opening a new connection, currently in state init
2020-02-27 20:31:04,481671 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 20:31:04,481808 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:31:04,481945 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 20:31:04,482081 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:31:04,513288 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:31:04,519729 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:31:04,521080 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:31:04,528873 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:31:04,529694 (Thread-1): finished collecting timing info
2020-02-27 20:31:04,530015 (Thread-2): finished collecting timing info
2020-02-27 20:31:04,530277 (Thread-3): finished collecting timing info
2020-02-27 20:31:04,555788 (Thread-4): finished collecting timing info
2020-02-27 20:31:05,245263 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 20:31:05,259259 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 20:31:05,260070 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 20:31:05,280486 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 20:31:05,281699 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 20:31:05,283932 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 20:31:05,284161 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 20:31:05,286419 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 20:31:07,877597 (Thread-4): finished collecting timing info
2020-02-27 20:31:07,878684 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e05da50>]}
2020-02-27 20:31:08,147558 (Thread-2): finished collecting timing info
2020-02-27 20:31:08,148631 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0e15d0>]}
2020-02-27 20:31:08,247080 (Thread-4): 12:31:08 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.40s]
2020-02-27 20:31:08,248707 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 20:31:08,249194 (Thread-4): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:31:08,249642 (Thread-4): 12:31:08 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 20:31:08,250413 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 20:31:08,250881 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 20:31:08,251055 (Thread-4): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:31:08,260375 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:31:08,261089 (Thread-4): finished collecting timing info
2020-02-27 20:31:08,268270 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 20:31:08,269728 (Thread-4): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:31:08,321842 (Thread-1): finished collecting timing info
2020-02-27 20:31:08,322924 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1242d0>]}
2020-02-27 20:31:08,642544 (Thread-2): 12:31:08 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 3.67s]
2020-02-27 20:31:08,643102 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 20:31:08,643414 (Thread-2): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:31:08,644739 (Thread-2): 12:31:08 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 20:31:08,645520 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 20:31:08,645966 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 20:31:08,646438 (Thread-2): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:31:08,655445 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:31:08,656057 (Thread-2): finished collecting timing info
2020-02-27 20:31:08,662449 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 20:31:08,662930 (Thread-2): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 20:31:08,827057 (Thread-3): finished collecting timing info
2020-02-27 20:31:08,828129 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e05d3d0>]}
2020-02-27 20:31:09,27446 (Thread-1): 12:31:09 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.84s]
2020-02-27 20:31:09,27987 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 20:31:09,28874 (Thread-1): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:31:09,29342 (Thread-1): 12:31:09 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 20:31:09,30045 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 20:31:09,30191 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 20:31:09,30555 (Thread-1): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:31:09,38880 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:31:09,39676 (Thread-1): finished collecting timing info
2020-02-27 20:31:09,45999 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 20:31:09,46496 (Thread-1): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 20:31:09,408580 (Thread-3): 12:31:09 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 4.35s]
2020-02-27 20:31:09,408886 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 20:31:09,409119 (Thread-3): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:31:09,409519 (Thread-3): 12:31:09 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-27 20:31:09,410003 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 20:31:09,410154 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 20:31:09,410323 (Thread-3): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:31:09,419641 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:31:09,420144 (Thread-3): finished collecting timing info
2020-02-27 20:31:09,427284 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 20:31:09,427705 (Thread-3): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 20:31:10,535297 (Thread-4): finished collecting timing info
2020-02-27 20:31:10,536364 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfc6ed0>]}
2020-02-27 20:31:10,797769 (Thread-2): finished collecting timing info
2020-02-27 20:31:10,798937 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5e62d0>]}
2020-02-27 20:31:10,883616 (Thread-1): finished collecting timing info
2020-02-27 20:31:10,884548 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0e15d0>]}
2020-02-27 20:31:10,937794 (Thread-4): 12:31:10 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.29s]
2020-02-27 20:31:10,938378 (Thread-4): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 20:31:10,938701 (Thread-4): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:31:10,940024 (Thread-4): 12:31:10 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 20:31:10,940590 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 20:31:10,940747 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 20:31:10,940915 (Thread-4): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:31:10,950429 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:31:10,951291 (Thread-4): finished collecting timing info
2020-02-27 20:31:10,957515 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 20:31:10,958282 (Thread-4): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 20:31:11,322071 (Thread-2): 12:31:11 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.15s]
2020-02-27 20:31:11,322689 (Thread-2): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 20:31:11,323957 (Thread-2): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:31:11,324598 (Thread-2): 12:31:11 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 20:31:11,325287 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 20:31:11,325479 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 20:31:11,325628 (Thread-2): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:31:11,334183 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:31:11,335054 (Thread-2): finished collecting timing info
2020-02-27 20:31:11,341848 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 20:31:11,342550 (Thread-2): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 20:31:11,707155 (Thread-1): 12:31:11 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 1.85s]
2020-02-27 20:31:11,707391 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 20:31:11,707576 (Thread-1): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:31:11,707764 (Thread-1): 12:31:11 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 20:31:11,708283 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 20:31:11,708411 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 20:31:11,708549 (Thread-1): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:31:11,716879 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:31:11,717302 (Thread-1): finished collecting timing info
2020-02-27 20:31:11,724885 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 20:31:11,725556 (Thread-1): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 20:31:11,737708 (Thread-3): finished collecting timing info
2020-02-27 20:31:11,738806 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5f0550>]}
2020-02-27 20:31:12,119002 (Thread-3): 12:31:12 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.33s]
2020-02-27 20:31:12,119357 (Thread-3): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 20:31:12,119626 (Thread-3): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:31:12,120073 (Thread-3): 12:31:12 | 12 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 20:31:12,120651 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 20:31:12,120839 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 20:31:12,121036 (Thread-3): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 20:31:12,132396 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:31:12,132902 (Thread-3): finished collecting timing info
2020-02-27 20:31:12,139025 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 20:31:12,139992 (Thread-3): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 20:31:12,894009 (Thread-4): finished collecting timing info
2020-02-27 20:31:12,895212 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6fd310>]}
2020-02-27 20:31:13,263013 (Thread-4): 12:31:13 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 1.95s]
2020-02-27 20:31:13,263369 (Thread-4): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 20:31:13,263646 (Thread-4): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:31:13,264069 (Thread-4): 12:31:13 | 13 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 20:31:13,264724 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 20:31:13,264913 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 20:31:13,265079 (Thread-4): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 20:31:13,275476 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:31:13,275998 (Thread-4): finished collecting timing info
2020-02-27 20:31:13,281923 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 20:31:13,282416 (Thread-4): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 20:31:14,96930 (Thread-3): finished collecting timing info
2020-02-27 20:31:14,97999 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e07d4d0>]}
2020-02-27 20:31:14,125790 (Thread-2): finished collecting timing info
2020-02-27 20:31:14,126855 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6ed950>]}
2020-02-27 20:31:14,205470 (Thread-1): finished collecting timing info
2020-02-27 20:31:14,206384 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6d8e10>]}
2020-02-27 20:31:14,464591 (Thread-3): 12:31:14 | 12 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 1.98s]
2020-02-27 20:31:14,466303 (Thread-3): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 20:31:14,466669 (Thread-3): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:31:14,467081 (Thread-3): 12:31:14 | 14 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-27 20:31:14,467957 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 20:31:14,468124 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 20:31:14,468595 (Thread-3): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:31:14,484431 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:14,848957 (Thread-2): 12:31:14 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.80s]
2020-02-27 20:31:14,850556 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 20:31:14,850903 (Thread-2): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:31:14,851277 (Thread-2): 12:31:14 | 15 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-27 20:31:14,851746 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 20:31:14,852166 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 20:31:14,852673 (Thread-2): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 20:31:14,868015 (Thread-2): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:15,244318 (Thread-1): 12:31:15 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.50s]
2020-02-27 20:31:15,244662 (Thread-1): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 20:31:15,244929 (Thread-1): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:31:15,245330 (Thread-1): 12:31:15 | 16 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 20:31:15,245827 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 20:31:15,245979 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 20:31:15,246141 (Thread-1): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 20:31:15,304558 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:15,650186 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:31:15,652010 (Thread-3): finished collecting timing info
2020-02-27 20:31:15,659116 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 20:31:15,660054 (Thread-3): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-27 20:31:16,187543 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:31:16,188199 (Thread-2): finished collecting timing info
2020-02-27 20:31:16,196806 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 20:31:16,198217 (Thread-2): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-27 20:31:16,505218 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-27 20:31:16,505504 (Thread-1): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 20:31:16,559675 (Thread-4): finished collecting timing info
2020-02-27 20:31:16,560935 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0d1110>]}
2020-02-27 20:31:16,660151 (Thread-1): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 20:31:16,660569 (Thread-1): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 20:31:16,663303 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:31:16,663877 (Thread-1): finished collecting timing info
2020-02-27 20:31:16,670635 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 20:31:16,671080 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 20:31:16,928177 (Thread-4): 12:31:16 | 13 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 3.30s]
2020-02-27 20:31:16,928484 (Thread-4): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 20:31:16,928721 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:31:16,929152 (Thread-4): 12:31:16 | 17 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 20:31:16,929782 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 20:31:16,929947 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 20:31:16,930114 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:31:16,944790 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:18,102644 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 20:31:18,269964 (Thread-4): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:31:18,270661 (Thread-4): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:31:18,273873 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:31:18,274423 (Thread-4): finished collecting timing info
2020-02-27 20:31:18,282367 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 20:31:18,282806 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 20:31:18,315329 (Thread-3): finished collecting timing info
2020-02-27 20:31:18,316681 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e776c10>]}
2020-02-27 20:31:18,325807 (Thread-2): finished collecting timing info
2020-02-27 20:31:18,326810 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfc6ed0>]}
2020-02-27 20:31:18,698297 (Thread-3): 12:31:18 | 14 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 3.85s]
2020-02-27 20:31:18,700240 (Thread-3): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 20:31:18,700599 (Thread-3): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:31:18,700975 (Thread-3): 12:31:18 | 18 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 20:31:18,701446 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 20:31:18,701862 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 20:31:18,702347 (Thread-3): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:31:18,714711 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:19,94571 (Thread-2): 12:31:19 | 15 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 3.48s]
2020-02-27 20:31:19,94895 (Thread-2): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 20:31:19,95131 (Thread-2): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:31:19,95661 (Thread-2): 12:31:19 | 19 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 20:31:19,96192 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 20:31:19,96362 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 20:31:19,96528 (Thread-2): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:31:19,115534 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:19,641081 (Thread-1): finished collecting timing info
2020-02-27 20:31:19,642158 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6ce290>]}
2020-02-27 20:31:20,18070 (Thread-1): 12:31:20 | 16 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.40s]
2020-02-27 20:31:20,18425 (Thread-1): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 20:31:20,18727 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:31:20,19257 (Thread-1): 12:31:20 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 20:31:20,19749 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 20:31:20,19903 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 20:31:20,20066 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:31:20,37913 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:31:20,38412 (Thread-1): finished collecting timing info
2020-02-27 20:31:20,44840 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 20:31:20,45372 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 20:31:20,284872 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:31:20,285545 (Thread-3): finished collecting timing info
2020-02-27 20:31:20,293116 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 20:31:20,293544 (Thread-3): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-27 20:31:20,464643 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:31:20,657238 (Thread-2): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 20:31:20,657942 (Thread-2): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 20:31:20,664946 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:31:20,665534 (Thread-2): finished collecting timing info
2020-02-27 20:31:20,674439 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 20:31:20,674967 (Thread-2): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:31:21,196599 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/bcaa00da-1ea4-44c9-add3-fc137aee8c31?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-27 20:31:21,196909 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 20:31:21,197123 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/bcaa00da-1ea4-44c9-add3-fc137aee8c31?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: bcaa00da-1ea4-44c9-add3-fc137aee8c31)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:31:21,197405 (Thread-2): finished collecting timing info
2020-02-27 20:31:21,198216 (Thread-2): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/bcaa00da-1ea4-44c9-add3-fc137aee8c31?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: bcaa00da-1ea4-44c9-add3-fc137aee8c31)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:31:21,212520 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e721890>]}
2020-02-27 20:31:21,591711 (Thread-2): 12:31:21 | 19 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.12s]
2020-02-27 20:31:21,592025 (Thread-2): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 20:31:21,592265 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:31:21,592738 (Thread-2): 12:31:21 | 21 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 20:31:21,593234 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 20:31:21,593386 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 20:31:21,593549 (Thread-2): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:31:21,620040 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:21,622976 (Thread-4): finished collecting timing info
2020-02-27 20:31:21,624484 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e709990>]}
2020-02-27 20:31:21,944090 (Thread-1): finished collecting timing info
2020-02-27 20:31:21,945164 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e144490>]}
2020-02-27 20:31:22,3179 (Thread-4): 12:31:22 | 17 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.69s]
2020-02-27 20:31:22,4813 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 20:31:22,5170 (Thread-4): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 20:31:22,5560 (Thread-4): 12:31:22 | 22 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 20:31:22,6070 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 20:31:22,6536 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 20:31:22,7041 (Thread-4): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 20:31:22,44819 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:22,403622 (Thread-1): 12:31:22 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 1.93s]
2020-02-27 20:31:22,403939 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 20:31:22,404177 (Thread-1): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 20:31:22,404594 (Thread-1): 12:31:22 | 23 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-27 20:31:22,405213 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 20:31:22,405408 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 20:31:22,405576 (Thread-1): Compiling model.journeyengine_recipes.adwords_join
2020-02-27 20:31:22,417836 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 20:31:22,420627 (Thread-1): finished collecting timing info
2020-02-27 20:31:22,427225 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 20:31:22,430668 (Thread-1): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-27 20:31:22,546764 (Thread-3): finished collecting timing info
2020-02-27 20:31:22,547839 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e697ad0>]}
2020-02-27 20:31:22,744147 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:22,920794 (Thread-3): 12:31:22 | 18 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.85s]
2020-02-27 20:31:22,921097 (Thread-3): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 20:31:22,921332 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 20:31:22,921749 (Thread-3): 12:31:22 | 24 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 20:31:22,922366 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 20:31:22,922553 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 20:31:22,922721 (Thread-3): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 20:31:22,937169 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:23,125373 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:23,880352 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:31:24,40670 (Thread-2): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:31:24,41161 (Thread-2): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:31:24,41525 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 20:31:24,187728 (Thread-2): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 20:31:24,188450 (Thread-2): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 20:31:24,191748 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:31:24,192363 (Thread-2): finished collecting timing info
2020-02-27 20:31:24,201128 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 20:31:24,201595 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:31:24,235423 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:24,302759 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:31:24,303304 (Thread-3): finished collecting timing info
2020-02-27 20:31:24,309800 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 20:31:24,310219 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 20:31:24,605283 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/d887ce88-e0e2-4324-a335-b731b8a97c0e?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 20:31:24,605592 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 20:31:24,605797 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/d887ce88-e0e2-4324-a335-b731b8a97c0e?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: d887ce88-e0e2-4324-a335-b731b8a97c0e)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:31:24,606071 (Thread-2): finished collecting timing info
2020-02-27 20:31:24,606882 (Thread-2): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/d887ce88-e0e2-4324-a335-b731b8a97c0e?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: d887ce88-e0e2-4324-a335-b731b8a97c0e)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:31:24,608013 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e71fc90>]}
2020-02-27 20:31:24,815822 (Thread-1): finished collecting timing info
2020-02-27 20:31:24,817008 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e709990>]}
2020-02-27 20:31:24,995833 (Thread-2): 12:31:24 | 21 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.01s]
2020-02-27 20:31:24,997027 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 20:31:24,997401 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:31:24,997831 (Thread-2): 12:31:24 | 25 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 20:31:24,998232 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 20:31:24,998738 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 20:31:24,999205 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:31:25,10938 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:31:25,11655 (Thread-2): finished collecting timing info
2020-02-27 20:31:25,18743 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 20:31:25,19364 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 20:31:25,414995 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:25,415396 (Thread-1): 12:31:25 | 23 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 2.41s]
2020-02-27 20:31:25,416142 (Thread-1): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 20:31:25,416997 (Thread-1): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:31:25,417582 (Thread-1): 12:31:25 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 20:31:25,417828 (Thread-1): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 20:31:25,418315 (Thread-1): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:31:25,418831 (Thread-1): 12:31:25 | 27 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-27 20:31:25,419399 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 20:31:25,419665 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-27 20:31:25,420015 (Thread-1): Compiling model.journeyengine_recipes.adwords_stats
2020-02-27 20:31:25,430423 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 20:31:25,431030 (Thread-1): finished collecting timing info
2020-02-27 20:31:25,438390 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 20:31:25,438847 (Thread-1): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-27 20:31:26,723494 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 20:31:27,8738 (Thread-3): finished collecting timing info
2020-02-27 20:31:27,9821 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5ead10>]}
2020-02-27 20:31:27,152359 (Thread-2): finished collecting timing info
2020-02-27 20:31:27,153435 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e776c10>]}
2020-02-27 20:31:27,388310 (Thread-3): 12:31:27 | 24 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 4.09s]
2020-02-27 20:31:27,388948 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 20:31:27,390018 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:31:27,390511 (Thread-3): 12:31:27 | 28 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 20:31:27,390866 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 20:31:27,391381 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:31:27,392149 (Thread-3): 12:31:27 | 29 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 20:31:27,392582 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 20:31:27,392829 (Thread-3): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:31:27,393328 (Thread-3): 12:31:27 | 30 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 20:31:27,393564 (Thread-3): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 20:31:27,394087 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:31:27,394335 (Thread-3): 12:31:27 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 20:31:27,394544 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 20:31:27,775706 (Thread-2): 12:31:27 | 25 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.16s]
2020-02-27 20:31:27,776035 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 20:31:27,776605 (Thread-3): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:31:27,776910 (Thread-2): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:31:27,777249 (Thread-3): 12:31:27 | 32 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 20:31:27,777531 (Thread-2): 12:31:27 | 33 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 20:31:27,778164 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 20:31:27,778584 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 20:31:27,778712 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-27 20:31:27,778883 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 20:31:27,779072 (Thread-3): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:31:27,779248 (Thread-2): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 20:31:27,790100 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:31:27,798493 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:31:27,800709 (Thread-3): finished collecting timing info
2020-02-27 20:31:27,807136 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 20:31:27,807985 (Thread-2): finished collecting timing info
2020-02-27 20:31:27,817734 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 20:31:27,818287 (Thread-3): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 20:31:27,819811 (Thread-2): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 20:31:27,852708 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:31:27,853388 (Thread-4): finished collecting timing info
2020-02-27 20:31:27,862526 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 20:31:27,862995 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:31:28,110604 (Thread-1): finished collecting timing info
2020-02-27 20:31:28,112213 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e807e90>]}
2020-02-27 20:31:28,338375 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a5f933e1-a2e3-4258-bbad-ae27cb4c80fe?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 20:31:28,338683 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 20:31:28,338890 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a5f933e1-a2e3-4258-bbad-ae27cb4c80fe?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: a5f933e1-a2e3-4258-bbad-ae27cb4c80fe)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal5completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal17completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal13completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal16completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal10completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal18completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 20:31:28,339170 (Thread-4): finished collecting timing info
2020-02-27 20:31:28,339994 (Thread-4): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a5f933e1-a2e3-4258-bbad-ae27cb4c80fe?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: a5f933e1-a2e3-4258-bbad-ae27cb4c80fe)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal5completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal17completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal13completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal16completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal10completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal18completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:31:28,341084 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e030c10>]}
2020-02-27 20:31:28,480475 (Thread-1): 12:31:28 | 27 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.69s]
2020-02-27 20:31:28,482232 (Thread-1): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 20:31:28,482979 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:31:28,483226 (Thread-1): 12:31:28 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 20:31:28,483804 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 20:31:28,484943 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:31:28,485164 (Thread-1): 12:31:28 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 20:31:28,485372 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 20:31:28,892911 (Thread-4): 12:31:28 | 22 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 6.34s]
2020-02-27 20:31:28,893272 (Thread-4): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 20:31:28,894000 (Thread-1): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 20:31:28,894309 (Thread-1): 12:31:28 | 36 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 20:31:28,894570 (Thread-1): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 20:31:28,895088 (Thread-4): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:31:28,895383 (Thread-4): 12:31:28 | 37 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 20:31:28,895634 (Thread-4): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 20:31:28,896216 (Thread-1): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:31:28,896453 (Thread-4): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:31:28,896679 (Thread-1): 12:31:28 | 38 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 20:31:28,896941 (Thread-4): 12:31:28 | 39 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 20:31:28,897291 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 20:31:28,897685 (Thread-4): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 20:31:28,898326 (Thread-1): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:31:28,898626 (Thread-1): 12:31:28 | 40 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 20:31:28,898878 (Thread-4): Began running node model.journeyengine_recipes.platform_index
2020-02-27 20:31:28,899091 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 20:31:28,899280 (Thread-4): 12:31:28 | 41 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 20:31:28,899760 (Thread-1): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:31:28,899957 (Thread-4): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 20:31:28,900141 (Thread-1): 12:31:28 | 42 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 20:31:28,900608 (Thread-4): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 20:31:28,900856 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 20:31:28,901092 (Thread-4): 12:31:28 | 43 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 20:31:28,901513 (Thread-4): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 20:31:29,793951 (Thread-3): finished collecting timing info
2020-02-27 20:31:29,795028 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e38d350>]}
2020-02-27 20:31:29,909345 (Thread-2): finished collecting timing info
2020-02-27 20:31:29,910202 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e38d450>]}
2020-02-27 20:31:30,168160 (Thread-3): 12:31:30 | 32 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.02s]
2020-02-27 20:31:30,169615 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 20:31:30,170356 (Thread-1): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:31:30,170622 (Thread-1): 12:31:30 | 44 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 20:31:30,171465 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 20:31:30,171942 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-27 20:31:30,172118 (Thread-1): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 20:31:30,183320 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:31:30,183895 (Thread-1): finished collecting timing info
2020-02-27 20:31:30,189918 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 20:31:30,190350 (Thread-1): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 20:31:30,610971 (Thread-2): 12:31:30 | 33 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.13s]
2020-02-27 20:31:30,611329 (Thread-2): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 20:31:32,36101 (Thread-1): finished collecting timing info
2020-02-27 20:31:32,37595 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dca10b67-6092-4969-ad14-1940cdd32c5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e84ff50>]}
2020-02-27 20:31:32,410887 (Thread-1): 12:31:32 | 44 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 1.87s]
2020-02-27 20:31:32,411247 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 20:31:32,425965 (MainThread): 12:31:32 | 
2020-02-27 20:31:32,426314 (MainThread): 12:31:32 | Finished running 44 table models in 28.68s.
2020-02-27 20:31:32,426548 (MainThread): Connection 'master' was left open.
2020-02-27 20:31:32,426726 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 20:31:32,426898 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 20:31:32,427068 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 20:31:32,427234 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 20:31:32,568556 (MainThread): 
2020-02-27 20:31:32,568909 (MainThread): Completed with 3 errors and 0 warnings:
2020-02-27 20:31:32,569096 (MainThread): 
2020-02-27 20:31:32,569253 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 20:31:32,569396 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-27 20:31:32,569531 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 20:31:32,569671 (MainThread): 
2020-02-27 20:31:32,569816 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 20:31:32,569953 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 20:31:32,570082 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 20:31:32,570219 (MainThread): 
2020-02-27 20:31:32,570361 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 20:31:32,570496 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 20:31:32,570625 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 20:31:32,570789 (MainThread): 
Done. PASS=41 WARN=0 ERROR=3 SKIP=0 TOTAL=44
2020-02-27 20:31:32,571027 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0be6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e1121d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e00a910>]}
2020-02-27 20:31:32,941209 (MainThread): Flushing usage events
2020-02-27 21:15:28,526377 (MainThread): Running with dbt=0.15.2
2020-02-27 21:15:28,831457 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-27 21:15:28,832718 (MainThread): Tracking: tracking
2020-02-27 21:15:28,842532 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d309d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d30a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d30f90>]}
2020-02-27 21:15:29,282616 (MainThread): Partial parsing not enabled
2020-02-27 21:15:29,288178 (MainThread): Parsing macros/core.sql
2020-02-27 21:15:29,294808 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-27 21:15:29,303796 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-27 21:15:29,306329 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-27 21:15:29,328411 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-27 21:15:29,352919 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-27 21:15:29,379163 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-27 21:15:29,382235 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-27 21:15:29,391058 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-27 21:15:29,400873 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-27 21:15:29,409387 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-27 21:15:29,417548 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-27 21:15:29,427294 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-27 21:15:29,429240 (MainThread): Parsing macros/etc/query.sql
2020-02-27 21:15:29,431316 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-27 21:15:29,434038 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-27 21:15:29,437150 (MainThread): Parsing macros/etc/datetime.sql
2020-02-27 21:15:29,447599 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-27 21:15:29,450277 (MainThread): Parsing macros/adapters/common.sql
2020-02-27 21:15:29,485656 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-27 21:15:29,487438 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-27 21:15:29,488920 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-27 21:15:29,490605 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-27 21:15:29,493836 (MainThread): Parsing macros/etc.sql
2020-02-27 21:15:29,495359 (MainThread): Parsing macros/catalog.sql
2020-02-27 21:15:29,500186 (MainThread): Parsing macros/adapters.sql
2020-02-27 21:15:29,518469 (MainThread): Parsing macros/materializations/merge.sql
2020-02-27 21:15:29,519976 (MainThread): Parsing macros/materializations/seed.sql
2020-02-27 21:15:29,523007 (MainThread): Parsing macros/materializations/view.sql
2020-02-27 21:15:29,525345 (MainThread): Parsing macros/materializations/table.sql
2020-02-27 21:15:29,536981 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-27 21:15:29,547439 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-27 21:15:29,592157 (MainThread): Partial parsing not enabled
2020-02-27 21:15:29,593350 (MainThread): Parsing macros/get_column_values.sql
2020-02-27 21:15:29,598390 (MainThread): Parsing macros/fill_missing.sql
2020-02-27 21:15:29,604795 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-27 21:15:29,606510 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-27 21:15:29,608917 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-27 21:15:29,612258 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-27 21:15:29,614169 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-27 21:15:29,620314 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-27 21:15:29,622430 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-27 21:15:29,624501 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-27 21:15:29,628017 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-27 21:15:29,629917 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-27 21:15:29,633121 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-27 21:15:29,636572 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-27 21:15:29,639742 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-27 21:15:29,642334 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-27 21:15:29,644705 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-27 21:15:29,646680 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-27 21:15:29,650365 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-27 21:15:29,656272 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-27 21:15:29,659990 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-27 21:15:29,662790 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-27 21:15:29,665410 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-27 21:15:29,689774 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-27 21:15:29,691041 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-27 21:15:29,692404 (MainThread): Parsing macros/logger/log_info.sql
2020-02-27 21:15:29,693707 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-27 21:15:29,698288 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-27 21:15:29,700874 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-27 21:15:29,704502 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-27 21:15:29,706813 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-27 21:15:29,708318 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-27 21:15:29,710360 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-27 21:15:29,713239 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-27 21:15:29,715410 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-27 21:15:29,716972 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-27 21:15:29,718750 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-27 21:15:29,720954 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-27 21:15:29,723448 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-27 21:15:29,725746 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-27 21:15:29,729839 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-27 21:15:29,734970 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-27 21:15:29,736801 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-27 21:15:29,741171 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-27 21:15:29,746558 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-27 21:15:29,750039 (MainThread): Parsing macros/sql/star.sql
2020-02-27 21:15:29,754204 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-27 21:15:29,762016 (MainThread): Parsing macros/sql/union.sql
2020-02-27 21:15:29,773998 (MainThread): Parsing macros/sql/groupby.sql
2020-02-27 21:15:29,776632 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-27 21:15:29,780689 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-27 21:15:29,783522 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-27 21:15:29,790501 (MainThread): Parsing macros/sql/pivot.sql
2020-02-27 21:15:29,794773 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-27 21:15:29,825595 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-27 21:15:29,825875 (MainThread): Opening a new connection, currently in state init
2020-02-27 21:15:29,855467 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 21:15:29,855658 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,864408 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-27 21:15:29,864601 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,872797 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 21:15:29,872917 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,880904 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-27 21:15:29,881097 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,890424 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-27 21:15:29,890596 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,903371 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-27 21:15:29,903530 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,913322 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-27 21:15:29,913524 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,923482 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 21:15:29,923638 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,933529 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 21:15:29,933661 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,947385 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-27 21:15:29,947553 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,958181 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-27 21:15:29,958447 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,970019 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 21:15:29,970233 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,979761 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 21:15:29,979924 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,988784 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 21:15:29,988987 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:29,996529 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 21:15:29,996683 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,6208 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-27 21:15:30,6472 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,17575 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-27 21:15:30,17721 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,25851 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-27 21:15:30,25978 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,37965 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-27 21:15:30,38207 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,47503 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-27 21:15:30,47703 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,56180 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 21:15:30,56300 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,111382 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-27 21:15:30,111601 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,125809 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 21:15:30,126040 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,136878 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 21:15:30,137089 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,145207 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 21:15:30,145347 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,191532 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 21:15:30,191788 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,200224 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 21:15:30,200370 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,207621 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 21:15:30,207750 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,215392 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 21:15:30,215560 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,223371 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 21:15:30,223564 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,237621 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-27 21:15:30,237798 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,249532 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 21:15:30,249662 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,257956 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 21:15:30,258095 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,271244 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 21:15:30,271375 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,292779 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 21:15:30,292911 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,305744 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 21:15:30,305892 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,322057 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 21:15:30,322270 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,332265 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 21:15:30,332432 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,340037 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 21:15:30,340233 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,350775 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 21:15:30,350940 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,359573 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 21:15:30,359700 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,371770 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 21:15:30,371965 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,384326 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 21:15:30,384452 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:30,643180 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-27 21:15:30,670229 (MainThread): 
2020-02-27 21:15:30,670708 (MainThread): Acquiring new bigquery connection "master".
2020-02-27 21:15:30,670847 (MainThread): Opening a new connection, currently in state closed
2020-02-27 21:15:31,592730 (MainThread): 13:15:31 | Concurrency: 4 threads (target='dev')
2020-02-27 21:15:31,592965 (MainThread): 13:15:31 | 
2020-02-27 21:15:31,598285 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-27 21:15:31,598657 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 21:15:31,598886 (Thread-1): 13:15:31 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-27 21:15:31,599091 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-27 21:15:31,599388 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 21:15:31,599615 (Thread-2): 13:15:31 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-27 21:15:31,599950 (Thread-3): 13:15:31 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-27 21:15:31,600311 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-27 21:15:31,600561 (Thread-4): 13:15:31 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-27 21:15:31,601015 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-27 21:15:31,601499 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-27 21:15:31,601649 (Thread-1): Opening a new connection, currently in state init
2020-02-27 21:15:31,602088 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-27 21:15:31,602198 (Thread-2): Opening a new connection, currently in state init
2020-02-27 21:15:31,602361 (Thread-3): Opening a new connection, currently in state init
2020-02-27 21:15:31,602557 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-27 21:15:31,602713 (Thread-4): Opening a new connection, currently in state init
2020-02-27 21:15:31,602888 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-27 21:15:31,603054 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-27 21:15:31,620588 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-27 21:15:31,621961 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 21:15:31,629704 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 21:15:31,637621 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 21:15:31,645773 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 21:15:31,646656 (Thread-2): finished collecting timing info
2020-02-27 21:15:31,652451 (Thread-1): finished collecting timing info
2020-02-27 21:15:31,670221 (Thread-4): finished collecting timing info
2020-02-27 21:15:31,720051 (Thread-3): finished collecting timing info
2020-02-27 21:15:32,365461 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-27 21:15:32,404697 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-27 21:15:32,427213 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-27 21:15:32,428211 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-27 21:15:32,429758 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-27 21:15:32,430742 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-27 21:15:32,430922 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-27 21:15:32,431957 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-27 21:15:35,201077 (Thread-3): finished collecting timing info
2020-02-27 21:15:35,202430 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f8eb10>]}
2020-02-27 21:15:35,343547 (Thread-4): finished collecting timing info
2020-02-27 21:15:35,344612 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f55110>]}
2020-02-27 21:15:35,354132 (Thread-1): finished collecting timing info
2020-02-27 21:15:35,355198 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ecfb10>]}
2020-02-27 21:15:35,477117 (Thread-2): finished collecting timing info
2020-02-27 21:15:35,478284 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e46a10>]}
2020-02-27 21:15:35,577048 (Thread-3): 13:15:35 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.60s]
2020-02-27 21:15:35,578662 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-27 21:15:35,579130 (Thread-3): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 21:15:35,579540 (Thread-3): 13:15:35 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-27 21:15:35,580028 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-27 21:15:35,580550 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-27 21:15:35,581149 (Thread-3): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-27 21:15:35,592040 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 21:15:35,592710 (Thread-3): finished collecting timing info
2020-02-27 21:15:35,598804 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-27 21:15:35,599226 (Thread-3): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 21:15:35,991490 (Thread-4): 13:15:35 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.74s]
2020-02-27 21:15:35,992177 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-27 21:15:35,992538 (Thread-4): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 21:15:35,993933 (Thread-4): 13:15:35 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-27 21:15:35,994606 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-27 21:15:35,994794 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-27 21:15:35,995002 (Thread-4): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-27 21:15:36,5245 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 21:15:36,7168 (Thread-4): finished collecting timing info
2020-02-27 21:15:36,14278 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-27 21:15:36,15041 (Thread-4): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-27 21:15:36,439080 (Thread-1): 13:15:36 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.75s]
2020-02-27 21:15:36,440627 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-27 21:15:36,441073 (Thread-1): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 21:15:36,441529 (Thread-1): 13:15:36 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-27 21:15:36,442636 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-27 21:15:36,443110 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-27 21:15:36,443288 (Thread-1): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 21:15:36,452563 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 21:15:36,453135 (Thread-1): finished collecting timing info
2020-02-27 21:15:36,459184 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-27 21:15:36,459648 (Thread-1): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-27 21:15:36,878334 (Thread-2): 13:15:36 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 3.88s]
2020-02-27 21:15:36,878660 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-27 21:15:36,878890 (Thread-2): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 21:15:36,879312 (Thread-2): 13:15:36 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-27 21:15:36,879974 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-27 21:15:36,880156 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-27 21:15:36,880318 (Thread-2): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-27 21:15:36,890566 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 21:15:36,892850 (Thread-2): finished collecting timing info
2020-02-27 21:15:36,899571 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-27 21:15:36,900086 (Thread-2): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-27 21:15:37,788521 (Thread-3): finished collecting timing info
2020-02-27 21:15:37,789580 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f4c090>]}
2020-02-27 21:15:38,162042 (Thread-3): 13:15:38 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.21s]
2020-02-27 21:15:38,162402 (Thread-3): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-27 21:15:38,162633 (Thread-3): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 21:15:38,163023 (Thread-3): 13:15:38 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-27 21:15:38,163502 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-27 21:15:38,163651 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-27 21:15:38,163811 (Thread-3): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-27 21:15:38,173180 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 21:15:38,173711 (Thread-3): finished collecting timing info
2020-02-27 21:15:38,179812 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-27 21:15:38,180283 (Thread-3): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-27 21:15:38,215605 (Thread-4): finished collecting timing info
2020-02-27 21:15:38,216711 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f3b1d0>]}
2020-02-27 21:15:38,584904 (Thread-4): 13:15:38 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.22s]
2020-02-27 21:15:38,585244 (Thread-4): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-27 21:15:38,585478 (Thread-4): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 21:15:38,585881 (Thread-4): 13:15:38 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-27 21:15:38,586373 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-27 21:15:38,586523 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-27 21:15:38,586682 (Thread-4): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 21:15:38,596038 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 21:15:38,597141 (Thread-4): finished collecting timing info
2020-02-27 21:15:38,603789 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-27 21:15:38,604305 (Thread-4): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-27 21:15:39,143418 (Thread-1): finished collecting timing info
2020-02-27 21:15:39,144703 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094fff50>]}
2020-02-27 21:15:39,166435 (Thread-2): finished collecting timing info
2020-02-27 21:15:39,167494 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094ff590>]}
2020-02-27 21:15:39,513478 (Thread-1): 13:15:39 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.70s]
2020-02-27 21:15:39,514886 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-27 21:15:39,515292 (Thread-1): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 21:15:39,515740 (Thread-1): 13:15:39 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-27 21:15:39,516557 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-27 21:15:39,517126 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-27 21:15:39,517305 (Thread-1): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-27 21:15:39,528614 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 21:15:39,529309 (Thread-1): finished collecting timing info
2020-02-27 21:15:39,535857 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-27 21:15:39,536408 (Thread-1): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-27 21:15:39,891468 (Thread-2): 13:15:39 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.29s]
2020-02-27 21:15:39,891767 (Thread-2): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-27 21:15:39,892000 (Thread-2): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 21:15:39,892400 (Thread-2): 13:15:39 | 12 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-27 21:15:39,892883 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-27 21:15:39,893033 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-27 21:15:39,893194 (Thread-2): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-27 21:15:39,905544 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:40,358416 (Thread-3): finished collecting timing info
2020-02-27 21:15:40,359584 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e613d0>]}
2020-02-27 21:15:40,724717 (Thread-3): 13:15:40 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.20s]
2020-02-27 21:15:40,725326 (Thread-3): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-27 21:15:40,725800 (Thread-3): Began running node model.journeyengine_recipes.adwords_urls
2020-02-27 21:15:40,726274 (Thread-3): 13:15:40 | 13 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-27 21:15:40,727326 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-27 21:15:40,727546 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-27 21:15:40,727755 (Thread-3): Compiling model.journeyengine_recipes.adwords_urls
2020-02-27 21:15:40,741641 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:41,16969 (Thread-4): finished collecting timing info
2020-02-27 21:15:41,18029 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10944f1d0>]}
2020-02-27 21:15:41,382650 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 21:15:41,383210 (Thread-2): finished collecting timing info
2020-02-27 21:15:41,389382 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-27 21:15:41,389785 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-27 21:15:41,450661 (Thread-4): 13:15:41 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.43s]
2020-02-27 21:15:41,451015 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-27 21:15:41,451286 (Thread-4): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-27 21:15:41,451732 (Thread-4): 13:15:41 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-27 21:15:41,452314 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-27 21:15:41,452498 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-27 21:15:41,452693 (Thread-4): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-27 21:15:41,467523 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:42,289657 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 21:15:42,290332 (Thread-3): finished collecting timing info
2020-02-27 21:15:42,337113 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-27 21:15:42,340085 (Thread-1): finished collecting timing info
2020-02-27 21:15:42,340910 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ce0c90>]}
2020-02-27 21:15:42,342847 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-27 21:15:42,643095 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-27 21:15:42,643383 (Thread-4): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-27 21:15:42,715061 (Thread-1): 13:15:42 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.82s]
2020-02-27 21:15:42,715311 (Thread-1): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-27 21:15:42,715522 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 21:15:42,715868 (Thread-1): 13:15:42 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-27 21:15:42,716276 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-27 21:15:42,716399 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-27 21:15:42,716520 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-27 21:15:42,729028 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:42,799396 (Thread-4): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-27 21:15:42,799819 (Thread-4): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-27 21:15:42,802449 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 21:15:42,803036 (Thread-4): finished collecting timing info
2020-02-27 21:15:42,810455 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-27 21:15:42,810993 (Thread-4): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-27 21:15:43,839270 (Thread-2): finished collecting timing info
2020-02-27 21:15:43,840577 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095fc450>]}
2020-02-27 21:15:43,878615 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-27 21:15:44,73053 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 21:15:44,73759 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 21:15:44,77017 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 21:15:44,77687 (Thread-1): finished collecting timing info
2020-02-27 21:15:44,85419 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-27 21:15:44,85876 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-27 21:15:44,197551 (Thread-3): finished collecting timing info
2020-02-27 21:15:44,198610 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095704d0>]}
2020-02-27 21:15:44,239635 (Thread-2): 13:15:44 | 12 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 3.95s]
2020-02-27 21:15:44,241420 (Thread-2): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-27 21:15:44,241861 (Thread-2): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 21:15:44,242271 (Thread-2): 13:15:44 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-27 21:15:44,242789 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-27 21:15:44,243272 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-27 21:15:44,243786 (Thread-2): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-27 21:15:44,257841 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:44,671740 (Thread-3): 13:15:44 | 13 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 3.47s]
2020-02-27 21:15:44,672047 (Thread-3): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-27 21:15:44,672282 (Thread-3): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 21:15:44,672519 (Thread-3): 13:15:44 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-27 21:15:44,673325 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-27 21:15:44,673495 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-27 21:15:44,673660 (Thread-3): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-27 21:15:44,689731 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:45,282513 (Thread-4): finished collecting timing info
2020-02-27 21:15:45,283578 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d93110>]}
2020-02-27 21:15:45,656166 (Thread-4): 13:15:45 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 3.83s]
2020-02-27 21:15:45,656524 (Thread-4): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-27 21:15:45,656762 (Thread-4): Began running node model.journeyengine_recipes.fb_conversions
2020-02-27 21:15:45,657292 (Thread-4): 13:15:45 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-27 21:15:45,657785 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-27 21:15:45,657942 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-27 21:15:45,658105 (Thread-4): Compiling model.journeyengine_recipes.fb_conversions
2020-02-27 21:15:45,668521 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 21:15:45,668984 (Thread-4): finished collecting timing info
2020-02-27 21:15:45,675025 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-27 21:15:45,675437 (Thread-4): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-27 21:15:45,954662 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 21:15:45,955337 (Thread-2): finished collecting timing info
2020-02-27 21:15:45,963178 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-27 21:15:45,963609 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-27 21:15:46,418599 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-27 21:15:46,593005 (Thread-3): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-27 21:15:46,593708 (Thread-3): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-27 21:15:46,600636 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 21:15:46,603012 (Thread-3): finished collecting timing info
2020-02-27 21:15:46,610565 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-27 21:15:46,611142 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 21:15:47,172860 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/6940712e-4e88-4481-a115-dfaefb9baf7f?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-27 21:15:47,173161 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-27 21:15:47,173365 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/6940712e-4e88-4481-a115-dfaefb9baf7f?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 6940712e-4e88-4481-a115-dfaefb9baf7f)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 21:15:47,173645 (Thread-3): finished collecting timing info
2020-02-27 21:15:47,193963 (Thread-1): finished collecting timing info
2020-02-27 21:15:47,194964 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f07b50>]}
2020-02-27 21:15:47,174451 (Thread-3): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/6940712e-4e88-4481-a115-dfaefb9baf7f?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 6940712e-4e88-4481-a115-dfaefb9baf7f)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 21:15:47,198506 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f326d0>]}
2020-02-27 21:15:47,561833 (Thread-1): 13:15:47 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.48s]
2020-02-27 21:15:47,563528 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-27 21:15:47,563940 (Thread-1): Began running node model.journeyengine_recipes.ga_conversions
2020-02-27 21:15:47,564348 (Thread-1): 13:15:47 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-27 21:15:47,564837 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-27 21:15:47,565000 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-27 21:15:47,565418 (Thread-1): Compiling model.journeyengine_recipes.ga_conversions
2020-02-27 21:15:47,576847 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 21:15:47,577596 (Thread-1): finished collecting timing info
2020-02-27 21:15:47,583921 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-27 21:15:47,584509 (Thread-1): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-27 21:15:47,950577 (Thread-3): 13:15:47 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.53s]
2020-02-27 21:15:47,950938 (Thread-3): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-27 21:15:47,951202 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 21:15:47,951675 (Thread-3): 13:15:47 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-27 21:15:47,952167 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-27 21:15:47,952318 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-27 21:15:47,952480 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 21:15:47,969066 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 21:15:47,969572 (Thread-3): finished collecting timing info
2020-02-27 21:15:47,977117 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-27 21:15:47,978178 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-27 21:15:48,38611 (Thread-2): finished collecting timing info
2020-02-27 21:15:48,39686 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10961f690>]}
2020-02-27 21:15:48,405852 (Thread-2): 13:15:48 | 16 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.80s]
2020-02-27 21:15:48,406237 (Thread-2): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-27 21:15:48,406474 (Thread-2): Began running node model.journeyengine_recipes.adwords_join
2020-02-27 21:15:48,406923 (Thread-2): 13:15:48 | 21 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-27 21:15:48,407668 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-27 21:15:48,407884 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-27 21:15:48,408051 (Thread-2): Compiling model.journeyengine_recipes.adwords_join
2020-02-27 21:15:48,420384 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 21:15:48,421374 (Thread-2): finished collecting timing info
2020-02-27 21:15:48,427868 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-27 21:15:48,428329 (Thread-2): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-27 21:15:49,775471 (Thread-1): finished collecting timing info
2020-02-27 21:15:49,776533 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109476a10>]}
2020-02-27 21:15:50,95105 (Thread-3): finished collecting timing info
2020-02-27 21:15:50,96282 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10948c350>]}
2020-02-27 21:15:50,147173 (Thread-1): 13:15:50 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.21s]
2020-02-27 21:15:50,148525 (Thread-1): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-27 21:15:50,148934 (Thread-1): Began running node model.journeyengine_recipes.fb_ads
2020-02-27 21:15:50,149485 (Thread-1): 13:15:50 | 22 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-27 21:15:50,150313 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-27 21:15:50,150788 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-27 21:15:50,150943 (Thread-1): Compiling model.journeyengine_recipes.fb_ads
2020-02-27 21:15:50,165655 (Thread-1): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:50,531551 (Thread-3): 13:15:50 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.14s]
2020-02-27 21:15:50,531870 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-27 21:15:50,532103 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 21:15:50,532513 (Thread-3): 13:15:50 | 23 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-27 21:15:50,532875 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-27 21:15:50,533141 (Thread-3): Began running node model.journeyengine_recipes.ga_proc
2020-02-27 21:15:50,533473 (Thread-3): 13:15:50 | 24 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-27 21:15:50,534045 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-27 21:15:50,534211 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-27 21:15:50,534378 (Thread-3): Compiling model.journeyengine_recipes.ga_proc
2020-02-27 21:15:50,571012 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:50,904018 (Thread-2): finished collecting timing info
2020-02-27 21:15:50,904917 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dcbb90>]}
2020-02-27 21:15:51,280944 (Thread-2): 13:15:51 | 21 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 2.50s]
2020-02-27 21:15:51,284826 (Thread-2): Finished running node model.journeyengine_recipes.adwords_join
2020-02-27 21:15:51,285240 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 21:15:51,285505 (Thread-2): 13:15:51 | 25 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-27 21:15:51,286292 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-27 21:15:51,286490 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-27 21:15:51,286658 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 21:15:51,299510 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 21:15:51,300022 (Thread-2): finished collecting timing info
2020-02-27 21:15:51,305810 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-27 21:15:51,307051 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-27 21:15:51,708200 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:51,852414 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 21:15:51,855430 (Thread-1): finished collecting timing info
2020-02-27 21:15:51,863367 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-27 21:15:51,863920 (Thread-1): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-27 21:15:52,811571 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:53,133124 (Thread-4): finished collecting timing info
2020-02-27 21:15:53,134199 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e0f4d0>]}
2020-02-27 21:15:53,432665 (Thread-2): finished collecting timing info
2020-02-27 21:15:53,433745 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090a2690>]}
2020-02-27 21:15:53,509729 (Thread-4): 13:15:53 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 7.48s]
2020-02-27 21:15:53,510445 (Thread-4): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-27 21:15:53,511665 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 21:15:53,512143 (Thread-4): 13:15:53 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-27 21:15:53,512604 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-27 21:15:53,512854 (Thread-4): Began running node model.journeyengine_recipes.adwords_stats
2020-02-27 21:15:53,513188 (Thread-4): 13:15:53 | 27 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-27 21:15:53,514168 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-27 21:15:53,514696 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-27 21:15:53,514880 (Thread-4): Compiling model.journeyengine_recipes.adwords_stats
2020-02-27 21:15:53,527232 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 21:15:53,528057 (Thread-4): finished collecting timing info
2020-02-27 21:15:53,535860 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-27 21:15:53,536356 (Thread-4): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-27 21:15:53,893462 (Thread-2): 13:15:53 | 25 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.15s]
2020-02-27 21:15:53,893823 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-27 21:15:53,894099 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 21:15:53,894590 (Thread-2): 13:15:53 | 28 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-27 21:15:53,895423 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-27 21:15:53,895603 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-27 21:15:53,895771 (Thread-2): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 21:15:53,923032 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:54,246591 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:54,502710 (Thread-1): finished collecting timing info
2020-02-27 21:15:54,503788 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ef5f50>]}
2020-02-27 21:15:54,873509 (Thread-1): 13:15:54 | 22 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 4.35s]
2020-02-27 21:15:54,873863 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads
2020-02-27 21:15:54,874136 (Thread-1): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 21:15:54,874531 (Thread-1): 13:15:54 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-27 21:15:54,874821 (Thread-1): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-27 21:15:54,875081 (Thread-1): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 21:15:54,875470 (Thread-1): 13:15:54 | 30 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-27 21:15:54,876129 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-27 21:15:54,876316 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-27 21:15:54,876479 (Thread-1): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-27 21:15:54,886875 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 21:15:54,887336 (Thread-1): finished collecting timing info
2020-02-27 21:15:54,893371 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-27 21:15:54,893799 (Thread-1): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-27 21:15:55,294792 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:55,943207 (Thread-4): finished collecting timing info
2020-02-27 21:15:55,944484 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f90fd0>]}
2020-02-27 21:15:56,19596 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-27 21:15:56,336329 (Thread-4): 13:15:56 | 27 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.43s]
2020-02-27 21:15:56,336673 (Thread-4): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-27 21:15:56,336908 (Thread-4): Began running node model.journeyengine_recipes.social_post_viz
2020-02-27 21:15:56,337288 (Thread-4): 13:15:56 | 31 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-27 21:15:56,337776 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-27 21:15:56,337925 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-27 21:15:56,338086 (Thread-4): Compiling model.journeyengine_recipes.social_post_viz
2020-02-27 21:15:56,349578 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 21:15:56,350118 (Thread-4): finished collecting timing info
2020-02-27 21:15:56,356263 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-27 21:15:56,358466 (Thread-4): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-27 21:15:56,458958 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 21:15:56,646022 (Thread-2): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 21:15:56,646698 (Thread-2): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 21:15:56,647203 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-27 21:15:56,801026 (Thread-2): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-27 21:15:56,801716 (Thread-2): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-27 21:15:56,804975 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 21:15:56,805632 (Thread-2): finished collecting timing info
2020-02-27 21:15:56,814826 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-27 21:15:56,815345 (Thread-2): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 21:15:57,344212 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/06a461b2-3937-4e27-af82-60bfd52a36b0?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-27 21:15:57,344515 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-27 21:15:57,344724 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/06a461b2-3937-4e27-af82-60bfd52a36b0?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 06a461b2-3937-4e27-af82-60bfd52a36b0)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 21:15:57,345001 (Thread-2): finished collecting timing info
2020-02-27 21:15:57,345812 (Thread-2): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/06a461b2-3937-4e27-af82-60bfd52a36b0?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 06a461b2-3937-4e27-af82-60bfd52a36b0)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 21:15:57,346927 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10953a6d0>]}
2020-02-27 21:15:57,416926 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 21:15:57,417612 (Thread-3): finished collecting timing info
2020-02-27 21:15:57,425264 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-27 21:15:57,425703 (Thread-3): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 21:15:57,500342 (Thread-1): finished collecting timing info
2020-02-27 21:15:57,501398 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f19610>]}
2020-02-27 21:15:57,712393 (Thread-2): 13:15:57 | 28 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.45s]
2020-02-27 21:15:57,714003 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-27 21:15:57,714435 (Thread-2): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 21:15:57,715088 (Thread-2): 13:15:57 | 32 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-27 21:15:57,715585 (Thread-2): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-27 21:15:57,716117 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 21:15:57,716346 (Thread-2): 13:15:57 | 33 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-27 21:15:57,716803 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-27 21:15:57,717213 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 21:15:57,717425 (Thread-2): 13:15:57 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-27 21:15:57,717701 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-27 21:15:57,718108 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 21:15:57,718317 (Thread-2): 13:15:57 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-27 21:15:57,718512 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-27 21:15:57,908009 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/68ed9917-c17e-478d-b009-154feb2cdf71?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]')
2020-02-27 21:15:57,909166 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal10completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-27 21:15:57,909641 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/68ed9917-c17e-478d-b009-154feb2cdf71?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 68ed9917-c17e-478d-b009-154feb2cdf71)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal10completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal5completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal17completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal13completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal18completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal16completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-27 21:15:57,910126 (Thread-3): finished collecting timing info
2020-02-27 21:15:57,911036 (Thread-3): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/68ed9917-c17e-478d-b009-154feb2cdf71?maxResults=0&location=US: Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]

(job ID: 68ed9917-c17e-478d-b009-154feb2cdf71)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal10completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal5completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal17completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal13completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal18completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal16completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 21:15:57,912322 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091fe890>]}
2020-02-27 21:15:58,84346 (Thread-1): 13:15:58 | 30 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.63s]
2020-02-27 21:15:58,85790 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-27 21:15:58,86424 (Thread-2): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-27 21:15:58,86691 (Thread-2): 13:15:58 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-27 21:15:58,87447 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-27 21:15:58,87963 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-27 21:15:58,88161 (Thread-2): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-27 21:15:58,99748 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 21:15:58,100499 (Thread-2): finished collecting timing info
2020-02-27 21:15:58,109463 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-27 21:15:58,110759 (Thread-2): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-27 21:15:58,467144 (Thread-3): 13:15:58 | 24 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 7.38s]
2020-02-27 21:15:58,467448 (Thread-3): Finished running node model.journeyengine_recipes.ga_proc
2020-02-27 21:15:58,468158 (Thread-1): Began running node model.journeyengine_recipes.ga_stats
2020-02-27 21:15:58,468414 (Thread-1): 13:15:58 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-27 21:15:58,468621 (Thread-1): Finished running node model.journeyengine_recipes.ga_stats
2020-02-27 21:15:58,469134 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 21:15:58,469455 (Thread-3): 13:15:58 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-27 21:15:58,469706 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-27 21:15:58,470279 (Thread-1): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 21:15:58,470518 (Thread-3): Began running node model.journeyengine_recipes.platform_by_month
2020-02-27 21:15:58,470766 (Thread-1): 13:15:58 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-27 21:15:58,471048 (Thread-3): 13:15:58 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-27 21:15:58,471438 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-27 21:15:58,471734 (Thread-3): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-27 21:15:58,472452 (Thread-1): Began running node model.journeyengine_recipes.landing_page_index
2020-02-27 21:15:58,472742 (Thread-1): 13:15:58 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-27 21:15:58,472922 (Thread-3): Began running node model.journeyengine_recipes.platform_index
2020-02-27 21:15:58,473168 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-27 21:15:58,473350 (Thread-3): 13:15:58 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-27 21:15:58,473833 (Thread-1): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-27 21:15:58,474032 (Thread-3): Finished running node model.journeyengine_recipes.platform_index
2020-02-27 21:15:58,474218 (Thread-1): 13:15:58 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-27 21:15:58,474748 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-27 21:15:58,474947 (Thread-3): Began running node model.journeyengine_recipes.platform_viz
2020-02-27 21:15:58,475293 (Thread-3): 13:15:58 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-27 21:15:58,475499 (Thread-3): Finished running node model.journeyengine_recipes.platform_viz
2020-02-27 21:15:58,508106 (Thread-4): finished collecting timing info
2020-02-27 21:15:58,509244 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094debd0>]}
2020-02-27 21:15:58,888132 (Thread-4): 13:15:58 | 31 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.17s]
2020-02-27 21:15:58,888473 (Thread-4): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-27 21:16:00,198348 (Thread-2): finished collecting timing info
2020-02-27 21:16:00,199410 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc25b1ee-754f-416b-b890-87bcb078b7f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109590190>]}
2020-02-27 21:16:00,634362 (Thread-2): 13:16:00 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.11s]
2020-02-27 21:16:00,634715 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-27 21:16:00,675770 (MainThread): 13:16:00 | 
2020-02-27 21:16:00,676095 (MainThread): 13:16:00 | Finished running 44 table models in 30.01s.
2020-02-27 21:16:00,676319 (MainThread): Connection 'master' was left open.
2020-02-27 21:16:00,676476 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-27 21:16:00,676625 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-27 21:16:00,676767 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-27 21:16:00,676905 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-27 21:16:00,828682 (MainThread): 
2020-02-27 21:16:00,828964 (MainThread): Completed with 3 errors and 0 warnings:
2020-02-27 21:16:00,829167 (MainThread): 
2020-02-27 21:16:00,829353 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-27 21:16:00,829502 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-27 21:16:00,829640 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-27 21:16:00,829782 (MainThread): 
2020-02-27 21:16:00,829930 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-27 21:16:00,830069 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-27 21:16:00,830199 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-27 21:16:00,830335 (MainThread): 
2020-02-27 21:16:00,830476 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-27 21:16:00,830610 (MainThread):   Unrecognized name: goalcompletionsall; Did you mean goal8completions? at [31:25]
2020-02-27 21:16:00,830738 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-27 21:16:00,830901 (MainThread): 
Done. PASS=41 WARN=0 ERROR=3 SKIP=0 TOTAL=44
2020-02-27 21:16:00,831138 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ef2a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109590190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108efb050>]}
2020-02-27 21:16:01,222119 (MainThread): Flushing usage events
2020-02-28 00:23:08,13231 (MainThread): Running with dbt=0.15.2
2020-02-28 00:23:08,300528 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-28 00:23:08,301844 (MainThread): Tracking: tracking
2020-02-28 00:23:08,311344 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea2f650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea2fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea2f590>]}
2020-02-28 00:23:08,766597 (MainThread): Partial parsing not enabled
2020-02-28 00:23:08,769863 (MainThread): Parsing macros/core.sql
2020-02-28 00:23:08,775263 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-28 00:23:08,784069 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-28 00:23:08,787657 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-28 00:23:08,810805 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-28 00:23:08,839501 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-28 00:23:08,866359 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-28 00:23:08,869180 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-28 00:23:08,877822 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-28 00:23:08,887161 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-28 00:23:08,895579 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-28 00:23:08,906913 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-28 00:23:08,916092 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-28 00:23:08,917831 (MainThread): Parsing macros/etc/query.sql
2020-02-28 00:23:08,919571 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-28 00:23:08,922353 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-28 00:23:08,925210 (MainThread): Parsing macros/etc/datetime.sql
2020-02-28 00:23:08,935651 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-28 00:23:08,938380 (MainThread): Parsing macros/adapters/common.sql
2020-02-28 00:23:08,976621 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-28 00:23:08,978839 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-28 00:23:08,980762 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-28 00:23:08,983262 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-28 00:23:08,987167 (MainThread): Parsing macros/etc.sql
2020-02-28 00:23:08,988488 (MainThread): Parsing macros/catalog.sql
2020-02-28 00:23:08,992821 (MainThread): Parsing macros/adapters.sql
2020-02-28 00:23:09,10407 (MainThread): Parsing macros/materializations/merge.sql
2020-02-28 00:23:09,11852 (MainThread): Parsing macros/materializations/seed.sql
2020-02-28 00:23:09,14607 (MainThread): Parsing macros/materializations/view.sql
2020-02-28 00:23:09,16780 (MainThread): Parsing macros/materializations/table.sql
2020-02-28 00:23:09,28161 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-28 00:23:09,35243 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-28 00:23:09,80860 (MainThread): Partial parsing not enabled
2020-02-28 00:23:09,82116 (MainThread): Parsing macros/get_column_values.sql
2020-02-28 00:23:09,87947 (MainThread): Parsing macros/fill_missing.sql
2020-02-28 00:23:09,95886 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-28 00:23:09,97461 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-28 00:23:09,99399 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-28 00:23:09,102372 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-28 00:23:09,104254 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-28 00:23:09,110470 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-28 00:23:09,112550 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-28 00:23:09,114403 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-28 00:23:09,117527 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-28 00:23:09,119128 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-28 00:23:09,121985 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-28 00:23:09,125062 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-28 00:23:09,127678 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-28 00:23:09,129644 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-28 00:23:09,131732 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-28 00:23:09,133228 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-28 00:23:09,136872 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-28 00:23:09,142686 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-28 00:23:09,146323 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-28 00:23:09,148922 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-28 00:23:09,151050 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-28 00:23:09,178542 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-28 00:23:09,179788 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-28 00:23:09,181295 (MainThread): Parsing macros/logger/log_info.sql
2020-02-28 00:23:09,182694 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-28 00:23:09,187289 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-28 00:23:09,189638 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-28 00:23:09,192750 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-28 00:23:09,194678 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-28 00:23:09,196315 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-28 00:23:09,198349 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-28 00:23:09,201119 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-28 00:23:09,203303 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-28 00:23:09,204864 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-28 00:23:09,206515 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-28 00:23:09,208411 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-28 00:23:09,210609 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-28 00:23:09,212458 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-28 00:23:09,216349 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-28 00:23:09,221734 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-28 00:23:09,223512 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-28 00:23:09,227770 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-28 00:23:09,232831 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-28 00:23:09,236373 (MainThread): Parsing macros/sql/star.sql
2020-02-28 00:23:09,240967 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-28 00:23:09,248978 (MainThread): Parsing macros/sql/union.sql
2020-02-28 00:23:09,261070 (MainThread): Parsing macros/sql/groupby.sql
2020-02-28 00:23:09,263471 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-28 00:23:09,267173 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-28 00:23:09,269632 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-28 00:23:09,276233 (MainThread): Parsing macros/sql/pivot.sql
2020-02-28 00:23:09,279876 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-28 00:23:09,307757 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-28 00:23:09,307916 (MainThread): Opening a new connection, currently in state init
2020-02-28 00:23:09,338712 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:23:09,338859 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,347950 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-28 00:23:09,348080 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,356124 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:23:09,356245 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,364117 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-28 00:23:09,364242 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,372545 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-28 00:23:09,372673 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,385429 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-28 00:23:09,385560 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,394658 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-28 00:23:09,394782 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,404628 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:23:09,404772 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,415188 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:23:09,415351 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,428688 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-28 00:23:09,428811 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,438963 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-28 00:23:09,439129 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,450916 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:23:09,451119 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,461582 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:23:09,461724 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,469007 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:23:09,469135 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,476216 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:23:09,476338 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,484048 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-28 00:23:09,484175 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,493166 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-28 00:23:09,493368 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,504103 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-28 00:23:09,504243 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,512414 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-28 00:23:09,512540 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,521268 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-28 00:23:09,521445 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,530920 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:23:09,531092 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,585634 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 00:23:09,585793 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,597411 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:23:09,597614 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,607921 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:23:09,608070 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,614998 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:23:09,615118 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,622587 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:23:09,622710 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,666838 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:23:09,667028 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,674061 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:23:09,674191 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,682423 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:23:09,682622 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,691288 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:23:09,691470 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,705958 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-28 00:23:09,706128 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,716876 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:23:09,717009 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,726605 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:23:09,726814 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,742161 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:23:09,742288 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,763514 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:23:09,763641 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,776237 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:23:09,776365 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,791052 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:23:09,791179 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,798906 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:23:09,799132 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,809482 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:23:09,809652 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,820555 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:23:09,820678 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,828640 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:23:09,828759 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,841259 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:23:09,841421 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:09,852927 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:23:09,853051 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:10,127551 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-28 00:23:10,151085 (MainThread): 
2020-02-28 00:23:10,151553 (MainThread): Acquiring new bigquery connection "master".
2020-02-28 00:23:10,151696 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:23:11,52734 (MainThread): 16:23:11 | Concurrency: 4 threads (target='dev')
2020-02-28 00:23:11,56105 (MainThread): 16:23:11 | 
2020-02-28 00:23:11,60098 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:23:11,60325 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:23:11,60516 (Thread-1): 16:23:11 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-28 00:23:11,60650 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:23:11,60833 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:23:11,61011 (Thread-2): 16:23:11 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-28 00:23:11,61279 (Thread-3): 16:23:11 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-28 00:23:11,61618 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:23:11,61796 (Thread-4): 16:23:11 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-28 00:23:11,62212 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:23:11,62352 (Thread-1): Opening a new connection, currently in state init
2020-02-28 00:23:11,62744 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:23:11,62858 (Thread-2): Opening a new connection, currently in state init
2020-02-28 00:23:11,63130 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:23:11,63300 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-28 00:23:11,63431 (Thread-3): Opening a new connection, currently in state init
2020-02-28 00:23:11,63567 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:23:11,63694 (Thread-4): Opening a new connection, currently in state init
2020-02-28 00:23:11,82657 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-28 00:23:11,84414 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:23:11,92195 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:23:11,92386 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:23:11,100527 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:23:11,109047 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:23:11,110028 (Thread-2): finished collecting timing info
2020-02-28 00:23:11,110378 (Thread-1): finished collecting timing info
2020-02-28 00:23:11,151477 (Thread-4): finished collecting timing info
2020-02-28 00:23:11,158138 (Thread-3): finished collecting timing info
2020-02-28 00:23:11,796109 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:23:11,854912 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:23:11,868377 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:23:11,879462 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:23:11,880014 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-28 00:23:11,882226 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-28 00:23:11,882446 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-28 00:23:11,883208 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-28 00:23:14,560382 (Thread-3): finished collecting timing info
2020-02-28 00:23:14,561457 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc88650>]}
2020-02-28 00:23:14,686536 (Thread-1): finished collecting timing info
2020-02-28 00:23:14,687827 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc5dc50>]}
2020-02-28 00:23:14,868032 (Thread-4): finished collecting timing info
2020-02-28 00:23:14,869095 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc02550>]}
2020-02-28 00:23:14,935273 (Thread-3): 16:23:14 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.50s]
2020-02-28 00:23:14,936990 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:23:14,937422 (Thread-3): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:23:14,937948 (Thread-3): 16:23:14 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-28 00:23:14,938814 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:23:14,939375 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-28 00:23:14,939585 (Thread-3): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:23:14,950322 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:23:14,950959 (Thread-3): finished collecting timing info
2020-02-28 00:23:14,957288 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:23:14,958332 (Thread-3): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:23:15,72471 (Thread-2): finished collecting timing info
2020-02-28 00:23:15,73573 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eb0fd50>]}
2020-02-28 00:23:15,317253 (Thread-1): 16:23:15 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.63s]
2020-02-28 00:23:15,319075 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:23:15,319555 (Thread-1): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:23:15,320133 (Thread-1): 16:23:15 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-28 00:23:15,321386 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:23:15,321623 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-28 00:23:15,322162 (Thread-1): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:23:15,333285 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:23:15,335960 (Thread-1): finished collecting timing info
2020-02-28 00:23:15,342675 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:23:15,343642 (Thread-1): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:23:15,699145 (Thread-4): 16:23:15 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.81s]
2020-02-28 00:23:15,700870 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:23:15,701341 (Thread-4): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:23:15,701780 (Thread-4): 16:23:15 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-28 00:23:15,702404 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:23:15,702916 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-28 00:23:15,703127 (Thread-4): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:23:15,713826 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:23:15,714465 (Thread-4): finished collecting timing info
2020-02-28 00:23:15,720990 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:23:15,722044 (Thread-4): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-28 00:23:16,87489 (Thread-2): 16:23:16 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 4.01s]
2020-02-28 00:23:16,87858 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:23:16,88192 (Thread-2): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:23:16,88699 (Thread-2): 16:23:16 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-28 00:23:16,89537 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:23:16,89751 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-28 00:23:16,89956 (Thread-2): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:23:16,99587 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:23:16,100187 (Thread-2): finished collecting timing info
2020-02-28 00:23:16,107083 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:23:16,108603 (Thread-2): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-28 00:23:17,222595 (Thread-3): finished collecting timing info
2020-02-28 00:23:17,223689 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc5ded0>]}
2020-02-28 00:23:17,589764 (Thread-3): 16:23:17 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.28s]
2020-02-28 00:23:17,590081 (Thread-3): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:23:17,590346 (Thread-3): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:23:17,590770 (Thread-3): 16:23:17 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-28 00:23:17,591278 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:23:17,591436 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-28 00:23:17,591600 (Thread-3): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:23:17,602366 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:23:17,602888 (Thread-3): finished collecting timing info
2020-02-28 00:23:17,609160 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:23:17,609650 (Thread-3): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-28 00:23:17,869619 (Thread-1): finished collecting timing info
2020-02-28 00:23:17,870672 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eb0fed0>]}
2020-02-28 00:23:18,186724 (Thread-4): finished collecting timing info
2020-02-28 00:23:18,187844 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10feeb850>]}
2020-02-28 00:23:18,237978 (Thread-1): 16:23:18 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.55s]
2020-02-28 00:23:18,239950 (Thread-1): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:23:18,240342 (Thread-1): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:23:18,240818 (Thread-1): 16:23:18 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-28 00:23:18,241297 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:23:18,241705 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-28 00:23:18,242187 (Thread-1): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:23:18,251663 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:23:18,252600 (Thread-1): finished collecting timing info
2020-02-28 00:23:18,259048 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:23:18,259635 (Thread-1): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-28 00:23:18,522772 (Thread-2): finished collecting timing info
2020-02-28 00:23:18,523833 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fcb2dd0>]}
2020-02-28 00:23:18,629490 (Thread-4): 16:23:18 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.49s]
2020-02-28 00:23:18,630214 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:23:18,631352 (Thread-4): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:23:18,631951 (Thread-4): 16:23:18 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-28 00:23:18,632452 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:23:18,632861 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-28 00:23:18,633390 (Thread-4): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:23:18,644769 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:23:18,645661 (Thread-4): finished collecting timing info
2020-02-28 00:23:18,652336 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:23:18,653357 (Thread-4): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-28 00:23:19,17598 (Thread-2): 16:23:19 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.43s]
2020-02-28 00:23:19,17938 (Thread-2): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:23:19,18226 (Thread-2): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:23:19,18664 (Thread-2): 16:23:19 | 12 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-28 00:23:19,19240 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:23:19,19427 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-28 00:23:19,19620 (Thread-2): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:23:19,35999 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:19,748540 (Thread-3): finished collecting timing info
2020-02-28 00:23:19,749613 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110275490>]}
2020-02-28 00:23:20,121555 (Thread-3): 16:23:20 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.16s]
2020-02-28 00:23:20,121860 (Thread-3): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:23:20,122091 (Thread-3): Began running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:23:20,122514 (Thread-3): 16:23:20 | 13 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-28 00:23:20,123132 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:23:20,123327 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-28 00:23:20,123492 (Thread-3): Compiling model.journeyengine_recipes.adwords_urls
2020-02-28 00:23:20,135894 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:20,788084 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:23:20,788739 (Thread-2): finished collecting timing info
2020-02-28 00:23:20,794973 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:23:20,798524 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-28 00:23:20,988623 (Thread-1): finished collecting timing info
2020-02-28 00:23:20,989686 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101bf950>]}
2020-02-28 00:23:21,110825 (Thread-4): finished collecting timing info
2020-02-28 00:23:21,112052 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102cac90>]}
2020-02-28 00:23:21,301633 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:23:21,303764 (Thread-3): finished collecting timing info
2020-02-28 00:23:21,311670 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:23:21,312184 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-28 00:23:21,369991 (Thread-1): 16:23:21 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.75s]
2020-02-28 00:23:21,370672 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:23:21,371836 (Thread-1): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:23:21,372341 (Thread-1): 16:23:21 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-28 00:23:21,372836 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:23:21,373251 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-28 00:23:21,373741 (Thread-1): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-28 00:23:21,389058 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:21,772755 (Thread-4): 16:23:21 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.48s]
2020-02-28 00:23:21,773100 (Thread-4): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:23:21,773346 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:23:21,773751 (Thread-4): 16:23:21 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-28 00:23:21,774256 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:23:21,774411 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-28 00:23:21,774574 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:23:21,788765 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:22,848517 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:23:22,848808 (Thread-1): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-28 00:23:23,18617 (Thread-1): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-28 00:23:23,19184 (Thread-1): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-28 00:23:23,22349 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:23:23,22974 (Thread-1): finished collecting timing info
2020-02-28 00:23:23,71515 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:23:23,72940 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-28 00:23:23,74642 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-28 00:23:23,253434 (Thread-4): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:23:23,254116 (Thread-4): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:23:23,257448 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:23:23,258245 (Thread-4): finished collecting timing info
2020-02-28 00:23:23,266875 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:23:23,270968 (Thread-2): finished collecting timing info
2020-02-28 00:23:23,271955 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110397450>]}
2020-02-28 00:23:23,273803 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-28 00:23:23,641288 (Thread-2): 16:23:23 | 12 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 4.25s]
2020-02-28 00:23:23,641595 (Thread-2): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:23:23,641835 (Thread-2): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:23:23,642229 (Thread-2): 16:23:23 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-28 00:23:23,642723 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:23:23,642876 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-28 00:23:23,643038 (Thread-2): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:23:23,656274 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:24,851089 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:23:24,852156 (Thread-2): finished collecting timing info
2020-02-28 00:23:24,858857 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:23:24,859304 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-28 00:23:25,629052 (Thread-3): finished collecting timing info
2020-02-28 00:23:25,630138 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110379c50>]}
2020-02-28 00:23:26,38520 (Thread-3): 16:23:26 | 13 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 5.51s]
2020-02-28 00:23:26,38920 (Thread-3): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:23:26,39400 (Thread-3): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:23:26,40085 (Thread-3): 16:23:26 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-28 00:23:26,40851 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:23:26,41029 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-28 00:23:26,41193 (Thread-3): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:23:26,61327 (Thread-1): finished collecting timing info
2020-02-28 00:23:26,64425 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:26,65192 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc27e10>]}
2020-02-28 00:23:26,442150 (Thread-1): 16:23:26 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.69s]
2020-02-28 00:23:26,442448 (Thread-1): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:23:26,442689 (Thread-1): Began running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:23:26,442930 (Thread-1): 16:23:26 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-28 00:23:26,443713 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:23:26,444016 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-28 00:23:26,444212 (Thread-1): Compiling model.journeyengine_recipes.fb_conversions
2020-02-28 00:23:26,453888 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:23:26,454364 (Thread-1): finished collecting timing info
2020-02-28 00:23:26,460583 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:23:26,461043 (Thread-1): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-28 00:23:26,936233 (Thread-4): finished collecting timing info
2020-02-28 00:23:26,937561 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fcb3090>]}
2020-02-28 00:23:27,175819 (Thread-2): finished collecting timing info
2020-02-28 00:23:27,176896 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110305ed0>]}
2020-02-28 00:23:27,338730 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 00:23:27,340993 (Thread-4): 16:23:27 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 5.16s]
2020-02-28 00:23:27,342163 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:23:27,342495 (Thread-4): Began running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:23:27,343547 (Thread-4): 16:23:27 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-28 00:23:27,344233 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:23:27,344523 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-28 00:23:27,344895 (Thread-4): Compiling model.journeyengine_recipes.ga_conversions
2020-02-28 00:23:27,355487 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:23:27,356586 (Thread-4): finished collecting timing info
2020-02-28 00:23:27,362755 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:23:27,363484 (Thread-4): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-28 00:23:27,514873 (Thread-3): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:23:27,515556 (Thread-3): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:23:27,522637 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:23:27,523269 (Thread-3): finished collecting timing info
2020-02-28 00:23:27,530425 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:23:27,530899 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:23:27,736538 (Thread-2): 16:23:27 | 16 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.53s]
2020-02-28 00:23:27,736892 (Thread-2): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:23:27,737190 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:23:27,737644 (Thread-2): 16:23:27 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-28 00:23:27,738228 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:23:27,738417 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-28 00:23:27,738614 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:23:27,756576 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:23:27,757084 (Thread-2): finished collecting timing info
2020-02-28 00:23:27,763100 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:23:27,763579 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-28 00:23:28,74619 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/24a7cd3e-448a-436c-9c3b-478a7c3fbba7?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-28 00:23:28,74911 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:23:28,75130 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/24a7cd3e-448a-436c-9c3b-478a7c3fbba7?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 24a7cd3e-448a-436c-9c3b-478a7c3fbba7)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:23:28,75413 (Thread-3): finished collecting timing info
2020-02-28 00:23:28,76228 (Thread-3): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/24a7cd3e-448a-436c-9c3b-478a7c3fbba7?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 24a7cd3e-448a-436c-9c3b-478a7c3fbba7)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:23:28,96300 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eaa3810>]}
2020-02-28 00:23:28,333511 (Thread-1): finished collecting timing info
2020-02-28 00:23:28,334611 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11016b7d0>]}
2020-02-28 00:23:28,463854 (Thread-3): 16:23:28 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 2.06s]
2020-02-28 00:23:28,465569 (Thread-3): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:23:28,465986 (Thread-3): Began running node model.journeyengine_recipes.adwords_join
2020-02-28 00:23:28,466515 (Thread-3): 16:23:28 | 21 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-28 00:23:28,467528 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:23:28,468012 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-28 00:23:28,468196 (Thread-3): Compiling model.journeyengine_recipes.adwords_join
2020-02-28 00:23:28,483109 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:23:28,484152 (Thread-3): finished collecting timing info
2020-02-28 00:23:28,493465 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:23:28,494507 (Thread-3): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-28 00:23:28,848129 (Thread-1): 16:23:28 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 1.89s]
2020-02-28 00:23:28,848437 (Thread-1): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:23:28,848690 (Thread-1): Began running node model.journeyengine_recipes.fb_ads
2020-02-28 00:23:28,849296 (Thread-1): 16:23:28 | 22 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-28 00:23:28,849795 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:23:28,849949 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-28 00:23:28,850110 (Thread-1): Compiling model.journeyengine_recipes.fb_ads
2020-02-28 00:23:28,863551 (Thread-1): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:29,561497 (Thread-4): finished collecting timing info
2020-02-28 00:23:29,562766 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebc0c50>]}
2020-02-28 00:23:29,601132 (Thread-2): finished collecting timing info
2020-02-28 00:23:29,602050 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc3d0d0>]}
2020-02-28 00:23:29,939378 (Thread-4): 16:23:29 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.22s]
2020-02-28 00:23:29,941086 (Thread-4): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:23:29,941460 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:23:29,941860 (Thread-4): 16:23:29 | 23 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-28 00:23:29,942486 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:23:29,943084 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:23:29,943325 (Thread-4): 16:23:29 | 24 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-28 00:23:29,944193 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:23:29,944362 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-28 00:23:29,944527 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:23:29,967710 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:30,242626 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:23:30,245061 (Thread-1): finished collecting timing info
2020-02-28 00:23:30,254009 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:23:30,254925 (Thread-1): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-28 00:23:30,296111 (Thread-3): finished collecting timing info
2020-02-28 00:23:30,296953 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc246d0>]}
2020-02-28 00:23:30,321297 (Thread-2): 16:23:30 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 1.86s]
2020-02-28 00:23:30,323052 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:23:30,323514 (Thread-2): Began running node model.journeyengine_recipes.ga_proc
2020-02-28 00:23:30,324014 (Thread-2): 16:23:30 | 25 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-28 00:23:30,324925 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:23:30,325420 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-28 00:23:30,325795 (Thread-2): Compiling model.journeyengine_recipes.ga_proc
2020-02-28 00:23:30,358769 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:30,747048 (Thread-3): 16:23:30 | 21 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 1.83s]
2020-02-28 00:23:30,747403 (Thread-3): Finished running node model.journeyengine_recipes.adwords_join
2020-02-28 00:23:30,747718 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:23:30,748273 (Thread-3): 16:23:30 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-28 00:23:30,748519 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:23:30,748740 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:23:30,749097 (Thread-3): 16:23:30 | 27 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-28 00:23:30,749719 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:23:30,749885 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-28 00:23:30,750050 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:23:30,763105 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:23:30,763576 (Thread-3): finished collecting timing info
2020-02-28 00:23:30,769674 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:23:30,770165 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-28 00:23:31,122716 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:31,466052 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:32,283791 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-28 00:23:32,453002 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:23:32,453567 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:23:32,453977 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-28 00:23:32,618087 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:23:32,618796 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:23:32,621970 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:23:32,622640 (Thread-4): finished collecting timing info
2020-02-28 00:23:32,630359 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:23:32,630889 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:23:32,659794 (Thread-1): finished collecting timing info
2020-02-28 00:23:32,662490 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:32,663223 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8cc410>]}
2020-02-28 00:23:33,43585 (Thread-1): 16:23:33 | 22 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.81s]
2020-02-28 00:23:33,43904 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads
2020-02-28 00:23:33,44172 (Thread-1): Began running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:23:33,44581 (Thread-1): 16:23:33 | 28 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-28 00:23:33,45089 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:23:33,45247 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-28 00:23:33,45410 (Thread-1): Compiling model.journeyengine_recipes.adwords_stats
2020-02-28 00:23:33,55832 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:23:33,57232 (Thread-1): finished collecting timing info
2020-02-28 00:23:33,63649 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:23:33,64092 (Thread-1): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-28 00:23:33,91926 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/aeb793a5-7140-4f7c-82d1-c8581adc0569?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-28 00:23:33,92154 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:23:33,92311 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/aeb793a5-7140-4f7c-82d1-c8581adc0569?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: aeb793a5-7140-4f7c-82d1-c8581adc0569)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:23:33,92522 (Thread-4): finished collecting timing info
2020-02-28 00:23:33,93144 (Thread-4): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/aeb793a5-7140-4f7c-82d1-c8581adc0569?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: aeb793a5-7140-4f7c-82d1-c8581adc0569)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:23:33,94156 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11039ce50>]}
2020-02-28 00:23:33,460137 (Thread-4): 16:23:33 | 24 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.15s]
2020-02-28 00:23:33,460510 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:23:33,460833 (Thread-4): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:23:33,461547 (Thread-4): 16:23:33 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-28 00:23:33,461819 (Thread-4): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:23:33,462041 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:23:33,462443 (Thread-4): 16:23:33 | 30 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-28 00:23:33,462850 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:23:33,463145 (Thread-4): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:23:33,463537 (Thread-4): 16:23:33 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-28 00:23:33,463754 (Thread-4): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:23:33,512988 (Thread-3): finished collecting timing info
2020-02-28 00:23:33,513930 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103a68d0>]}
2020-02-28 00:23:33,822024 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:33,883359 (Thread-3): 16:23:33 | 27 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.76s]
2020-02-28 00:23:33,883734 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:23:33,884605 (Thread-4): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:23:33,884949 (Thread-4): 16:23:33 | 32 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-28 00:23:33,885522 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:23:33,885691 (Thread-3): Began running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:23:33,885867 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-28 00:23:33,886081 (Thread-3): 16:23:33 | 33 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-28 00:23:33,886255 (Thread-4): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:23:33,886782 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:23:33,893015 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-28 00:23:33,899587 (Thread-3): Compiling model.journeyengine_recipes.social_post_viz
2020-02-28 00:23:33,900388 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:23:33,909125 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:23:33,909659 (Thread-3): finished collecting timing info
2020-02-28 00:23:33,915932 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:23:33,916130 (Thread-4): finished collecting timing info
2020-02-28 00:23:33,923411 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:23:33,924055 (Thread-3): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-28 00:23:33,924720 (Thread-4): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-28 00:23:34,987883 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:23:35,173981 (Thread-1): finished collecting timing info
2020-02-28 00:23:35,175020 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101e60d0>]}
2020-02-28 00:23:35,540882 (Thread-1): 16:23:35 | 28 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.13s]
2020-02-28 00:23:35,541222 (Thread-1): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:23:35,541883 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:23:35,542184 (Thread-1): 16:23:35 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-28 00:23:35,542446 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:23:35,542936 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:23:35,543176 (Thread-1): 16:23:35 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-28 00:23:35,543381 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:23:36,156593 (Thread-3): finished collecting timing info
2020-02-28 00:23:36,157710 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103b32d0>]}
2020-02-28 00:23:36,174459 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:23:36,175209 (Thread-2): finished collecting timing info
2020-02-28 00:23:36,182463 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:23:36,182952 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 00:23:36,246549 (Thread-4): finished collecting timing info
2020-02-28 00:23:36,247764 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103b3ed0>]}
2020-02-28 00:23:36,522633 (Thread-3): 16:23:36 | 33 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.27s]
2020-02-28 00:23:36,523006 (Thread-3): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:23:36,742893 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/88d72097-1d18-4c09-abf3-ffa86ce1b2b0?maxResults=0&location=US: Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]')
2020-02-28 00:23:36,743276 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 00:23:36,743533 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/88d72097-1d18-4c09-abf3-ffa86ce1b2b0?maxResults=0&location=US: Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]

(job ID: 88d72097-1d18-4c09-abf3-ffa86ce1b2b0)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal16completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal18completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal5completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal17completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal13completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal10completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:23:36,743835 (Thread-2): finished collecting timing info
2020-02-28 00:23:36,744654 (Thread-2): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/88d72097-1d18-4c09-abf3-ffa86ce1b2b0?maxResults=0&location=US: Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]

(job ID: 88d72097-1d18-4c09-abf3-ffa86ce1b2b0)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal16completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal18completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal5completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal17completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal13completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal10completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-28 00:23:36,745805 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10feb84d0>]}
2020-02-28 00:23:36,926864 (Thread-4): 16:23:36 | 32 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.36s]
2020-02-28 00:23:36,928277 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:23:36,928997 (Thread-1): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:23:36,929288 (Thread-1): 16:23:36 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-28 00:23:36,930140 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:23:36,930711 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-28 00:23:36,930894 (Thread-1): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-28 00:23:36,943744 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:23:36,944274 (Thread-1): finished collecting timing info
2020-02-28 00:23:36,950432 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:23:36,950902 (Thread-1): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-28 00:23:37,319584 (Thread-2): 16:23:37 | 25 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 6.42s]
2020-02-28 00:23:37,319937 (Thread-2): Finished running node model.journeyengine_recipes.ga_proc
2020-02-28 00:23:37,320656 (Thread-4): Began running node model.journeyengine_recipes.ga_stats
2020-02-28 00:23:37,320928 (Thread-4): 16:23:37 | 37 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-28 00:23:37,321320 (Thread-4): Finished running node model.journeyengine_recipes.ga_stats
2020-02-28 00:23:37,321786 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:23:37,322056 (Thread-2): 16:23:37 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-28 00:23:37,322269 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:23:37,322750 (Thread-4): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:23:37,322945 (Thread-3): Began running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:23:37,323139 (Thread-4): 16:23:37 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-28 00:23:37,323365 (Thread-3): 16:23:37 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-28 00:23:37,323619 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:23:37,323909 (Thread-3): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:23:37,324442 (Thread-2): Began running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:23:37,324750 (Thread-2): 16:23:37 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-28 00:23:37,324933 (Thread-3): Began running node model.journeyengine_recipes.platform_index
2020-02-28 00:23:37,325134 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:23:37,325365 (Thread-3): 16:23:37 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-28 00:23:37,325835 (Thread-4): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:23:37,326130 (Thread-3): Finished running node model.journeyengine_recipes.platform_index
2020-02-28 00:23:37,326424 (Thread-4): 16:23:37 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-28 00:23:37,326939 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:23:37,327162 (Thread-2): Began running node model.journeyengine_recipes.platform_viz
2020-02-28 00:23:37,327541 (Thread-2): 16:23:37 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-28 00:23:37,327757 (Thread-2): Finished running node model.journeyengine_recipes.platform_viz
2020-02-28 00:23:39,146619 (Thread-1): finished collecting timing info
2020-02-28 00:23:39,147713 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f604f324-72dc-4740-8f1d-6fb4996d9dbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103fa0d0>]}
2020-02-28 00:23:39,527935 (Thread-1): 16:23:39 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.22s]
2020-02-28 00:23:39,528309 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:23:39,569056 (MainThread): 16:23:39 | 
2020-02-28 00:23:39,569355 (MainThread): 16:23:39 | Finished running 44 table models in 29.42s.
2020-02-28 00:23:39,569573 (MainThread): Connection 'master' was left open.
2020-02-28 00:23:39,569730 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-28 00:23:39,569875 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-28 00:23:39,570016 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-28 00:23:39,570154 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-28 00:23:39,716833 (MainThread): 
2020-02-28 00:23:39,717120 (MainThread): Completed with 3 errors and 0 warnings:
2020-02-28 00:23:39,717334 (MainThread): 
2020-02-28 00:23:39,717516 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-28 00:23:39,717692 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-28 00:23:39,717855 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:23:39,718030 (MainThread): 
2020-02-28 00:23:39,718176 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-28 00:23:39,718313 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-28 00:23:39,718441 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:23:39,718575 (MainThread): 
2020-02-28 00:23:39,718715 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-28 00:23:39,718847 (MainThread):   Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]
2020-02-28 00:23:39,718972 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-28 00:23:39,719135 (MainThread): 
Done. PASS=41 WARN=0 ERROR=3 SKIP=0 TOTAL=44
2020-02-28 00:23:39,719369 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eae5f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc6c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11035be90>]}
2020-02-28 00:23:40,95370 (MainThread): Flushing usage events
2020-02-28 00:25:37,199220 (MainThread): Running with dbt=0.15.2
2020-02-28 00:25:37,472658 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-28 00:25:37,473651 (MainThread): Tracking: tracking
2020-02-28 00:25:37,482316 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11179a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111221150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11179ac90>]}
2020-02-28 00:25:37,938474 (MainThread): Partial parsing not enabled
2020-02-28 00:25:37,941108 (MainThread): Parsing macros/core.sql
2020-02-28 00:25:37,946389 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-28 00:25:37,955367 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-28 00:25:37,957672 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-28 00:25:37,978480 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-28 00:25:38,3009 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-28 00:25:38,25572 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-28 00:25:38,28298 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-28 00:25:38,38096 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-28 00:25:38,47629 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-28 00:25:38,55962 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-28 00:25:38,63948 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-28 00:25:38,70464 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-28 00:25:38,71822 (MainThread): Parsing macros/etc/query.sql
2020-02-28 00:25:38,73388 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-28 00:25:38,75698 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-28 00:25:38,78472 (MainThread): Parsing macros/etc/datetime.sql
2020-02-28 00:25:38,89692 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-28 00:25:38,92446 (MainThread): Parsing macros/adapters/common.sql
2020-02-28 00:25:38,129370 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-28 00:25:38,132072 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-28 00:25:38,134077 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-28 00:25:38,136031 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-28 00:25:38,139425 (MainThread): Parsing macros/etc.sql
2020-02-28 00:25:38,141057 (MainThread): Parsing macros/catalog.sql
2020-02-28 00:25:38,146070 (MainThread): Parsing macros/adapters.sql
2020-02-28 00:25:38,164334 (MainThread): Parsing macros/materializations/merge.sql
2020-02-28 00:25:38,165779 (MainThread): Parsing macros/materializations/seed.sql
2020-02-28 00:25:38,168544 (MainThread): Parsing macros/materializations/view.sql
2020-02-28 00:25:38,170686 (MainThread): Parsing macros/materializations/table.sql
2020-02-28 00:25:38,182160 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-28 00:25:38,189511 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-28 00:25:38,234484 (MainThread): Partial parsing not enabled
2020-02-28 00:25:38,235766 (MainThread): Parsing macros/get_column_values.sql
2020-02-28 00:25:38,241844 (MainThread): Parsing macros/fill_missing.sql
2020-02-28 00:25:38,248371 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-28 00:25:38,249934 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-28 00:25:38,251881 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-28 00:25:38,254771 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-28 00:25:38,256558 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-28 00:25:38,262633 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-28 00:25:38,264605 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-28 00:25:38,266457 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-28 00:25:38,269629 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-28 00:25:38,271228 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-28 00:25:38,274036 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-28 00:25:38,277092 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-28 00:25:38,279799 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-28 00:25:38,281884 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-28 00:25:38,284061 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-28 00:25:38,285558 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-28 00:25:38,289303 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-28 00:25:38,295169 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-28 00:25:38,298909 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-28 00:25:38,301638 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-28 00:25:38,303914 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-28 00:25:38,327609 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-28 00:25:38,328712 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-28 00:25:38,330059 (MainThread): Parsing macros/logger/log_info.sql
2020-02-28 00:25:38,331246 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-28 00:25:38,335576 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-28 00:25:38,337879 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-28 00:25:38,341171 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-28 00:25:38,343072 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-28 00:25:38,344681 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-28 00:25:38,346730 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-28 00:25:38,349583 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-28 00:25:38,351744 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-28 00:25:38,353582 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-28 00:25:38,355253 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-28 00:25:38,357143 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-28 00:25:38,359452 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-28 00:25:38,361239 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-28 00:25:38,365103 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-28 00:25:38,370138 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-28 00:25:38,371893 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-28 00:25:38,376221 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-28 00:25:38,381422 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-28 00:25:38,384763 (MainThread): Parsing macros/sql/star.sql
2020-02-28 00:25:38,388762 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-28 00:25:38,396420 (MainThread): Parsing macros/sql/union.sql
2020-02-28 00:25:38,409233 (MainThread): Parsing macros/sql/groupby.sql
2020-02-28 00:25:38,410828 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-28 00:25:38,413385 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-28 00:25:38,415263 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-28 00:25:38,420959 (MainThread): Parsing macros/sql/pivot.sql
2020-02-28 00:25:38,424587 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-28 00:25:38,451058 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-28 00:25:38,451231 (MainThread): Opening a new connection, currently in state init
2020-02-28 00:25:38,481014 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:25:38,481235 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,492026 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-28 00:25:38,492187 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,500894 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:25:38,501027 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,509215 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-28 00:25:38,509339 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,517460 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-28 00:25:38,517586 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,531653 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-28 00:25:38,531887 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,544955 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-28 00:25:38,545161 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,556963 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:25:38,557102 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,566065 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:25:38,566192 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,581594 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-28 00:25:38,581851 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,591758 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-28 00:25:38,591902 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,603436 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:25:38,603566 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,610503 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:25:38,610637 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,617616 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:25:38,617745 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,624362 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:25:38,624481 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,632720 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-28 00:25:38,632870 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,641869 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-28 00:25:38,642029 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,650874 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-28 00:25:38,651015 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,659852 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-28 00:25:38,659975 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,667906 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-28 00:25:38,668032 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,677027 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:25:38,677229 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,732683 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 00:25:38,732932 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,746179 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:25:38,746303 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,754335 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:25:38,754457 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,760985 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:25:38,761109 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,768855 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:25:38,768985 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,812779 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:25:38,812994 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,820287 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:25:38,820421 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,827183 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:25:38,827310 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,834394 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:25:38,834566 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,848054 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-28 00:25:38,848195 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,859827 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:25:38,859991 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,869754 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:25:38,869927 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,884638 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:25:38,884768 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,909387 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:25:38,909569 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,923075 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:25:38,923220 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,941744 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:25:38,941954 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,950949 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:25:38,951088 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,958980 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:25:38,959105 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,968188 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:25:38,968311 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,976012 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:25:38,976163 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,987740 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:25:38,987868 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:38,999136 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:25:38,999264 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:39,272870 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-28 00:25:39,300678 (MainThread): 
2020-02-28 00:25:39,301166 (MainThread): Acquiring new bigquery connection "master".
2020-02-28 00:25:39,301304 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:25:40,57668 (MainThread): 16:25:40 | Concurrency: 4 threads (target='dev')
2020-02-28 00:25:40,57912 (MainThread): 16:25:40 | 
2020-02-28 00:25:40,64617 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:25:40,64795 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:25:40,65006 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:25:40,65194 (Thread-1): 16:25:40 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-28 00:25:40,65320 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:25:40,65536 (Thread-2): 16:25:40 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-28 00:25:40,65725 (Thread-3): 16:25:40 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-28 00:25:40,65978 (Thread-4): 16:25:40 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-28 00:25:40,66287 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:25:40,66632 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:25:40,67027 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:25:40,67169 (Thread-1): Opening a new connection, currently in state init
2020-02-28 00:25:40,67431 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:25:40,67576 (Thread-2): Opening a new connection, currently in state init
2020-02-28 00:25:40,67709 (Thread-3): Opening a new connection, currently in state init
2020-02-28 00:25:40,67863 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-28 00:25:40,67991 (Thread-4): Opening a new connection, currently in state init
2020-02-28 00:25:40,68128 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:25:40,68264 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-28 00:25:40,80034 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:25:40,85552 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:25:40,93171 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:25:40,101658 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:25:40,110240 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:25:40,111338 (Thread-4): finished collecting timing info
2020-02-28 00:25:40,111653 (Thread-1): finished collecting timing info
2020-02-28 00:25:40,111929 (Thread-2): finished collecting timing info
2020-02-28 00:25:40,112175 (Thread-3): finished collecting timing info
2020-02-28 00:25:40,871109 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:25:40,877817 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:25:40,883787 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:25:40,898746 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:25:40,900335 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-28 00:25:40,901203 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-28 00:25:40,902496 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-28 00:25:40,902747 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-28 00:25:43,124180 (Thread-2): finished collecting timing info
2020-02-28 00:25:43,125075 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111773810>]}
2020-02-28 00:25:43,493645 (Thread-2): 16:25:43 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (9) in 3.06s]
2020-02-28 00:25:43,493891 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:25:43,494081 (Thread-2): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:25:43,494440 (Thread-2): 16:25:43 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-28 00:25:43,494987 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:25:43,495114 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-28 00:25:43,495253 (Thread-2): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:25:43,503331 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:25:43,503898 (Thread-2): finished collecting timing info
2020-02-28 00:25:43,510702 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:25:43,511121 (Thread-2): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:25:43,646736 (Thread-3): finished collecting timing info
2020-02-28 00:25:43,647854 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112933cd0>]}
2020-02-28 00:25:43,682682 (Thread-1): finished collecting timing info
2020-02-28 00:25:43,683824 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110de3dd0>]}
2020-02-28 00:25:44,9866 (Thread-3): 16:25:44 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.58s]
2020-02-28 00:25:44,11437 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:25:44,11819 (Thread-3): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:25:44,12223 (Thread-3): 16:25:44 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-28 00:25:44,12728 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:25:44,13133 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-28 00:25:44,13615 (Thread-3): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:25:44,23852 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:25:44,24655 (Thread-3): finished collecting timing info
2020-02-28 00:25:44,31264 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:25:44,31995 (Thread-3): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:25:44,392012 (Thread-4): finished collecting timing info
2020-02-28 00:25:44,393103 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11292ec10>]}
2020-02-28 00:25:44,395583 (Thread-1): 16:25:44 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.62s]
2020-02-28 00:25:44,396759 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:25:44,397023 (Thread-1): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:25:44,397490 (Thread-1): 16:25:44 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-28 00:25:44,398405 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:25:44,398798 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-28 00:25:44,398952 (Thread-1): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:25:44,407343 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:25:44,407917 (Thread-1): finished collecting timing info
2020-02-28 00:25:44,414292 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:25:44,414740 (Thread-1): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-28 00:25:44,765769 (Thread-4): 16:25:44 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 4.33s]
2020-02-28 00:25:44,766067 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:25:44,766303 (Thread-4): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:25:44,766691 (Thread-4): 16:25:44 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-28 00:25:44,767178 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:25:44,767331 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-28 00:25:44,767494 (Thread-4): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:25:44,776744 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:25:44,777217 (Thread-4): finished collecting timing info
2020-02-28 00:25:44,784218 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:25:44,784645 (Thread-4): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-28 00:25:45,622017 (Thread-2): finished collecting timing info
2020-02-28 00:25:45,623074 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c7add0>]}
2020-02-28 00:25:45,986217 (Thread-2): 16:25:45 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.13s]
2020-02-28 00:25:45,986576 (Thread-2): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:25:45,986797 (Thread-2): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:25:45,987045 (Thread-2): 16:25:45 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-28 00:25:45,987617 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:25:45,987738 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-28 00:25:45,987865 (Thread-2): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:25:45,997193 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:25:45,997742 (Thread-2): finished collecting timing info
2020-02-28 00:25:46,4145 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:25:46,4561 (Thread-2): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-28 00:25:46,518753 (Thread-1): finished collecting timing info
2020-02-28 00:25:46,519828 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11292edd0>]}
2020-02-28 00:25:46,909762 (Thread-1): 16:25:46 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.12s]
2020-02-28 00:25:46,910111 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:25:46,910345 (Thread-1): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:25:46,910737 (Thread-1): 16:25:46 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-28 00:25:46,911221 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:25:46,911371 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-28 00:25:46,911534 (Thread-1): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:25:46,920930 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:25:46,921410 (Thread-1): finished collecting timing info
2020-02-28 00:25:46,927793 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:25:46,928223 (Thread-1): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-28 00:25:46,975544 (Thread-4): finished collecting timing info
2020-02-28 00:25:46,976392 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f76750>]}
2020-02-28 00:25:47,356781 (Thread-4): 16:25:47 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.21s]
2020-02-28 00:25:47,357115 (Thread-4): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:25:47,357398 (Thread-4): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:25:47,357861 (Thread-4): 16:25:47 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-28 00:25:47,358433 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:25:47,358617 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-28 00:25:47,358819 (Thread-4): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:25:47,369116 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:25:47,369625 (Thread-4): finished collecting timing info
2020-02-28 00:25:47,376828 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:25:47,377241 (Thread-4): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-28 00:25:48,162167 (Thread-2): finished collecting timing info
2020-02-28 00:25:48,163213 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ec82d0>]}
2020-02-28 00:25:48,535843 (Thread-2): 16:25:48 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.18s]
2020-02-28 00:25:48,536189 (Thread-2): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:25:48,536435 (Thread-2): Began running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:25:48,536821 (Thread-2): 16:25:48 | 12 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-28 00:25:48,537302 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:25:48,537453 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-28 00:25:48,537616 (Thread-2): Compiling model.journeyengine_recipes.fb_conversions
2020-02-28 00:25:48,548375 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:25:48,548831 (Thread-2): finished collecting timing info
2020-02-28 00:25:48,554896 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:25:48,555300 (Thread-2): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-28 00:25:49,718243 (Thread-1): finished collecting timing info
2020-02-28 00:25:49,719323 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c47450>]}
2020-02-28 00:25:49,803114 (Thread-4): finished collecting timing info
2020-02-28 00:25:49,804182 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129a7c50>]}
2020-02-28 00:25:50,91333 (Thread-1): 16:25:50 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.81s]
2020-02-28 00:25:50,92901 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:25:50,93370 (Thread-1): Began running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:25:50,93836 (Thread-1): 16:25:50 | 13 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-28 00:25:50,94611 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:25:50,95088 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-28 00:25:50,95274 (Thread-1): Compiling model.journeyengine_recipes.ga_conversions
2020-02-28 00:25:50,106305 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:25:50,106857 (Thread-1): finished collecting timing info
2020-02-28 00:25:50,112854 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:25:50,113257 (Thread-1): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-28 00:25:50,221648 (Thread-3): finished collecting timing info
2020-02-28 00:25:50,222704 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128a3c50>]}
2020-02-28 00:25:50,468713 (Thread-4): 16:25:50 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.45s]
2020-02-28 00:25:50,470375 (Thread-4): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:25:50,470836 (Thread-4): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:25:50,471325 (Thread-4): 16:25:50 | 14 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-28 00:25:50,472233 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:25:50,472818 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-28 00:25:50,474218 (Thread-4): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:25:50,488487 (Thread-4): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:50,844393 (Thread-3): 16:25:50 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 6.21s]
2020-02-28 00:25:50,844687 (Thread-3): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:25:50,844928 (Thread-3): Began running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:25:50,845363 (Thread-3): 16:25:50 | 15 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-28 00:25:50,845998 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:25:50,846196 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-28 00:25:50,846365 (Thread-3): Compiling model.journeyengine_recipes.adwords_urls
2020-02-28 00:25:50,860093 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:51,85021 (Thread-2): finished collecting timing info
2020-02-28 00:25:51,86108 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11289fd90>]}
2020-02-28 00:25:51,488605 (Thread-2): 16:25:51 | 12 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.55s]
2020-02-28 00:25:51,489028 (Thread-2): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:25:51,489278 (Thread-2): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:25:51,489810 (Thread-2): 16:25:51 | 16 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-28 00:25:51,490317 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:25:51,490470 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-28 00:25:51,490631 (Thread-2): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-28 00:25:51,504032 (Thread-2): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:51,898405 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:25:51,898926 (Thread-4): finished collecting timing info
2020-02-28 00:25:51,905198 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:25:51,905615 (Thread-4): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-28 00:25:52,30209 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:25:52,30783 (Thread-3): finished collecting timing info
2020-02-28 00:25:52,38419 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:25:52,38988 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-28 00:25:52,310141 (Thread-1): finished collecting timing info
2020-02-28 00:25:52,311245 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130d12d0>]}
2020-02-28 00:25:52,705907 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-28 00:25:52,706202 (Thread-2): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-28 00:25:52,711008 (Thread-1): 16:25:52 | 13 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (9) in 2.22s]
2020-02-28 00:25:52,711334 (Thread-1): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:25:52,711549 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:25:52,711891 (Thread-1): 16:25:52 | 17 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-28 00:25:52,712409 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:25:52,712547 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-28 00:25:52,712677 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:25:52,724870 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:52,859875 (Thread-2): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-28 00:25:52,860370 (Thread-2): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-28 00:25:52,863258 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:25:52,863944 (Thread-2): finished collecting timing info
2020-02-28 00:25:52,872411 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:25:52,872856 (Thread-2): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-28 00:25:53,873881 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:25:54,31576 (Thread-4): finished collecting timing info
2020-02-28 00:25:54,32708 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f0d450>]}
2020-02-28 00:25:54,45977 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:25:54,46563 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:25:54,48967 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:25:54,49495 (Thread-1): finished collecting timing info
2020-02-28 00:25:54,56315 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:25:54,56874 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-28 00:25:54,197489 (Thread-3): finished collecting timing info
2020-02-28 00:25:54,198670 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112982890>]}
2020-02-28 00:25:54,421174 (Thread-4): 16:25:54 | 14 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 3.56s]
2020-02-28 00:25:54,422994 (Thread-4): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:25:54,423430 (Thread-4): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:25:54,423838 (Thread-4): 16:25:54 | 18 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-28 00:25:54,424572 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:25:54,425042 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-28 00:25:54,425216 (Thread-4): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:25:54,438832 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:54,804147 (Thread-3): 16:25:54 | 15 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 3.35s]
2020-02-28 00:25:54,804488 (Thread-3): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:25:54,804793 (Thread-3): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:25:54,805366 (Thread-3): 16:25:54 | 19 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-28 00:25:54,805853 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:25:54,806004 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-28 00:25:54,806166 (Thread-3): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:25:54,822263 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:55,514723 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:25:55,515403 (Thread-4): finished collecting timing info
2020-02-28 00:25:55,524112 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:25:55,524559 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-28 00:25:56,57538 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 00:25:56,183576 (Thread-3): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:25:56,184306 (Thread-3): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:25:56,191407 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:25:56,191997 (Thread-3): finished collecting timing info
2020-02-28 00:25:56,199263 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:25:56,199688 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:25:56,695855 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/2e22f5b3-9465-4beb-996e-b1126cec37b5?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-28 00:25:56,696156 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:25:56,696368 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/2e22f5b3-9465-4beb-996e-b1126cec37b5?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 2e22f5b3-9465-4beb-996e-b1126cec37b5)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:25:56,696652 (Thread-3): finished collecting timing info
2020-02-28 00:25:56,697480 (Thread-3): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/2e22f5b3-9465-4beb-996e-b1126cec37b5?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 2e22f5b3-9465-4beb-996e-b1126cec37b5)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:25:56,714438 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f4cf10>]}
2020-02-28 00:25:56,728761 (Thread-1): finished collecting timing info
2020-02-28 00:25:56,729803 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130f5650>]}
2020-02-28 00:25:57,85039 (Thread-3): 16:25:57 | 19 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.91s]
2020-02-28 00:25:57,86855 (Thread-3): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:25:57,87171 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:25:57,87750 (Thread-3): 16:25:57 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-28 00:25:57,88245 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:25:57,88422 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-28 00:25:57,88922 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:25:57,107772 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:25:57,111439 (Thread-2): finished collecting timing info
2020-02-28 00:25:57,112227 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112889b50>]}
2020-02-28 00:25:57,112793 (Thread-3): finished collecting timing info
2020-02-28 00:25:57,119272 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:25:57,119768 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-28 00:25:57,528861 (Thread-1): 16:25:57 | 17 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.02s]
2020-02-28 00:25:57,530682 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:25:57,531126 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:25:57,531607 (Thread-1): 16:25:57 | 21 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-28 00:25:57,532186 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:25:57,532683 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-28 00:25:57,532889 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:25:57,564285 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:57,914822 (Thread-2): 16:25:57 | 16 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 5.62s]
2020-02-28 00:25:57,915158 (Thread-2): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:25:57,915444 (Thread-2): Began running node model.journeyengine_recipes.ga_proc
2020-02-28 00:25:57,915992 (Thread-2): 16:25:57 | 22 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-28 00:25:57,916603 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:25:57,916809 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-28 00:25:57,917011 (Thread-2): Compiling model.journeyengine_recipes.ga_proc
2020-02-28 00:25:57,953933 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:58,200109 (Thread-4): finished collecting timing info
2020-02-28 00:25:58,200957 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11295e150>]}
2020-02-28 00:25:58,585312 (Thread-4): 16:25:58 | 18 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.78s]
2020-02-28 00:25:58,585656 (Thread-4): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:25:58,585935 (Thread-4): Began running node model.journeyengine_recipes.adwords_join
2020-02-28 00:25:58,586344 (Thread-4): 16:25:58 | 23 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-28 00:25:58,587013 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:25:58,587183 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-28 00:25:58,587347 (Thread-4): Compiling model.journeyengine_recipes.adwords_join
2020-02-28 00:25:58,599614 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:25:58,600098 (Thread-4): finished collecting timing info
2020-02-28 00:25:58,605964 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:25:58,606362 (Thread-4): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-28 00:25:58,647842 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:59,17154 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:25:59,493366 (Thread-3): finished collecting timing info
2020-02-28 00:25:59,494710 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c76410>]}
2020-02-28 00:25:59,927821 (Thread-3): 16:25:59 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.41s]
2020-02-28 00:25:59,928145 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:25:59,928381 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-28 00:25:59,928792 (Thread-3): 16:25:59 | 24 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-28 00:25:59,929412 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:25:59,929608 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-28 00:25:59,929782 (Thread-3): Compiling model.journeyengine_recipes.fb_ads
2020-02-28 00:25:59,944177 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:26:00,7114 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:26:00,172203 (Thread-1): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:26:00,172859 (Thread-1): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:26:00,173359 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:26:00,365080 (Thread-1): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:26:00,365747 (Thread-1): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:26:00,369022 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:26:00,369671 (Thread-1): finished collecting timing info
2020-02-28 00:26:00,379467 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:26:00,380132 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:26:00,531447 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:26:00,851041 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/61b6557f-3f1b-42e4-9faf-0261a010ed42?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-28 00:26:00,851328 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:26:00,851536 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/61b6557f-3f1b-42e4-9faf-0261a010ed42?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 61b6557f-3f1b-42e4-9faf-0261a010ed42)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:26:00,851808 (Thread-1): finished collecting timing info
2020-02-28 00:26:00,852618 (Thread-1): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/61b6557f-3f1b-42e4-9faf-0261a010ed42?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 61b6557f-3f1b-42e4-9faf-0261a010ed42)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:26:00,853772 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130b4ed0>]}
2020-02-28 00:26:00,977662 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:26:00,978313 (Thread-3): finished collecting timing info
2020-02-28 00:26:00,986022 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:26:00,986434 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-28 00:26:01,222493 (Thread-1): 16:26:01 | 21 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.32s]
2020-02-28 00:26:01,222842 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:26:01,223151 (Thread-1): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:26:01,223638 (Thread-1): 16:26:01 | 25 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-28 00:26:01,223861 (Thread-1): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:26:01,224076 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:26:01,224416 (Thread-1): 16:26:01 | 26 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-28 00:26:01,225072 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:26:01,225269 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-28 00:26:01,225438 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:26:01,239564 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:26:01,240215 (Thread-1): finished collecting timing info
2020-02-28 00:26:01,246878 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:26:01,247414 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-28 00:26:02,174617 (Thread-4): finished collecting timing info
2020-02-28 00:26:02,175965 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ec1910>]}
2020-02-28 00:26:02,188033 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:26:03,46684 (Thread-4): 16:26:03 | 23 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 3.59s]
2020-02-28 00:26:03,47155 (Thread-4): Finished running node model.journeyengine_recipes.adwords_join
2020-02-28 00:26:03,47369 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:26:03,47711 (Thread-4): 16:26:03 | 27 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-28 00:26:03,48008 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:26:03,48206 (Thread-4): Began running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:26:03,48479 (Thread-4): 16:26:03 | 28 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-28 00:26:03,48974 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:26:03,49112 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-28 00:26:03,49254 (Thread-4): Compiling model.journeyengine_recipes.adwords_stats
2020-02-28 00:26:03,58524 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:26:03,60328 (Thread-4): finished collecting timing info
2020-02-28 00:26:03,68306 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:26:03,69064 (Thread-4): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-28 00:26:03,508857 (Thread-3): finished collecting timing info
2020-02-28 00:26:03,510455 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128a3c50>]}
2020-02-28 00:26:03,677091 (Thread-1): finished collecting timing info
2020-02-28 00:26:03,678529 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f92190>]}
2020-02-28 00:26:03,681752 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:26:04,176283 (Thread-3): 16:26:04 | 24 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.58s]
2020-02-28 00:26:04,177709 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-28 00:26:04,178050 (Thread-3): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:26:04,178418 (Thread-3): 16:26:04 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-28 00:26:04,178972 (Thread-3): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:26:04,179483 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:26:04,179707 (Thread-3): 16:26:04 | 30 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-28 00:26:04,180182 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:26:04,180669 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:26:04,180858 (Thread-3): 16:26:04 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-28 00:26:04,181026 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:26:04,808455 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:26:04,809459 (Thread-2): finished collecting timing info
2020-02-28 00:26:04,817998 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:26:04,819110 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 00:26:04,974131 (Thread-1): 16:26:04 | 26 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.45s]
2020-02-28 00:26:04,974430 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:26:04,975030 (Thread-3): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:26:04,975267 (Thread-1): Began running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:26:04,975481 (Thread-3): 16:26:04 | 32 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-28 00:26:04,975741 (Thread-1): 16:26:04 | 33 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-28 00:26:04,976452 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:26:04,976975 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:26:04,977104 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-28 00:26:04,977271 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-28 00:26:04,977485 (Thread-3): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:26:04,977707 (Thread-1): Compiling model.journeyengine_recipes.social_post_viz
2020-02-28 00:26:04,988252 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:26:04,998090 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:26:05,175 (Thread-1): finished collecting timing info
2020-02-28 00:26:05,6533 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:26:05,6733 (Thread-3): finished collecting timing info
2020-02-28 00:26:05,16642 (Thread-1): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-28 00:26:05,17526 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:26:05,20125 (Thread-3): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-28 00:26:05,285810 (Thread-2): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/6f86ffd3-4fb5-4bb7-a160-55d2b7bf3296?maxResults=0&location=US: Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]')
2020-02-28 00:26:05,286094 (Thread-2): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
			
				
					cast(goal19completions as int64) 
					 
					 as mqls,  
				
			
							
				null as subscribers,		
						
			
				
					cast(goal18completions as int64) 
					 +  
					 
				
					cast(goal16completions as int64) 
					 +  
					 
				
					cast(goal5completions as int64) 
					 +  
					 
				
					cast(goal13completions as int64) 
					 +  
					 
				
					cast(goal17completions as int64) 
					 +  
					 
				
					cast(goal10completions as int64) 
					 
					 as excluded,  
				
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 00:26:05,286312 (Thread-2): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/6f86ffd3-4fb5-4bb7-a160-55d2b7bf3296?maxResults=0&location=US: Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]

(job ID: 6f86ffd3-4fb5-4bb7-a160-55d2b7bf3296)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal16completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal5completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal13completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal17completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal10completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:26:05,286588 (Thread-2): finished collecting timing info
2020-02-28 00:26:05,287395 (Thread-2): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/6f86ffd3-4fb5-4bb7-a160-55d2b7bf3296?maxResults=0&location=US: Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]

(job ID: 6f86ffd3-4fb5-4bb7-a160-55d2b7bf3296)

                                                                         -----Query Job SQL Follows-----                                                                         

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  10:
  11:
  12:
  13:
  14:with ga_report as (
  15:
  16:	    
  17:
  18:	    	
  19:	    	
  20:	    	
  21:	    	
  22:
  23:		   	SELECT
  24:		   	'quantic' as bigquery_name,
  25:		   	'Google Analytics' as lookup_platform,
  26:			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  27:			date,
  28:			lower(source) source,
  29:			lower(medium) medium,
  30:			sessions,
  31:			goalcompletionsall goal_completions,
  32:			## goal completion columns
  33:			
  34:				
  35:					cast(goal19completions as int64) 
  36:					 
  37:					 as mqls,  
  38:				
  39:			
  40:							
  41:				null as subscribers,		
  42:						
  43:			
  44:				
  45:					cast(goal18completions as int64) 
  46:					 +  
  47:					 
  48:				
  49:					cast(goal16completions as int64) 
  50:					 +  
  51:					 
  52:				
  53:					cast(goal5completions as int64) 
  54:					 +  
  55:					 
  56:				
  57:					cast(goal13completions as int64) 
  58:					 +  
  59:					 
  60:				
  61:					cast(goal17completions as int64) 
  62:					 +  
  63:					 
  64:				
  65:					cast(goal10completions as int64) 
  66:					 
  67:					 as excluded,  
  68:				
  69:					
  70:							
  71:				null as other,		
  72:						
  73:			_sdc_sequence,
  74:			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
  75:			FROM `journeyengine-recipes.ga_quantic.report` 
  76:
  77:		    
  78:	   
  79:
  80:)
  81:
  82:
  83:SELECT 
  84:bigquery_name,
  85:lookup_platform,
  86:date,
  87:url,
  88:source,
  89:medium,
  90:sum(sessions) sessions,
  91:sum(goal_completions) goal_completions,
  92:sum(mqls) mqls,
  93:sum(subscribers) subscribers,
  94:sum(excluded) excluded,
  95:sum(other) other
  96:FROM ga_report
  97:where lv = _sdc_sequence
  98:group by bigquery_name, lookup_platform, date, url, source, medium
  99:
 100:
 101:  );
 102:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model ga_proc (models/base/ga/ga_proc.sql)
  Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]
  compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-28 00:26:05,288570 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129d7c90>]}
2020-02-28 00:26:05,451137 (Thread-4): finished collecting timing info
2020-02-28 00:26:05,452203 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fe3fd0>]}
2020-02-28 00:26:05,655225 (Thread-2): 16:26:05 | 22 of 44 ERROR creating table model agency_data_pipeline.ga_proc..... [ERROR in 7.37s]
2020-02-28 00:26:05,656826 (Thread-2): Finished running node model.journeyengine_recipes.ga_proc
2020-02-28 00:26:05,657681 (Thread-2): Began running node model.journeyengine_recipes.ga_stats
2020-02-28 00:26:05,657991 (Thread-2): 16:26:05 | 34 of 44 SKIP relation agency_data_pipeline.ga_stats................. [SKIP]
2020-02-28 00:26:05,658521 (Thread-2): Finished running node model.journeyengine_recipes.ga_stats
2020-02-28 00:26:06,25294 (Thread-4): 16:26:06 | 28 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.40s]
2020-02-28 00:26:06,25645 (Thread-4): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:26:06,26414 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:26:06,26729 (Thread-2): 16:26:06 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-28 00:26:06,26989 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:26:06,27561 (Thread-4): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:26:06,27876 (Thread-4): 16:26:06 | 36 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-28 00:26:06,28129 (Thread-4): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:26:06,28666 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:26:06,28968 (Thread-2): 16:26:06 | 37 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-28 00:26:06,29226 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:26:06,29805 (Thread-4): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:26:06,30090 (Thread-4): 16:26:06 | 38 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-28 00:26:06,30283 (Thread-2): Began running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:26:06,30638 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:26:06,30915 (Thread-2): 16:26:06 | 39 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-28 00:26:06,31534 (Thread-4): Began running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:26:06,31743 (Thread-2): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:26:06,31938 (Thread-4): 16:26:06 | 40 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-28 00:26:06,32433 (Thread-2): Began running node model.journeyengine_recipes.platform_index
2020-02-28 00:26:06,32676 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:26:06,32864 (Thread-2): 16:26:06 | 41 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-28 00:26:06,33421 (Thread-4): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:26:06,33649 (Thread-4): 16:26:06 | 42 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-28 00:26:06,33825 (Thread-2): Finished running node model.journeyengine_recipes.platform_index
2020-02-28 00:26:06,34125 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:26:06,34605 (Thread-2): Began running node model.journeyengine_recipes.platform_viz
2020-02-28 00:26:06,35079 (Thread-2): 16:26:06 | 43 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-28 00:26:06,35416 (Thread-2): Finished running node model.journeyengine_recipes.platform_viz
2020-02-28 00:26:07,477706 (Thread-3): finished collecting timing info
2020-02-28 00:26:07,478795 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113159490>]}
2020-02-28 00:26:07,490517 (Thread-1): finished collecting timing info
2020-02-28 00:26:07,491355 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11316d150>]}
2020-02-28 00:26:07,864156 (Thread-3): 16:26:07 | 32 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.50s]
2020-02-28 00:26:07,865838 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:26:07,866588 (Thread-4): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:26:07,866873 (Thread-4): 16:26:07 | 44 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-28 00:26:07,867755 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:26:07,868345 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-28 00:26:07,868608 (Thread-4): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-28 00:26:07,881072 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:26:07,881571 (Thread-4): finished collecting timing info
2020-02-28 00:26:07,888024 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:26:07,888466 (Thread-4): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-28 00:26:08,283255 (Thread-1): 16:26:08 | 33 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.51s]
2020-02-28 00:26:08,283617 (Thread-1): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:26:09,996207 (Thread-4): finished collecting timing info
2020-02-28 00:26:09,997312 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ed7f5c4-6f92-429a-b6fb-9d6ec27f288d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129fa1d0>]}
2020-02-28 00:26:10,369591 (Thread-4): 16:26:10 | 44 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.13s]
2020-02-28 00:26:10,369941 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:26:10,442424 (MainThread): 16:26:10 | 
2020-02-28 00:26:10,442684 (MainThread): 16:26:10 | Finished running 44 table models in 31.14s.
2020-02-28 00:26:10,442852 (MainThread): Connection 'master' was left open.
2020-02-28 00:26:10,442983 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-28 00:26:10,443098 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-28 00:26:10,443209 (MainThread): Connection 'model.journeyengine_recipes.social_platform_by_month' was left open.
2020-02-28 00:26:10,443317 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-28 00:26:10,594173 (MainThread): 
2020-02-28 00:26:10,594423 (MainThread): Completed with 3 errors and 0 warnings:
2020-02-28 00:26:10,594603 (MainThread): 
2020-02-28 00:26:10,594777 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-28 00:26:10,594937 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-28 00:26:10,595097 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:26:10,595239 (MainThread): 
2020-02-28 00:26:10,595386 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-28 00:26:10,595523 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-28 00:26:10,595652 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:26:10,595788 (MainThread): 
2020-02-28 00:26:10,595931 (MainThread): Database Error in model ga_proc (models/base/ga/ga_proc.sql)
2020-02-28 00:26:10,596065 (MainThread):   Unrecognized name: goal5completions; Did you mean goal8completions? at [53:46]
2020-02-28 00:26:10,596193 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/ga/ga_proc.sql
2020-02-28 00:26:10,596360 (MainThread): 
Done. PASS=41 WARN=0 ERROR=3 SKIP=0 TOTAL=44
2020-02-28 00:26:10,596595 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11290a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111221150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129fa1d0>]}
2020-02-28 00:26:10,977715 (MainThread): Flushing usage events
2020-02-28 00:27:26,313478 (MainThread): Running with dbt=0.15.2
2020-02-28 00:27:26,544816 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-28 00:27:26,545452 (MainThread): Tracking: tracking
2020-02-28 00:27:26,552667 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a01810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a01ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a01790>]}
2020-02-28 00:27:27,27830 (MainThread): Partial parsing not enabled
2020-02-28 00:27:27,30097 (MainThread): Parsing macros/core.sql
2020-02-28 00:27:27,37027 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-28 00:27:27,45875 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-28 00:27:27,47948 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-28 00:27:27,68862 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-28 00:27:27,92232 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-28 00:27:27,115247 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-28 00:27:27,118717 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-28 00:27:27,128385 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-28 00:27:27,137328 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-28 00:27:27,145084 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-28 00:27:27,152476 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-28 00:27:27,159360 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-28 00:27:27,161409 (MainThread): Parsing macros/etc/query.sql
2020-02-28 00:27:27,163100 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-28 00:27:27,165375 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-28 00:27:27,167989 (MainThread): Parsing macros/etc/datetime.sql
2020-02-28 00:27:27,182982 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-28 00:27:27,186408 (MainThread): Parsing macros/adapters/common.sql
2020-02-28 00:27:27,222700 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-28 00:27:27,224200 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-28 00:27:27,225435 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-28 00:27:27,226852 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-28 00:27:27,229854 (MainThread): Parsing macros/etc.sql
2020-02-28 00:27:27,230743 (MainThread): Parsing macros/catalog.sql
2020-02-28 00:27:27,235936 (MainThread): Parsing macros/adapters.sql
2020-02-28 00:27:27,254408 (MainThread): Parsing macros/materializations/merge.sql
2020-02-28 00:27:27,255525 (MainThread): Parsing macros/materializations/seed.sql
2020-02-28 00:27:27,258001 (MainThread): Parsing macros/materializations/view.sql
2020-02-28 00:27:27,259762 (MainThread): Parsing macros/materializations/table.sql
2020-02-28 00:27:27,273836 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-28 00:27:27,282065 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-28 00:27:27,322008 (MainThread): Partial parsing not enabled
2020-02-28 00:27:27,322482 (MainThread): Parsing macros/get_column_values.sql
2020-02-28 00:27:27,326793 (MainThread): Parsing macros/fill_missing.sql
2020-02-28 00:27:27,332127 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-28 00:27:27,333320 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-28 00:27:27,334890 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-28 00:27:27,337333 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-28 00:27:27,338741 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-28 00:27:27,344560 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-28 00:27:27,346257 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-28 00:27:27,347694 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-28 00:27:27,350472 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-28 00:27:27,351667 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-28 00:27:27,354083 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-28 00:27:27,356694 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-28 00:27:27,358868 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-28 00:27:27,360533 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-28 00:27:27,362275 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-28 00:27:27,364180 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-28 00:27:27,368129 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-28 00:27:27,373795 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-28 00:27:27,377112 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-28 00:27:27,379291 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-28 00:27:27,381116 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-28 00:27:27,404390 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-28 00:27:27,405283 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-28 00:27:27,406359 (MainThread): Parsing macros/logger/log_info.sql
2020-02-28 00:27:27,407280 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-28 00:27:27,411177 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-28 00:27:27,413468 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-28 00:27:27,417995 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-28 00:27:27,420025 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-28 00:27:27,421616 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-28 00:27:27,424350 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-28 00:27:27,427933 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-28 00:27:27,430323 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-28 00:27:27,433088 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-28 00:27:27,435058 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-28 00:27:27,437109 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-28 00:27:27,439197 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-28 00:27:27,440571 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-28 00:27:27,443979 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-28 00:27:27,448707 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-28 00:27:27,450136 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-28 00:27:27,454008 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-28 00:27:27,458869 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-28 00:27:27,461909 (MainThread): Parsing macros/sql/star.sql
2020-02-28 00:27:27,465544 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-28 00:27:27,472920 (MainThread): Parsing macros/sql/union.sql
2020-02-28 00:27:27,484283 (MainThread): Parsing macros/sql/groupby.sql
2020-02-28 00:27:27,485525 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-28 00:27:27,487675 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-28 00:27:27,489225 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-28 00:27:27,494298 (MainThread): Parsing macros/sql/pivot.sql
2020-02-28 00:27:27,497593 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-28 00:27:27,525736 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-28 00:27:27,525863 (MainThread): Opening a new connection, currently in state init
2020-02-28 00:27:27,550982 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:27:27,551137 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,558556 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-28 00:27:27,558674 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,566451 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:27:27,566579 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,574079 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-28 00:27:27,574197 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,582480 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-28 00:27:27,582674 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,596482 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-28 00:27:27,596722 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,606178 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-28 00:27:27,606335 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,615659 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:27:27,615786 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,624519 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:27:27,624637 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,639090 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-28 00:27:27,639256 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,648257 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-28 00:27:27,648380 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,659221 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:27:27,659341 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,666110 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:27:27,666243 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,672599 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:27:27,672722 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,679041 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:27:27,679158 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,690110 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-28 00:27:27,690250 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,698206 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-28 00:27:27,698329 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,705930 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-28 00:27:27,706047 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,714252 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-28 00:27:27,714373 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,721685 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-28 00:27:27,721801 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,729172 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:27:27,729399 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,783689 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 00:27:27,783831 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,794105 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:27:27,794227 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,801786 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:27:27,801903 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,808283 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:27:27,808404 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,815706 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:27:27,815831 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,858802 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:27:27,859030 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,866101 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:27:27,866246 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,872623 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:27:27,872742 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,879393 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:27:27,879526 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,891954 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-28 00:27:27,892071 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,902891 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:27:27,903033 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,912785 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:27:27,912965 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,925543 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:27:27,925661 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,947312 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:27:27,947473 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,959394 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:27:27,959515 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,973902 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:27:27,974050 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,980540 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:27:27,980660 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,987643 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:27:27,987761 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:27,996379 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:27:27,996499 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:28,3745 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:27:28,3861 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:28,14664 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:27:28,14793 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:28,25498 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:27:28,25615 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:28,299796 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-28 00:27:28,327124 (MainThread): 
2020-02-28 00:27:28,327572 (MainThread): Acquiring new bigquery connection "master".
2020-02-28 00:27:28,327686 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:27:29,76038 (MainThread): 16:27:29 | Concurrency: 4 threads (target='dev')
2020-02-28 00:27:29,76284 (MainThread): 16:27:29 | 
2020-02-28 00:27:29,79280 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:27:29,79516 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:27:29,79788 (Thread-1): 16:27:29 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-28 00:27:29,79982 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:27:29,80291 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:27:29,80513 (Thread-2): 16:27:29 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-28 00:27:29,80993 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:27:29,81174 (Thread-3): 16:27:29 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-28 00:27:29,81429 (Thread-4): 16:27:29 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-28 00:27:29,81923 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:27:29,82034 (Thread-1): Opening a new connection, currently in state init
2020-02-28 00:27:29,82602 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:27:29,82991 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:27:29,83207 (Thread-2): Opening a new connection, currently in state init
2020-02-28 00:27:29,83444 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-28 00:27:29,83625 (Thread-3): Opening a new connection, currently in state init
2020-02-28 00:27:29,83828 (Thread-4): Opening a new connection, currently in state init
2020-02-28 00:27:29,84019 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:27:29,100760 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:27:29,100890 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-28 00:27:29,101263 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:27:29,113115 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:27:29,122470 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:27:29,129040 (Thread-1): finished collecting timing info
2020-02-28 00:27:29,130570 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:27:29,148334 (Thread-2): finished collecting timing info
2020-02-28 00:27:29,167284 (Thread-3): finished collecting timing info
2020-02-28 00:27:29,251309 (Thread-4): finished collecting timing info
2020-02-28 00:27:29,830437 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:27:29,831731 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:27:29,832951 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:27:29,833436 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:27:29,835607 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-28 00:27:29,836958 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-28 00:27:29,837864 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-28 00:27:29,839432 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-28 00:27:32,155793 (Thread-1): finished collecting timing info
2020-02-28 00:27:32,156707 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c12e90>]}
2020-02-28 00:27:32,237418 (Thread-3): finished collecting timing info
2020-02-28 00:27:32,238501 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b8b190>]}
2020-02-28 00:27:32,339891 (Thread-4): finished collecting timing info
2020-02-28 00:27:32,340995 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b9e750>]}
2020-02-28 00:27:32,492535 (Thread-2): finished collecting timing info
2020-02-28 00:27:32,493634 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b71590>]}
2020-02-28 00:27:32,550411 (Thread-1): 16:27:32 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.08s]
2020-02-28 00:27:32,551981 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:27:32,552405 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:27:32,553259 (Thread-1): 16:27:32 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-28 00:27:32,553783 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:27:32,553951 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-28 00:27:32,554377 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:27:32,563771 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:27:32,564782 (Thread-1): finished collecting timing info
2020-02-28 00:27:32,571152 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:27:32,571619 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:27:32,980980 (Thread-3): 16:27:32 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.16s]
2020-02-28 00:27:32,982732 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:27:32,983189 (Thread-3): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:27:32,983627 (Thread-3): 16:27:32 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-28 00:27:32,984406 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:27:32,984884 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-28 00:27:32,985067 (Thread-3): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:27:32,997133 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:27:32,997816 (Thread-3): finished collecting timing info
2020-02-28 00:27:33,5589 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:27:33,6158 (Thread-3): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:27:33,364319 (Thread-4): 16:27:33 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.26s]
2020-02-28 00:27:33,365719 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:27:33,366208 (Thread-4): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:27:33,366648 (Thread-4): 16:27:33 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-28 00:27:33,367622 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:27:33,368214 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-28 00:27:33,368435 (Thread-4): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:27:33,378829 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:27:33,379453 (Thread-4): finished collecting timing info
2020-02-28 00:27:33,385963 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:27:33,386421 (Thread-4): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-28 00:27:33,740387 (Thread-2): 16:27:33 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (7) in 3.41s]
2020-02-28 00:27:33,741409 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:27:33,741794 (Thread-2): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:27:33,742236 (Thread-2): 16:27:33 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-28 00:27:33,742904 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:27:33,743065 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-28 00:27:33,743235 (Thread-2): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:27:33,752759 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:27:33,753234 (Thread-2): finished collecting timing info
2020-02-28 00:27:33,759543 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:27:33,759999 (Thread-2): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-28 00:27:35,430931 (Thread-3): finished collecting timing info
2020-02-28 00:27:35,432746 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e9a1d0>]}
2020-02-28 00:27:35,647611 (Thread-1): finished collecting timing info
2020-02-28 00:27:35,648678 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112bdeed0>]}
2020-02-28 00:27:35,808021 (Thread-3): 16:27:35 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.45s]
2020-02-28 00:27:35,809814 (Thread-3): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:27:35,810268 (Thread-3): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:27:35,811693 (Thread-3): 16:27:35 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-28 00:27:35,813124 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:27:35,813334 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-28 00:27:35,816359 (Thread-2): finished collecting timing info
2020-02-28 00:27:35,816783 (Thread-3): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:27:35,817824 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114196cd0>]}
2020-02-28 00:27:35,828917 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:27:35,829627 (Thread-3): finished collecting timing info
2020-02-28 00:27:35,836629 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:27:35,837175 (Thread-3): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-28 00:27:36,191350 (Thread-1): 16:27:36 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 3.09s]
2020-02-28 00:27:36,192111 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:27:36,193512 (Thread-1): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:27:36,194040 (Thread-1): 16:27:36 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-28 00:27:36,194562 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:27:36,194986 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-28 00:27:36,195491 (Thread-1): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:27:36,205255 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:27:36,205882 (Thread-1): finished collecting timing info
2020-02-28 00:27:36,212213 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:27:36,212667 (Thread-1): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-28 00:27:36,560238 (Thread-2): 16:27:36 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.07s]
2020-02-28 00:27:36,560604 (Thread-2): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:27:36,560913 (Thread-2): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:27:36,561365 (Thread-2): 16:27:36 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-28 00:27:36,561873 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:27:36,562036 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-28 00:27:36,562204 (Thread-2): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:27:36,572294 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:27:36,572836 (Thread-2): finished collecting timing info
2020-02-28 00:27:36,579240 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:27:36,579696 (Thread-2): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-28 00:27:36,734480 (Thread-4): finished collecting timing info
2020-02-28 00:27:36,735579 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112bb2f10>]}
2020-02-28 00:27:37,175460 (Thread-4): 16:27:37 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 3.37s]
2020-02-28 00:27:37,175802 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:27:37,176119 (Thread-4): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:27:37,176583 (Thread-4): 16:27:37 | 12 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-28 00:27:37,177188 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:27:37,177380 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-28 00:27:37,177582 (Thread-4): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:27:37,192479 (Thread-4): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:37,924538 (Thread-3): finished collecting timing info
2020-02-28 00:27:37,925603 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e28750>]}
2020-02-28 00:27:38,304903 (Thread-3): 16:27:38 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.11s]
2020-02-28 00:27:38,305258 (Thread-3): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:27:38,305568 (Thread-3): Began running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:27:38,306093 (Thread-3): 16:27:38 | 13 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-28 00:27:38,306905 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:27:38,307118 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-28 00:27:38,307339 (Thread-3): Compiling model.journeyengine_recipes.adwords_urls
2020-02-28 00:27:38,322119 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:38,333843 (Thread-1): finished collecting timing info
2020-02-28 00:27:38,334616 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141a8d10>]}
2020-02-28 00:27:38,609696 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:27:38,610634 (Thread-4): finished collecting timing info
2020-02-28 00:27:38,618037 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:27:38,619826 (Thread-4): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-28 00:27:38,674863 (Thread-2): finished collecting timing info
2020-02-28 00:27:38,675922 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114161310>]}
2020-02-28 00:27:38,707754 (Thread-1): 16:27:38 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.14s]
2020-02-28 00:27:38,709517 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:27:38,709981 (Thread-1): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:27:38,710395 (Thread-1): 16:27:38 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-28 00:27:38,710836 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:27:38,711253 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-28 00:27:38,711422 (Thread-1): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-28 00:27:38,725683 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:39,98471 (Thread-2): 16:27:39 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.11s]
2020-02-28 00:27:39,98833 (Thread-2): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:27:39,99145 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:27:39,99612 (Thread-2): 16:27:39 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-28 00:27:39,100220 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:27:39,100413 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-28 00:27:39,100615 (Thread-2): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:27:39,115974 (Thread-2): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:39,875751 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:27:39,876759 (Thread-3): finished collecting timing info
2020-02-28 00:27:39,884350 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:27:39,884798 (Thread-3): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-28 00:27:40,43954 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:27:40,44251 (Thread-1): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-28 00:27:40,201620 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-28 00:27:40,209125 (Thread-1): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-28 00:27:40,209516 (Thread-1): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-28 00:27:40,212075 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:27:40,212636 (Thread-1): finished collecting timing info
2020-02-28 00:27:40,261026 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:27:40,261677 (Thread-1): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-28 00:27:40,368300 (Thread-2): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:27:40,368785 (Thread-2): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:27:40,370911 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:27:40,371451 (Thread-2): finished collecting timing info
2020-02-28 00:27:40,378252 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:27:40,378921 (Thread-2): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-28 00:27:41,880877 (Thread-4): finished collecting timing info
2020-02-28 00:27:41,881934 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114300290>]}
2020-02-28 00:27:42,252837 (Thread-4): 16:27:42 | 12 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 4.70s]
2020-02-28 00:27:42,253208 (Thread-4): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:27:42,253478 (Thread-4): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:27:42,253941 (Thread-4): 16:27:42 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-28 00:27:42,254552 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:27:42,254747 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-28 00:27:42,254950 (Thread-4): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:27:42,268537 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:42,352455 (Thread-3): finished collecting timing info
2020-02-28 00:27:42,353540 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114138d90>]}
2020-02-28 00:27:42,641543 (Thread-1): finished collecting timing info
2020-02-28 00:27:42,642992 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11410da50>]}
2020-02-28 00:27:42,732450 (Thread-3): 16:27:42 | 13 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 4.05s]
2020-02-28 00:27:42,733817 (Thread-3): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:27:42,734246 (Thread-3): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:27:42,734746 (Thread-3): 16:27:42 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-28 00:27:42,735685 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:27:42,736181 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-28 00:27:42,736564 (Thread-3): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:27:42,752854 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:43,141109 (Thread-1): 16:27:43 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 3.93s]
2020-02-28 00:27:43,141405 (Thread-1): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:27:43,141657 (Thread-1): Began running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:27:43,142203 (Thread-1): 16:27:43 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-28 00:27:43,142740 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:27:43,142900 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-28 00:27:43,143069 (Thread-1): Compiling model.journeyengine_recipes.fb_conversions
2020-02-28 00:27:43,154706 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:27:43,155181 (Thread-1): finished collecting timing info
2020-02-28 00:27:43,161240 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:27:43,161702 (Thread-1): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-28 00:27:43,515810 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:27:43,516441 (Thread-4): finished collecting timing info
2020-02-28 00:27:43,524316 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:27:43,524872 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-28 00:27:43,544810 (Thread-2): finished collecting timing info
2020-02-28 00:27:43,545671 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112bc5610>]}
2020-02-28 00:27:43,826545 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 00:27:43,920488 (Thread-2): 16:27:43 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.45s]
2020-02-28 00:27:43,920756 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:27:43,920979 (Thread-2): Began running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:27:43,921201 (Thread-2): 16:27:43 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-28 00:27:43,921749 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:27:43,921885 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-28 00:27:43,922022 (Thread-2): Compiling model.journeyengine_recipes.ga_conversions
2020-02-28 00:27:43,932653 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:27:43,933098 (Thread-2): finished collecting timing info
2020-02-28 00:27:43,939276 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:27:43,939693 (Thread-2): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-28 00:27:43,984775 (Thread-3): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:27:43,985236 (Thread-3): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:27:43,990596 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:27:43,991085 (Thread-3): finished collecting timing info
2020-02-28 00:27:43,998016 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:27:43,998479 (Thread-3): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:27:44,396819 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/8e6c6f8e-d3f2-4591-a10c-889510d07177?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-28 00:27:44,397038 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:27:44,397196 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/8e6c6f8e-d3f2-4591-a10c-889510d07177?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 8e6c6f8e-d3f2-4591-a10c-889510d07177)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:27:44,397402 (Thread-3): finished collecting timing info
2020-02-28 00:27:44,397993 (Thread-3): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/8e6c6f8e-d3f2-4591-a10c-889510d07177?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 8e6c6f8e-d3f2-4591-a10c-889510d07177)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:27:44,401914 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140fd710>]}
2020-02-28 00:27:44,772319 (Thread-3): 16:27:44 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.67s]
2020-02-28 00:27:44,772679 (Thread-3): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:27:44,772935 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:27:44,773421 (Thread-3): 16:27:44 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-28 00:27:44,774002 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:27:44,774176 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-28 00:27:44,774346 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:27:44,793734 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:27:44,796699 (Thread-3): finished collecting timing info
2020-02-28 00:27:44,806085 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:27:44,807749 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-28 00:27:44,943417 (Thread-1): finished collecting timing info
2020-02-28 00:27:44,944477 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c58550>]}
2020-02-28 00:27:45,310218 (Thread-1): 16:27:45 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 1.80s]
2020-02-28 00:27:45,310573 (Thread-1): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:27:45,310869 (Thread-1): Began running node model.journeyengine_recipes.adwords_join
2020-02-28 00:27:45,311482 (Thread-1): 16:27:45 | 21 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-28 00:27:45,311998 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:27:45,312156 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-28 00:27:45,312322 (Thread-1): Compiling model.journeyengine_recipes.adwords_join
2020-02-28 00:27:45,324459 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:27:45,324918 (Thread-1): finished collecting timing info
2020-02-28 00:27:45,332427 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:27:45,332895 (Thread-1): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-28 00:27:45,837587 (Thread-2): finished collecting timing info
2020-02-28 00:27:45,838703 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142643d0>]}
2020-02-28 00:27:46,202857 (Thread-2): 16:27:46 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (7) in 1.92s]
2020-02-28 00:27:46,203235 (Thread-2): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:27:46,203561 (Thread-2): Began running node model.journeyengine_recipes.fb_ads
2020-02-28 00:27:46,204161 (Thread-2): 16:27:46 | 22 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-28 00:27:46,204757 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:27:46,204928 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-28 00:27:46,205097 (Thread-2): Compiling model.journeyengine_recipes.fb_ads
2020-02-28 00:27:46,220501 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:46,929999 (Thread-3): finished collecting timing info
2020-02-28 00:27:46,931135 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a5a150>]}
2020-02-28 00:27:47,112037 (Thread-4): finished collecting timing info
2020-02-28 00:27:47,113118 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c3f790>]}
2020-02-28 00:27:47,305085 (Thread-3): 16:27:47 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.16s]
2020-02-28 00:27:47,305754 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:27:47,307063 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:27:47,307655 (Thread-3): 16:27:47 | 23 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-28 00:27:47,308322 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:27:47,308528 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-28 00:27:47,309006 (Thread-3): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:27:47,334837 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:47,340641 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:27:47,342563 (Thread-2): finished collecting timing info
2020-02-28 00:27:47,350405 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:27:47,351273 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-28 00:27:47,744080 (Thread-4): 16:27:47 | 16 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 4.86s]
2020-02-28 00:27:47,744426 (Thread-4): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:27:47,744786 (Thread-4): Began running node model.journeyengine_recipes.ga_proc
2020-02-28 00:27:47,745445 (Thread-4): 16:27:47 | 24 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-28 00:27:47,746240 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:27:47,746409 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-28 00:27:47,746584 (Thread-4): Compiling model.journeyengine_recipes.ga_proc
2020-02-28 00:27:47,780919 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:48,532778 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:48,831694 (Thread-1): finished collecting timing info
2020-02-28 00:27:48,833030 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b3b4d0>]}
2020-02-28 00:27:48,959465 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:49,200398 (Thread-1): 16:27:49 | 21 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 3.52s]
2020-02-28 00:27:49,200708 (Thread-1): Finished running node model.journeyengine_recipes.adwords_join
2020-02-28 00:27:49,200957 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:27:49,201445 (Thread-1): 16:27:49 | 25 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-28 00:27:49,202180 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:27:49,202424 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-28 00:27:49,202631 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:27:49,216057 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:27:49,216525 (Thread-1): finished collecting timing info
2020-02-28 00:27:49,222496 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:27:49,222903 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-28 00:27:49,792133 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 00:27:49,958476 (Thread-3): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:27:49,959182 (Thread-3): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:27:49,959740 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 00:27:50,33159 (Thread-2): finished collecting timing info
2020-02-28 00:27:50,34590 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11433ab50>]}
2020-02-28 00:27:50,43439 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:50,151351 (Thread-3): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:27:50,152020 (Thread-3): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:27:50,155347 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:27:50,156009 (Thread-3): finished collecting timing info
2020-02-28 00:27:50,164061 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:27:50,164653 (Thread-3): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:27:50,400684 (Thread-2): 16:27:50 | 22 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.83s]
2020-02-28 00:27:50,401040 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads
2020-02-28 00:27:50,401329 (Thread-2): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:27:50,401780 (Thread-2): 16:27:50 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-28 00:27:50,402073 (Thread-2): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:27:50,402346 (Thread-2): Began running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:27:50,402927 (Thread-2): 16:27:50 | 27 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-28 00:27:50,403608 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:27:50,403770 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-28 00:27:50,403936 (Thread-2): Compiling model.journeyengine_recipes.adwords_stats
2020-02-28 00:27:50,414819 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:27:50,415310 (Thread-2): finished collecting timing info
2020-02-28 00:27:50,422601 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:27:50,423043 (Thread-2): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-28 00:27:50,557863 (Thread-3): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a10d4591-df9f-428e-a73d-aa32db4009de?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-28 00:27:50,558172 (Thread-3): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:27:50,558396 (Thread-3): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a10d4591-df9f-428e-a73d-aa32db4009de?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: a10d4591-df9f-428e-a73d-aa32db4009de)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:27:50,558683 (Thread-3): finished collecting timing info
2020-02-28 00:27:50,559525 (Thread-3): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/a10d4591-df9f-428e-a73d-aa32db4009de?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: a10d4591-df9f-428e-a73d-aa32db4009de)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:27:50,560778 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11435a450>]}
2020-02-28 00:27:50,933809 (Thread-3): 16:27:50 | 23 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.25s]
2020-02-28 00:27:50,934174 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:27:50,934477 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:27:50,935257 (Thread-3): 16:27:50 | 28 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-28 00:27:50,935589 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:27:50,935868 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:27:50,936307 (Thread-3): 16:27:50 | 29 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-28 00:27:50,936729 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:27:50,936991 (Thread-3): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:27:50,937361 (Thread-3): 16:27:50 | 30 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-28 00:27:50,937618 (Thread-3): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:27:50,938108 (Thread-3): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:27:50,938369 (Thread-3): 16:27:50 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-28 00:27:50,938618 (Thread-3): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:27:51,419927 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:52,549244 (Thread-2): finished collecting timing info
2020-02-28 00:27:52,550346 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11438d590>]}
2020-02-28 00:27:52,589712 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:27:52,943058 (Thread-2): 16:27:52 | 27 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.15s]
2020-02-28 00:27:52,943418 (Thread-2): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:27:52,944211 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:27:52,944558 (Thread-3): 16:27:52 | 32 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-28 00:27:52,944807 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:27:52,945346 (Thread-2): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:27:52,945658 (Thread-2): 16:27:52 | 33 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-28 00:27:52,945918 (Thread-2): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:27:54,115013 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:27:54,115682 (Thread-4): finished collecting timing info
2020-02-28 00:27:54,123739 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:27:54,124257 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
							
				null as mqls,		
			
							
				null as subscribers,		
						
							
				null as excluded,		
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 00:27:54,403701 (Thread-1): finished collecting timing info
2020-02-28 00:27:54,404811 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140ce750>]}
2020-02-28 00:27:54,772890 (Thread-1): 16:27:54 | 25 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 5.20s]
2020-02-28 00:27:54,773205 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:27:54,773852 (Thread-3): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:27:54,774112 (Thread-2): Began running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:27:54,774346 (Thread-3): 16:27:54 | 34 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-28 00:27:54,774601 (Thread-2): 16:27:54 | 35 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-28 00:27:54,775198 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:27:54,775629 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:27:54,775801 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-28 00:27:54,775976 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-28 00:27:54,776170 (Thread-3): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:27:54,776349 (Thread-2): Compiling model.journeyengine_recipes.social_post_viz
2020-02-28 00:27:54,787466 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:27:54,797450 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:27:54,798050 (Thread-3): finished collecting timing info
2020-02-28 00:27:54,803946 (Thread-2): finished collecting timing info
2020-02-28 00:27:54,805502 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:27:54,813383 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:27:54,814041 (Thread-3): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-28 00:27:54,814652 (Thread-2): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-28 00:27:56,937018 (Thread-2): finished collecting timing info
2020-02-28 00:27:56,938117 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11438bd10>]}
2020-02-28 00:27:57,257611 (Thread-3): finished collecting timing info
2020-02-28 00:27:57,258708 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143bedd0>]}
2020-02-28 00:27:57,343215 (Thread-2): 16:27:57 | 35 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.16s]
2020-02-28 00:27:57,345068 (Thread-2): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:27:57,740889 (Thread-3): 16:27:57 | 34 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.48s]
2020-02-28 00:27:57,741260 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:27:57,741964 (Thread-1): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:27:57,742334 (Thread-1): 16:27:57 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-28 00:27:57,742924 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:27:57,743116 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-28 00:27:57,743318 (Thread-1): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-28 00:27:57,755061 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:27:57,755619 (Thread-1): finished collecting timing info
2020-02-28 00:27:57,761922 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:27:57,762413 (Thread-1): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-28 00:27:59,666499 (Thread-1): finished collecting timing info
2020-02-28 00:27:59,667594 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e3fb90>]}
2020-02-28 00:28:00,40712 (Thread-1): 16:28:00 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 1.92s]
2020-02-28 00:28:00,41013 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:28:02,203447 (Thread-4): finished collecting timing info
2020-02-28 00:28:02,204538 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b7abd0>]}
2020-02-28 00:28:02,584927 (Thread-4): 16:28:02 | 24 of 44 OK created table model agency_data_pipeline.ga_proc......... [CREATE TABLE (698763) in 14.46s]
2020-02-28 00:28:02,585229 (Thread-4): Finished running node model.journeyengine_recipes.ga_proc
2020-02-28 00:28:02,585804 (Thread-3): Began running node model.journeyengine_recipes.ga_stats
2020-02-28 00:28:02,586090 (Thread-3): 16:28:02 | 37 of 44 START table model agency_data_pipeline.ga_stats............. [RUN]
2020-02-28 00:28:02,586580 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 00:28:02,586733 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.social_platform_by_month).
2020-02-28 00:28:02,586895 (Thread-3): Compiling model.journeyengine_recipes.ga_stats
2020-02-28 00:28:02,600628 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 00:28:02,601060 (Thread-3): finished collecting timing info
2020-02-28 00:28:02,607139 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 00:28:02,607577 (Thread-3): On model.journeyengine_recipes.ga_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_stats`
  
  
  OPTIONS()
  as (
    SELECT  
cast(date as date) date,
b.account,
b.site site,
c.source source,
c.medium medium,
concat(a.source, ' / ', a.medium) source_medium,  
case when c.platform is null then "Unmapped" else c.platform end as platform,
case when c.channel is null then "Unmapped" else c.channel end as channel,
url,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(other) other,
sum(excluded) excluded
FROM `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b 
ON ( a.bigquery_name = b.bigquery_name 
	AND a.lookup_platform = b.platform )
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc` c
ON ( a.source = c.source
  AND a.medium = c.medium 
  AND a.bigquery_name = c.bigquery_name )
GROUP BY date, account, site, source, medium, source_medium, platform, channel, url
  );
    
2020-02-28 00:28:13,772923 (Thread-3): finished collecting timing info
2020-02-28 00:28:13,773991 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8871c64-e654-49a1-9350-61c4d35256ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114383450>]}
2020-02-28 00:28:14,151856 (Thread-3): 16:28:14 | 37 of 44 OK created table model agency_data_pipeline.ga_stats........ [CREATE TABLE (698763) in 11.19s]
2020-02-28 00:28:14,152199 (Thread-3): Finished running node model.journeyengine_recipes.ga_stats
2020-02-28 00:28:14,152868 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:28:14,153174 (Thread-1): 16:28:14 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-28 00:28:14,153440 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:28:14,153975 (Thread-2): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:28:14,154226 (Thread-3): Began running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:28:14,154477 (Thread-2): 16:28:14 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-28 00:28:14,154706 (Thread-3): 16:28:14 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-28 00:28:14,155061 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:28:14,155445 (Thread-3): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:28:14,156182 (Thread-1): Began running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:28:14,156527 (Thread-1): 16:28:14 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-28 00:28:14,156709 (Thread-2): Began running node model.journeyengine_recipes.platform_index
2020-02-28 00:28:14,156952 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:28:14,157136 (Thread-2): 16:28:14 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-28 00:28:14,157608 (Thread-4): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:28:14,157792 (Thread-2): Finished running node model.journeyengine_recipes.platform_index
2020-02-28 00:28:14,158003 (Thread-4): 16:28:14 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-28 00:28:14,158496 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:28:14,158691 (Thread-1): Began running node model.journeyengine_recipes.platform_viz
2020-02-28 00:28:14,159034 (Thread-1): 16:28:14 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-28 00:28:14,159236 (Thread-1): Finished running node model.journeyengine_recipes.platform_viz
2020-02-28 00:28:14,247109 (MainThread): 16:28:14 | 
2020-02-28 00:28:14,247472 (MainThread): 16:28:14 | Finished running 44 table models in 45.92s.
2020-02-28 00:28:14,247732 (MainThread): Connection 'master' was left open.
2020-02-28 00:28:14,247998 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-28 00:28:14,248178 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-28 00:28:14,248348 (MainThread): Connection 'model.journeyengine_recipes.ga_stats' was left open.
2020-02-28 00:28:14,248514 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-28 00:28:14,388294 (MainThread): 
2020-02-28 00:28:14,388542 (MainThread): Completed with 2 errors and 0 warnings:
2020-02-28 00:28:14,388725 (MainThread): 
2020-02-28 00:28:14,388899 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-28 00:28:14,389049 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-28 00:28:14,389194 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:28:14,389334 (MainThread): 
2020-02-28 00:28:14,389479 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-28 00:28:14,389617 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-28 00:28:14,389747 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:28:14,389911 (MainThread): 
Done. PASS=42 WARN=0 ERROR=2 SKIP=0 TOTAL=44
2020-02-28 00:28:14,390144 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143420d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143be410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143be290>]}
2020-02-28 00:28:14,769788 (MainThread): Flushing usage events
2020-02-28 00:28:21,734945 (MainThread): Running with dbt=0.15.2
2020-02-28 00:28:21,973151 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-28 00:28:21,973756 (MainThread): Tracking: tracking
2020-02-28 00:28:21,980531 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f71c790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f71c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f71cd10>]}
2020-02-28 00:28:22,386137 (MainThread): Partial parsing not enabled
2020-02-28 00:28:22,388462 (MainThread): Parsing macros/core.sql
2020-02-28 00:28:22,393509 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-28 00:28:22,402093 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-28 00:28:22,404280 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-28 00:28:22,428449 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-28 00:28:22,453213 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-28 00:28:22,478554 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-28 00:28:22,481039 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-28 00:28:22,489070 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-28 00:28:22,498128 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-28 00:28:22,505967 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-28 00:28:22,514500 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-28 00:28:22,521107 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-28 00:28:22,522402 (MainThread): Parsing macros/etc/query.sql
2020-02-28 00:28:22,523823 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-28 00:28:22,526039 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-28 00:28:22,528740 (MainThread): Parsing macros/etc/datetime.sql
2020-02-28 00:28:22,539448 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-28 00:28:22,542105 (MainThread): Parsing macros/adapters/common.sql
2020-02-28 00:28:22,588506 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-28 00:28:22,590177 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-28 00:28:22,591476 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-28 00:28:22,592921 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-28 00:28:22,596072 (MainThread): Parsing macros/etc.sql
2020-02-28 00:28:22,596981 (MainThread): Parsing macros/catalog.sql
2020-02-28 00:28:22,600866 (MainThread): Parsing macros/adapters.sql
2020-02-28 00:28:22,622381 (MainThread): Parsing macros/materializations/merge.sql
2020-02-28 00:28:22,623463 (MainThread): Parsing macros/materializations/seed.sql
2020-02-28 00:28:22,625909 (MainThread): Parsing macros/materializations/view.sql
2020-02-28 00:28:22,627701 (MainThread): Parsing macros/materializations/table.sql
2020-02-28 00:28:22,640297 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-28 00:28:22,647661 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-28 00:28:22,699199 (MainThread): Partial parsing not enabled
2020-02-28 00:28:22,699939 (MainThread): Parsing macros/get_column_values.sql
2020-02-28 00:28:22,705776 (MainThread): Parsing macros/fill_missing.sql
2020-02-28 00:28:22,711788 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-28 00:28:22,713006 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-28 00:28:22,714601 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-28 00:28:22,717331 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-28 00:28:22,718820 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-28 00:28:22,724656 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-28 00:28:22,726395 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-28 00:28:22,727841 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-28 00:28:22,730616 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-28 00:28:22,731930 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-28 00:28:22,735928 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-28 00:28:22,739557 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-28 00:28:22,742650 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-28 00:28:22,744902 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-28 00:28:22,747123 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-28 00:28:22,748454 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-28 00:28:22,751758 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-28 00:28:22,757049 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-28 00:28:22,760300 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-28 00:28:22,762526 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-28 00:28:22,764393 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-28 00:28:22,788240 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-28 00:28:22,789127 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-28 00:28:22,790121 (MainThread): Parsing macros/logger/log_info.sql
2020-02-28 00:28:22,791597 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-28 00:28:22,797441 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-28 00:28:22,799983 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-28 00:28:22,803388 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-28 00:28:22,805109 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-28 00:28:22,806314 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-28 00:28:22,807864 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-28 00:28:22,810225 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-28 00:28:22,811941 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-28 00:28:22,813246 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-28 00:28:22,814533 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-28 00:28:22,816053 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-28 00:28:22,817793 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-28 00:28:22,819134 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-28 00:28:22,822627 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-28 00:28:22,827163 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-28 00:28:22,828563 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-28 00:28:22,834534 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-28 00:28:22,839570 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-28 00:28:22,842627 (MainThread): Parsing macros/sql/star.sql
2020-02-28 00:28:22,846235 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-28 00:28:22,853704 (MainThread): Parsing macros/sql/union.sql
2020-02-28 00:28:22,867762 (MainThread): Parsing macros/sql/groupby.sql
2020-02-28 00:28:22,869409 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-28 00:28:22,872366 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-28 00:28:22,874271 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-28 00:28:22,879896 (MainThread): Parsing macros/sql/pivot.sql
2020-02-28 00:28:22,883183 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-28 00:28:22,907558 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-28 00:28:22,907689 (MainThread): Opening a new connection, currently in state init
2020-02-28 00:28:22,932622 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:28:22,932747 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:22,940076 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-28 00:28:22,940193 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:22,947787 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:28:22,947906 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:22,955510 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-28 00:28:22,955640 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:22,963454 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-28 00:28:22,963582 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:22,975606 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-28 00:28:22,975723 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:22,985775 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-28 00:28:22,985984 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:22,998147 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:28:22,998357 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,8305 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:28:23,8465 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,22448 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-28 00:28:23,22620 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,32558 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-28 00:28:23,32752 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,45800 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:28:23,45981 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,53649 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:28:23,53905 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,63261 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:28:23,63455 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,70788 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:28:23,70966 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,78936 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-28 00:28:23,79093 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,86782 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-28 00:28:23,86909 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,94530 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-28 00:28:23,94671 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,103152 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-28 00:28:23,103272 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,111261 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-28 00:28:23,111395 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,119065 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:28:23,119184 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,176858 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 00:28:23,177016 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,187308 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:28:23,187437 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,194743 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:28:23,194889 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,201141 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:28:23,201264 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,208462 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:28:23,208587 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,254581 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:28:23,254815 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,261897 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:28:23,262019 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,268343 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:28:23,268464 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,274616 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:28:23,274732 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,288716 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-28 00:28:23,288922 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,301202 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:28:23,301332 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,309181 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:28:23,309300 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,321684 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:28:23,321810 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,346800 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:28:23,346963 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,359025 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:28:23,359154 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,373872 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:28:23,374000 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,380232 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:28:23,380352 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,387183 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:28:23,387298 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,395824 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:28:23,395948 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,403248 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:28:23,403366 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,414042 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:28:23,414218 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,428766 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:28:23,428922 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:23,697281 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 266 macros, 0 operations, 0 seed files, 0 sources
2020-02-28 00:28:23,724697 (MainThread): 
2020-02-28 00:28:23,725109 (MainThread): Acquiring new bigquery connection "master".
2020-02-28 00:28:23,725234 (MainThread): Opening a new connection, currently in state closed
2020-02-28 00:28:24,472678 (MainThread): 16:28:24 | Concurrency: 4 threads (target='dev')
2020-02-28 00:28:24,472932 (MainThread): 16:28:24 | 
2020-02-28 00:28:24,475858 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:28:24,476094 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:28:24,476368 (Thread-1): 16:28:24 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-28 00:28:24,476528 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:28:24,476817 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:28:24,477263 (Thread-2): 16:28:24 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-28 00:28:24,477723 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 00:28:24,477906 (Thread-3): 16:28:24 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-28 00:28:24,478186 (Thread-4): 16:28:24 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-28 00:28:24,478717 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 00:28:24,478968 (Thread-1): Opening a new connection, currently in state init
2020-02-28 00:28:24,479382 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 00:28:24,479754 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 00:28:24,479979 (Thread-2): Opening a new connection, currently in state init
2020-02-28 00:28:24,480201 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-28 00:28:24,480402 (Thread-3): Opening a new connection, currently in state init
2020-02-28 00:28:24,480581 (Thread-4): Opening a new connection, currently in state init
2020-02-28 00:28:24,480788 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:28:24,493652 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-28 00:28:24,502064 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:28:24,502243 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:28:24,510320 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:28:24,518238 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:28:24,526452 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:28:24,526844 (Thread-1): finished collecting timing info
2020-02-28 00:28:24,527502 (Thread-2): finished collecting timing info
2020-02-28 00:28:24,527831 (Thread-3): finished collecting timing info
2020-02-28 00:28:24,533472 (Thread-4): finished collecting timing info
2020-02-28 00:28:25,198982 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 00:28:25,248392 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 00:28:25,258153 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 00:28:25,285238 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 00:28:25,285922 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-28 00:28:25,286911 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-28 00:28:25,287935 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-28 00:28:25,288760 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-28 00:28:27,410772 (Thread-1): finished collecting timing info
2020-02-28 00:28:27,411877 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110959b90>]}
2020-02-28 00:28:27,661748 (Thread-3): finished collecting timing info
2020-02-28 00:28:27,662880 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108ff8d0>]}
2020-02-28 00:28:27,678220 (Thread-2): finished collecting timing info
2020-02-28 00:28:27,679249 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bfde90>]}
2020-02-28 00:28:27,779630 (Thread-1): 16:28:27 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 2.93s]
2020-02-28 00:28:27,781190 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-28 00:28:27,781652 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:28:27,782290 (Thread-1): 16:28:27 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-28 00:28:27,783594 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 00:28:27,784148 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-28 00:28:27,784330 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:28:27,794152 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:28:27,794756 (Thread-1): finished collecting timing info
2020-02-28 00:28:27,801003 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 00:28:27,801444 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:28:27,905273 (Thread-4): finished collecting timing info
2020-02-28 00:28:27,906374 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110959450>]}
2020-02-28 00:28:28,221668 (Thread-3): 16:28:28 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.18s]
2020-02-28 00:28:28,223274 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-28 00:28:28,223722 (Thread-3): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:28:28,224210 (Thread-3): 16:28:28 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-28 00:28:28,225050 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 00:28:28,225608 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-28 00:28:28,225809 (Thread-3): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:28:28,237645 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:28:28,238502 (Thread-3): finished collecting timing info
2020-02-28 00:28:28,245106 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 00:28:28,245619 (Thread-3): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 00:28:28,609432 (Thread-2): 16:28:28 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (7) in 3.20s]
2020-02-28 00:28:28,610081 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 00:28:28,611304 (Thread-2): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:28:28,611858 (Thread-2): 16:28:28 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-28 00:28:28,612557 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 00:28:28,612729 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-28 00:28:28,613145 (Thread-2): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:28:28,622920 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:28:28,623653 (Thread-2): finished collecting timing info
2020-02-28 00:28:28,630210 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 00:28:28,630754 (Thread-2): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-28 00:28:28,990017 (Thread-4): 16:28:28 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.43s]
2020-02-28 00:28:28,990362 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 00:28:28,990656 (Thread-4): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:28:28,991147 (Thread-4): 16:28:28 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-28 00:28:28,991739 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 00:28:28,991929 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-28 00:28:28,992128 (Thread-4): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:28:29,2251 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:28:29,2751 (Thread-4): finished collecting timing info
2020-02-28 00:28:29,9097 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 00:28:29,9534 (Thread-4): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-28 00:28:29,956099 (Thread-1): finished collecting timing info
2020-02-28 00:28:29,957133 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109bb650>]}
2020-02-28 00:28:30,111550 (Thread-3): finished collecting timing info
2020-02-28 00:28:30,112592 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f677d0>]}
2020-02-28 00:28:30,331076 (Thread-1): 16:28:30 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.17s]
2020-02-28 00:28:30,332863 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 00:28:30,333312 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:28:30,333735 (Thread-1): 16:28:30 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-28 00:28:30,334485 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 00:28:30,334946 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-28 00:28:30,335121 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:28:30,345714 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:28:30,346452 (Thread-1): finished collecting timing info
2020-02-28 00:28:30,352690 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 00:28:30,353330 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-28 00:28:30,718711 (Thread-3): 16:28:30 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 1.89s]
2020-02-28 00:28:30,719052 (Thread-3): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 00:28:30,719346 (Thread-3): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:28:30,719799 (Thread-3): 16:28:30 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-28 00:28:30,720377 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 00:28:30,720564 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-28 00:28:30,720769 (Thread-3): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:28:30,730850 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:28:30,731395 (Thread-3): finished collecting timing info
2020-02-28 00:28:30,737800 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 00:28:30,738206 (Thread-3): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-28 00:28:30,774741 (Thread-2): finished collecting timing info
2020-02-28 00:28:30,775899 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108e7910>]}
2020-02-28 00:28:30,820885 (Thread-4): finished collecting timing info
2020-02-28 00:28:30,821916 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108e7990>]}
2020-02-28 00:28:31,144297 (Thread-2): 16:28:31 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.16s]
2020-02-28 00:28:31,145015 (Thread-2): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 00:28:31,145404 (Thread-2): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:28:31,147010 (Thread-2): 16:28:31 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-28 00:28:31,147766 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 00:28:31,147979 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-28 00:28:31,148503 (Thread-2): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:28:31,159143 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:28:31,159881 (Thread-2): finished collecting timing info
2020-02-28 00:28:31,167073 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 00:28:31,167813 (Thread-2): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-28 00:28:31,550406 (Thread-4): 16:28:31 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 1.83s]
2020-02-28 00:28:31,550782 (Thread-4): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 00:28:31,551068 (Thread-4): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:28:31,551314 (Thread-4): 16:28:31 | 12 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-28 00:28:31,551972 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 00:28:31,552393 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-28 00:28:31,552680 (Thread-4): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:28:31,567332 (Thread-4): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:32,141044 (Thread-1): finished collecting timing info
2020-02-28 00:28:32,142105 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f2a710>]}
2020-02-28 00:28:32,532036 (Thread-1): 16:28:32 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 1.81s]
2020-02-28 00:28:32,532369 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 00:28:32,532650 (Thread-1): Began running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:28:32,533275 (Thread-1): 16:28:32 | 13 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-28 00:28:32,534015 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 00:28:32,534251 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-28 00:28:32,534453 (Thread-1): Compiling model.journeyengine_recipes.adwords_urls
2020-02-28 00:28:32,549383 (Thread-1): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:32,935895 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:28:32,936411 (Thread-4): finished collecting timing info
2020-02-28 00:28:32,942715 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 00:28:32,943111 (Thread-4): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-28 00:28:32,948028 (Thread-2): finished collecting timing info
2020-02-28 00:28:32,949255 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108ecf90>]}
2020-02-28 00:28:33,332603 (Thread-2): 16:28:33 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 1.80s]
2020-02-28 00:28:33,332959 (Thread-2): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 00:28:33,333289 (Thread-2): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:28:33,333721 (Thread-2): 16:28:33 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-28 00:28:33,334202 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 00:28:33,334356 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-28 00:28:33,334516 (Thread-2): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-28 00:28:33,348429 (Thread-2): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:33,436996 (Thread-3): finished collecting timing info
2020-02-28 00:28:33,438874 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11090fad0>]}
2020-02-28 00:28:33,595397 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:28:33,596780 (Thread-1): finished collecting timing info
2020-02-28 00:28:33,605371 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 00:28:33,605841 (Thread-1): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-28 00:28:33,806379 (Thread-3): 16:28:33 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.72s]
2020-02-28 00:28:33,806729 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 00:28:33,807012 (Thread-3): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:28:33,807482 (Thread-3): 16:28:33 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-28 00:28:33,808061 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 00:28:33,808252 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-28 00:28:33,808447 (Thread-3): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:28:33,823257 (Thread-3): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:34,344983 (Thread-2): Actual dataset: fb_ads_quantic
2020-02-28 00:28:34,345266 (Thread-2): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-28 00:28:34,524718 (Thread-2): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-28 00:28:34,525209 (Thread-2): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-28 00:28:34,528110 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:28:34,528687 (Thread-2): finished collecting timing info
2020-02-28 00:28:34,538338 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 00:28:34,538901 (Thread-2): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


	    
		   	SELECT 
		   	
  id
, object_url
, url_tags
, _sdc_sequence
            FROM `journeyengine-recipes.fb_ads_quantic.adcreative`
		    
	   
)

select creative_id, max(url) url
from (
  select
  id creative_id,
  lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
  first_value(_sdc_sequence) OVER (PARTITION BY id ORDER BY _sdc_sequence DESC) lv,
  _sdc_sequence
  from fb_adcreative
  )
where lv = _sdc_sequence
group by creative_id


  );
    
2020-02-28 00:28:34,767792 (Thread-4): finished collecting timing info
2020-02-28 00:28:34,768847 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110861250>]}
2020-02-28 00:28:35,227123 (Thread-4): 16:28:35 | 12 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 3.22s]
2020-02-28 00:28:35,227420 (Thread-4): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 00:28:35,227658 (Thread-4): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:28:35,228071 (Thread-4): 16:28:35 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-28 00:28:35,228557 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 00:28:35,228710 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-28 00:28:35,228873 (Thread-4): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:28:35,242515 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:35,414506 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 00:28:35,591036 (Thread-3): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:28:35,591724 (Thread-3): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:28:35,594950 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:28:35,595633 (Thread-3): finished collecting timing info
2020-02-28 00:28:35,603567 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 00:28:35,604021 (Thread-3): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-28 00:28:35,671862 (Thread-1): finished collecting timing info
2020-02-28 00:28:35,672916 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11105ec90>]}
2020-02-28 00:28:36,51600 (Thread-1): 16:28:36 | 13 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 3.14s]
2020-02-28 00:28:36,51961 (Thread-1): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-28 00:28:36,52268 (Thread-1): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:28:36,52946 (Thread-1): 16:28:36 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-28 00:28:36,53538 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 00:28:36,53730 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-28 00:28:36,53930 (Thread-1): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:28:36,71243 (Thread-1): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:36,249052 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:28:36,249750 (Thread-4): finished collecting timing info
2020-02-28 00:28:36,257458 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 00:28:36,257937 (Thread-4): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-28 00:28:37,350814 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:28:37,481144 (Thread-2): finished collecting timing info
2020-02-28 00:28:37,482190 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11094d850>]}
2020-02-28 00:28:37,503539 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 00:28:37,504256 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 00:28:37,511188 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:28:37,511738 (Thread-1): finished collecting timing info
2020-02-28 00:28:37,518349 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 00:28:37,518746 (Thread-1): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:28:37,858846 (Thread-2): 16:28:37 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.15s]
2020-02-28 00:28:37,859195 (Thread-2): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-28 00:28:37,859483 (Thread-2): Began running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:28:37,859737 (Thread-2): 16:28:37 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-28 00:28:37,860523 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 00:28:37,860696 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-28 00:28:37,860861 (Thread-2): Compiling model.journeyengine_recipes.fb_conversions
2020-02-28 00:28:37,871610 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:28:37,872129 (Thread-2): finished collecting timing info
2020-02-28 00:28:37,878261 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 00:28:37,878663 (Thread-2): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-28 00:28:37,976679 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/287e08c5-8d6e-4c60-8687-f65d72a43034?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]')
2020-02-28 00:28:37,977315 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          pk_id,
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          _sdc_sequence,
          _sdc_batched_at,
          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
          sum(_28d_click) as conversions

          from (

                select
                

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    to_hex(md5(cast(
  concat(coalesce(cast(ad_id as 
  
    string

), ''), '-', coalesce(cast(adset_id as 
  
    string

), ''), '-', coalesce(cast(campaign_id as 
  
    string

), ''), '-', coalesce(cast(date_start as 
  
    string

), ''), '-', coalesce(cast(publisher_platform as 
  
    string

), ''), '-', coalesce(cast(platform_position as 
  
    string

), ''), '-', coalesce(cast(impression_device as 
  
    string

), ''))
 as 
  
    string

))) as pk_id,
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

                      
                   

)

 select distinct
pk_id, 
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions,
_sdc_sequence,
_sdc_batched_at,
most_recent_sequence,
most_recent_batch
from fb_adplatforms
 where _sdc_sequence = most_recent_sequence
 and _sdc_batched_at = most_recent_batch

 
  );
    
2020-02-28 00:28:37,977807 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/287e08c5-8d6e-4c60-8687-f65d72a43034?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 287e08c5-8d6e-4c60-8687-f65d72a43034)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:28:37,978157 (Thread-1): finished collecting timing info
2020-02-28 00:28:37,979020 (Thread-1): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/287e08c5-8d6e-4c60-8687-f65d72a43034?maxResults=0&location=US: Unrecognized name: _28d_click at [116:17]

(job ID: 287e08c5-8d6e-4c60-8687-f65d72a43034)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          pk_id,
  19:          account_name account,
  20:          'Facebook Ads' as platform,
  21:          date_start date,
  22:          campaign_name campaign,
  23:          adset_name group_set,
  24:          ad_name ad,
  25:          objective,
  26:          Concat(publisher_platform,"-",platform_position) as placement,
  27:          spend,
  28:          impressions,
  29:          clicks,
  30:          inline_link_clicks link_clicks,
  31:          _sdc_sequence,
  32:          _sdc_batched_at,
  33:          max(_sdc_sequence) over (partition by pk_id) as most_recent_sequence,
  34:          max(_sdc_batched_at) over (partition by pk_id) as most_recent_batch,
  35:          sum(_28d_click) as conversions
  36:
  37:          from (
  38:
  39:                select
  40:                
  41:
  42:    
  43:        
  44:    
  45:
  46:    
  47:        
  48:    
  49:
  50:    
  51:        
  52:    
  53:
  54:    
  55:        
  56:    
  57:
  58:    
  59:        
  60:    
  61:
  62:    
  63:        
  64:    
  65:
  66:    to_hex(md5(cast(
  67:  concat(coalesce(cast(ad_id as 
  68:  
  69:    string
  70:
  71:), ''), '-', coalesce(cast(adset_id as 
  72:  
  73:    string
  74:
  75:), ''), '-', coalesce(cast(campaign_id as 
  76:  
  77:    string
  78:
  79:), ''), '-', coalesce(cast(date_start as 
  80:  
  81:    string
  82:
  83:), ''), '-', coalesce(cast(publisher_platform as 
  84:  
  85:    string
  86:
  87:), ''), '-', coalesce(cast(platform_position as 
  88:  
  89:    string
  90:
  91:), ''), '-', coalesce(cast(impression_device as 
  92:  
  93:    string
  94:
  95:), ''))
  96: as 
  97:  
  98:    string
  99:
 100:))) as pk_id,
 101:                
 102:  account_name
 103:, date_start
 104:, campaign_name
 105:, adset_name
 106:, ad_name
 107:, objective
 108:, publisher_platform
 109:, platform_position
 110:, spend
 111:, impressions
 112:, clicks
 113:, inline_link_clicks
 114:, _sdc_sequence
 115:, _sdc_batched_at,
 116:                _28d_click,
 117:               from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device`
 118:               left join unnest(actions)
 119:
 120:               )
 121:
 122:            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
 123:
 124:                      
 125:                   
 126:
 127:)
 128:
 129: select distinct
 130:pk_id, 
 131:account,
 132:platform,
 133:date,
 134:campaign,
 135:group_set,
 136:ad,
 137:objective,
 138:placement,
 139:spend,
 140:impressions,
 141:clicks,
 142:link_clicks,
 143:conversions,
 144:_sdc_sequence,
 145:_sdc_batched_at,
 146:most_recent_sequence,
 147:most_recent_batch
 148:from fb_adplatforms
 149: where _sdc_sequence = most_recent_sequence
 150: and _sdc_batched_at = most_recent_batch
 151:
 152: 
 153:  );
 154:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [116:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:28:37,984465 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11094d690>]}
2020-02-28 00:28:38,284183 (Thread-4): finished collecting timing info
2020-02-28 00:28:38,285248 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109d1b90>]}
2020-02-28 00:28:38,356717 (Thread-1): 16:28:38 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.93s]
2020-02-28 00:28:38,358502 (Thread-1): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 00:28:38,358977 (Thread-1): Began running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:28:38,359510 (Thread-1): 16:28:38 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-28 00:28:38,360631 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 00:28:38,361173 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-28 00:28:38,361416 (Thread-1): Compiling model.journeyengine_recipes.ga_conversions
2020-02-28 00:28:38,374689 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:28:38,375290 (Thread-1): finished collecting timing info
2020-02-28 00:28:38,381688 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 00:28:38,382207 (Thread-1): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-28 00:28:38,534760 (Thread-3): finished collecting timing info
2020-02-28 00:28:38,535800 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e6ae90>]}
2020-02-28 00:28:38,745738 (Thread-4): 16:28:38 | 16 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.06s]
2020-02-28 00:28:38,747546 (Thread-4): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 00:28:38,747993 (Thread-4): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:28:38,748424 (Thread-4): 16:28:38 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-28 00:28:38,749473 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 00:28:38,750036 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-28 00:28:38,750218 (Thread-4): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:28:38,767164 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:28:38,767681 (Thread-4): finished collecting timing info
2020-02-28 00:28:38,773590 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 00:28:38,774000 (Thread-4): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-28 00:28:39,134212 (Thread-3): 16:28:39 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 4.73s]
2020-02-28 00:28:39,134729 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 00:28:39,135004 (Thread-3): Began running node model.journeyengine_recipes.adwords_join
2020-02-28 00:28:39,135399 (Thread-3): 16:28:39 | 21 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-28 00:28:39,135902 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 00:28:39,136064 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-28 00:28:39,136231 (Thread-3): Compiling model.journeyengine_recipes.adwords_join
2020-02-28 00:28:39,149571 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:28:39,150107 (Thread-3): finished collecting timing info
2020-02-28 00:28:39,157006 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 00:28:39,157461 (Thread-3): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-28 00:28:39,710417 (Thread-2): finished collecting timing info
2020-02-28 00:28:39,711510 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e6a610>]}
2020-02-28 00:28:40,81451 (Thread-2): 16:28:40 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 1.85s]
2020-02-28 00:28:40,81799 (Thread-2): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-28 00:28:40,82062 (Thread-2): Began running node model.journeyengine_recipes.fb_ads
2020-02-28 00:28:40,82545 (Thread-2): 16:28:40 | 22 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-28 00:28:40,83231 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 00:28:40,83394 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-28 00:28:40,83556 (Thread-2): Compiling model.journeyengine_recipes.fb_ads
2020-02-28 00:28:40,98096 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:40,143032 (Thread-1): finished collecting timing info
2020-02-28 00:28:40,144199 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e41750>]}
2020-02-28 00:28:40,514772 (Thread-1): 16:28:40 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (7) in 1.78s]
2020-02-28 00:28:40,516258 (Thread-1): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-28 00:28:40,516535 (Thread-1): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:28:40,516946 (Thread-1): 16:28:40 | 23 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-28 00:28:40,517298 (Thread-1): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 00:28:40,517543 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:28:40,517884 (Thread-1): 16:28:40 | 24 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-28 00:28:40,518468 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 00:28:40,518626 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-28 00:28:40,518789 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:28:40,542913 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:40,827806 (Thread-4): finished collecting timing info
2020-02-28 00:28:40,830541 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de2bf50>]}
2020-02-28 00:28:41,207492 (Thread-4): 16:28:41 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.08s]
2020-02-28 00:28:41,207841 (Thread-4): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 00:28:41,208124 (Thread-4): Began running node model.journeyengine_recipes.ga_proc
2020-02-28 00:28:41,208731 (Thread-4): 16:28:41 | 25 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-28 00:28:41,209508 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 00:28:41,209710 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-28 00:28:41,209910 (Thread-4): Compiling model.journeyengine_recipes.ga_proc
2020-02-28 00:28:41,246770 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:41,441383 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:28:41,442050 (Thread-2): finished collecting timing info
2020-02-28 00:28:41,448973 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 00:28:41,449447 (Thread-2): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id,
			_sdc_sequence
			FROM `journeyengine-recipes.fb_ads_quantic.ads`
		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    first_value(_sdc_sequence) OVER (PARTITION BY ad_id ORDER BY _sdc_sequence DESC) lv,
    _sdc_sequence
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)
WHERE a.lv = a._sdc_sequence


  );
    
2020-02-28 00:28:41,581635 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:41,588827 (Thread-3): finished collecting timing info
2020-02-28 00:28:41,589885 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110861a50>]}
2020-02-28 00:28:41,995536 (Thread-3): 16:28:41 | 21 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 2.45s]
2020-02-28 00:28:41,995860 (Thread-3): Finished running node model.journeyengine_recipes.adwords_join
2020-02-28 00:28:41,996093 (Thread-3): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:28:41,996599 (Thread-3): 16:28:41 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-28 00:28:41,997836 (Thread-3): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 00:28:41,998561 (Thread-3): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:28:41,999614 (Thread-3): 16:28:41 | 27 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-28 00:28:42,272 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 00:28:42,424 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-28 00:28:42,817 (Thread-3): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:28:42,13596 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:28:42,14460 (Thread-3): finished collecting timing info
2020-02-28 00:28:42,21035 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 00:28:42,21539 (Thread-3): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-28 00:28:42,495730 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:42,600720 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:28:42,769223 (Thread-1): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:28:42,769806 (Thread-1): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:28:42,770262 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 00:28:42,920566 (Thread-1): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 00:28:42,921263 (Thread-1): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 00:28:42,924312 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:28:42,924954 (Thread-1): finished collecting timing info
2020-02-28 00:28:42,933473 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 00:28:42,934023 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:28:43,338663 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/e678e87f-841b-41c6-a3f9-68f5fd007cd9?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-28 00:28:43,338956 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 00:28:43,339161 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/e678e87f-841b-41c6-a3f9-68f5fd007cd9?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: e678e87f-841b-41c6-a3f9-68f5fd007cd9)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 00:28:43,339437 (Thread-1): finished collecting timing info
2020-02-28 00:28:43,340236 (Thread-1): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/e678e87f-841b-41c6-a3f9-68f5fd007cd9?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: e678e87f-841b-41c6-a3f9-68f5fd007cd9)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:28:43,341437 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11104a090>]}
2020-02-28 00:28:43,509436 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:43,716034 (Thread-1): 16:28:43 | 24 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 2.82s]
2020-02-28 00:28:43,716392 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 00:28:43,716677 (Thread-1): Began running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:28:43,717265 (Thread-1): 16:28:43 | 28 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-28 00:28:43,717839 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 00:28:43,718026 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-28 00:28:43,718221 (Thread-1): Compiling model.journeyengine_recipes.adwords_stats
2020-02-28 00:28:43,730223 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:28:43,730814 (Thread-1): finished collecting timing info
2020-02-28 00:28:43,737272 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 00:28:43,737805 (Thread-1): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-28 00:28:43,843242 (Thread-2): finished collecting timing info
2020-02-28 00:28:43,844312 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de314d0>]}
2020-02-28 00:28:44,118140 (Thread-3): finished collecting timing info
2020-02-28 00:28:44,119200 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bf33d0>]}
2020-02-28 00:28:44,228205 (Thread-2): 16:28:44 | 22 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.76s]
2020-02-28 00:28:44,230132 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads
2020-02-28 00:28:44,230595 (Thread-2): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:28:44,231090 (Thread-2): 16:28:44 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-28 00:28:44,231540 (Thread-2): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 00:28:44,231838 (Thread-2): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:28:44,232478 (Thread-2): 16:28:44 | 30 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-28 00:28:44,233268 (Thread-2): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 00:28:44,233644 (Thread-2): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:28:44,234324 (Thread-2): 16:28:44 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-28 00:28:44,234591 (Thread-2): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 00:28:44,597311 (Thread-3): 16:28:44 | 27 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.12s]
2020-02-28 00:28:44,597662 (Thread-3): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 00:28:44,598336 (Thread-2): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:28:44,598617 (Thread-3): Began running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:28:44,598874 (Thread-2): 16:28:44 | 32 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-28 00:28:44,599187 (Thread-3): 16:28:44 | 33 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-28 00:28:44,599892 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 00:28:44,600435 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 00:28:44,600604 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-28 00:28:44,600806 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-28 00:28:44,601063 (Thread-2): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:28:44,601294 (Thread-3): Compiling model.journeyengine_recipes.social_post_viz
2020-02-28 00:28:44,619585 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:28:44,622612 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:28:44,623223 (Thread-2): finished collecting timing info
2020-02-28 00:28:44,623515 (Thread-3): finished collecting timing info
2020-02-28 00:28:44,630721 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 00:28:44,638614 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 00:28:44,640645 (Thread-3): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-28 00:28:44,640874 (Thread-2): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-28 00:28:44,815617 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:45,871264 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 00:28:46,63432 (Thread-1): finished collecting timing info
2020-02-28 00:28:46,64496 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111043490>]}
2020-02-28 00:28:46,441771 (Thread-1): 16:28:46 | 28 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.35s]
2020-02-28 00:28:46,442078 (Thread-1): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-28 00:28:46,442642 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:28:46,442892 (Thread-1): 16:28:46 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-28 00:28:46,443105 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 00:28:46,443558 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:28:46,443802 (Thread-1): 16:28:46 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-28 00:28:46,444009 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 00:28:46,691757 (Thread-3): finished collecting timing info
2020-02-28 00:28:46,692825 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111017150>]}
2020-02-28 00:28:46,736510 (Thread-2): finished collecting timing info
2020-02-28 00:28:46,737505 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eef610>]}
2020-02-28 00:28:46,896818 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:28:46,897499 (Thread-4): finished collecting timing info
2020-02-28 00:28:46,905459 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 00:28:46,905913 (Thread-4): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
							
				null as mqls,		
			
							
				null as subscribers,		
						
							
				null as excluded,		
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 00:28:47,62474 (Thread-3): 16:28:47 | 33 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.09s]
2020-02-28 00:28:47,64277 (Thread-3): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-28 00:28:47,457499 (Thread-2): 16:28:47 | 32 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.14s]
2020-02-28 00:28:47,457928 (Thread-2): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 00:28:47,458543 (Thread-1): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:28:47,458856 (Thread-1): 16:28:47 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-28 00:28:47,459389 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 00:28:47,459555 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-28 00:28:47,459722 (Thread-1): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-28 00:28:47,470523 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:28:47,471025 (Thread-1): finished collecting timing info
2020-02-28 00:28:47,478337 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 00:28:47,478785 (Thread-1): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-28 00:28:50,772071 (Thread-1): finished collecting timing info
2020-02-28 00:28:50,773161 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ff8d10>]}
2020-02-28 00:28:51,141935 (Thread-1): 16:28:51 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 3.31s]
2020-02-28 00:28:51,142295 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-28 00:28:55,807384 (Thread-4): finished collecting timing info
2020-02-28 00:28:55,808506 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11090fa50>]}
2020-02-28 00:28:56,179573 (Thread-4): 16:28:56 | 25 of 44 OK created table model agency_data_pipeline.ga_proc......... [CREATE TABLE (698763) in 14.60s]
2020-02-28 00:28:56,179895 (Thread-4): Finished running node model.journeyengine_recipes.ga_proc
2020-02-28 00:28:56,180466 (Thread-2): Began running node model.journeyengine_recipes.ga_stats
2020-02-28 00:28:56,180776 (Thread-2): 16:28:56 | 37 of 44 START table model agency_data_pipeline.ga_stats............. [RUN]
2020-02-28 00:28:56,181293 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 00:28:56,181459 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.social_platform_by_month).
2020-02-28 00:28:56,181627 (Thread-2): Compiling model.journeyengine_recipes.ga_stats
2020-02-28 00:28:56,195959 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 00:28:56,196446 (Thread-2): finished collecting timing info
2020-02-28 00:28:56,203128 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 00:28:56,203612 (Thread-2): On model.journeyengine_recipes.ga_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_stats`
  
  
  OPTIONS()
  as (
    SELECT  
cast(date as date) date,
b.account,
b.site site,
c.source source,
c.medium medium,
concat(a.source, ' / ', a.medium) source_medium,  
case when c.platform is null then "Unmapped" else c.platform end as platform,
case when c.channel is null then "Unmapped" else c.channel end as channel,
url,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(other) other,
sum(excluded) excluded
FROM `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b 
ON ( a.bigquery_name = b.bigquery_name 
	AND a.lookup_platform = b.platform )
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc` c
ON ( a.source = c.source
  AND a.medium = c.medium 
  AND a.bigquery_name = c.bigquery_name )
GROUP BY date, account, site, source, medium, source_medium, platform, channel, url
  );
    
2020-02-28 00:29:08,31066 (Thread-2): finished collecting timing info
2020-02-28 00:29:08,32483 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '721d85d8-ff6b-4aa1-9316-18ea797a6e06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eeb650>]}
2020-02-28 00:29:08,408935 (Thread-2): 16:29:08 | 37 of 44 OK created table model agency_data_pipeline.ga_stats........ [CREATE TABLE (698763) in 11.85s]
2020-02-28 00:29:08,409282 (Thread-2): Finished running node model.journeyengine_recipes.ga_stats
2020-02-28 00:29:08,409960 (Thread-1): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:29:08,410289 (Thread-1): 16:29:08 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-28 00:29:08,410555 (Thread-1): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 00:29:08,411170 (Thread-3): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:29:08,411420 (Thread-2): Began running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:29:08,411607 (Thread-3): 16:29:08 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-28 00:29:08,411929 (Thread-2): 16:29:08 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-28 00:29:08,412291 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 00:29:08,412656 (Thread-2): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-28 00:29:08,413459 (Thread-1): Began running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:29:08,413724 (Thread-4): Began running node model.journeyengine_recipes.platform_index
2020-02-28 00:29:08,413941 (Thread-1): 16:29:08 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-28 00:29:08,414216 (Thread-4): 16:29:08 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-28 00:29:08,414546 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-28 00:29:08,414858 (Thread-4): Finished running node model.journeyengine_recipes.platform_index
2020-02-28 00:29:08,415523 (Thread-2): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:29:08,415874 (Thread-2): 16:29:08 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-28 00:29:08,416058 (Thread-1): Began running node model.journeyengine_recipes.platform_viz
2020-02-28 00:29:08,416264 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-28 00:29:08,416491 (Thread-1): 16:29:08 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-28 00:29:08,416875 (Thread-1): Finished running node model.journeyengine_recipes.platform_viz
2020-02-28 00:29:08,500772 (MainThread): 16:29:08 | 
2020-02-28 00:29:08,501119 (MainThread): 16:29:08 | Finished running 44 table models in 44.78s.
2020-02-28 00:29:08,501356 (MainThread): Connection 'master' was left open.
2020-02-28 00:29:08,501536 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-28 00:29:08,501711 (MainThread): Connection 'model.journeyengine_recipes.ga_stats' was left open.
2020-02-28 00:29:08,501879 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-28 00:29:08,502046 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-28 00:29:08,648904 (MainThread): 
2020-02-28 00:29:08,649146 (MainThread): Completed with 2 errors and 0 warnings:
2020-02-28 00:29:08,649343 (MainThread): 
2020-02-28 00:29:08,649523 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-28 00:29:08,649677 (MainThread):   Unrecognized name: _28d_click at [116:17]
2020-02-28 00:29:08,649824 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 00:29:08,649968 (MainThread): 
2020-02-28 00:29:08,650117 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-28 00:29:08,650256 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-28 00:29:08,650387 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 00:29:08,650555 (MainThread): 
Done. PASS=42 WARN=0 ERROR=2 SKIP=0 TOTAL=44
2020-02-28 00:29:08,650789 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109a1050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11094d5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110847dd0>]}
2020-02-28 00:29:09,15540 (MainThread): Flushing usage events
2020-02-28 20:43:50,202311 (MainThread): Running with dbt=0.15.2
2020-02-28 20:43:50,521070 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-28 20:43:50,523067 (MainThread): Tracking: tracking
2020-02-28 20:43:50,533401 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051d4dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051d4450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051d4e90>]}
2020-02-28 20:43:51,518522 (MainThread): Partial parsing not enabled
2020-02-28 20:43:51,522784 (MainThread): Parsing macros/core.sql
2020-02-28 20:43:51,530522 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-28 20:43:51,541508 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-28 20:43:51,544348 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-28 20:43:51,569506 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-28 20:43:51,597068 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-28 20:43:51,619232 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-28 20:43:51,622294 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-28 20:43:51,631188 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-28 20:43:51,640679 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-28 20:43:51,649399 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-28 20:43:51,657314 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-28 20:43:51,663959 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-28 20:43:51,665376 (MainThread): Parsing macros/etc/query.sql
2020-02-28 20:43:51,667104 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-28 20:43:51,670981 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-28 20:43:51,673712 (MainThread): Parsing macros/etc/datetime.sql
2020-02-28 20:43:51,684229 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-28 20:43:51,687392 (MainThread): Parsing macros/adapters/common.sql
2020-02-28 20:43:51,726665 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-28 20:43:51,728466 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-28 20:43:51,729972 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-28 20:43:51,731648 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-28 20:43:51,735031 (MainThread): Parsing macros/etc.sql
2020-02-28 20:43:51,736672 (MainThread): Parsing macros/catalog.sql
2020-02-28 20:43:51,741637 (MainThread): Parsing macros/adapters.sql
2020-02-28 20:43:51,760031 (MainThread): Parsing macros/materializations/merge.sql
2020-02-28 20:43:51,762356 (MainThread): Parsing macros/materializations/seed.sql
2020-02-28 20:43:51,766775 (MainThread): Parsing macros/materializations/view.sql
2020-02-28 20:43:51,769866 (MainThread): Parsing macros/materializations/table.sql
2020-02-28 20:43:51,782518 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-28 20:43:51,789536 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-28 20:43:51,839209 (MainThread): Partial parsing not enabled
2020-02-28 20:43:51,840316 (MainThread): Parsing macros/get_column_values.sql
2020-02-28 20:43:51,846698 (MainThread): Parsing macros/fill_missing.sql
2020-02-28 20:43:51,850697 (MainThread): Parsing macros/most_recent_record.sql
2020-02-28 20:43:51,857234 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-28 20:43:51,859087 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-28 20:43:51,861165 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-28 20:43:51,864485 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-28 20:43:51,866658 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-28 20:43:51,873199 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-28 20:43:51,875257 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-28 20:43:51,877220 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-28 20:43:51,880629 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-28 20:43:51,882701 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-28 20:43:51,885806 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-28 20:43:51,889057 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-28 20:43:51,891688 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-28 20:43:51,893740 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-28 20:43:51,895957 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-28 20:43:51,897457 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-28 20:43:51,901249 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-28 20:43:51,907488 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-28 20:43:51,911479 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-28 20:43:51,914409 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-28 20:43:51,917113 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-28 20:43:51,941709 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-28 20:43:51,942986 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-28 20:43:51,944455 (MainThread): Parsing macros/logger/log_info.sql
2020-02-28 20:43:51,945948 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-28 20:43:51,950595 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-28 20:43:51,953266 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-28 20:43:51,956827 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-28 20:43:51,959193 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-28 20:43:51,960938 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-28 20:43:51,963326 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-28 20:43:51,966821 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-28 20:43:51,969244 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-28 20:43:51,970854 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-28 20:43:51,972587 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-28 20:43:51,974748 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-28 20:43:51,977301 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-28 20:43:51,979247 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-28 20:43:51,983626 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-28 20:43:51,988824 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-28 20:43:51,990985 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-28 20:43:51,995528 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-28 20:43:52,896 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-28 20:43:52,4480 (MainThread): Parsing macros/sql/star.sql
2020-02-28 20:43:52,8482 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-28 20:43:52,16735 (MainThread): Parsing macros/sql/union.sql
2020-02-28 20:43:52,32229 (MainThread): Parsing macros/sql/groupby.sql
2020-02-28 20:43:52,33995 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-28 20:43:52,36843 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-28 20:43:52,39181 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-28 20:43:52,45121 (MainThread): Parsing macros/sql/pivot.sql
2020-02-28 20:43:52,49214 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-28 20:43:52,78738 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-28 20:43:52,78982 (MainThread): Opening a new connection, currently in state init
2020-02-28 20:43:52,108603 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 20:43:52,108891 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,119814 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-28 20:43:52,119967 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,128097 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 20:43:52,128222 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,136137 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-28 20:43:52,136262 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,144816 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-28 20:43:52,145019 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,159999 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-28 20:43:52,160268 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,172844 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-28 20:43:52,173031 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,183566 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 20:43:52,183775 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,193584 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 20:43:52,193708 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,207128 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-28 20:43:52,207298 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,216987 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-28 20:43:52,217112 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,229931 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 20:43:52,230179 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,239742 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 20:43:52,239894 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,247584 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 20:43:52,247758 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,255230 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 20:43:52,255358 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,264163 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-28 20:43:52,264343 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,273228 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-28 20:43:52,273408 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,281954 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-28 20:43:52,282082 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,291186 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-28 20:43:52,291331 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,299645 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-28 20:43:52,299783 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,308659 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 20:43:52,308826 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,363825 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 20:43:52,363982 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,375876 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 20:43:52,376082 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,387505 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 20:43:52,387718 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,394966 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 20:43:52,395092 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,403745 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 20:43:52,403893 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,448131 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 20:43:52,448400 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,458976 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 20:43:52,459225 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,468946 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 20:43:52,469166 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,476292 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 20:43:52,476417 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,489336 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-28 20:43:52,489470 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,500045 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 20:43:52,500174 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,507966 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 20:43:52,508086 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,521491 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 20:43:52,521616 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,545329 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 20:43:52,545532 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,558835 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 20:43:52,558981 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,577841 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 20:43:52,578133 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,586895 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 20:43:52,587033 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,595419 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 20:43:52,595574 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,605466 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 20:43:52,605608 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,614455 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 20:43:52,614628 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,629351 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 20:43:52,629518 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,643596 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 20:43:52,643895 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:52,906518 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 267 macros, 0 operations, 0 seed files, 0 sources
2020-02-28 20:43:52,933862 (MainThread): 
2020-02-28 20:43:52,934357 (MainThread): Acquiring new bigquery connection "master".
2020-02-28 20:43:52,934482 (MainThread): Opening a new connection, currently in state closed
2020-02-28 20:43:54,141405 (MainThread): 12:43:54 | Concurrency: 4 threads (target='dev')
2020-02-28 20:43:54,141667 (MainThread): 12:43:54 | 
2020-02-28 20:43:54,147005 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-28 20:43:54,147320 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 20:43:54,147604 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-28 20:43:54,147826 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 20:43:54,148123 (Thread-1): 12:43:54 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-28 20:43:54,148413 (Thread-2): 12:43:54 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-28 20:43:54,148704 (Thread-3): 12:43:54 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-28 20:43:54,148981 (Thread-4): 12:43:54 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-28 20:43:54,149560 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 20:43:54,149983 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 20:43:54,150434 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 20:43:54,150785 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 20:43:54,150914 (Thread-1): Opening a new connection, currently in state init
2020-02-28 20:43:54,151092 (Thread-2): Opening a new connection, currently in state init
2020-02-28 20:43:54,151252 (Thread-3): Opening a new connection, currently in state init
2020-02-28 20:43:54,151422 (Thread-4): Opening a new connection, currently in state init
2020-02-28 20:43:54,151605 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-28 20:43:54,151782 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-28 20:43:54,151941 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-28 20:43:54,152117 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-28 20:43:54,192235 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 20:43:54,192808 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 20:43:54,195887 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 20:43:54,203981 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 20:43:54,205644 (Thread-3): finished collecting timing info
2020-02-28 20:43:54,211228 (Thread-2): finished collecting timing info
2020-02-28 20:43:54,240863 (Thread-4): finished collecting timing info
2020-02-28 20:43:54,258736 (Thread-1): finished collecting timing info
2020-02-28 20:43:54,897150 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 20:43:54,898586 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 20:43:54,937985 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 20:43:54,949915 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 20:43:54,951957 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-28 20:43:54,952223 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-28 20:43:54,952365 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-28 20:43:54,954688 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-28 20:43:57,701549 (Thread-1): finished collecting timing info
2020-02-28 20:43:57,702624 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053e2a90>]}
2020-02-28 20:43:58,67458 (Thread-1): 12:43:58 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.55s]
2020-02-28 20:43:58,67750 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-28 20:43:58,67954 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 20:43:58,68391 (Thread-1): 12:43:58 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-28 20:43:58,69171 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 20:43:58,69316 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-28 20:43:58,69459 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-28 20:43:58,77703 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 20:43:58,78261 (Thread-1): finished collecting timing info
2020-02-28 20:43:58,84395 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 20:43:58,85425 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 20:43:58,92789 (Thread-4): finished collecting timing info
2020-02-28 20:43:58,93628 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053540d0>]}
2020-02-28 20:43:58,223107 (Thread-3): finished collecting timing info
2020-02-28 20:43:58,224948 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106409d10>]}
2020-02-28 20:43:58,228109 (Thread-2): finished collecting timing info
2020-02-28 20:43:58,229233 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053cdb10>]}
2020-02-28 20:43:58,439894 (Thread-4): 12:43:58 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.94s]
2020-02-28 20:43:58,441198 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 20:43:58,441554 (Thread-4): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 20:43:58,441990 (Thread-4): 12:43:58 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-28 20:43:58,442721 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 20:43:58,443181 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-28 20:43:58,443357 (Thread-4): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-28 20:43:58,455177 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 20:43:58,455860 (Thread-4): finished collecting timing info
2020-02-28 20:43:58,462909 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 20:43:58,463435 (Thread-4): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 20:43:58,818788 (Thread-3): 12:43:58 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 4.07s]
2020-02-28 20:43:58,820496 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-28 20:43:58,820863 (Thread-3): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 20:43:58,821134 (Thread-3): 12:43:58 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-28 20:43:58,821762 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 20:43:58,822167 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-28 20:43:58,822635 (Thread-3): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 20:43:58,832078 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 20:43:58,832894 (Thread-3): finished collecting timing info
2020-02-28 20:43:58,839573 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 20:43:58,840584 (Thread-3): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-28 20:43:59,256561 (Thread-2): 12:43:59 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (7) in 4.08s]
2020-02-28 20:43:59,256918 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 20:43:59,257185 (Thread-2): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 20:43:59,257610 (Thread-2): 12:43:59 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-28 20:43:59,258345 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 20:43:59,258522 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-28 20:43:59,258686 (Thread-2): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-28 20:43:59,268072 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 20:43:59,270674 (Thread-2): finished collecting timing info
2020-02-28 20:43:59,277891 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 20:43:59,278427 (Thread-2): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-28 20:44:00,691067 (Thread-4): finished collecting timing info
2020-02-28 20:44:00,692152 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10539c550>]}
2020-02-28 20:44:00,709470 (Thread-1): finished collecting timing info
2020-02-28 20:44:00,710410 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a03510>]}
2020-02-28 20:44:00,724757 (Thread-3): finished collecting timing info
2020-02-28 20:44:00,725814 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069bd990>]}
2020-02-28 20:44:01,340297 (Thread-4): 12:44:01 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.25s]
2020-02-28 20:44:01,342070 (Thread-4): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 20:44:01,342465 (Thread-4): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 20:44:01,342851 (Thread-4): 12:44:01 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-28 20:44:01,343401 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 20:44:01,343893 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-28 20:44:01,344451 (Thread-4): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-28 20:44:01,357290 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 20:44:01,361175 (Thread-2): finished collecting timing info
2020-02-28 20:44:01,361510 (Thread-4): finished collecting timing info
2020-02-28 20:44:01,362329 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053cdb90>]}
2020-02-28 20:44:01,368616 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 20:44:01,369504 (Thread-4): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-28 20:44:01,715551 (Thread-1): 12:44:01 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.64s]
2020-02-28 20:44:01,717124 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 20:44:01,717551 (Thread-1): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 20:44:01,717971 (Thread-1): 12:44:01 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-28 20:44:01,718500 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 20:44:01,718948 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-28 20:44:01,719443 (Thread-1): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 20:44:01,729419 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 20:44:01,732445 (Thread-1): finished collecting timing info
2020-02-28 20:44:01,739164 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 20:44:01,739756 (Thread-1): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-28 20:44:02,96224 (Thread-3): 12:44:02 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 1.90s]
2020-02-28 20:44:02,97674 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 20:44:02,98038 (Thread-3): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 20:44:02,98438 (Thread-3): 12:44:02 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-28 20:44:02,98923 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 20:44:02,99325 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-28 20:44:02,99793 (Thread-3): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-28 20:44:02,110004 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 20:44:02,110917 (Thread-3): finished collecting timing info
2020-02-28 20:44:02,117461 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 20:44:02,118428 (Thread-3): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-28 20:44:02,469354 (Thread-2): 12:44:02 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.10s]
2020-02-28 20:44:02,469693 (Thread-2): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 20:44:02,469929 (Thread-2): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 20:44:02,470326 (Thread-2): 12:44:02 | 12 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-28 20:44:02,470818 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 20:44:02,470969 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-28 20:44:02,471130 (Thread-2): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-28 20:44:02,484988 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:03,514165 (Thread-4): finished collecting timing info
2020-02-28 20:44:03,515286 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069df190>]}
2020-02-28 20:44:03,672247 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 20:44:03,672844 (Thread-2): finished collecting timing info
2020-02-28 20:44:03,679348 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 20:44:03,679851 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-28 20:44:03,883426 (Thread-4): 12:44:03 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 2.17s]
2020-02-28 20:44:03,883764 (Thread-4): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 20:44:03,883999 (Thread-4): Began running node model.journeyengine_recipes.adwords_urls
2020-02-28 20:44:03,884426 (Thread-4): 12:44:03 | 13 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-28 20:44:03,885050 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 20:44:03,885226 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-28 20:44:03,885392 (Thread-4): Compiling model.journeyengine_recipes.adwords_urls
2020-02-28 20:44:03,898359 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:04,540020 (Thread-3): finished collecting timing info
2020-02-28 20:44:04,541310 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10694b190>]}
2020-02-28 20:44:04,549895 (Thread-1): finished collecting timing info
2020-02-28 20:44:04,550754 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106926e10>]}
2020-02-28 20:44:04,923125 (Thread-3): 12:44:04 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.44s]
2020-02-28 20:44:04,924946 (Thread-3): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 20:44:04,925368 (Thread-3): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-28 20:44:04,925805 (Thread-3): 12:44:04 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-28 20:44:04,926606 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 20:44:04,927147 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-28 20:44:04,927324 (Thread-3): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-28 20:44:04,944768 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:05,280384 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 20:44:05,281130 (Thread-4): finished collecting timing info
2020-02-28 20:44:05,288668 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 20:44:05,289130 (Thread-4): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-28 20:44:06,251919 (Thread-2): finished collecting timing info
2020-02-28 20:44:06,252987 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10537a790>]}
2020-02-28 20:44:06,298187 (Thread-1): 12:44:06 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 2.83s]
2020-02-28 20:44:06,300001 (Thread-1): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 20:44:06,300356 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 20:44:06,300754 (Thread-1): 12:44:06 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-28 20:44:06,301236 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 20:44:06,301656 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-28 20:44:06,302168 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-28 20:44:06,318686 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:06,394637 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 20:44:06,394923 (Thread-3): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-28 20:44:06,556984 (Thread-3): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-28 20:44:06,557432 (Thread-3): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-28 20:44:06,563256 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 20:44:06,563906 (Thread-3): finished collecting timing info
2020-02-28 20:44:06,612214 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 20:44:06,613538 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


      
        SELECT 
        
  id
, object_url
, url_tags
, _sdc_sequence
            FROM  



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by id) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by id) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.adcreative` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


        
     
)

select creative_id, max(url) url
from (
  select
    id creative_id,
    lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  from fb_adcreative
  )
group by creative_id


  );
    
2020-02-28 20:44:06,699080 (Thread-2): 12:44:06 | 12 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 3.78s]
2020-02-28 20:44:06,699393 (Thread-2): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 20:44:06,699627 (Thread-2): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 20:44:06,700027 (Thread-2): 12:44:06 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-28 20:44:06,700515 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 20:44:06,700668 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-28 20:44:06,700831 (Thread-2): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-28 20:44:06,713535 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:07,750240 (Thread-4): finished collecting timing info
2020-02-28 20:44:07,751297 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b18590>]}
2020-02-28 20:44:07,768459 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 20:44:07,909552 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 20:44:07,911156 (Thread-2): finished collecting timing info
2020-02-28 20:44:07,919190 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 20:44:07,919781 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-28 20:44:07,934617 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 20:44:07,935217 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 20:44:07,937446 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 20:44:07,938028 (Thread-1): finished collecting timing info
2020-02-28 20:44:07,944575 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 20:44:07,945121 (Thread-1): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-28 20:44:08,117993 (Thread-4): 12:44:08 | 13 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 3.87s]
2020-02-28 20:44:08,118293 (Thread-4): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-28 20:44:08,118527 (Thread-4): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 20:44:08,119054 (Thread-4): 12:44:08 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-28 20:44:08,119542 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 20:44:08,119694 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-28 20:44:08,119855 (Thread-4): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-28 20:44:08,136298 (Thread-4): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:09,311547 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-28 20:44:09,373803 (Thread-3): finished collecting timing info
2020-02-28 20:44:09,374876 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ae0110>]}
2020-02-28 20:44:09,489041 (Thread-4): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 20:44:09,489749 (Thread-4): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 20:44:09,496874 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 20:44:09,497514 (Thread-4): finished collecting timing info
2020-02-28 20:44:09,504697 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 20:44:09,505134 (Thread-4): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          sum(_28d_click) as conversions

          from (

                select
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from 



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12

                      
                   

)

select distinct
  account,
  platform,
  date,
  campaign,
  group_set,
  ad,
  objective,
  placement,
  spend,
  impressions,
  clicks,
  link_clicks,
  conversions
from fb_adplatforms

 
  );
    
2020-02-28 20:44:09,752384 (Thread-3): 12:44:09 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.45s]
2020-02-28 20:44:09,752727 (Thread-3): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-28 20:44:09,752964 (Thread-3): Began running node model.journeyengine_recipes.fb_conversions
2020-02-28 20:44:09,753490 (Thread-3): 12:44:09 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-28 20:44:09,753981 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 20:44:09,754134 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-28 20:44:09,754295 (Thread-3): Compiling model.journeyengine_recipes.fb_conversions
2020-02-28 20:44:09,764710 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 20:44:09,765212 (Thread-3): finished collecting timing info
2020-02-28 20:44:09,771415 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 20:44:09,771866 (Thread-3): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-28 20:44:09,986450 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/79a0d7d8-e550-4024-bc31-fce0a00238f4?maxResults=0&location=US: Unrecognized name: _28d_click at [50:17]')
2020-02-28 20:44:09,986763 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          sum(_28d_click) as conversions

          from (

                select
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from 



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12

                      
                   

)

select distinct
  account,
  platform,
  date,
  campaign,
  group_set,
  ad,
  objective,
  placement,
  spend,
  impressions,
  clicks,
  link_clicks,
  conversions
from fb_adplatforms

 
  );
    
2020-02-28 20:44:09,986971 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/79a0d7d8-e550-4024-bc31-fce0a00238f4?maxResults=0&location=US: Unrecognized name: _28d_click at [50:17]

(job ID: 79a0d7d8-e550-4024-bc31-fce0a00238f4)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          account_name account,
  19:          'Facebook Ads' as platform,
  20:          date_start date,
  21:          campaign_name campaign,
  22:          adset_name group_set,
  23:          ad_name ad,
  24:          objective,
  25:          Concat(publisher_platform,"-",platform_position) as placement,
  26:          spend,
  27:          impressions,
  28:          clicks,
  29:          inline_link_clicks link_clicks,
  30:          sum(_28d_click) as conversions
  31:
  32:          from (
  33:
  34:                select
  35:                
  36:  account_name
  37:, date_start
  38:, campaign_name
  39:, adset_name
  40:, ad_name
  41:, objective
  42:, publisher_platform
  43:, platform_position
  44:, spend
  45:, impressions
  46:, clicks
  47:, inline_link_clicks
  48:, _sdc_sequence
  49:, _sdc_batched_at,
  50:                _28d_click,
  51:               from 
  52:
  53:
  54:
  55:(
  56:	select * from (
  57:
  58:		select 
  59:			*,
  60:			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
  61:			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
  62:		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 
  63:
  64:	) 
  65:	where _sdc_sequence = most_recent_sequence
  66:	and _sdc_batched_at = most_recent_batch
  67:
  68:)
  69:
  70:
  71:               left join unnest(actions)
  72:
  73:               )
  74:
  75:            group by 1,2,3,4,5,6,7,8,9,10,11,12
  76:
  77:                      
  78:                   
  79:
  80:)
  81:
  82:select distinct
  83:  account,
  84:  platform,
  85:  date,
  86:  campaign,
  87:  group_set,
  88:  ad,
  89:  objective,
  90:  placement,
  91:  spend,
  92:  impressions,
  93:  clicks,
  94:  link_clicks,
  95:  conversions
  96:from fb_adplatforms
  97:
  98: 
  99:  );
 100:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 20:44:09,987260 (Thread-4): finished collecting timing info
2020-02-28 20:44:09,988093 (Thread-4): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [50:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/79a0d7d8-e550-4024-bc31-fce0a00238f4?maxResults=0&location=US: Unrecognized name: _28d_click at [50:17]

(job ID: 79a0d7d8-e550-4024-bc31-fce0a00238f4)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          account_name account,
  19:          'Facebook Ads' as platform,
  20:          date_start date,
  21:          campaign_name campaign,
  22:          adset_name group_set,
  23:          ad_name ad,
  24:          objective,
  25:          Concat(publisher_platform,"-",platform_position) as placement,
  26:          spend,
  27:          impressions,
  28:          clicks,
  29:          inline_link_clicks link_clicks,
  30:          sum(_28d_click) as conversions
  31:
  32:          from (
  33:
  34:                select
  35:                
  36:  account_name
  37:, date_start
  38:, campaign_name
  39:, adset_name
  40:, ad_name
  41:, objective
  42:, publisher_platform
  43:, platform_position
  44:, spend
  45:, impressions
  46:, clicks
  47:, inline_link_clicks
  48:, _sdc_sequence
  49:, _sdc_batched_at,
  50:                _28d_click,
  51:               from 
  52:
  53:
  54:
  55:(
  56:	select * from (
  57:
  58:		select 
  59:			*,
  60:			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
  61:			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
  62:		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 
  63:
  64:	) 
  65:	where _sdc_sequence = most_recent_sequence
  66:	and _sdc_batched_at = most_recent_batch
  67:
  68:)
  69:
  70:
  71:               left join unnest(actions)
  72:
  73:               )
  74:
  75:            group by 1,2,3,4,5,6,7,8,9,10,11,12
  76:
  77:                      
  78:                   
  79:
  80:)
  81:
  82:select distinct
  83:  account,
  84:  platform,
  85:  date,
  86:  campaign,
  87:  group_set,
  88:  ad,
  89:  objective,
  90:  placement,
  91:  spend,
  92:  impressions,
  93:  clicks,
  94:  link_clicks,
  95:  conversions
  96:from fb_adplatforms
  97:
  98: 
  99:  );
 100:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [50:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 20:44:10,6207 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069133d0>]}
2020-02-28 20:44:10,353475 (Thread-4): 12:44:10 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.89s]
2020-02-28 20:44:10,353820 (Thread-4): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 20:44:10,354104 (Thread-4): Began running node model.journeyengine_recipes.ga_conversions
2020-02-28 20:44:10,354598 (Thread-4): 12:44:10 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-28 20:44:10,355080 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 20:44:10,355232 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-28 20:44:10,355393 (Thread-4): Compiling model.journeyengine_recipes.ga_conversions
2020-02-28 20:44:10,366309 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 20:44:10,366846 (Thread-4): finished collecting timing info
2020-02-28 20:44:10,372788 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 20:44:10,373227 (Thread-4): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-28 20:44:10,578286 (Thread-2): finished collecting timing info
2020-02-28 20:44:10,579342 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10534f7d0>]}
2020-02-28 20:44:11,382458 (Thread-2): 12:44:11 | 16 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.88s]
2020-02-28 20:44:11,382791 (Thread-2): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 20:44:11,383024 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 20:44:11,383441 (Thread-2): 12:44:11 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-28 20:44:11,384077 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 20:44:11,384253 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-28 20:44:11,384420 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 20:44:11,401414 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 20:44:11,403984 (Thread-2): finished collecting timing info
2020-02-28 20:44:11,410665 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 20:44:11,415227 (Thread-1): finished collecting timing info
2020-02-28 20:44:11,416034 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aff590>]}
2020-02-28 20:44:11,417504 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-28 20:44:11,777326 (Thread-1): 12:44:11 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 5.11s]
2020-02-28 20:44:11,777690 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 20:44:11,777925 (Thread-1): Began running node model.journeyengine_recipes.adwords_join
2020-02-28 20:44:11,778368 (Thread-1): 12:44:11 | 21 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-28 20:44:11,778955 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 20:44:11,779142 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-28 20:44:11,779338 (Thread-1): Compiling model.journeyengine_recipes.adwords_join
2020-02-28 20:44:11,793100 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 20:44:11,795638 (Thread-1): finished collecting timing info
2020-02-28 20:44:11,802291 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 20:44:11,804735 (Thread-1): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-28 20:44:12,178097 (Thread-3): finished collecting timing info
2020-02-28 20:44:12,179160 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ada710>]}
2020-02-28 20:44:12,522388 (Thread-4): finished collecting timing info
2020-02-28 20:44:12,523470 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105279610>]}
2020-02-28 20:44:12,551750 (Thread-3): 12:44:12 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.43s]
2020-02-28 20:44:12,553327 (Thread-3): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-28 20:44:12,553727 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-28 20:44:12,554272 (Thread-3): 12:44:12 | 22 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-28 20:44:12,555070 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 20:44:12,555570 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-28 20:44:12,555765 (Thread-3): Compiling model.journeyengine_recipes.fb_ads
2020-02-28 20:44:12,572607 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:13,797532 (Thread-4): 12:44:13 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (7) in 2.17s]
2020-02-28 20:44:13,797836 (Thread-4): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-28 20:44:13,798072 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 20:44:13,798589 (Thread-4): 12:44:13 | 23 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-28 20:44:13,798846 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 20:44:13,799061 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 20:44:13,799381 (Thread-4): 12:44:13 | 24 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-28 20:44:13,799954 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 20:44:13,800103 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-28 20:44:13,800263 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 20:44:13,823986 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:13,926446 (Thread-2): finished collecting timing info
2020-02-28 20:44:13,927517 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106908990>]}
2020-02-28 20:44:14,26420 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 20:44:14,28977 (Thread-3): finished collecting timing info
2020-02-28 20:44:14,36915 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 20:44:14,37530 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id
			FROM  



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by id) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by id) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.ads` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)


  );
    
2020-02-28 20:44:14,291057 (Thread-2): 12:44:14 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.54s]
2020-02-28 20:44:14,291425 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 20:44:14,291682 (Thread-2): Began running node model.journeyengine_recipes.ga_proc
2020-02-28 20:44:14,292116 (Thread-2): 12:44:14 | 25 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-28 20:44:14,292806 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 20:44:14,292977 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-28 20:44:14,293146 (Thread-2): Compiling model.journeyengine_recipes.ga_proc
2020-02-28 20:44:14,327890 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:14,512747 (Thread-1): finished collecting timing info
2020-02-28 20:44:14,513829 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066cffd0>]}
2020-02-28 20:44:14,983371 (Thread-1): 12:44:14 | 21 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 2.73s]
2020-02-28 20:44:14,984631 (Thread-1): Finished running node model.journeyengine_recipes.adwords_join
2020-02-28 20:44:14,984984 (Thread-1): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 20:44:14,985385 (Thread-1): 12:44:14 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-28 20:44:14,985828 (Thread-1): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 20:44:14,986099 (Thread-1): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 20:44:14,986460 (Thread-1): 12:44:14 | 27 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-28 20:44:14,987165 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 20:44:14,987324 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-28 20:44:14,987493 (Thread-1): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 20:44:14,999953 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 20:44:15,616 (Thread-1): finished collecting timing info
2020-02-28 20:44:15,6582 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 20:44:15,7075 (Thread-1): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-28 20:44:15,272016 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:15,763284 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:16,300692 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-28 20:44:16,440347 (Thread-3): finished collecting timing info
2020-02-28 20:44:16,441408 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053f7510>]}
2020-02-28 20:44:16,460863 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 20:44:16,461459 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 20:44:16,461877 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-28 20:44:16,638870 (Thread-4): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 20:44:16,639555 (Thread-4): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 20:44:16,643038 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 20:44:16,643852 (Thread-4): finished collecting timing info
2020-02-28 20:44:16,652432 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 20:44:16,652929 (Thread-4): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 20:44:17,109999 (Thread-4): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/98cfa7f4-84c5-4e98-8b5e-fa8ddcf1ee81?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-28 20:44:17,110298 (Thread-4): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 20:44:17,110503 (Thread-4): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/98cfa7f4-84c5-4e98-8b5e-fa8ddcf1ee81?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 98cfa7f4-84c5-4e98-8b5e-fa8ddcf1ee81)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 20:44:17,110782 (Thread-4): finished collecting timing info
2020-02-28 20:44:17,111589 (Thread-4): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/98cfa7f4-84c5-4e98-8b5e-fa8ddcf1ee81?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: 98cfa7f4-84c5-4e98-8b5e-fa8ddcf1ee81)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 20:44:17,112774 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10699cd50>]}
2020-02-28 20:44:17,167610 (Thread-3): 12:44:17 | 22 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 3.89s]
2020-02-28 20:44:17,169339 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-28 20:44:17,169764 (Thread-3): Began running node model.journeyengine_recipes.adwords_stats
2020-02-28 20:44:17,170213 (Thread-3): 12:44:17 | 28 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-28 20:44:17,171006 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 20:44:17,171539 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-28 20:44:17,171716 (Thread-3): Compiling model.journeyengine_recipes.adwords_stats
2020-02-28 20:44:17,182319 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 20:44:17,183144 (Thread-3): finished collecting timing info
2020-02-28 20:44:17,189393 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 20:44:17,190033 (Thread-3): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-28 20:44:17,210777 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:17,512272 (Thread-1): finished collecting timing info
2020-02-28 20:44:17,513645 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10669ac90>]}
2020-02-28 20:44:17,537684 (Thread-4): 12:44:17 | 24 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.31s]
2020-02-28 20:44:17,538211 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 20:44:17,539251 (Thread-4): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 20:44:17,539787 (Thread-4): 12:44:17 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-28 20:44:17,540096 (Thread-4): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 20:44:17,540320 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 20:44:17,540895 (Thread-4): 12:44:17 | 30 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-28 20:44:17,541367 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 20:44:17,541693 (Thread-4): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 20:44:17,541949 (Thread-4): 12:44:17 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-28 20:44:17,542123 (Thread-4): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 20:44:17,898962 (Thread-1): 12:44:17 | 27 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 2.53s]
2020-02-28 20:44:17,899212 (Thread-1): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 20:44:17,899747 (Thread-4): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 20:44:17,899955 (Thread-4): 12:44:17 | 32 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-28 20:44:17,900219 (Thread-1): Began running node model.journeyengine_recipes.social_post_viz
2020-02-28 20:44:17,900780 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 20:44:17,900967 (Thread-1): 12:44:17 | 33 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-28 20:44:17,901111 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-28 20:44:17,901319 (Thread-4): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-28 20:44:17,901631 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 20:44:17,911096 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 20:44:17,911280 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-28 20:44:17,911553 (Thread-1): Compiling model.journeyengine_recipes.social_post_viz
2020-02-28 20:44:17,921562 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 20:44:17,921876 (Thread-4): finished collecting timing info
2020-02-28 20:44:17,932257 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 20:44:17,932877 (Thread-1): finished collecting timing info
2020-02-28 20:44:17,940711 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 20:44:17,941183 (Thread-4): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-28 20:44:17,942808 (Thread-1): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-28 20:44:18,610429 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:19,759979 (Thread-3): finished collecting timing info
2020-02-28 20:44:19,761052 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066cfc50>]}
2020-02-28 20:44:19,930346 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 20:44:20,23437 (Thread-1): finished collecting timing info
2020-02-28 20:44:20,24504 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10692c410>]}
2020-02-28 20:44:20,119164 (Thread-3): 12:44:20 | 28 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.59s]
2020-02-28 20:44:20,120663 (Thread-3): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-28 20:44:20,121331 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 20:44:20,121584 (Thread-3): 12:44:20 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-28 20:44:20,122070 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 20:44:20,122862 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 20:44:20,123244 (Thread-3): 12:44:20 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-28 20:44:20,123484 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 20:44:20,398706 (Thread-4): finished collecting timing info
2020-02-28 20:44:20,399791 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b98610>]}
2020-02-28 20:44:20,481318 (Thread-1): 12:44:20 | 33 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.12s]
2020-02-28 20:44:20,482821 (Thread-1): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-28 20:44:20,847991 (Thread-4): 12:44:20 | 32 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.50s]
2020-02-28 20:44:20,848291 (Thread-4): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 20:44:20,848897 (Thread-3): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-28 20:44:20,849212 (Thread-3): 12:44:20 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-28 20:44:20,849774 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 20:44:20,849963 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-28 20:44:20,850156 (Thread-3): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-28 20:44:20,862449 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 20:44:20,865270 (Thread-3): finished collecting timing info
2020-02-28 20:44:20,874709 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 20:44:20,875473 (Thread-3): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-28 20:44:21,44169 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 20:44:21,44927 (Thread-2): finished collecting timing info
2020-02-28 20:44:21,52229 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 20:44:21,52692 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
							
				null as mqls,		
			
							
				null as subscribers,		
						
							
				null as excluded,		
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 20:44:23,288376 (Thread-3): finished collecting timing info
2020-02-28 20:44:23,289446 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b6ef90>]}
2020-02-28 20:44:23,996851 (Thread-3): 12:44:23 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.44s]
2020-02-28 20:44:23,997155 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-28 20:44:32,820051 (Thread-2): finished collecting timing info
2020-02-28 20:44:32,821360 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106942ad0>]}
2020-02-28 20:44:33,175857 (Thread-2): 12:44:33 | 25 of 44 OK created table model agency_data_pipeline.ga_proc......... [CREATE TABLE (699111) in 18.53s]
2020-02-28 20:44:33,176221 (Thread-2): Finished running node model.journeyengine_recipes.ga_proc
2020-02-28 20:44:33,176800 (Thread-4): Began running node model.journeyengine_recipes.ga_stats
2020-02-28 20:44:33,177131 (Thread-4): 12:44:33 | 37 of 44 START table model agency_data_pipeline.ga_stats............. [RUN]
2020-02-28 20:44:33,177687 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 20:44:33,177869 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.social_platform_by_month).
2020-02-28 20:44:33,178061 (Thread-4): Compiling model.journeyengine_recipes.ga_stats
2020-02-28 20:44:33,194220 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 20:44:33,197932 (Thread-4): finished collecting timing info
2020-02-28 20:44:33,207016 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 20:44:33,207758 (Thread-4): On model.journeyengine_recipes.ga_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_stats`
  
  
  OPTIONS()
  as (
    SELECT  
cast(date as date) date,
b.account,
b.site site,
c.source source,
c.medium medium,
concat(a.source, ' / ', a.medium) source_medium,  
case when c.platform is null then "Unmapped" else c.platform end as platform,
case when c.channel is null then "Unmapped" else c.channel end as channel,
url,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(other) other,
sum(excluded) excluded
FROM `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b 
ON ( a.bigquery_name = b.bigquery_name 
	AND a.lookup_platform = b.platform )
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc` c
ON ( a.source = c.source
  AND a.medium = c.medium 
  AND a.bigquery_name = c.bigquery_name )
GROUP BY date, account, site, source, medium, source_medium, platform, channel, url
  );
    
2020-02-28 20:44:45,196285 (Thread-4): finished collecting timing info
2020-02-28 20:44:45,199931 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc5bc11c-3fe0-453f-8ff6-3882c15622d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bef510>]}
2020-02-28 20:44:45,557311 (Thread-4): 12:44:45 | 37 of 44 OK created table model agency_data_pipeline.ga_stats........ [CREATE TABLE (699111) in 12.02s]
2020-02-28 20:44:45,557649 (Thread-4): Finished running node model.journeyengine_recipes.ga_stats
2020-02-28 20:44:45,558211 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 20:44:45,558469 (Thread-3): 12:44:45 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-28 20:44:45,558676 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 20:44:45,559171 (Thread-1): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 20:44:45,559352 (Thread-4): Began running node model.journeyengine_recipes.platform_by_month
2020-02-28 20:44:45,559589 (Thread-1): 12:44:45 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-28 20:44:45,559840 (Thread-4): 12:44:45 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-28 20:44:45,560118 (Thread-1): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 20:44:45,560396 (Thread-4): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-28 20:44:45,560956 (Thread-3): Began running node model.journeyengine_recipes.landing_page_index
2020-02-28 20:44:45,561294 (Thread-3): 12:44:45 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-28 20:44:45,561473 (Thread-1): Began running node model.journeyengine_recipes.platform_index
2020-02-28 20:44:45,561668 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-28 20:44:45,561922 (Thread-1): 12:44:45 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-28 20:44:45,562412 (Thread-2): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-28 20:44:45,562608 (Thread-1): Finished running node model.journeyengine_recipes.platform_index
2020-02-28 20:44:45,562792 (Thread-2): 12:44:45 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-28 20:44:45,563279 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-28 20:44:45,563460 (Thread-3): Began running node model.journeyengine_recipes.platform_viz
2020-02-28 20:44:45,563813 (Thread-3): 12:44:45 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-28 20:44:45,564018 (Thread-3): Finished running node model.journeyengine_recipes.platform_viz
2020-02-28 20:44:45,645679 (MainThread): 12:44:45 | 
2020-02-28 20:44:45,646040 (MainThread): 12:44:45 | Finished running 44 table models in 52.71s.
2020-02-28 20:44:45,646275 (MainThread): Connection 'master' was left open.
2020-02-28 20:44:45,646452 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-28 20:44:45,646625 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-28 20:44:45,646796 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-28 20:44:45,646963 (MainThread): Connection 'model.journeyengine_recipes.ga_stats' was left open.
2020-02-28 20:44:45,786208 (MainThread): 
2020-02-28 20:44:45,786452 (MainThread): Completed with 2 errors and 0 warnings:
2020-02-28 20:44:45,786652 (MainThread): 
2020-02-28 20:44:45,786837 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-28 20:44:45,786993 (MainThread):   Unrecognized name: _28d_click at [50:17]
2020-02-28 20:44:45,787140 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 20:44:45,787285 (MainThread): 
2020-02-28 20:44:45,787433 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-28 20:44:45,787572 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-28 20:44:45,787703 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 20:44:45,787872 (MainThread): 
Done. PASS=42 WARN=0 ERROR=2 SKIP=0 TOTAL=44
2020-02-28 20:44:45,788110 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053ce6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e6950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e6b50>]}
2020-02-28 20:44:46,574991 (MainThread): Flushing usage events
2020-02-28 21:06:32,437414 (MainThread): Running with dbt=0.15.2
2020-02-28 21:06:32,733997 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/justinthomas/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-02-28 21:06:32,735019 (MainThread): Tracking: tracking
2020-02-28 21:06:32,744399 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4eafd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4eaed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4eaa50>]}
2020-02-28 21:06:33,311312 (MainThread): Partial parsing not enabled
2020-02-28 21:06:33,314217 (MainThread): Parsing macros/core.sql
2020-02-28 21:06:33,321432 (MainThread): Parsing macros/materializations/helpers.sql
2020-02-28 21:06:33,332614 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-02-28 21:06:33,336632 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-02-28 21:06:33,360233 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-02-28 21:06:33,384880 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-02-28 21:06:33,407454 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-02-28 21:06:33,410444 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-02-28 21:06:33,419676 (MainThread): Parsing macros/materializations/common/merge.sql
2020-02-28 21:06:33,429221 (MainThread): Parsing macros/materializations/table/table.sql
2020-02-28 21:06:33,437549 (MainThread): Parsing macros/materializations/view/view.sql
2020-02-28 21:06:33,448603 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-02-28 21:06:33,455661 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-02-28 21:06:33,457148 (MainThread): Parsing macros/etc/query.sql
2020-02-28 21:06:33,458774 (MainThread): Parsing macros/etc/is_incremental.sql
2020-02-28 21:06:33,461151 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-02-28 21:06:33,464030 (MainThread): Parsing macros/etc/datetime.sql
2020-02-28 21:06:33,474508 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-02-28 21:06:33,477289 (MainThread): Parsing macros/adapters/common.sql
2020-02-28 21:06:33,514221 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-02-28 21:06:33,516054 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-02-28 21:06:33,517560 (MainThread): Parsing macros/schema_tests/unique.sql
2020-02-28 21:06:33,519261 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-02-28 21:06:33,522627 (MainThread): Parsing macros/etc.sql
2020-02-28 21:06:33,524216 (MainThread): Parsing macros/catalog.sql
2020-02-28 21:06:33,528880 (MainThread): Parsing macros/adapters.sql
2020-02-28 21:06:33,546832 (MainThread): Parsing macros/materializations/merge.sql
2020-02-28 21:06:33,548200 (MainThread): Parsing macros/materializations/seed.sql
2020-02-28 21:06:33,550939 (MainThread): Parsing macros/materializations/view.sql
2020-02-28 21:06:33,553076 (MainThread): Parsing macros/materializations/table.sql
2020-02-28 21:06:33,564554 (MainThread): Parsing macros/materializations/incremental.sql
2020-02-28 21:06:33,571539 (MainThread): Parsing macros/materializations/snapshot.sql
2020-02-28 21:06:33,612107 (MainThread): Partial parsing not enabled
2020-02-28 21:06:33,613843 (MainThread): Parsing macros/get_column_values.sql
2020-02-28 21:06:33,619013 (MainThread): Parsing macros/fill_missing.sql
2020-02-28 21:06:33,623400 (MainThread): Parsing macros/most_recent_record.sql
2020-02-28 21:06:33,627052 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-02-28 21:06:33,628550 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-02-28 21:06:33,630523 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-02-28 21:06:33,633811 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-02-28 21:06:33,636109 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-02-28 21:06:33,642340 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-02-28 21:06:33,644366 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-02-28 21:06:33,646307 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-02-28 21:06:33,649636 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-02-28 21:06:33,651372 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-02-28 21:06:33,654585 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-02-28 21:06:33,658086 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-02-28 21:06:33,661105 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-02-28 21:06:33,663153 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-02-28 21:06:33,665362 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-02-28 21:06:33,666988 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-02-28 21:06:33,670919 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-02-28 21:06:33,677000 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-02-28 21:06:33,680969 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-02-28 21:06:33,684209 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-02-28 21:06:33,686607 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-02-28 21:06:33,710639 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-02-28 21:06:33,711860 (MainThread): Parsing macros/logger/pretty_time.sql
2020-02-28 21:06:33,713290 (MainThread): Parsing macros/logger/log_info.sql
2020-02-28 21:06:33,714632 (MainThread): Parsing macros/datetime/date_spine.sql
2020-02-28 21:06:33,719172 (MainThread): Parsing macros/web/get_url_host.sql
2020-02-28 21:06:33,721788 (MainThread): Parsing macros/web/get_url_path.sql
2020-02-28 21:06:33,725292 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-02-28 21:06:33,727612 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-02-28 21:06:33,729311 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-02-28 21:06:33,731555 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-02-28 21:06:33,734782 (MainThread): Parsing macros/schema_tests/recency.sql
2020-02-28 21:06:33,737085 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-02-28 21:06:33,738711 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-02-28 21:06:33,740453 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-02-28 21:06:33,742575 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-02-28 21:06:33,744654 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-02-28 21:06:33,746470 (MainThread): Parsing macros/schema_tests/equality.sql
2020-02-28 21:06:33,750725 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-02-28 21:06:33,756206 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-02-28 21:06:33,758196 (MainThread): Parsing macros/sql/generate_series.sql
2020-02-28 21:06:33,762648 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-02-28 21:06:33,767916 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-02-28 21:06:33,771290 (MainThread): Parsing macros/sql/star.sql
2020-02-28 21:06:33,775202 (MainThread): Parsing macros/sql/unpivot.sql
2020-02-28 21:06:33,783386 (MainThread): Parsing macros/sql/union.sql
2020-02-28 21:06:33,795166 (MainThread): Parsing macros/sql/groupby.sql
2020-02-28 21:06:33,796816 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-02-28 21:06:33,799684 (MainThread): Parsing macros/sql/nullcheck.sql
2020-02-28 21:06:33,802126 (MainThread): Parsing macros/sql/get_column_values.sql
2020-02-28 21:06:33,807855 (MainThread): Parsing macros/sql/pivot.sql
2020-02-28 21:06:33,811839 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-02-28 21:06:33,839073 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ad_platform_viz".
2020-02-28 21:06:33,839231 (MainThread): Opening a new connection, currently in state init
2020-02-28 21:06:33,865625 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 21:06:33,865812 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,874376 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_viz".
2020-02-28 21:06:33,874553 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,882871 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 21:06:33,883018 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,891363 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_viz".
2020-02-28 21:06:33,891537 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,899788 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_union".
2020-02-28 21:06:33,899907 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,912032 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_adplatforms_site".
2020-02-28 21:06:33,912167 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,924637 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_ga".
2020-02-28 21:06:33,924841 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,938834 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 21:06:33,939087 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,951043 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 21:06:33,951222 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,965765 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_site".
2020-02-28 21:06:33,965941 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,975877 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.agg_platforms_union".
2020-02-28 21:06:33,976056 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,988775 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 21:06:33,988983 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:33,998240 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 21:06:33,998428 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,5851 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 21:06:34,6016 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,13019 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 21:06:34,13144 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,22376 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_index".
2020-02-28 21:06:34,22646 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,33485 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adplatform_cost_calculations".
2020-02-28 21:06:34,33697 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,42091 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_by_month".
2020-02-28 21:06:34,42219 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,51869 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.platform_index".
2020-02-28 21:06:34,52020 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,61346 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.landing_page_by_month".
2020-02-28 21:06:34,61571 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,72299 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 21:06:34,72464 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,127877 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 21:06:34,128032 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,139221 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 21:06:34,139370 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,147642 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 21:06:34,147769 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,154393 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 21:06:34,154515 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,162117 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 21:06:34,162242 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,206751 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 21:06:34,206942 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,215152 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 21:06:34,215386 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,225533 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 21:06:34,225810 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,236951 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 21:06:34,237228 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,254371 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_stats".
2020-02-28 21:06:34,254514 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,265568 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 21:06:34,265710 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,275322 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 21:06:34,275533 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,292235 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 21:06:34,292371 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,313963 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 21:06:34,314121 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,329709 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 21:06:34,329852 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,345368 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 21:06:34,345506 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,352575 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 21:06:34,352712 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,360302 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 21:06:34,360424 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,370107 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 21:06:34,370316 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,378550 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 21:06:34,378676 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,390906 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 21:06:34,391132 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,405356 (MainThread): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 21:06:34,405511 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:34,669541 (MainThread): Found 44 models, 0 tests, 0 snapshots, 0 analyses, 267 macros, 0 operations, 0 seed files, 0 sources
2020-02-28 21:06:34,694760 (MainThread): 
2020-02-28 21:06:34,695291 (MainThread): Acquiring new bigquery connection "master".
2020-02-28 21:06:34,695432 (MainThread): Opening a new connection, currently in state closed
2020-02-28 21:06:35,687778 (MainThread): 13:06:35 | Concurrency: 4 threads (target='dev')
2020-02-28 21:06:35,688026 (MainThread): 13:06:35 | 
2020-02-28 21:06:35,693959 (Thread-1): Began running node model.journeyengine_recipes.accounts_proc
2020-02-28 21:06:35,694360 (Thread-2): Began running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 21:06:35,694616 (Thread-3): Began running node model.journeyengine_recipes.gsc_stats
2020-02-28 21:06:35,694920 (Thread-1): 13:06:35 | 1 of 44 START table model agency_data_pipeline.accounts_proc......... [RUN]
2020-02-28 21:06:35,695130 (Thread-4): Began running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 21:06:35,695397 (Thread-2): 13:06:35 | 2 of 44 START table model agency_data_pipeline.conversion_goals_proc. [RUN]
2020-02-28 21:06:35,695636 (Thread-3): 13:06:35 | 3 of 44 START table model agency_data_pipeline.gsc_stats............. [RUN]
2020-02-28 21:06:35,696206 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.accounts_proc".
2020-02-28 21:06:35,696401 (Thread-4): 13:06:35 | 4 of 44 START table model agency_data_pipeline.mappings_ga_proc...... [RUN]
2020-02-28 21:06:35,696853 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.conversion_goals_proc".
2020-02-28 21:06:35,697390 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.gsc_stats".
2020-02-28 21:06:35,697539 (Thread-1): Opening a new connection, currently in state init
2020-02-28 21:06:35,698049 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.mappings_ga_proc".
2020-02-28 21:06:35,698194 (Thread-2): Opening a new connection, currently in state init
2020-02-28 21:06:35,698372 (Thread-3): Opening a new connection, currently in state init
2020-02-28 21:06:35,698571 (Thread-1): Compiling model.journeyengine_recipes.accounts_proc
2020-02-28 21:06:35,698737 (Thread-4): Opening a new connection, currently in state init
2020-02-28 21:06:35,698913 (Thread-2): Compiling model.journeyengine_recipes.conversion_goals_proc
2020-02-28 21:06:35,699090 (Thread-3): Compiling model.journeyengine_recipes.gsc_stats
2020-02-28 21:06:35,710789 (Thread-4): Compiling model.journeyengine_recipes.mappings_ga_proc
2020-02-28 21:06:35,717668 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 21:06:35,725908 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 21:06:35,735071 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 21:06:35,743866 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 21:06:35,745069 (Thread-2): finished collecting timing info
2020-02-28 21:06:35,745419 (Thread-1): finished collecting timing info
2020-02-28 21:06:35,745688 (Thread-4): finished collecting timing info
2020-02-28 21:06:35,745943 (Thread-3): finished collecting timing info
2020-02-28 21:06:36,420283 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.gsc_stats"
2020-02-28 21:06:36,421642 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.mappings_ga_proc"
2020-02-28 21:06:36,423482 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.conversion_goals_proc"
2020-02-28 21:06:36,424668 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.accounts_proc"
2020-02-28 21:06:36,428287 (Thread-2): On model.journeyengine_recipes.conversion_goals_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.conversion_goals_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
max(goal_type) goal_type,
account,
max(time_of_entry) time_of_entry
FROM  ( 

	SELECT  
	site,
	bigquery_name,
	platform,
	trim(replace(replace(lower(goal_name),',',''),' ','')) goal_name,
	goal_type,
	account,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY platform ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.conversion_goals` 

) 

WHERE lv = time_of_entry
group by site, bigquery_name, platform, account, goal_name
  );
    
2020-02-28 21:06:36,429614 (Thread-3): On model.journeyengine_recipes.gsc_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.gsc_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`gsc_stats`
  
  
  OPTIONS()
  as (
    SELECT
date, 
account, 
channel,
platform,
url,
0 as cost,
sum(impressions) as impressions,
sum(clicks) as clicks,
0 as conversions
FROM 
  ( 
	SELECT  
	date, 
	site as account,
	'Organic' as channel,
	'Organic' as platform,
	lower(trim(regexp_replace(replace(replace(replace(replace(landing_page_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
	max(impressions) as impressions, 
	max(clicks) as clicks
	FROM `journeyengine-recipes.agency_data_pipeline.gsc`
	GROUP BY date, account, channel, platform, url
  ) 
GROUP BY date, account, channel, platform, url
ORDER BY account asc, date asc, url asc
  );
    
2020-02-28 21:06:36,430321 (Thread-1): On model.journeyengine_recipes.accounts_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.accounts_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
platform,
bigquery_name
FROM (
  SELECT
  site,
  account,
  platform,
  bigquery_name,
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  FROM `journeyengine-recipes.agency_data_pipeline.accounts`
  )
  WHERE time_of_entry = lv
  );
    
2020-02-28 21:06:36,431117 (Thread-4): On model.journeyengine_recipes.mappings_ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.mappings_ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc`
  
  
  OPTIONS()
  as (
    SELECT
site,
account,
bigquery_name,
source,
medium,
max(platform_n) platform,
max(channel_n) channel,
time_of_entry
FROM  ( 

	SELECT  
	site,
	account,
	bigquery_name,
	source,
	medium,
	platform as platform_n,
	channel as channel_n,
	time_of_entry,
	first_value(time_of_entry) OVER (PARTITION BY site ORDER BY time_of_entry DESC) lv
	FROM `journeyengine-recipes.agency_data_pipeline.mappings_ga` 

) 

WHERE lv = time_of_entry
group by site, account, bigquery_name, source, medium, platform_n, channel_n, time_of_entry
  );
    
2020-02-28 21:06:39,416361 (Thread-1): finished collecting timing info
2020-02-28 21:06:39,417435 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106e5310>]}
2020-02-28 21:06:39,444817 (Thread-4): finished collecting timing info
2020-02-28 21:06:39,445874 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110760a90>]}
2020-02-28 21:06:39,464611 (Thread-3): finished collecting timing info
2020-02-28 21:06:39,465667 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11099ca50>]}
2020-02-28 21:06:39,667521 (Thread-2): finished collecting timing info
2020-02-28 21:06:39,668579 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f58fcd0>]}
2020-02-28 21:06:39,776860 (Thread-1): 13:06:39 | 1 of 44 OK created table model agency_data_pipeline.accounts_proc.... [CREATE TABLE (9) in 3.72s]
2020-02-28 21:06:39,778456 (Thread-1): Finished running node model.journeyengine_recipes.accounts_proc
2020-02-28 21:06:39,778829 (Thread-1): Began running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 21:06:39,779289 (Thread-1): 13:06:39 | 5 of 44 START table model agency_data_pipeline.facebook_insights_stats [RUN]
2020-02-28 21:06:39,780390 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.facebook_insights_stats".
2020-02-28 21:06:39,780866 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.accounts_proc).
2020-02-28 21:06:39,781047 (Thread-1): Compiling model.journeyengine_recipes.facebook_insights_stats
2020-02-28 21:06:39,790175 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 21:06:39,790849 (Thread-1): finished collecting timing info
2020-02-28 21:06:39,797252 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.facebook_insights_stats"
2020-02-28 21:06:39,797718 (Thread-1): On model.journeyengine_recipes.facebook_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.facebook_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'Facebook' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_image_url, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.facebook_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 21:06:40,154977 (Thread-4): 13:06:40 | 4 of 44 OK created table model agency_data_pipeline.mappings_ga_proc. [CREATE TABLE (252) in 3.75s]
2020-02-28 21:06:40,156571 (Thread-4): Finished running node model.journeyengine_recipes.mappings_ga_proc
2020-02-28 21:06:40,156954 (Thread-4): Began running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 21:06:40,157379 (Thread-4): 13:06:40 | 6 of 44 START table model agency_data_pipeline.instagram_insights_stats [RUN]
2020-02-28 21:06:40,158184 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.instagram_insights_stats".
2020-02-28 21:06:40,158739 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.mappings_ga_proc).
2020-02-28 21:06:40,158911 (Thread-4): Compiling model.journeyengine_recipes.instagram_insights_stats
2020-02-28 21:06:40,169695 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 21:06:40,170295 (Thread-4): finished collecting timing info
2020-02-28 21:06:40,176394 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.instagram_insights_stats"
2020-02-28 21:06:40,176831 (Thread-4): On model.journeyengine_recipes.instagram_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.instagram_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
0 as shares,
0 as link_clicks
from (
  select
  'Instagram' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  0 as shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.instagram_insights` 
)
where time_of_entry = lv
  );
    
2020-02-28 21:06:40,547765 (Thread-3): 13:06:40 | 3 of 44 OK created table model agency_data_pipeline.gsc_stats........ [CREATE TABLE (11027) in 3.77s]
2020-02-28 21:06:40,549153 (Thread-3): Finished running node model.journeyengine_recipes.gsc_stats
2020-02-28 21:06:40,549558 (Thread-3): Began running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 21:06:40,549969 (Thread-3): 13:06:40 | 7 of 44 START table model agency_data_pipeline.linkedin_company_pages_stats [RUN]
2020-02-28 21:06:40,550480 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_company_pages_stats".
2020-02-28 21:06:40,550896 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.gsc_stats).
2020-02-28 21:06:40,551383 (Thread-3): Compiling model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 21:06:40,560378 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 21:06:40,561181 (Thread-3): finished collecting timing info
2020-02-28 21:06:40,567502 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_company_pages_stats"
2020-02-28 21:06:40,568362 (Thread-3): On model.journeyengine_recipes.linkedin_company_pages_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_company_pages_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'LinkedIn' as platform,
  account, 
  date, 
  post_url,
  post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks,
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.linkedin_company_pages`
)
where time_of_entry = lv
  );
    
2020-02-28 21:06:41,18614 (Thread-2): 13:06:41 | 2 of 44 OK created table model agency_data_pipeline.conversion_goals_proc [CREATE TABLE (7) in 3.97s]
2020-02-28 21:06:41,18965 (Thread-2): Finished running node model.journeyengine_recipes.conversion_goals_proc
2020-02-28 21:06:41,19225 (Thread-2): Began running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 21:06:41,19663 (Thread-2): 13:06:41 | 8 of 44 START table model agency_data_pipeline.twitter_premium_stats. [RUN]
2020-02-28 21:06:41,20389 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_premium_stats".
2020-02-28 21:06:41,20569 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.conversion_goals_proc).
2020-02-28 21:06:41,20735 (Thread-2): Compiling model.journeyengine_recipes.twitter_premium_stats
2020-02-28 21:06:41,30111 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 21:06:41,30684 (Thread-2): finished collecting timing info
2020-02-28 21:06:41,37025 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.twitter_premium_stats"
2020-02-28 21:06:41,37440 (Thread-2): On model.journeyengine_recipes.twitter_premium_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_premium_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
0 as link_clicks
from (
  select
  'Twitter' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  impressions, 
  reactions, 
  comments, 
  shares,
  0 as link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.twitter_premium` 
)
where 
account is not null and
time_of_entry = lv
  );
    
2020-02-28 21:06:42,570369 (Thread-1): finished collecting timing info
2020-02-28 21:06:42,571438 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d43cd0>]}
2020-02-28 21:06:42,702133 (Thread-4): finished collecting timing info
2020-02-28 21:06:42,703025 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110624f10>]}
2020-02-28 21:06:42,928437 (Thread-3): finished collecting timing info
2020-02-28 21:06:42,929512 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106242d0>]}
2020-02-28 21:06:42,970973 (Thread-1): 13:06:42 | 5 of 44 OK created table model agency_data_pipeline.facebook_insights_stats [CREATE TABLE (811) in 2.79s]
2020-02-28 21:06:42,973531 (Thread-1): Finished running node model.journeyengine_recipes.facebook_insights_stats
2020-02-28 21:06:42,974767 (Thread-1): Began running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 21:06:42,975508 (Thread-1): 13:06:42 | 9 of 44 START table model agency_data_pipeline.youtube_insights_stats [RUN]
2020-02-28 21:06:42,976425 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.youtube_insights_stats".
2020-02-28 21:06:42,976655 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.facebook_insights_stats).
2020-02-28 21:06:42,979233 (Thread-1): Compiling model.journeyengine_recipes.youtube_insights_stats
2020-02-28 21:06:42,991065 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 21:06:42,992157 (Thread-1): finished collecting timing info
2020-02-28 21:06:42,998484 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.youtube_insights_stats"
2020-02-28 21:06:42,998941 (Thread-1): On model.journeyengine_recipes.youtube_insights_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.youtube_insights_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
null as post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from (
  select
  'YouTube' as platform,
  account, 
  date, 
  post_url,
  null as post_image_url,
  post_text, 
  views as impressions, 
  reactions, 
  comments, 
  shares,
  link_clicks, 
  time_of_entry,
  first_value(time_of_entry) over (partition by account, date, post_url, post_text order by time_of_entry desc) lv
  from `journeyengine-recipes.agency_data_pipeline.youtube_insights`
)
where time_of_entry = lv
  );
    
2020-02-28 21:06:43,176670 (Thread-2): finished collecting timing info
2020-02-28 21:06:43,177751 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110660f10>]}
2020-02-28 21:06:43,351047 (Thread-4): 13:06:43 | 6 of 44 OK created table model agency_data_pipeline.instagram_insights_stats [CREATE TABLE (25) in 2.54s]
2020-02-28 21:06:43,352504 (Thread-4): Finished running node model.journeyengine_recipes.instagram_insights_stats
2020-02-28 21:06:43,352904 (Thread-4): Began running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 21:06:43,353314 (Thread-4): 13:06:43 | 10 of 44 START table model agency_data_pipeline.linkedin_adplatforms. [RUN]
2020-02-28 21:06:43,354089 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.linkedin_adplatforms".
2020-02-28 21:06:43,354255 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.instagram_insights_stats).
2020-02-28 21:06:43,354762 (Thread-4): Compiling model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 21:06:43,364475 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 21:06:43,365154 (Thread-4): finished collecting timing info
2020-02-28 21:06:43,371424 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.linkedin_adplatforms"
2020-02-28 21:06:43,372461 (Thread-4): On model.journeyengine_recipes.linkedin_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.linkedin_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`linkedin_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'LinkedIn Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    null as objective,
    campaign_type placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.linkedin_ads`
  )
  where time_of_entry = lv
  );
    
2020-02-28 21:06:43,746934 (Thread-3): 13:06:43 | 7 of 44 OK created table model agency_data_pipeline.linkedin_company_pages_stats [CREATE TABLE (0) in 2.38s]
2020-02-28 21:06:43,748736 (Thread-3): Finished running node model.journeyengine_recipes.linkedin_company_pages_stats
2020-02-28 21:06:43,749202 (Thread-3): Began running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 21:06:43,749616 (Thread-3): 13:06:43 | 11 of 44 START table model agency_data_pipeline.twitter_adplatforms.. [RUN]
2020-02-28 21:06:43,750164 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.twitter_adplatforms".
2020-02-28 21:06:43,750633 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_company_pages_stats).
2020-02-28 21:06:43,751122 (Thread-3): Compiling model.journeyengine_recipes.twitter_adplatforms
2020-02-28 21:06:43,762215 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 21:06:43,762984 (Thread-3): finished collecting timing info
2020-02-28 21:06:43,770806 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.twitter_adplatforms"
2020-02-28 21:06:43,771640 (Thread-3): On model.journeyengine_recipes.twitter_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.twitter_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`twitter_adplatforms`
  
  
  OPTIONS()
  as (
    select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from(
    select
    account,
    'Twitter Ads' as platform,
    date,
    campaign,
    group_set,
    ad,
    campaign_type as objective,
    placement,
    cost spend,
    impressions,
    clicks,
    link_clicks,
    conversions,
    time_of_entry,
    first_value(time_of_entry) over (partition by date order by time_of_entry desc) lv
    from `journeyengine-recipes.agency_data_pipeline.twitter_ads` 
    )
where time_of_entry = lv
  );
    
2020-02-28 21:06:44,128250 (Thread-2): 13:06:44 | 8 of 44 OK created table model agency_data_pipeline.twitter_premium_stats [CREATE TABLE (0) in 2.16s]
2020-02-28 21:06:44,128602 (Thread-2): Finished running node model.journeyengine_recipes.twitter_premium_stats
2020-02-28 21:06:44,128835 (Thread-2): Began running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 21:06:44,129229 (Thread-2): 13:06:44 | 12 of 44 START table model agency_data_pipeline.adwords_campaigns.... [RUN]
2020-02-28 21:06:44,129725 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_campaigns".
2020-02-28 21:06:44,129876 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_premium_stats).
2020-02-28 21:06:44,130036 (Thread-2): Compiling model.journeyengine_recipes.adwords_campaigns
2020-02-28 21:06:44,143753 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:44,924295 (Thread-1): finished collecting timing info
2020-02-28 21:06:44,929734 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c54b10>]}
2020-02-28 21:06:45,314421 (Thread-1): 13:06:45 | 9 of 44 OK created table model agency_data_pipeline.youtube_insights_stats [CREATE TABLE (0) in 1.95s]
2020-02-28 21:06:45,314783 (Thread-1): Finished running node model.journeyengine_recipes.youtube_insights_stats
2020-02-28 21:06:45,315015 (Thread-1): Began running node model.journeyengine_recipes.adwords_urls
2020-02-28 21:06:45,315254 (Thread-1): 13:06:45 | 13 of 44 START table model agency_data_pipeline.adwords_urls......... [RUN]
2020-02-28 21:06:45,316023 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_urls".
2020-02-28 21:06:45,316205 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.youtube_insights_stats).
2020-02-28 21:06:45,316373 (Thread-1): Compiling model.journeyengine_recipes.adwords_urls
2020-02-28 21:06:45,329558 (Thread-1): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:45,552624 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 21:06:45,553219 (Thread-2): finished collecting timing info
2020-02-28 21:06:45,559854 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_campaigns"
2020-02-28 21:06:45,560361 (Thread-2): On model.journeyengine_recipes.adwords_campaigns: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_campaigns"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns`
  
  
  OPTIONS()
  as (
    



with adwords_campaigns as (
      
 
	SELECT  
	'Paid' as channel,
	'Google Ads' as platform,
	day,
	campaignid,
	campaign,
	account as account,
	cost/1000000 cost, 
	impressions as impressions, 
	clicks, 
	conversions,
	_sdc_sequence,
	first_value(_sdc_sequence) OVER (PARTITION BY campaignid, day ORDER BY _sdc_sequence DESC) lv
	FROM `journeyengine-recipes.google_ads_quantic.CAMPAIGN_PERFORMANCE_REPORT`
	    	
            
)

SELECT
day,
campaignid,
campaign,
account, 
channel,
platform,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM adwords_campaigns

WHERE lv = _sdc_sequence
GROUP BY day, campaignid, account, channel, platform, campaign

 
  );
    
2020-02-28 21:06:45,929098 (Thread-3): finished collecting timing info
2020-02-28 21:06:45,930213 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109832d0>]}
2020-02-28 21:06:46,299177 (Thread-3): 13:06:46 | 11 of 44 OK created table model agency_data_pipeline.twitter_adplatforms [CREATE TABLE (0) in 2.18s]
2020-02-28 21:06:46,299525 (Thread-3): Finished running node model.journeyengine_recipes.twitter_adplatforms
2020-02-28 21:06:46,299761 (Thread-3): Began running node model.journeyengine_recipes.fb_adcreative
2020-02-28 21:06:46,300172 (Thread-3): 13:06:46 | 14 of 44 START table model agency_data_pipeline.fb_adcreative........ [RUN]
2020-02-28 21:06:46,300660 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adcreative".
2020-02-28 21:06:46,300825 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.twitter_adplatforms).
2020-02-28 21:06:46,300985 (Thread-3): Compiling model.journeyengine_recipes.fb_adcreative
2020-02-28 21:06:46,315961 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:46,599102 (Thread-4): finished collecting timing info
2020-02-28 21:06:46,600166 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ce4f10>]}
2020-02-28 21:06:46,738493 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 21:06:46,739166 (Thread-1): finished collecting timing info
2020-02-28 21:06:46,747230 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.adwords_urls"
2020-02-28 21:06:46,747679 (Thread-1): On model.journeyengine_recipes.adwords_urls: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_urls"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls`
  
  
  OPTIONS()
  as (
    



with adwords_urls as (
      

	SELECT  
	campaignid,
	max(finalurl) finalurl
	FROM `journeyengine-recipes.google_ads_quantic.FINAL_URL_REPORT`
	GROUP BY campaignid
		    
            
)

SELECT
campaignid,
lower(trim(regexp_replace(replace(replace(replace(replace(finalurl,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
FROM adwords_urls

 
  );
    
2020-02-28 21:06:46,955661 (Thread-4): 13:06:46 | 10 of 44 OK created table model agency_data_pipeline.linkedin_adplatforms [CREATE TABLE (46234) in 3.25s]
2020-02-28 21:06:46,955965 (Thread-4): Finished running node model.journeyengine_recipes.linkedin_adplatforms
2020-02-28 21:06:46,956356 (Thread-4): Began running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 21:06:46,956841 (Thread-4): 13:06:46 | 15 of 44 START table model agency_data_pipeline.fb_ads_insights...... [RUN]
2020-02-28 21:06:46,957366 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights".
2020-02-28 21:06:46,957523 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.linkedin_adplatforms).
2020-02-28 21:06:46,957688 (Thread-4): Compiling model.journeyengine_recipes.fb_ads_insights
2020-02-28 21:06:46,973226 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:47,997866 (Thread-3): Actual dataset: fb_ads_quantic
2020-02-28 21:06:47,998298 (Thread-3): * Deprecation Warning: The adapter function `adapter.get_columns_in_table` is deprecated and will be removed in
 a future release of dbt. Please use `adapter.get_columns_in_relation` instead.
 Documentation for get_columns_in_relation can be found here:
 https://docs.getdbt.com/docs/adapter

2020-02-28 21:06:48,163453 (Thread-3): Actual columns: [<BigQueryColumn id (STRING, NULLABLE)>, <BigQueryColumn name (STRING, NULLABLE)>, <BigQueryColumn url_tags (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn call_to_action_type (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn thumbnail_url (STRING, NULLABLE)>, <BigQueryColumn image_url (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn object_url (STRING, NULLABLE)>, <BigQueryColumn link_url (STRING, NULLABLE)>]
2020-02-28 21:06:48,163935 (Thread-3): Actual column names: ['id', 'name', 'url_tags', '_sdc_table_version', 'call_to_action_type', '_sdc_received_at', '_sdc_sequence', 'thumbnail_url', 'image_url', '_sdc_batched_at', '_sdc_extracted_at', 'object_url', 'link_url']
2020-02-28 21:06:48,169627 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 21:06:48,170222 (Thread-3): finished collecting timing info
2020-02-28 21:06:48,220391 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_adcreative"
2020-02-28 21:06:48,222975 (Thread-2): finished collecting timing info
2020-02-28 21:06:48,223882 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dbba50>]}
2020-02-28 21:06:48,225249 (Thread-3): On model.journeyengine_recipes.fb_adcreative: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adcreative"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`
  
  
  OPTIONS()
  as (
    



with fb_adcreative as (


      
        SELECT 
        
  id
, object_url
, url_tags
, _sdc_sequence
            FROM  



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by id) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by id) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.adcreative` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


        
     
)

select creative_id, max(url) url
from (
  select
    id creative_id,
    lower(trim(regexp_replace(replace(replace(replace(replace(object_url,'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url
  from fb_adcreative
  )
group by creative_id


  );
    
2020-02-28 21:06:48,740046 (Thread-2): 13:06:48 | 12 of 44 OK created table model agency_data_pipeline.adwords_campaigns [CREATE TABLE (1555) in 4.09s]
2020-02-28 21:06:48,740727 (Thread-2): Finished running node model.journeyengine_recipes.adwords_campaigns
2020-02-28 21:06:48,741166 (Thread-2): Began running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 21:06:48,741433 (Thread-2): 13:06:48 | 16 of 44 START table model agency_data_pipeline.adwords_adplatforms.. [RUN]
2020-02-28 21:06:48,742168 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_adplatforms".
2020-02-28 21:06:48,742526 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_campaigns).
2020-02-28 21:06:48,742811 (Thread-2): Compiling model.journeyengine_recipes.adwords_adplatforms
2020-02-28 21:06:48,755767 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:49,65291 (Thread-1): finished collecting timing info
2020-02-28 21:06:49,66377 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dbd4050>]}
2020-02-28 21:06:49,88010 (Thread-4): Actual dataset: fb_ads_quantic
2020-02-28 21:06:49,252924 (Thread-4): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 21:06:49,253619 (Thread-4): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 21:06:49,256412 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 21:06:49,257189 (Thread-4): finished collecting timing info
2020-02-28 21:06:49,264787 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights"
2020-02-28 21:06:49,265282 (Thread-4): On model.journeyengine_recipes.fb_ads_insights: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights`
  
  
  OPTIONS()
  as (
    



with fb_ads_insights as (

	    
	    
		   	SELECT 
			date_start,
			campaign_id,
			campaign_name,
			ad_id,
			account_name,
			spend,
			reach,
			inline_link_clicks,
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY date_start, ad_id, campaign_id ORDER BY _sdc_sequence DESC) lv

			from (
				select
				
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, spend
, null as reach
, inline_link_clicks
, _sdc_sequence,
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`

			)

		    
	   

)

select
date_start date,
campaign_id,
campaign_name campaign,
ad_id,
account_name account,
max(spend) cost,
max(reach) impressions,
max(inline_link_clicks) clicks
from fb_ads_insights
where lv = _sdc_sequence
group by date, campaign_id, ad_id, account, campaign


  );
    
2020-02-28 21:06:49,442204 (Thread-1): 13:06:49 | 13 of 44 OK created table model agency_data_pipeline.adwords_urls.... [CREATE TABLE (28) in 3.75s]
2020-02-28 21:06:49,442574 (Thread-1): Finished running node model.journeyengine_recipes.adwords_urls
2020-02-28 21:06:49,442919 (Thread-1): Began running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 21:06:49,443414 (Thread-1): 13:06:49 | 17 of 44 START table model agency_data_pipeline.fb_adplatforms....... [RUN]
2020-02-28 21:06:49,444094 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_adplatforms".
2020-02-28 21:06:49,444267 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_urls).
2020-02-28 21:06:49,444434 (Thread-1): Compiling model.journeyengine_recipes.fb_adplatforms
2020-02-28 21:06:49,461827 (Thread-1): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:50,234259 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 21:06:50,234828 (Thread-2): finished collecting timing info
2020-02-28 21:06:50,242469 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.adwords_adplatforms"
2020-02-28 21:06:50,242980 (Thread-2): On model.journeyengine_recipes.adwords_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_adplatforms`
  
  
  OPTIONS()
  as (
    



with adwords_adplatforms as (

      
          select
          account,
          'Google Ads' as platform,
          day date,
          campaign,
          adgroup group_set,
          concat( headline1, " | ", headline2, " - ", description) as ad,
          null as objective,
          adtype placement,
          cost / 1000000 as spend,
          impressions,
          clicks,
          clicks link_clicks,
          conversions,
          _sdc_report_datetime,
          first_value(_sdc_report_datetime) over (partition by day order by _sdc_report_datetime desc) lv
         from `journeyengine-recipes.google_ads_quantic.AD_PERFORMANCE_REPORT`
                
             

)

 select
account,
platform,
date,
campaign,
group_set,
ad,
objective,
placement,
spend,
impressions,
clicks,
link_clicks,
conversions
from adwords_adplatforms
 where _sdc_report_datetime = lv

 
  );
    
2020-02-28 21:06:50,577245 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 21:06:50,738948 (Thread-1): Actual columns: [<BigQueryColumn publisher_platform (STRING, NULLABLE)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn platform_position (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn impression_device (STRING, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>, <BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>]
2020-02-28 21:06:50,739702 (Thread-1): Actual column names: ['publisher_platform', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'platform_position', 'ad_id', '_sdc_table_version', 'impression_device', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start', 'action_values']
2020-02-28 21:06:50,747027 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 21:06:50,747651 (Thread-1): finished collecting timing info
2020-02-28 21:06:50,755049 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_adplatforms"
2020-02-28 21:06:50,755550 (Thread-1): On model.journeyengine_recipes.fb_adplatforms: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          sum(_28d_click) as conversions

          from (

                select
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from 



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12

                      
                   

)

select distinct
  account,
  platform,
  date,
  campaign,
  group_set,
  ad,
  objective,
  placement,
  spend,
  impressions,
  clicks,
  link_clicks,
  conversions
from fb_adplatforms

 
  );
    
2020-02-28 21:06:50,797454 (Thread-3): finished collecting timing info
2020-02-28 21:06:50,798334 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d9eb90>]}
2020-02-28 21:06:51,168763 (Thread-3): 13:06:51 | 14 of 44 OK created table model agency_data_pipeline.fb_adcreative... [CREATE TABLE (32895) in 4.50s]
2020-02-28 21:06:51,169070 (Thread-3): Finished running node model.journeyengine_recipes.fb_adcreative
2020-02-28 21:06:51,169307 (Thread-3): Began running node model.journeyengine_recipes.fb_conversions
2020-02-28 21:06:51,169873 (Thread-3): 13:06:51 | 18 of 44 START table model agency_data_pipeline.fb_conversions....... [RUN]
2020-02-28 21:06:51,170378 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_conversions".
2020-02-28 21:06:51,170530 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adcreative).
2020-02-28 21:06:51,170692 (Thread-3): Compiling model.journeyengine_recipes.fb_conversions
2020-02-28 21:06:51,181548 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 21:06:51,182031 (Thread-3): finished collecting timing info
2020-02-28 21:06:51,188293 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_conversions"
2020-02-28 21:06:51,188736 (Thread-3): On model.journeyengine_recipes.fb_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Facebook Ads'
  );
    
2020-02-28 21:06:51,251762 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/664ae163-bf8f-4212-b5ec-3cd47fa5fb0f?maxResults=0&location=US: Unrecognized name: _28d_click at [50:17]')
2020-02-28 21:06:51,251977 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
  
  
  OPTIONS()
  as (
    



with fb_adplatforms as (

      
          
          select
          account_name account,
          'Facebook Ads' as platform,
          date_start date,
          campaign_name campaign,
          adset_name group_set,
          ad_name ad,
          objective,
          Concat(publisher_platform,"-",platform_position) as placement,
          spend,
          impressions,
          clicks,
          inline_link_clicks link_clicks,
          sum(_28d_click) as conversions

          from (

                select
                
  account_name
, date_start
, campaign_name
, adset_name
, ad_name
, objective
, publisher_platform
, platform_position
, spend
, impressions
, clicks
, inline_link_clicks
, _sdc_sequence
, _sdc_batched_at,
                _28d_click,
               from 



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


               left join unnest(actions)

               )

            group by 1,2,3,4,5,6,7,8,9,10,11,12

                      
                   

)

select distinct
  account,
  platform,
  date,
  campaign,
  group_set,
  ad,
  objective,
  placement,
  spend,
  impressions,
  clicks,
  link_clicks,
  conversions
from fb_adplatforms

 
  );
    
2020-02-28 21:06:51,252106 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/664ae163-bf8f-4212-b5ec-3cd47fa5fb0f?maxResults=0&location=US: Unrecognized name: _28d_click at [50:17]

(job ID: 664ae163-bf8f-4212-b5ec-3cd47fa5fb0f)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          account_name account,
  19:          'Facebook Ads' as platform,
  20:          date_start date,
  21:          campaign_name campaign,
  22:          adset_name group_set,
  23:          ad_name ad,
  24:          objective,
  25:          Concat(publisher_platform,"-",platform_position) as placement,
  26:          spend,
  27:          impressions,
  28:          clicks,
  29:          inline_link_clicks link_clicks,
  30:          sum(_28d_click) as conversions
  31:
  32:          from (
  33:
  34:                select
  35:                
  36:  account_name
  37:, date_start
  38:, campaign_name
  39:, adset_name
  40:, ad_name
  41:, objective
  42:, publisher_platform
  43:, platform_position
  44:, spend
  45:, impressions
  46:, clicks
  47:, inline_link_clicks
  48:, _sdc_sequence
  49:, _sdc_batched_at,
  50:                _28d_click,
  51:               from 
  52:
  53:
  54:
  55:(
  56:	select * from (
  57:
  58:		select 
  59:			*,
  60:			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
  61:			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
  62:		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 
  63:
  64:	) 
  65:	where _sdc_sequence = most_recent_sequence
  66:	and _sdc_batched_at = most_recent_batch
  67:
  68:)
  69:
  70:
  71:               left join unnest(actions)
  72:
  73:               )
  74:
  75:            group by 1,2,3,4,5,6,7,8,9,10,11,12
  76:
  77:                      
  78:                   
  79:
  80:)
  81:
  82:select distinct
  83:  account,
  84:  platform,
  85:  date,
  86:  campaign,
  87:  group_set,
  88:  ad,
  89:  objective,
  90:  placement,
  91:  spend,
  92:  impressions,
  93:  clicks,
  94:  link_clicks,
  95:  conversions
  96:from fb_adplatforms
  97:
  98: 
  99:  );
 100:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 21:06:51,252293 (Thread-1): finished collecting timing info
2020-02-28 21:06:51,252843 (Thread-1): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [50:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/664ae163-bf8f-4212-b5ec-3cd47fa5fb0f?maxResults=0&location=US: Unrecognized name: _28d_click at [50:17]

(job ID: 664ae163-bf8f-4212-b5ec-3cd47fa5fb0f)

                                                                     -----Query Job SQL Follows-----                                                                      

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_adplatforms"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_adplatforms`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    
  10:
  11:
  12:
  13:with fb_adplatforms as (
  14:
  15:      
  16:          
  17:          select
  18:          account_name account,
  19:          'Facebook Ads' as platform,
  20:          date_start date,
  21:          campaign_name campaign,
  22:          adset_name group_set,
  23:          ad_name ad,
  24:          objective,
  25:          Concat(publisher_platform,"-",platform_position) as placement,
  26:          spend,
  27:          impressions,
  28:          clicks,
  29:          inline_link_clicks link_clicks,
  30:          sum(_28d_click) as conversions
  31:
  32:          from (
  33:
  34:                select
  35:                
  36:  account_name
  37:, date_start
  38:, campaign_name
  39:, adset_name
  40:, ad_name
  41:, objective
  42:, publisher_platform
  43:, platform_position
  44:, spend
  45:, impressions
  46:, clicks
  47:, inline_link_clicks
  48:, _sdc_sequence
  49:, _sdc_batched_at,
  50:                _28d_click,
  51:               from 
  52:
  53:
  54:
  55:(
  56:	select * from (
  57:
  58:		select 
  59:			*,
  60:			max(_sdc_sequence) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_sequence,
  61:			max(_sdc_batched_at) over (partition by ad_id,adset_id,campaign_id,date_start,publisher_platform,platform_position,impression_device) as most_recent_batch
  62:		from `journeyengine-recipes.fb_ads_quantic.ads_insights_platform_and_device` 
  63:
  64:	) 
  65:	where _sdc_sequence = most_recent_sequence
  66:	and _sdc_batched_at = most_recent_batch
  67:
  68:)
  69:
  70:
  71:               left join unnest(actions)
  72:
  73:               )
  74:
  75:            group by 1,2,3,4,5,6,7,8,9,10,11,12
  76:
  77:                      
  78:                   
  79:
  80:)
  81:
  82:select distinct
  83:  account,
  84:  platform,
  85:  date,
  86:  campaign,
  87:  group_set,
  88:  ad,
  89:  objective,
  90:  placement,
  91:  spend,
  92:  impressions,
  93:  clicks,
  94:  link_clicks,
  95:  conversions
  96:from fb_adplatforms
  97:
  98: 
  99:  );
 100:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
  Unrecognized name: _28d_click at [50:17]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 21:06:51,267775 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dbc2fd0>]}
2020-02-28 21:06:51,630174 (Thread-1): 13:06:51 | 17 of 44 ERROR creating table model agency_data_pipeline.fb_adplatforms [ERROR in 1.82s]
2020-02-28 21:06:51,630504 (Thread-1): Finished running node model.journeyengine_recipes.fb_adplatforms
2020-02-28 21:06:51,630738 (Thread-1): Began running node model.journeyengine_recipes.ga_conversions
2020-02-28 21:06:51,631209 (Thread-1): 13:06:51 | 19 of 44 START table model agency_data_pipeline.ga_conversions....... [RUN]
2020-02-28 21:06:51,631704 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_conversions".
2020-02-28 21:06:51,631858 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_adplatforms).
2020-02-28 21:06:51,632020 (Thread-1): Compiling model.journeyengine_recipes.ga_conversions
2020-02-28 21:06:51,642897 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 21:06:51,643364 (Thread-1): finished collecting timing info
2020-02-28 21:06:51,650905 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_conversions"
2020-02-28 21:06:51,651373 (Thread-1): On model.journeyengine_recipes.ga_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
  
  
  OPTIONS()
  as (
    SELECT 
site,
bigquery_name,
platform,
goal_name,
goal_type,
account,
time_of_entry
FROM `journeyengine-recipes`.`agency_data_pipeline`.`conversion_goals_proc`
WHERE platform = 'Google Analytics'
  );
    
2020-02-28 21:06:52,328530 (Thread-2): finished collecting timing info
2020-02-28 21:06:52,329587 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c30310>]}
2020-02-28 21:06:52,662112 (Thread-4): finished collecting timing info
2020-02-28 21:06:52,663185 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c06b10>]}
2020-02-28 21:06:52,702367 (Thread-2): 13:06:52 | 16 of 44 OK created table model agency_data_pipeline.adwords_adplatforms [CREATE TABLE (10720) in 3.59s]
2020-02-28 21:06:52,703903 (Thread-2): Finished running node model.journeyengine_recipes.adwords_adplatforms
2020-02-28 21:06:52,704304 (Thread-2): Began running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 21:06:52,704747 (Thread-2): 13:06:52 | 20 of 44 START table model agency_data_pipeline.agg_social_platforms_union [RUN]
2020-02-28 21:06:52,705992 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_union".
2020-02-28 21:06:52,706174 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_adplatforms).
2020-02-28 21:06:52,706356 (Thread-2): Compiling model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 21:06:52,723118 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 21:06:52,723869 (Thread-2): finished collecting timing info
2020-02-28 21:06:52,732423 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_union"
2020-02-28 21:06:52,732982 (Thread-2): On model.journeyengine_recipes.agg_social_platforms_union: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_union"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union`
  
  
  OPTIONS()
  as (
    select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`facebook_insights_stats` 

UNION ALL
select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`instagram_insights_stats` 

UNION ALL

select
platform,
account, 
date, 
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`linkedin_company_pages_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`twitter_premium_stats` 

UNION ALL
select
platform,
account, 
date, 
cast (post_image_url as string), 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
from 
`journeyengine-recipes`.`agency_data_pipeline`.`youtube_insights_stats`
  );
    
2020-02-28 21:06:53,65642 (Thread-4): 13:06:53 | 15 of 44 OK created table model agency_data_pipeline.fb_ads_insights. [CREATE TABLE (61042) in 5.71s]
2020-02-28 21:06:53,65899 (Thread-4): Finished running node model.journeyengine_recipes.fb_ads_insights
2020-02-28 21:06:53,66087 (Thread-4): Began running node model.journeyengine_recipes.adwords_join
2020-02-28 21:06:53,66399 (Thread-4): 13:06:53 | 21 of 44 START table model agency_data_pipeline.adwords_join......... [RUN]
2020-02-28 21:06:53,66803 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_join".
2020-02-28 21:06:53,66930 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights).
2020-02-28 21:06:53,67062 (Thread-4): Compiling model.journeyengine_recipes.adwords_join
2020-02-28 21:06:53,80310 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 21:06:53,80916 (Thread-4): finished collecting timing info
2020-02-28 21:06:53,87959 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.adwords_join"
2020-02-28 21:06:53,88925 (Thread-4): On model.journeyengine_recipes.adwords_join: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_join"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
  
  
  OPTIONS()
  as (
    SELECT
day,
a.campaign,
a.campaignid, 
account, 
channel,
platform,
b.url,
cost,
impressions,
clicks,
conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_campaigns` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`adwords_urls` b
ON a.campaignid = b.campaignid
  );
    
2020-02-28 21:06:53,342890 (Thread-3): finished collecting timing info
2020-02-28 21:06:53,343998 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11062d610>]}
2020-02-28 21:06:53,738536 (Thread-3): 13:06:53 | 18 of 44 OK created table model agency_data_pipeline.fb_conversions.. [CREATE TABLE (0) in 2.17s]
2020-02-28 21:06:53,738784 (Thread-3): Finished running node model.journeyengine_recipes.fb_conversions
2020-02-28 21:06:53,738967 (Thread-3): Began running node model.journeyengine_recipes.fb_ads
2020-02-28 21:06:53,739388 (Thread-3): 13:06:53 | 22 of 44 START table model agency_data_pipeline.fb_ads............... [RUN]
2020-02-28 21:06:53,739806 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads".
2020-02-28 21:06:53,739924 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_conversions).
2020-02-28 21:06:53,740052 (Thread-3): Compiling model.journeyengine_recipes.fb_ads
2020-02-28 21:06:53,755875 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:53,858651 (Thread-1): finished collecting timing info
2020-02-28 21:06:53,859707 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106feed0>]}
2020-02-28 21:06:54,223950 (Thread-1): 13:06:54 | 19 of 44 OK created table model agency_data_pipeline.ga_conversions.. [CREATE TABLE (7) in 2.23s]
2020-02-28 21:06:54,224270 (Thread-1): Finished running node model.journeyengine_recipes.ga_conversions
2020-02-28 21:06:54,224509 (Thread-1): Began running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 21:06:54,225038 (Thread-1): 13:06:54 | 23 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_union.... [SKIP]
2020-02-28 21:06:54,225274 (Thread-1): Finished running node model.journeyengine_recipes.agg_adplatforms_union
2020-02-28 21:06:54,225487 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 21:06:54,225950 (Thread-1): 13:06:54 | 24 of 44 START table model agency_data_pipeline.fb_ads_insights_conversions [RUN]
2020-02-28 21:06:54,226462 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.fb_ads_insights_conversions".
2020-02-28 21:06:54,226616 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.ga_conversions).
2020-02-28 21:06:54,226777 (Thread-1): Compiling model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 21:06:54,250079 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Facebook Ads'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:54,828784 (Thread-2): finished collecting timing info
2020-02-28 21:06:54,829851 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c065d0>]}
2020-02-28 21:06:55,98203 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 21:06:55,98877 (Thread-3): finished collecting timing info
2020-02-28 21:06:55,106116 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads"
2020-02-28 21:06:55,106991 (Thread-3): On model.journeyengine_recipes.fb_ads: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative`





with fb_ads as (

	    
		   	SELECT 
			id ad_id,
			creative.id creative_id
			FROM  



(
	select * from (

		select 
			*,
			max(_sdc_sequence) over (partition by id) as most_recent_sequence,
			max(_sdc_batched_at) over (partition by id) as most_recent_batch
		from `journeyengine-recipes.fb_ads_quantic.ads` 

	) 
	where _sdc_sequence = most_recent_sequence
	and _sdc_batched_at = most_recent_batch

)


		     
	   

)

SELECT
a.ad_id,
b.creative_id,
b.url
FROM (
    SELECT
    ad_id,
    creative_id,
    FROM fb_ads
    ) a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`fb_adcreative` b
ON (
	a.creative_id = b.creative_id 
)


  );
    
2020-02-28 21:06:55,194462 (Thread-2): 13:06:55 | 20 of 44 OK created table model agency_data_pipeline.agg_social_platforms_union [CREATE TABLE (836) in 2.12s]
2020-02-28 21:06:55,194827 (Thread-2): Finished running node model.journeyengine_recipes.agg_social_platforms_union
2020-02-28 21:06:55,195062 (Thread-2): Began running node model.journeyengine_recipes.ga_proc
2020-02-28 21:06:55,195301 (Thread-2): 13:06:55 | 25 of 44 START table model agency_data_pipeline.ga_proc.............. [RUN]
2020-02-28 21:06:55,196186 (Thread-2): Acquiring new bigquery connection "model.journeyengine_recipes.ga_proc".
2020-02-28 21:06:55,196396 (Thread-2): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_union).
2020-02-28 21:06:55,196603 (Thread-2): Compiling model.journeyengine_recipes.ga_proc
2020-02-28 21:06:55,231191 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            bigquery_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc`
        where bigquery_name is not null
        and bigquery_name != ''

        
        ##where 1 = 1
        and platform = 'Google Analytics'
        
        
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:55,505306 (Thread-4): finished collecting timing info
2020-02-28 21:06:55,507583 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d62e50>]}
2020-02-28 21:06:55,903934 (Thread-4): 13:06:55 | 21 of 44 OK created table model agency_data_pipeline.adwords_join.... [CREATE TABLE (1555) in 2.44s]
2020-02-28 21:06:55,904303 (Thread-4): Finished running node model.journeyengine_recipes.adwords_join
2020-02-28 21:06:55,905558 (Thread-4): Began running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 21:06:55,905822 (Thread-4): 13:06:55 | 26 of 44 SKIP relation agency_data_pipeline.agg_adplatforms_site..... [SKIP]
2020-02-28 21:06:55,906267 (Thread-4): Finished running node model.journeyengine_recipes.agg_adplatforms_site
2020-02-28 21:06:55,906547 (Thread-4): Began running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 21:06:55,909337 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Lead'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:55,909766 (Thread-4): 13:06:55 | 27 of 44 START table model agency_data_pipeline.agg_social_platforms_site [RUN]
2020-02-28 21:06:55,911419 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.agg_social_platforms_site".
2020-02-28 21:06:55,911653 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_join).
2020-02-28 21:06:55,911825 (Thread-4): Compiling model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 21:06:55,924147 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 21:06:55,925079 (Thread-4): finished collecting timing info
2020-02-28 21:06:55,932876 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.agg_social_platforms_site"
2020-02-28 21:06:55,933671 (Thread-4): On model.journeyengine_recipes.agg_social_platforms_site: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.agg_social_platforms_site"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  
  
  OPTIONS()
  as (
    SELECT 
date, 
a.account account, 
b.site site,
a.platform platform,
post_image_url, 
post_url, 
post_text,
impressions, 
reactions, 
comments, 
shares,
link_clicks
FROM 
  `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_union` a
LEFT JOIN 
  `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b
ON ( 
  a.account = b.account AND
  a.platform = b.platform
)
  );
    
2020-02-28 21:06:56,565792 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'MQL'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:57,56552 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 21:06:57,218528 (Thread-1): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 21:06:57,219229 (Thread-1): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 21:06:57,219742 (Thread-1): Actual dataset: fb_ads_quantic
2020-02-28 21:06:57,398174 (Thread-1): Actual columns: [<BigQueryColumn action_values (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn ad_name (STRING, NULLABLE)>, <BigQueryColumn impressions (INT64, NULLABLE)>, <BigQueryColumn campaign_id (STRING, NULLABLE)>, <BigQueryColumn account_name (STRING, NULLABLE)>, <BigQueryColumn campaign_name (STRING, NULLABLE)>, <BigQueryColumn clicks (INT64, NULLABLE)>, <BigQueryColumn adset_id (STRING, NULLABLE)>, <BigQueryColumn ad_id (STRING, NULLABLE)>, <BigQueryColumn reach (INT64, NULLABLE)>, <BigQueryColumn _sdc_table_version (INT64, NULLABLE)>, <BigQueryColumn inline_link_clicks (INT64, NULLABLE)>, <BigQueryColumn objective (STRING, NULLABLE)>, <BigQueryColumn _sdc_received_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_sequence (INT64, NULLABLE)>, <BigQueryColumn adset_name (STRING, NULLABLE)>, <BigQueryColumn spend (FLOAT64, NULLABLE)>, <BigQueryColumn account_id (STRING, NULLABLE)>, <BigQueryColumn _sdc_batched_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn _sdc_extracted_at (TIMESTAMP, NULLABLE)>, <BigQueryColumn date_stop (TIMESTAMP, NULLABLE)>, <BigQueryColumn actions (ARRAY<STRUCT<value STRUCT<_7d_view FLOAT64, _7d_click FLOAT64, _28d_view FLOAT64, value FLOAT64, _28d_click FLOAT64, _1d_click FLOAT64, action_target_id STRING, action_type STRING, action_destination STRING, _1d_view FLOAT64>>>, REPEATED)>, <BigQueryColumn date_start (TIMESTAMP, NULLABLE)>]
2020-02-28 21:06:57,398850 (Thread-1): Actual column names: ['action_values', 'ad_name', 'impressions', 'campaign_id', 'account_name', 'campaign_name', 'clicks', 'adset_id', 'ad_id', 'reach', '_sdc_table_version', 'inline_link_clicks', 'objective', '_sdc_received_at', '_sdc_sequence', 'adset_name', 'spend', 'account_id', '_sdc_batched_at', '_sdc_extracted_at', 'date_stop', 'actions', 'date_start']
2020-02-28 21:06:57,402064 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 21:06:57,402679 (Thread-1): finished collecting timing info
2020-02-28 21:06:57,410596 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.fb_ads_insights_conversions"
2020-02-28 21:06:57,411063 (Thread-1): On model.journeyengine_recipes.fb_ads_insights_conversions: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 21:06:57,738338 (Thread-3): finished collecting timing info
2020-02-28 21:06:57,739400 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e18190>]}
2020-02-28 21:06:57,890313 (Thread-1): Not Retrying after 0 previous attempts. Error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/db96c259-570d-402e-9b17-4044f334896b?maxResults=0&location=US: Unrecognized name: action_type at [29:25]')
2020-02-28 21:06:57,890575 (Thread-1): Bad request while running:
/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`





with fb_ads_insights_conversions as (

	    

	    	

		   	SELECT
		   	
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			_28d_click conversions,
			null as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)

			## goal completion columns
			
			
			UNION ALL

		   	SELECT 
			
  date_start
, campaign_id
, campaign_name
, ad_id
, account_name
, _sdc_sequence,
			action_type,
			null as conversions,
			_28d_click as revenue
			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
			cross join unnest(actions)
			
			## goal completion columns
			

		    
	   

)

SELECT 
date,
campaign_id,
campaign,
ad_id,
account,
sum(conversions) conversions,
sum(revenue) revenue
FROM 
		(
	    SELECT
	    date_start date,
	    campaign_id,
	    campaign_name campaign,
	    ad_id,
	    account_name account,
	    action_type,
	    conversions,
	    revenue,
	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
	    _sdc_sequence
	    FROM fb_ads_insights_conversions
	   	)
where lv = _sdc_sequence
group by date, campaign_id, campaign, ad_id, account



  );
    
2020-02-28 21:06:57,890741 (Thread-1): 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/db96c259-570d-402e-9b17-4044f334896b?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: db96c259-570d-402e-9b17-4044f334896b)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2020-02-28 21:06:57,890971 (Thread-1): finished collecting timing info
2020-02-28 21:06:57,891657 (Thread-1): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 81, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 208, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 331, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3124, in result
    super(QueryJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 779, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3037, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3024, in done
    location=self.location,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1112, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 487, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 421, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/journeyengine-recipes/queries/db96c259-570d-402e-9b17-4044f334896b?maxResults=0&location=US: Unrecognized name: action_type at [29:25]

(job ID: db96c259-570d-402e-9b17-4044f334896b)

                                                                            -----Query Job SQL Follows-----                                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.fb_ads_insights_conversions"} */
   2:
   3:
   4:  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`fb_ads_insights_conversions`
   5:  
   6:  
   7:  OPTIONS()
   8:  as (
   9:    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`fb_conversions`
  10:
  11:
  12:
  13:
  14:
  15:with fb_ads_insights_conversions as (
  16:
  17:	    
  18:
  19:	    	
  20:
  21:		   	SELECT
  22:		   	
  23:  date_start
  24:, campaign_id
  25:, campaign_name
  26:, ad_id
  27:, account_name
  28:, _sdc_sequence,
  29:			action_type,
  30:			_28d_click conversions,
  31:			null as revenue
  32:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  33:			cross join unnest(actions)
  34:
  35:			## goal completion columns
  36:			
  37:			
  38:			UNION ALL
  39:
  40:		   	SELECT 
  41:			
  42:  date_start
  43:, campaign_id
  44:, campaign_name
  45:, ad_id
  46:, account_name
  47:, _sdc_sequence,
  48:			action_type,
  49:			null as conversions,
  50:			_28d_click as revenue
  51:			FROM `journeyengine-recipes.fb_ads_quantic.ads_insights`
  52:			cross join unnest(actions)
  53:			
  54:			## goal completion columns
  55:			
  56:
  57:		    
  58:	   
  59:
  60:)
  61:
  62:SELECT 
  63:date,
  64:campaign_id,
  65:campaign,
  66:ad_id,
  67:account,
  68:sum(conversions) conversions,
  69:sum(revenue) revenue
  70:FROM 
  71:		(
  72:	    SELECT
  73:	    date_start date,
  74:	    campaign_id,
  75:	    campaign_name campaign,
  76:	    ad_id,
  77:	    account_name account,
  78:	    action_type,
  79:	    conversions,
  80:	    revenue,
  81:	    first_value(_sdc_sequence) OVER (PARTITION BY ad_id, date_start ORDER BY _sdc_sequence DESC) lv,
  82:	    _sdc_sequence
  83:	    FROM fb_ads_insights_conversions
  84:	   	)
  85:where lv = _sdc_sequence
  86:group by date, campaign_id, campaign, ad_id, account
  87:
  88:
  89:
  90:  );
  91:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 218, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 161, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 260, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 436, in execute
    result = materialization_macro.generator(context)()
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 209, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 155, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 276, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 217, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 210, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 342, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 85, in exception_handler
    self.handle_error(e, message, sql)
  File "/usr/local/Cellar/dbt/0.15.2_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 73, in handle_error
    raise dbt.exceptions.DatabaseException(error_msg) from error
dbt.exceptions.DatabaseException: Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
  Unrecognized name: action_type at [29:25]
  compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 21:06:57,892752 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106df910>]}
2020-02-28 21:06:57,912432 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Subscriber'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:58,102382 (Thread-3): 13:06:58 | 22 of 44 OK created table model agency_data_pipeline.fb_ads.......... [CREATE TABLE (7894) in 4.00s]
2020-02-28 21:06:58,103827 (Thread-3): Finished running node model.journeyengine_recipes.fb_ads
2020-02-28 21:06:58,104171 (Thread-3): Began running node model.journeyengine_recipes.adwords_stats
2020-02-28 21:06:58,104541 (Thread-3): 13:06:58 | 28 of 44 START table model agency_data_pipeline.adwords_stats........ [RUN]
2020-02-28 21:06:58,105015 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.adwords_stats".
2020-02-28 21:06:58,105478 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads).
2020-02-28 21:06:58,105989 (Thread-3): Compiling model.journeyengine_recipes.adwords_stats
2020-02-28 21:06:58,119092 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 21:06:58,119707 (Thread-3): finished collecting timing info
2020-02-28 21:06:58,127068 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.adwords_stats"
2020-02-28 21:06:58,127589 (Thread-3): On model.journeyengine_recipes.adwords_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.adwords_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`adwords_stats`
  
  
  OPTIONS()
  as (
    SELECT 
cast(day as date) date, 
account, 
platform,
channel,
url,
campaign,
sum(cost) cost,
sum(impressions) impressions,
sum(clicks) clicks,
sum(conversions) conversions
FROM `journeyengine-recipes`.`agency_data_pipeline`.`adwords_join`
GROUP BY date, account, platform, channel, url, campaign
  );
    
2020-02-28 21:06:58,484731 (Thread-1): 13:06:58 | 24 of 44 ERROR creating table model agency_data_pipeline.fb_ads_insights_conversions [ERROR in 3.67s]
2020-02-28 21:06:58,485034 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_insights_conversions
2020-02-28 21:06:58,485271 (Thread-1): Began running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 21:06:58,485991 (Thread-1): 13:06:58 | 29 of 44 SKIP relation agency_data_pipeline.adplatform_cost_calculations [SKIP]
2020-02-28 21:06:58,486370 (Thread-1): Finished running node model.journeyengine_recipes.adplatform_cost_calculations
2020-02-28 21:06:58,486595 (Thread-1): Began running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 21:06:58,486910 (Thread-1): 13:06:58 | 30 of 44 SKIP relation agency_data_pipeline.fb_ads_stats............. [SKIP]
2020-02-28 21:06:58,487242 (Thread-1): Finished running node model.journeyengine_recipes.fb_ads_stats
2020-02-28 21:06:58,487452 (Thread-1): Began running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 21:06:58,487739 (Thread-1): 13:06:58 | 31 of 44 SKIP relation agency_data_pipeline.ad_platform_viz.......... [SKIP]
2020-02-28 21:06:58,487939 (Thread-1): Finished running node model.journeyengine_recipes.ad_platform_viz
2020-02-28 21:06:59,10044 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Exclude'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:06:59,433181 (Thread-4): finished collecting timing info
2020-02-28 21:06:59,434238 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106e70d0>]}
2020-02-28 21:06:59,793591 (Thread-4): 13:06:59 | 27 of 44 OK created table model agency_data_pipeline.agg_social_platforms_site [CREATE TABLE (836) in 3.52s]
2020-02-28 21:06:59,793894 (Thread-4): Finished running node model.journeyengine_recipes.agg_social_platforms_site
2020-02-28 21:06:59,794493 (Thread-1): Began running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 21:06:59,794689 (Thread-4): Began running node model.journeyengine_recipes.social_post_viz
2020-02-28 21:06:59,794944 (Thread-1): 13:06:59 | 32 of 44 START table model agency_data_pipeline.social_platform_by_month [RUN]
2020-02-28 21:06:59,795180 (Thread-4): 13:06:59 | 33 of 44 START table model agency_data_pipeline.social_post_viz...... [RUN]
2020-02-28 21:06:59,795768 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_by_month".
2020-02-28 21:06:59,797004 (Thread-4): Acquiring new bigquery connection "model.journeyengine_recipes.social_post_viz".
2020-02-28 21:06:59,797657 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.fb_ads_insights_conversions).
2020-02-28 21:06:59,798435 (Thread-4): Re-using an available connection from the pool (formerly model.journeyengine_recipes.agg_social_platforms_site).
2020-02-28 21:06:59,798679 (Thread-1): Compiling model.journeyengine_recipes.social_platform_by_month
2020-02-28 21:06:59,798852 (Thread-4): Compiling model.journeyengine_recipes.social_post_viz
2020-02-28 21:06:59,808999 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 21:06:59,821810 (Thread-4): Writing injected SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 21:06:59,822455 (Thread-1): finished collecting timing info
2020-02-28 21:06:59,822760 (Thread-4): finished collecting timing info
2020-02-28 21:06:59,830474 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_by_month"
2020-02-28 21:06:59,840088 (Thread-4): Writing runtime SQL for node "model.journeyengine_recipes.social_post_viz"
2020-02-28 21:06:59,840570 (Thread-1): On model.journeyengine_recipes.social_platform_by_month: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_by_month"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm, 
site,
platform,
posts,
impressions, 
reactions, 
comments, 
shares,
link_clicks,
sum(impressions/posts) OVER w1 impressions_per_post,
sum(reactions/posts) OVER w1 applause_rate,
sum(comments/posts) OVER w1 conversation_rate,
sum(comments/posts) OVER w1 amplification_rate,
sum(link_clicks/posts) OVER w1 clicks_per_post

FROM (
    SELECT 
    FORMAT_DATE("%Y-%m", date) AS yyyymm,
    site,
    platform, 
    sum(impressions) impressions,
    sum(reactions) reactions,
    sum(comments) comments,
    sum(shares) shares,
    sum(link_clicks) link_clicks,
    count(post_url) as posts
	FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
    GROUP BY yyyymm, site, platform
    )
 WINDOW w1 as (PARTITION BY yyyymm, site)
  );
    
2020-02-28 21:06:59,841940 (Thread-4): On model.journeyengine_recipes.social_post_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_post_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_post_viz`
  
  
  OPTIONS()
  as (
    SELECT 
date,
site,
platform,
ifnull(post_image_url,'') ImageURL, 
ifnull(post_url,'') PostURL,
ifnull(post_text,'') PostText,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions, 
ifnull(comments, 0) Comments, 
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks
FROM `journeyengine-recipes`.`agency_data_pipeline`.`agg_social_platforms_site`
  );
    
2020-02-28 21:07:00,108230 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


        select
            goal_name as value

        from `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`
        where goal_name is not null
        and goal_name != ''

        
        ##where 1 = 1
        and goal_type = 'Other'
        
        
        
        ##and 2 = 2
        and bigquery_name = 'quantic'
        

        group by 1
        order by count(*) desc

        
        limit 50
        
2020-02-28 21:07:00,191065 (Thread-3): finished collecting timing info
2020-02-28 21:07:00,191917 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bfdcd0>]}
2020-02-28 21:07:00,558255 (Thread-3): 13:07:00 | 28 of 44 OK created table model agency_data_pipeline.adwords_stats... [CREATE TABLE (1555) in 2.09s]
2020-02-28 21:07:00,558563 (Thread-3): Finished running node model.journeyengine_recipes.adwords_stats
2020-02-28 21:07:00,559101 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 21:07:00,559344 (Thread-3): 13:07:00 | 34 of 44 SKIP relation agency_data_pipeline.agg_platforms_union...... [SKIP]
2020-02-28 21:07:00,559548 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_union
2020-02-28 21:07:00,560051 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 21:07:00,560263 (Thread-3): 13:07:00 | 35 of 44 SKIP relation agency_data_pipeline.agg_platforms_site....... [SKIP]
2020-02-28 21:07:00,560458 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_site
2020-02-28 21:07:01,462976 (Thread-2): Writing injected SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 21:07:01,463724 (Thread-2): finished collecting timing info
2020-02-28 21:07:01,471914 (Thread-2): Writing runtime SQL for node "model.journeyengine_recipes.ga_proc"
2020-02-28 21:07:01,472426 (Thread-2): On model.journeyengine_recipes.ga_proc: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_proc"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc`
  
  
  OPTIONS()
  as (
    -- depends_on: `journeyengine-recipes`.`agency_data_pipeline`.`ga_conversions`




with ga_report as (

	    

	    	
	    	
	    	
	    	

		   	SELECT
		   	'quantic' as bigquery_name,
		   	'Google Analytics' as lookup_platform,
			lower(trim(regexp_replace(replace(replace(replace(replace(CONCAT(hostname,landingpagepath),'www.',''),'http://',''),'https://',''),'.html',''),r'\?.*$',''),'/')) as url,
			date,
			lower(source) source,
			lower(medium) medium,
			sessions,
			goalcompletionsall goal_completions,
			## goal completion columns
							
				null as mqls,		
			
							
				null as subscribers,		
						
							
				null as excluded,		
					
							
				null as other,		
						
			_sdc_sequence,
			first_value(_sdc_sequence) OVER (PARTITION BY hostname, landingpagepath, date, source, medium ORDER BY _sdc_sequence DESC) lv
			FROM `journeyengine-recipes.ga_quantic.report` 

		    
	   

)


SELECT 
bigquery_name,
lookup_platform,
date,
url,
source,
medium,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(excluded) excluded,
sum(other) other
FROM ga_report
where lv = _sdc_sequence
group by bigquery_name, lookup_platform, date, url, source, medium


  );
    
2020-02-28 21:07:01,968633 (Thread-4): finished collecting timing info
2020-02-28 21:07:01,969698 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e2ef10>]}
2020-02-28 21:07:02,328856 (Thread-4): 13:07:02 | 33 of 44 OK created table model agency_data_pipeline.social_post_viz. [CREATE TABLE (836) in 2.17s]
2020-02-28 21:07:02,329161 (Thread-4): Finished running node model.journeyengine_recipes.social_post_viz
2020-02-28 21:07:02,578848 (Thread-1): finished collecting timing info
2020-02-28 21:07:02,579972 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110983050>]}
2020-02-28 21:07:02,953371 (Thread-1): 13:07:02 | 32 of 44 OK created table model agency_data_pipeline.social_platform_by_month [CREATE TABLE (56) in 2.78s]
2020-02-28 21:07:02,953734 (Thread-1): Finished running node model.journeyengine_recipes.social_platform_by_month
2020-02-28 21:07:02,954325 (Thread-3): Began running node model.journeyengine_recipes.social_platform_viz
2020-02-28 21:07:02,954646 (Thread-3): 13:07:02 | 36 of 44 START table model agency_data_pipeline.social_platform_viz.. [RUN]
2020-02-28 21:07:02,955215 (Thread-3): Acquiring new bigquery connection "model.journeyengine_recipes.social_platform_viz".
2020-02-28 21:07:02,955400 (Thread-3): Re-using an available connection from the pool (formerly model.journeyengine_recipes.adwords_stats).
2020-02-28 21:07:02,955595 (Thread-3): Compiling model.journeyengine_recipes.social_platform_viz
2020-02-28 21:07:02,966994 (Thread-3): Writing injected SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 21:07:02,967489 (Thread-3): finished collecting timing info
2020-02-28 21:07:02,975453 (Thread-3): Writing runtime SQL for node "model.journeyengine_recipes.social_platform_viz"
2020-02-28 21:07:02,975921 (Thread-3): On model.journeyengine_recipes.social_platform_viz: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.social_platform_viz"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_viz`
  
  
  OPTIONS()
  as (
    SELECT
yyyymm Month, 
site Site,
platform Platform,
ifnull(posts, 0) Posts,
ifnull(impressions, 0) Impressions,
ifnull(reactions, 0) Reactions,
ifnull(comments, 0) Comments,
ifnull(shares, 0) Shares,
ifnull(link_clicks, 0) LinkClicks,
round(ifnull(impressions_per_post,0),0) ImpressionsPerPost,
round(ifnull(applause_rate, 0),0) ApplauseRate,
round(ifnull(conversation_rate, 0),0) ConversationRate,
round(ifnull(amplification_rate, 0),0) AmplificationRate,
round(ifnull(clicks_per_post, 0),0) ClicksPerPost
FROM `journeyengine-recipes`.`agency_data_pipeline`.`social_platform_by_month`
  );
    
2020-02-28 21:07:05,63229 (Thread-3): finished collecting timing info
2020-02-28 21:07:05,64290 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110edc750>]}
2020-02-28 21:07:05,437825 (Thread-3): 13:07:05 | 36 of 44 OK created table model agency_data_pipeline.social_platform_viz [CREATE TABLE (56) in 2.11s]
2020-02-28 21:07:05,438169 (Thread-3): Finished running node model.journeyengine_recipes.social_platform_viz
2020-02-28 21:07:15,228926 (Thread-2): finished collecting timing info
2020-02-28 21:07:15,229995 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d27d10>]}
2020-02-28 21:07:15,618299 (Thread-2): 13:07:15 | 25 of 44 OK created table model agency_data_pipeline.ga_proc......... [CREATE TABLE (699111) in 20.03s]
2020-02-28 21:07:15,618667 (Thread-2): Finished running node model.journeyengine_recipes.ga_proc
2020-02-28 21:07:15,619210 (Thread-1): Began running node model.journeyengine_recipes.ga_stats
2020-02-28 21:07:15,619475 (Thread-1): 13:07:15 | 37 of 44 START table model agency_data_pipeline.ga_stats............. [RUN]
2020-02-28 21:07:15,619952 (Thread-1): Acquiring new bigquery connection "model.journeyengine_recipes.ga_stats".
2020-02-28 21:07:15,620101 (Thread-1): Re-using an available connection from the pool (formerly model.journeyengine_recipes.social_platform_by_month).
2020-02-28 21:07:15,620260 (Thread-1): Compiling model.journeyengine_recipes.ga_stats
2020-02-28 21:07:15,635032 (Thread-1): Writing injected SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 21:07:15,635605 (Thread-1): finished collecting timing info
2020-02-28 21:07:15,642101 (Thread-1): Writing runtime SQL for node "model.journeyengine_recipes.ga_stats"
2020-02-28 21:07:15,642566 (Thread-1): On model.journeyengine_recipes.ga_stats: /* {"app": "dbt", "dbt_version": "0.15.2", "profile_name": "journey-data-pipeline", "target_name": "dev", "node_id": "model.journeyengine_recipes.ga_stats"} */


  create or replace table `journeyengine-recipes`.`agency_data_pipeline`.`ga_stats`
  
  
  OPTIONS()
  as (
    SELECT  
cast(date as date) date,
b.account,
b.site site,
c.source source,
c.medium medium,
concat(a.source, ' / ', a.medium) source_medium,  
case when c.platform is null then "Unmapped" else c.platform end as platform,
case when c.channel is null then "Unmapped" else c.channel end as channel,
url,
sum(sessions) sessions,
sum(goal_completions) goal_completions,
sum(mqls) mqls,
sum(subscribers) subscribers,
sum(other) other,
sum(excluded) excluded
FROM `journeyengine-recipes`.`agency_data_pipeline`.`ga_proc` a
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`accounts_proc` b 
ON ( a.bigquery_name = b.bigquery_name 
	AND a.lookup_platform = b.platform )
LEFT JOIN `journeyengine-recipes`.`agency_data_pipeline`.`mappings_ga_proc` c
ON ( a.source = c.source
  AND a.medium = c.medium 
  AND a.bigquery_name = c.bigquery_name )
GROUP BY date, account, site, source, medium, source_medium, platform, channel, url
  );
    
2020-02-28 21:07:27,624859 (Thread-1): finished collecting timing info
2020-02-28 21:07:27,626000 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd38ab70-106b-4f84-84fa-ef6f6ef9713e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e001d0>]}
2020-02-28 21:07:27,989146 (Thread-1): 13:07:27 | 37 of 44 OK created table model agency_data_pipeline.ga_stats........ [CREATE TABLE (699111) in 12.01s]
2020-02-28 21:07:27,989474 (Thread-1): Finished running node model.journeyengine_recipes.ga_stats
2020-02-28 21:07:27,990097 (Thread-3): Began running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 21:07:27,990413 (Thread-3): 13:07:27 | 38 of 44 SKIP relation agency_data_pipeline.agg_platforms_ga......... [SKIP]
2020-02-28 21:07:27,990637 (Thread-3): Finished running node model.journeyengine_recipes.agg_platforms_ga
2020-02-28 21:07:27,991176 (Thread-4): Began running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 21:07:27,991365 (Thread-1): Began running node model.journeyengine_recipes.platform_by_month
2020-02-28 21:07:27,991610 (Thread-4): 13:07:27 | 39 of 44 SKIP relation agency_data_pipeline.landing_page_by_month.... [SKIP]
2020-02-28 21:07:27,991844 (Thread-1): 13:07:27 | 40 of 44 SKIP relation agency_data_pipeline.platform_by_month........ [SKIP]
2020-02-28 21:07:27,992175 (Thread-4): Finished running node model.journeyengine_recipes.landing_page_by_month
2020-02-28 21:07:27,992447 (Thread-1): Finished running node model.journeyengine_recipes.platform_by_month
2020-02-28 21:07:27,993062 (Thread-3): Began running node model.journeyengine_recipes.landing_page_index
2020-02-28 21:07:27,993411 (Thread-4): Began running node model.journeyengine_recipes.platform_index
2020-02-28 21:07:27,993622 (Thread-3): 13:07:27 | 41 of 44 SKIP relation agency_data_pipeline.landing_page_index....... [SKIP]
2020-02-28 21:07:27,993833 (Thread-4): 13:07:27 | 42 of 44 SKIP relation agency_data_pipeline.platform_index........... [SKIP]
2020-02-28 21:07:27,994068 (Thread-3): Finished running node model.journeyengine_recipes.landing_page_index
2020-02-28 21:07:27,994272 (Thread-4): Finished running node model.journeyengine_recipes.platform_index
2020-02-28 21:07:27,994804 (Thread-2): Began running node model.journeyengine_recipes.landing_page_viz
2020-02-28 21:07:27,994970 (Thread-1): Began running node model.journeyengine_recipes.platform_viz
2020-02-28 21:07:27,995142 (Thread-2): 13:07:27 | 43 of 44 SKIP relation agency_data_pipeline.landing_page_viz......... [SKIP]
2020-02-28 21:07:27,995344 (Thread-1): 13:07:27 | 44 of 44 SKIP relation agency_data_pipeline.platform_viz............. [SKIP]
2020-02-28 21:07:27,995576 (Thread-2): Finished running node model.journeyengine_recipes.landing_page_viz
2020-02-28 21:07:27,995800 (Thread-1): Finished running node model.journeyengine_recipes.platform_viz
2020-02-28 21:07:28,55329 (MainThread): 13:07:28 | 
2020-02-28 21:07:28,55667 (MainThread): 13:07:28 | Finished running 44 table models in 53.36s.
2020-02-28 21:07:28,55864 (MainThread): Connection 'master' was left open.
2020-02-28 21:07:28,56080 (MainThread): Connection 'model.journeyengine_recipes.ga_stats' was left open.
2020-02-28 21:07:28,56241 (MainThread): Connection 'model.journeyengine_recipes.ga_proc' was left open.
2020-02-28 21:07:28,56384 (MainThread): Connection 'model.journeyengine_recipes.social_platform_viz' was left open.
2020-02-28 21:07:28,56523 (MainThread): Connection 'model.journeyengine_recipes.social_post_viz' was left open.
2020-02-28 21:07:28,206696 (MainThread): 
2020-02-28 21:07:28,207096 (MainThread): Completed with 2 errors and 0 warnings:
2020-02-28 21:07:28,207344 (MainThread): 
2020-02-28 21:07:28,207586 (MainThread): Database Error in model fb_adplatforms (models/base/fb-ads/fb_adplatforms.sql)
2020-02-28 21:07:28,207820 (MainThread):   Unrecognized name: _28d_click at [50:17]
2020-02-28 21:07:28,208029 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_adplatforms.sql
2020-02-28 21:07:28,208246 (MainThread): 
2020-02-28 21:07:28,208466 (MainThread): Database Error in model fb_ads_insights_conversions (models/base/fb-ads/fb_ads_insights_conversions.sql)
2020-02-28 21:07:28,208691 (MainThread):   Unrecognized name: action_type at [29:25]
2020-02-28 21:07:28,208903 (MainThread):   compiled SQL at target/run/journeyengine_recipes/base/fb-ads/fb_ads_insights_conversions.sql
2020-02-28 21:07:28,209173 (MainThread): 
Done. PASS=42 WARN=0 ERROR=2 SKIP=0 TOTAL=44
2020-02-28 21:07:28,209682 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11062de90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dd3210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11078aa50>]}
2020-02-28 21:07:28,596367 (MainThread): Flushing usage events
